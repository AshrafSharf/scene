var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Vector3D = require("awayjs-core/lib/geom/Vector3D");
var LookAtController = require("awayjs-display/lib/controllers/LookAtController");
/**
 * Uses spring physics to animate the target object towards a position that is
 * defined as the lookAtTarget object's position plus the vector defined by the
 * positionOffset property.
 */
var SpringController = (function (_super) {
    __extends(SpringController, _super);
    function SpringController(targetObject, lookAtObject, stiffness, mass, damping) {
        if (targetObject === void 0) { targetObject = null; }
        if (lookAtObject === void 0) { lookAtObject = null; }
        if (stiffness === void 0) { stiffness = 1; }
        if (mass === void 0) { mass = 40; }
        if (damping === void 0) { damping = 4; }
        _super.call(this, targetObject, lookAtObject);
        /**
         * Offset of spring center from target in target object space, ie: Where the camera should ideally be in the target object space.
         */
        this.positionOffset = new Vector3D(0, 500, -1000);
        this.stiffness = stiffness;
        this.damping = damping;
        this.mass = mass;
        this._velocity = new Vector3D();
        this._dv = new Vector3D();
        this._stretch = new Vector3D();
        this._force = new Vector3D();
        this._acceleration = new Vector3D();
        this._desiredPosition = new Vector3D();
    }
    SpringController.prototype.update = function (interpolate) {
        if (interpolate === void 0) { interpolate = true; }
        var offs;
        if (!this._pLookAtObject || !this._pTargetObject)
            return;
        offs = this._pLookAtObject.transform.matrix3D.deltaTransformVector(this.positionOffset);
        this._desiredPosition.x = this._pLookAtObject.x + offs.x;
        this._desiredPosition.y = this._pLookAtObject.y + offs.y;
        this._desiredPosition.z = this._pLookAtObject.z + offs.z;
        this._stretch = this._pTargetObject.transform.position.add(this._desiredPosition);
        this._stretch.scaleBy(-this.stiffness);
        this._dv.copyFrom(this._velocity);
        this._dv.scaleBy(this.damping);
        this._force.x = this._stretch.x - this._dv.x;
        this._force.y = this._stretch.y - this._dv.y;
        this._force.z = this._stretch.z - this._dv.z;
        this._acceleration.copyFrom(this._force);
        this._acceleration.scaleBy(1 / this.mass);
        this._velocity.incrementBy(this._acceleration);
        this._pTargetObject.transform.position = this._pTargetObject.transform.position.add(this._velocity);
        _super.prototype.update.call(this);
    };
    return SpringController;
})(LookAtController);
module.exports = SpringController;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1kaXNwbGF5L2xpYi9jb250cm9sbGVycy9zcHJpbmdjb250cm9sbGVyLnRzIl0sIm5hbWVzIjpbIlNwcmluZ0NvbnRyb2xsZXIiLCJTcHJpbmdDb250cm9sbGVyLmNvbnN0cnVjdG9yIiwiU3ByaW5nQ29udHJvbGxlci51cGRhdGUiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLElBQU8sUUFBUSxXQUFlLCtCQUErQixDQUFDLENBQUM7QUFHL0QsSUFBTyxnQkFBZ0IsV0FBYSxpREFBaUQsQ0FBQyxDQUFDO0FBRXZGLEFBS0E7Ozs7R0FERztJQUNHLGdCQUFnQjtJQUFTQSxVQUF6QkEsZ0JBQWdCQSxVQUF5QkE7SUErQjlDQSxTQS9CS0EsZ0JBQWdCQSxDQStCVEEsWUFBaUNBLEVBQUVBLFlBQWlDQSxFQUFFQSxTQUFvQkEsRUFBRUEsSUFBZ0JBLEVBQUVBLE9BQWtCQTtRQUFoSUMsNEJBQWlDQSxHQUFqQ0EsbUJBQWlDQTtRQUFFQSw0QkFBaUNBLEdBQWpDQSxtQkFBaUNBO1FBQUVBLHlCQUFvQkEsR0FBcEJBLGFBQW9CQTtRQUFFQSxvQkFBZ0JBLEdBQWhCQSxTQUFnQkE7UUFBRUEsdUJBQWtCQSxHQUFsQkEsV0FBa0JBO1FBRTNJQSxrQkFBTUEsWUFBWUEsRUFBRUEsWUFBWUEsQ0FBQ0EsQ0FBQ0E7UUFQbkNBOztXQUVHQTtRQUNJQSxtQkFBY0EsR0FBWUEsSUFBSUEsUUFBUUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsR0FBR0EsRUFBRUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFNNURBLElBQUlBLENBQUNBLFNBQVNBLEdBQUdBLFNBQVNBLENBQUNBO1FBQzNCQSxJQUFJQSxDQUFDQSxPQUFPQSxHQUFHQSxPQUFPQSxDQUFDQTtRQUN2QkEsSUFBSUEsQ0FBQ0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFFakJBLElBQUlBLENBQUNBLFNBQVNBLEdBQUdBLElBQUlBLFFBQVFBLEVBQUVBLENBQUNBO1FBQ2hDQSxJQUFJQSxDQUFDQSxHQUFH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LENBQUNBO1FBRS9DQSxJQUFJQSxDQUFDQSxjQUFjQSxDQUFDQSxTQUFTQSxDQUFDQSxRQUFRQSxHQUFHQSxJQUFJQSxDQUFDQSxjQUFjQSxDQUFDQSxTQUFTQSxDQUFDQSxRQUFRQSxDQUFDQSxHQUFHQSxDQUFDQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQTtRQUVwR0EsZ0JBQUtBLENBQUNBLE1BQU1BLFdBQUVBLENBQUNBO0lBQ2hCQSxDQUFDQTtJQUNGRix1QkFBQ0E7QUFBREEsQ0EvRUEsQUErRUNBLEVBL0U4QixnQkFBZ0IsRUErRTlDO0FBRUQsQUFBMEIsaUJBQWpCLGdCQUFnQixDQUFDIiwiZmlsZSI6ImNvbnRyb2xsZXJzL1NwcmluZ0NvbnRyb2xsZXIuanMiLCJzb3VyY2VSb290IjoiLi4vIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFZlY3RvcjNEXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9nZW9tL1ZlY3RvcjNEXCIpO1xuXG5pbXBvcnQgRGlzcGxheU9iamVjdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9iYXNlL0Rpc3BsYXlPYmplY3RcIik7XG5pbXBvcnQgTG9va0F0Q29udHJvbGxlclx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9jb250cm9sbGVycy9Mb29rQXRDb250cm9sbGVyXCIpO1xuXG4vKipcbiAqIFVzZXMgc3ByaW5nIHBoeXNpY3MgdG8gYW5pbWF0ZSB0aGUgdGFyZ2V0IG9iamVjdCB0b3dhcmRzIGEgcG9zaXRpb24gdGhhdCBpc1xuICogZGVmaW5lZCBhcyB0aGUgbG9va0F0VGFyZ2V0IG9iamVjdCdzIHBvc2l0aW9uIHBsdXMgdGhlIHZlY3RvciBkZWZpbmVkIGJ5IHRoZVxuICogcG9zaXRpb25PZmZzZXQgcHJvcGVydHkuXG4gKi9cbmNsYXNzIFNwcmluZ0NvbnRyb2xsZXIgZXh0ZW5kcyBMb29rQXRDb250cm9sbGVyXG57XG5cdHByaXZhdGUgX3ZlbG9jaXR5OlZlY3RvcjNEO1xuXHRwcml2YXRlIF9kdjpWZWN0b3IzRDtcblx0cHJpdmF0ZSBfc3RyZXRjaDpWZWN0b3IzRDtcblx0cHJpdmF0ZSBfZm9yY2U6VmVjdG9yM0Q7XG5cdHByaXZhdGUgX2FjY2VsZXJhdGlvbjpWZWN0b3IzRDtcblx0cHJpdmF0ZSBfZGVzaXJlZFBvc2l0aW9uOlZlY3RvcjNEO1xuXG5cdC8qKlxuXHQgKiBTdGlmZm5lc3Mgb2YgdGhlIHNwcmluZywgaG93IGhhcmQgaXMgaXQgdG8gZXh0ZW5kLiBUaGUgaGlnaGVyIGl0IGlzLCB0aGUgbW9yZSBcImZpeGVkXCIgdGhlIGNhbSB3aWxsIGJlLlxuXHQgKiBBIG51bWJlciBiZXR3ZWVuIDEgYW5kIDIwIGlzIHJlY29tbWVuZGVkLlxuXHQgKi9cblx0cHVibGljIHN0aWZmbmVzczpudW1iZXI7XG5cblx0LyoqXG5cdCAqIERhbXBpbmcgaXMgdGhlIHNwcmluZyBpbnRlcm5hbCBmcmljdGlvbiwgb3IgaG93IG11Y2ggaXQgcmVzaXN0cyB0aGUgXCJib2luZ2dnZ2dcIiBlZmZlY3QuIFRvbyBoaWdoIGFuZCB5b3UnbGwgbG9zZSBpdCFcblx0ICogQSBudW1iZXIgYmV0d2VlbiAxIGFuZCAyMCBpcyByZWNvbW1lbmRlZC5cblx0ICovXG5cdHB1YmxpYyBkYW1waW5nOm51bWJlcjtcblxuXHQvKipcblx0ICogTWFzcyBvZiB0aGUgY2FtZXJhLCBpZiBvdmVyIDEyMCBhbmQgaXQnbGwgYmUgdmVyeSBoZWF2eSB0byBtb3ZlLlxuXHQgKi9cblx0cHVibGljIG1hc3M6bnVtYmVyO1xuXG5cdC8qKlxuXHQgKiBPZmZzZXQgb2Ygc3ByaW5nIGNlbnRlciBmcm9tIHRhcmdldCBpbiB0YXJnZXQgb2JqZWN0IHNwYWNlLCBpZTogV2hlcmUgdGhlIGNhbWVyYSBzaG91bGQgaWRlYWxseSBiZSBpbiB0aGUgdGFyZ2V0IG9iamVjdCBzcGFjZS5cblx0ICovXG5cdHB1YmxpYyBwb3NpdGlvbk9mZnNldDpWZWN0b3IzRCA9IG5ldyBWZWN0b3IzRCgwLCA1MDAsIC0xMDAwKTtcblxuXHRjb25zdHJ1Y3Rvcih0YXJnZXRPYmplY3Q6RGlzcGxheU9iamVjdCA9IG51bGwsIGxvb2tBdE9iamVjdDpEaXNwbGF5T2JqZWN0ID0gbnVsbCwgc3RpZmZuZXNzOm51bWJlciA9IDEsIG1hc3M6bnVtYmVyID0gNDAsIGRhbXBpbmc6bnVtYmVyID0gNClcblx0e1xuXHRcdHN1cGVyKHRhcmdldE9iamVjdCwgbG9va0F0T2JqZWN0KTtcblxuXHRcdHRoaXMuc3RpZmZuZXNzID0gc3RpZmZuZXNzO1xuXHRcdHRoaXMuZGFtcGluZyA9IGRhbXBpbmc7XG5cdFx0dGhpcy5tYXNzID0gbWFzcztcblxuXHRcdHRoaXMuX3ZlbG9jaXR5ID0gbmV3IFZlY3RvcjNEKCk7XG5cdFx0dGhpcy5fZHYgPSBuZXcgVmVjdG9yM0QoKTtcblx0XHR0aGlzLl9zdHJldGNoID0gbmV3IFZlY3RvcjNEKCk7XG5cdFx0dGhpcy5fZm9yY2UgPSBuZXcgVmVjdG9yM0QoKTtcblx0XHR0aGlzLl9hY2NlbGVyYXRpb24gPSBuZXcgVmVjdG9yM0QoKTtcblx0XHR0aGlzLl9kZXNpcmVkUG9zaXRpb24gPSBuZXcgVmVjdG9yM0QoKTtcblxuXHR9XG5cblx0cHVibGljIHVwZGF0ZShpbnRlcnBvbGF0ZTpib29sZWFuID0gdHJ1ZSlcblx0e1xuXHRcdHZhciBvZmZzOlZlY3RvcjNEO1xuXG5cdFx0aWYgKCF0aGlzLl9wTG9va0F0T2JqZWN0IHx8ICF0aGlzLl9wVGFyZ2V0T2JqZWN0KVxuXHRcdFx0cmV0dXJuO1xuXG5cdFx0b2ZmcyA9IHRoaXMuX3BMb29rQXRPYmplY3QudHJhbnNmb3JtLm1hdHJpeDNELmRlbHRhVHJhbnNmb3JtVmVjdG9yKHRoaXMucG9zaXRpb25PZmZzZXQpO1xuXHRcdHRoaXMuX2Rlc2lyZWRQb3NpdGlvbi54ID0gdGhpcy5fcExvb2tBdE9iamVjdC54ICsgb2Zmcy54O1xuXHRcdHRoaXMuX2Rlc2lyZWRQb3NpdGlvbi55ID0gdGhpcy5fcExvb2tBdE9iamVjdC55ICsgb2Zmcy55O1xuXHRcdHRoaXMuX2Rlc2lyZWRQb3NpdGlvbi56ID0gdGhpcy5fcExvb2tBdE9iamVjdC56ICsgb2Zmcy56O1xuXG5cdFx0dGhpcy5fc3RyZXRjaCA9IHRoaXMuX3BUYXJnZXRPYmplY3QudHJhbnNmb3JtLnBvc2l0aW9uLmFkZCh0aGlzLl9kZXNpcmVkUG9zaXRpb24pO1xuXHRcdHRoaXMuX3N0cmV0Y2guc2NhbGVCeSgtdGhpcy5zdGlmZm5lc3MpO1xuXG5cdFx0dGhpcy5fZHYuY29weUZyb20odGhpcy5fdmVsb2NpdHkpO1xuXHRcdHRoaXMuX2R2LnNjYWxlQnkodGhpcy5kYW1waW5nKTtcblxuXHRcdHRoaXMuX2ZvcmNlLnggPSB0aGlzLl9zdHJldGNoLnggLSB0aGlzLl9kdi54O1xuXHRcdHRoaXMuX2ZvcmNlLnkgPSB0aGlzLl9zdHJldGNoLnkgLSB0aGlzLl9kdi55O1xuXHRcdHRoaXMuX2ZvcmNlLnogPSB0aGlzLl9zdHJldGNoLnogLSB0aGlzLl9kdi56O1xuXG5cdFx0dGhpcy5fYWNjZWxlcmF0aW9uLmNvcHlGcm9tKHRoaXMuX2ZvcmNlKTtcblx0XHR0aGlzLl9hY2NlbGVyYXRpb24uc2NhbGVCeSgxL3RoaXMubWFzcyk7XG5cblx0XHR0aGlzLl92ZWxvY2l0eS5pbmNyZW1lbnRCeSh0aGlzLl9hY2NlbGVyYXRpb24pO1xuXG5cdFx0dGhpcy5fcFRhcmdldE9iamVjdC50cmFuc2Zvcm0ucG9zaXRpb24gPSB0aGlzLl9wVGFyZ2V0T2JqZWN0LnRyYW5zZm9ybS5wb3NpdGlvbi5hZGQodGhpcy5fdmVsb2NpdHkpO1xuXG5cdFx0c3VwZXIudXBkYXRlKCk7XG5cdH1cbn1cblxuZXhwb3J0ID0gU3ByaW5nQ29udHJvbGxlcjsiXX0=