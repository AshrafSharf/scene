var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Vector3D = require("awayjs-core/lib/geom/Vector3D");
var LookAtController = require("awayjs-display/lib/controllers/LookAtController");
/**
 * Uses spring physics to animate the target object towards a position that is
 * defined as the lookAtTarget object's position plus the vector defined by the
 * positionOffset property.
 */
var SpringController = (function (_super) {
    __extends(SpringController, _super);
    function SpringController(targetObject, lookAtObject, stiffness, mass, damping) {
        if (targetObject === void 0) { targetObject = null; }
        if (lookAtObject === void 0) { lookAtObject = null; }
        if (stiffness === void 0) { stiffness = 1; }
        if (mass === void 0) { mass = 40; }
        if (damping === void 0) { damping = 4; }
        _super.call(this, targetObject, lookAtObject);
        /**
         * Offset of spring center from target in target object space, ie: Where the camera should ideally be in the target object space.
         */
        this.positionOffset = new Vector3D(0, 500, -1000);
        this.stiffness = stiffness;
        this.damping = damping;
        this.mass = mass;
        this._velocity = new Vector3D();
        this._dv = new Vector3D();
        this._stretch = new Vector3D();
        this._force = new Vector3D();
        this._acceleration = new Vector3D();
        this._desiredPosition = new Vector3D();
    }
    SpringController.prototype.update = function (interpolate) {
        if (interpolate === void 0) { interpolate = true; }
        var offs;
        if (!this._pLookAtObject || !this._pTargetObject)
            return;
        offs = this._pLookAtObject.transform.matrix3D.deltaTransformVector(this.positionOffset);
        this._desiredPosition.x = this._pLookAtObject.x + offs.x;
        this._desiredPosition.y = this._pLookAtObject.y + offs.y;
        this._desiredPosition.z = this._pLookAtObject.z + offs.z;
        this._stretch = this._pTargetObject.transform.position.add(this._desiredPosition);
        this._stretch.scaleBy(-this.stiffness);
        this._dv.copyFrom(this._velocity);
        this._dv.scaleBy(this.damping);
        this._force.x = this._stretch.x - this._dv.x;
        this._force.y = this._stretch.y - this._dv.y;
        this._force.z = this._stretch.z - this._dv.z;
        this._acceleration.copyFrom(this._force);
        this._acceleration.scaleBy(1 / this.mass);
        this._velocity.incrementBy(this._acceleration);
        this._pTargetObject.transform.position = this._pTargetObject.transform.position.add(this._velocity);
        _super.prototype.update.call(this);
    };
    return SpringController;
})(LookAtController);
module.exports = SpringController;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1kaXNwbGF5L2xpYi9jb250cm9sbGVycy9TcHJpbmdDb250cm9sbGVyLnRzIl0sIm5hbWVzIjpbIlNwcmluZ0NvbnRyb2xsZXIiLCJTcHJpbmdDb250cm9sbGVyLmNvbnN0cnVjdG9yIiwiU3ByaW5nQ29udHJvbGxlci51cGRhdGUiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLElBQU8sUUFBUSxXQUFlLCtCQUErQixDQUFDLENBQUM7QUFHL0QsSUFBTyxnQkFBZ0IsV0FBYSxpREFBaUQsQ0FBQyxDQUFDO0FBRXZGLEFBS0E7Ozs7R0FERztJQUNHLGdCQUFnQjtJQUFTQSxVQUF6QkEsZ0JBQWdCQSxVQUF5QkE7SUErQjlDQSxTQS9CS0EsZ0JBQWdCQSxDQStCVEEsWUFBaUNBLEVBQUVBLFlBQWlDQSxFQUFFQSxTQUFvQkEsRUFBRUEsSUFBZ0JBLEVBQUVBLE9BQWtCQTtRQUFoSUMsNEJBQWlDQSxHQUFqQ0EsbUJBQWlDQTtRQUFFQSw0QkFBaUNBLEdBQWpDQSxtQkFBaUNBO1FBQUVBLHlCQUFvQkEsR0FBcEJBLGFBQW9CQTtRQUFFQSxvQkFBZ0JBLEdBQWhCQSxTQUFnQkE7UUFBRUEsdUJBQWtCQSxHQUFsQkEsV0FBa0JBO1FBRTNJQSxrQkFBTUEsWUFBWUEsRUFBRUEsWUFBWUEsQ0FBQ0EsQ0FBQ0E7UUFQbkNBOztXQUVHQTtRQUNJQSxtQkFBY0EsR0FBWUEsSUFBSUEsUUFBUUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsR0FBR0EsRUFBRUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFNNURBLElBQUlBLENBQUNBLFNBQVNBLEdBQUdBLFNBQVNBLENBQUNBO1FBQzNCQSxJQUFJQSxDQUFDQSxPQUFPQSxHQUFHQSxPQUFPQSxDQUFDQTtRQUN2QkEsSUFBSUEsQ0FBQ0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFFakJBLElBQUlBLENBQUNBLFNBQVNBLEdBQUdBLElBQUlBLFFBQVFBLEVBQUVBLENBQUNBO1FBQ2hDQSxJQUFJQSxDQUFDQSxHQUFH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LENBQUNBO1FBRS9DQSxJQUFJQSxDQUFDQSxjQUFjQSxDQUFDQSxTQUFTQSxDQUFDQSxRQUFRQSxHQUFHQSxJQUFJQSxDQUFDQSxjQUFjQSxDQUFDQSxTQUFTQSxDQUFDQSxRQUFRQSxDQUFDQSxHQUFHQSxDQUFDQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQTtRQUVwR0EsZ0JBQUtBLENBQUNBLE1BQU1BLFdBQUVBLENBQUNBO0lBQ2hCQSxDQUFDQTtJQUNGRix1QkFBQ0E7QUFBREEsQ0EvRUEsQUErRUNBLEVBL0U4QixnQkFBZ0IsRUErRTlDO0FBRUQsQUFBMEIsaUJBQWpCLGdCQUFnQixDQUFDIiwiZmlsZSI6ImNvbnRyb2xsZXJzL1NwcmluZ0NvbnRyb2xsZXIuanMiLCJzb3VyY2VSb290IjoiLi4vIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFZlY3RvcjNEXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9nZW9tL1ZlY3RvcjNEXCIpO1xyXG5cclxuaW1wb3J0IERpc3BsYXlPYmplY3RcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvYmFzZS9EaXNwbGF5T2JqZWN0XCIpO1xyXG5pbXBvcnQgTG9va0F0Q29udHJvbGxlclx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9jb250cm9sbGVycy9Mb29rQXRDb250cm9sbGVyXCIpO1xyXG5cclxuLyoqXHJcbiAqIFVzZXMgc3ByaW5nIHBoeXNpY3MgdG8gYW5pbWF0ZSB0aGUgdGFyZ2V0IG9iamVjdCB0b3dhcmRzIGEgcG9zaXRpb24gdGhhdCBpc1xyXG4gKiBkZWZpbmVkIGFzIHRoZSBsb29rQXRUYXJnZXQgb2JqZWN0J3MgcG9zaXRpb24gcGx1cyB0aGUgdmVjdG9yIGRlZmluZWQgYnkgdGhlXHJcbiAqIHBvc2l0aW9uT2Zmc2V0IHByb3BlcnR5LlxyXG4gKi9cclxuY2xhc3MgU3ByaW5nQ29udHJvbGxlciBleHRlbmRzIExvb2tBdENvbnRyb2xsZXJcclxue1xyXG5cdHByaXZhdGUgX3ZlbG9jaXR5OlZlY3RvcjNEO1xyXG5cdHByaXZhdGUgX2R2OlZlY3RvcjNEO1xyXG5cdHByaXZhdGUgX3N0cmV0Y2g6VmVjdG9yM0Q7XHJcblx0cHJpdmF0ZSBfZm9yY2U6VmVjdG9yM0Q7XHJcblx0cHJpdmF0ZSBfYWNjZWxlcmF0aW9uOlZlY3RvcjNEO1xyXG5cdHByaXZhdGUgX2Rlc2lyZWRQb3NpdGlvbjpWZWN0b3IzRDtcclxuXHJcblx0LyoqXHJcblx0ICogU3RpZmZuZXNzIG9mIHRoZSBzcHJpbmcsIGhvdyBoYXJkIGlzIGl0IHRvIGV4dGVuZC4gVGhlIGhpZ2hlciBpdCBpcywgdGhlIG1vcmUgXCJmaXhlZFwiIHRoZSBjYW0gd2lsbCBiZS5cclxuXHQgKiBBIG51bWJlciBiZXR3ZWVuIDEgYW5kIDIwIGlzIHJlY29tbWVuZGVkLlxyXG5cdCAqL1xyXG5cdHB1YmxpYyBzdGlmZm5lc3M6bnVtYmVyO1xyXG5cclxuXHQvKipcclxuXHQgKiBEYW1waW5nIGlzIHRoZSBzcHJpbmcgaW50ZXJuYWwgZnJpY3Rpb24sIG9yIGhvdyBtdWNoIGl0IHJlc2lzdHMgdGhlIFwiYm9pbmdnZ2dnXCIgZWZmZWN0LiBUb28gaGlnaCBhbmQgeW91J2xsIGxvc2UgaXQhXHJcblx0ICogQSBudW1iZXIgYmV0d2VlbiAxIGFuZCAyMCBpcyByZWNvbW1lbmRlZC5cclxuXHQgKi9cclxuXHRwdWJsaWMgZGFtcGluZzpudW1iZXI7XHJcblxyXG5cdC8qKlxyXG5cdCAqIE1hc3Mgb2YgdGhlIGNhbWVyYSwgaWYgb3ZlciAxMjAgYW5kIGl0J2xsIGJlIHZlcnkgaGVhdnkgdG8gbW92ZS5cclxuXHQgKi9cclxuXHRwdWJsaWMgbWFzczpudW1iZXI7XHJcblxyXG5cdC8qKlxyXG5cdCAqIE9mZnNldCBvZiBzcHJpbmcgY2VudGVyIGZyb20gdGFyZ2V0IGluIHRhcmdldCBvYmplY3Qgc3BhY2UsIGllOiBXaGVyZSB0aGUgY2FtZXJhIHNob3VsZCBpZGVhbGx5IGJlIGluIHRoZSB0YXJnZXQgb2JqZWN0IHNwYWNlLlxyXG5cdCAqL1xyXG5cdHB1YmxpYyBwb3NpdGlvbk9mZnNldDpWZWN0b3IzRCA9IG5ldyBWZWN0b3IzRCgwLCA1MDAsIC0xMDAwKTtcclxuXHJcblx0Y29uc3RydWN0b3IodGFyZ2V0T2JqZWN0OkRpc3BsYXlPYmplY3QgPSBudWxsLCBsb29rQXRPYmplY3Q6RGlzcGxheU9iamVjdCA9IG51bGwsIHN0aWZmbmVzczpudW1iZXIgPSAxLCBtYXNzOm51bWJlciA9IDQwLCBkYW1waW5nOm51bWJlciA9IDQpXHJcblx0e1xyXG5cdFx0c3VwZXIodGFyZ2V0T2JqZWN0LCBsb29rQXRPYmplY3QpO1xyXG5cclxuXHRcdHRoaXMuc3RpZmZuZXNzID0gc3RpZmZuZXNzO1xyXG5cdFx0dGhpcy5kYW1waW5nID0gZGFtcGluZztcclxuXHRcdHRoaXMubWFzcyA9IG1hc3M7XHJcblxyXG5cdFx0dGhpcy5fdmVsb2NpdHkgPSBuZXcgVmVjdG9yM0QoKTtcclxuXHRcdHRoaXMuX2R2ID0gbmV3IFZlY3RvcjNEKCk7XHJcblx0XHR0aGlzLl9zdHJldGNoID0gbmV3IFZlY3RvcjNEKCk7XHJcblx0XHR0aGlzLl9mb3JjZSA9IG5ldyBWZWN0b3IzRCgpO1xyXG5cdFx0dGhpcy5fYWNjZWxlcmF0aW9uID0gbmV3IFZlY3RvcjNEKCk7XHJcblx0XHR0aGlzLl9kZXNpcmVkUG9zaXRpb24gPSBuZXcgVmVjdG9yM0QoKTtcclxuXHJcblx0fVxyXG5cclxuXHRwdWJsaWMgdXBkYXRlKGludGVycG9sYXRlOmJvb2xlYW4gPSB0cnVlKVxyXG5cdHtcclxuXHRcdHZhciBvZmZzOlZlY3RvcjNEO1xyXG5cclxuXHRcdGlmICghdGhpcy5fcExvb2tBdE9iamVjdCB8fCAhdGhpcy5fcFRhcmdldE9iamVjdClcclxuXHRcdFx0cmV0dXJuO1xyXG5cclxuXHRcdG9mZnMgPSB0aGlzLl9wTG9va0F0T2JqZWN0LnRyYW5zZm9ybS5tYXRyaXgzRC5kZWx0YVRyYW5zZm9ybVZlY3Rvcih0aGlzLnBvc2l0aW9uT2Zmc2V0KTtcclxuXHRcdHRoaXMuX2Rlc2lyZWRQb3NpdGlvbi54ID0gdGhpcy5fcExvb2tBdE9iamVjdC54ICsgb2Zmcy54O1xyXG5cdFx0dGhpcy5fZGVzaXJlZFBvc2l0aW9uLnkgPSB0aGlzLl9wTG9va0F0T2JqZWN0LnkgKyBvZmZzLnk7XHJcblx0XHR0aGlzLl9kZXNpcmVkUG9zaXRpb24ueiA9IHRoaXMuX3BMb29rQXRPYmplY3QueiArIG9mZnMuejtcclxuXHJcblx0XHR0aGlzLl9zdHJldGNoID0gdGhpcy5fcFRhcmdldE9iamVjdC50cmFuc2Zvcm0ucG9zaXRpb24uYWRkKHRoaXMuX2Rlc2lyZWRQb3NpdGlvbik7XHJcblx0XHR0aGlzLl9zdHJldGNoLnNjYWxlQnkoLXRoaXMuc3RpZmZuZXNzKTtcclxuXHJcblx0XHR0aGlzLl9kdi5jb3B5RnJvbSh0aGlzLl92ZWxvY2l0eSk7XHJcblx0XHR0aGlzLl9kdi5zY2FsZUJ5KHRoaXMuZGFtcGluZyk7XHJcblxyXG5cdFx0dGhpcy5fZm9yY2UueCA9IHRoaXMuX3N0cmV0Y2gueCAtIHRoaXMuX2R2Lng7XHJcblx0XHR0aGlzLl9mb3JjZS55ID0gdGhpcy5fc3RyZXRjaC55IC0gdGhpcy5fZHYueTtcclxuXHRcdHRoaXMuX2ZvcmNlLnogPSB0aGlzLl9zdHJldGNoLnogLSB0aGlzLl9kdi56O1xyXG5cclxuXHRcdHRoaXMuX2FjY2VsZXJhdGlvbi5jb3B5RnJvbSh0aGlzLl9mb3JjZSk7XHJcblx0XHR0aGlzLl9hY2NlbGVyYXRpb24uc2NhbGVCeSgxL3RoaXMubWFzcyk7XHJcblxyXG5cdFx0dGhpcy5fdmVsb2NpdHkuaW5jcmVtZW50QnkodGhpcy5fYWNjZWxlcmF0aW9uKTtcclxuXHJcblx0XHR0aGlzLl9wVGFyZ2V0T2JqZWN0LnRyYW5zZm9ybS5wb3NpdGlvbiA9IHRoaXMuX3BUYXJnZXRPYmplY3QudHJhbnNmb3JtLnBvc2l0aW9uLmFkZCh0aGlzLl92ZWxvY2l0eSk7XHJcblxyXG5cdFx0c3VwZXIudXBkYXRlKCk7XHJcblx0fVxyXG59XHJcblxyXG5leHBvcnQgPSBTcHJpbmdDb250cm9sbGVyOyJdfQ==