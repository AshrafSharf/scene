var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var MathConsts = require("awayjs-core/lib/geom/MathConsts");
var Vector3D = require("awayjs-core/lib/geom/Vector3D");
var LookAtController = require("awayjs-display/lib/controllers/LookAtController");
/**
 * Extended camera used to hover round a specified target object.
 *
 * @see    away.containers.View
 */
var HoverController = (function (_super) {
    __extends(HoverController, _super);
    /**
     * Creates a new <code>HoverController</code> object.
     */
    function HoverController(targetObject, lookAtObject, panAngle, tiltAngle, distance, minTiltAngle, maxTiltAngle, minPanAngle, maxPanAngle, steps, yFactor, wrapPanAngle) {
        if (targetObject === void 0) { targetObject = null; }
        if (lookAtObject === void 0) { lookAtObject = null; }
        if (panAngle === void 0) { panAngle = 0; }
        if (tiltAngle === void 0) { tiltAngle = 90; }
        if (distance === void 0) { distance = 1000; }
        if (minTiltAngle === void 0) { minTiltAngle = -90; }
        if (maxTiltAngle === void 0) { maxTiltAngle = 90; }
        if (minPanAngle === void 0) { minPanAngle = null; }
        if (maxPanAngle === void 0) { maxPanAngle = null; }
        if (steps === void 0) { steps = 8; }
        if (yFactor === void 0) { yFactor = 2; }
        if (wrapPanAngle === void 0) { wrapPanAngle = false; }
        _super.call(this, targetObject, lookAtObject);
        this._iCurrentPanAngle = 0;
        this._iCurrentTiltAngle = 90;
        this._panAngle = 0;
        this._tiltAngle = 90;
        this._distance = 1000;
        this._minPanAngle = -Infinity;
        this._maxPanAngle = Infinity;
        this._minTiltAngle = -90;
        this._maxTiltAngle = 90;
        this._steps = 8;
        this._yFactor = 2;
        this._wrapPanAngle = false;
        this._upAxis = new Vector3D();
        this.distance = distance;
        this.panAngle = panAngle;
        this.tiltAngle = tiltAngle;
        this.minPanAngle = (minPanAngle != null) ? minPanAngle : -Infinity;
        this.maxPanAngle = (maxPanAngle != null) ? maxPanAngle : Infinity;
        this.minTiltAngle = minTiltAngle;
        this.maxTiltAngle = maxTiltAngle;
        this.steps = steps;
        this.yFactor = yFactor;
        this.wrapPanAngle = wrapPanAngle;
        //values passed in contrustor are applied immediately
        this._iCurrentPanAngle = this._panAngle;
        this._iCurrentTiltAngle = this._tiltAngle;
    }
    Object.defineProperty(HoverController.prototype, "steps", {
        /**
         * Fractional step taken each time the <code>hover()</code> method is called. Defaults to 8.
         *
         * Affects the speed at which the <code>tiltAngle</code> and <code>panAngle</code> resolve to their targets.
         *
         * @see    #tiltAngle
         * @see    #panAngle
         */
        get: function () {
            return this._steps;
        },
        set: function (val) {
            val = (val < 1) ? 1 : val;
            if (this._steps == val)
                return;
            this._steps = val;
            this.pNotifyUpdate();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(HoverController.prototype, "panAngle", {
        /**
         * Rotation of the camera in degrees around the y axis. Defaults to 0.
         */
        get: function () {
            return this._panAngle;
        },
        set: function (val) {
            val = Math.max(this._minPanAngle, Math.min(this._maxPanAngle, val));
            if (this._panAngle == val)
                return;
            this._panAngle = val;
            this.pNotifyUpdate();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(HoverController.prototype, "tiltAngle", {
        /**
         * Elevation angle of the camera in degrees. Defaults to 90.
         */
        get: function () {
            return this._tiltAngle;
        },
        set: function (val) {
            val = Math.max(this._minTiltAngle, Math.min(this._maxTiltAngle, val));
            if (this._tiltAngle == val)
                return;
            this._tiltAngle = val;
            this.pNotifyUpdate();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(HoverController.prototype, "distance", {
        /**
         * Distance between the camera and the specified target. Defaults to 1000.
         */
        get: function () {
            return this._distance;
        },
        set: function (val) {
            if (this._distance == val)
                return;
            this._distance = val;
            this.pNotifyUpdate();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(HoverController.prototype, "minPanAngle", {
        /**
         * Minimum bounds for the <code>panAngle</code>. Defaults to -Infinity.
         *
         * @see    #panAngle
         */
        get: function () {
            return this._minPanAngle;
        },
        set: function (val) {
            if (this._minPanAngle == val)
                return;
            this._minPanAngle = val;
            this.panAngle = Math.max(this._minPanAngle, Math.min(this._maxPanAngle, this._panAngle));
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(HoverController.prototype, "maxPanAngle", {
        /**
         * Maximum bounds for the <code>panAngle</code>. Defaults to Infinity.
         *
         * @see    #panAngle
         */
        get: function () {
            return this._maxPanAngle;
        },
        set: function (val) {
            if (this._maxPanAngle == val)
                return;
            this._maxPanAngle = val;
            this.panAngle = Math.max(this._minPanAngle, Math.min(this._maxPanAngle, this._panAngle));
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(HoverController.prototype, "minTiltAngle", {
        /**
         * Minimum bounds for the <code>tiltAngle</code>. Defaults to -90.
         *
         * @see    #tiltAngle
         */
        get: function () {
            return this._minTiltAngle;
        },
        set: function (val) {
            if (this._minTiltAngle == val)
                return;
            this._minTiltAngle = val;
            this.tiltAngle = Math.max(this._minTiltAngle, Math.min(this._maxTiltAngle, this._tiltAngle));
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(HoverController.prototype, "maxTiltAngle", {
        /**
         * Maximum bounds for the <code>tiltAngle</code>. Defaults to 90.
         *
         * @see    #tiltAngle
         */
        get: function () {
            return this._maxTiltAngle;
        },
        set: function (val) {
            if (this._maxTiltAngle == val)
                return;
            this._maxTiltAngle = val;
            this.tiltAngle = Math.max(this._minTiltAngle, Math.min(this._maxTiltAngle, this._tiltAngle));
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(HoverController.prototype, "yFactor", {
        /**
         * Fractional difference in distance between the horizontal camera orientation and vertical camera orientation. Defaults to 2.
         *
         * @see    #distance
         */
        get: function () {
            return this._yFactor;
        },
        set: function (val) {
            if (this._yFactor == val)
                return;
            this._yFactor = val;
            this.pNotifyUpdate();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(HoverController.prototype, "wrapPanAngle", {
        /**
         * Defines whether the value of the pan angle wraps when over 360 degrees or under 0 degrees. Defaults to false.
         */
        get: function () {
            return this._wrapPanAngle;
        },
        set: function (val) {
            if (this._wrapPanAngle == val)
                return;
            this._wrapPanAngle = val;
            this.pNotifyUpdate();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Updates the current tilt angle and pan angle values.
     *
     * Values are calculated using the defined <code>tiltAngle</code>, <code>panAngle</code> and <code>steps</code> variables.
     *
     * @param interpolate   If the update to a target pan- or tiltAngle is interpolated. Default is true.
     *
     * @see    #tiltAngle
     * @see    #panAngle
     * @see    #steps
     */
    HoverController.prototype.update = function (interpolate) {
        if (interpolate === void 0) { interpolate = true; }
        if (this._tiltAngle != this._iCurrentTiltAngle || this._panAngle != this._iCurrentPanAngle) {
            this.pNotifyUpdate();
            if (this._wrapPanAngle) {
                if (this._panAngle < 0) {
                    this._iCurrentPanAngle += this._panAngle % 360 + 360 - this._panAngle;
                    this._panAngle = this._panAngle % 360 + 360;
                }
                else {
                    this._iCurrentPanAngle += this._panAngle % 360 - this._panAngle;
                    this._panAngle = this._panAngle % 360;
                }
                while (this._panAngle - this._iCurrentPanAngle < -180)
                    this._iCurrentPanAngle -= 360;
                while (this._panAngle - this._iCurrentPanAngle > 180)
                    this._iCurrentPanAngle += 360;
            }
            if (interpolate) {
                this._iCurrentTiltAngle += (this._tiltAngle - this._iCurrentTiltAngle) / (this.steps + 1);
                this._iCurrentPanAngle += (this._panAngle - this._iCurrentPanAngle) / (this.steps + 1);
            }
            else {
                this._iCurrentPanAngle = this._panAngle;
                this._iCurrentTiltAngle = this._tiltAngle;
            }
            //snap coords if angle differences are close
            if ((Math.abs(this.tiltAngle - this._iCurrentTiltAngle) < 0.01) && (Math.abs(this._panAngle - this._iCurrentPanAngle) < 0.01)) {
                this._iCurrentTiltAngle = this._tiltAngle;
                this._iCurrentPanAngle = this._panAngle;
            }
        }
        var pos = (this.lookAtObject) ? this.lookAtObject.transform.position : (this.lookAtPosition) ? this.lookAtPosition : this._pOrigin;
        this.targetObject.x = pos.x + this.distance * Math.sin(this._iCurrentPanAngle * MathConsts.DEGREES_TO_RADIANS) * Math.cos(this._iCurrentTiltAngle * MathConsts.DEGREES_TO_RADIANS);
        this.targetObject.y = pos.y + this.distance * Math.sin(this._iCurrentTiltAngle * MathConsts.DEGREES_TO_RADIANS) * this.yFactor;
        this.targetObject.z = pos.z + this.distance * Math.cos(this._iCurrentPanAngle * MathConsts.DEGREES_TO_RADIANS) * Math.cos(this._iCurrentTiltAngle * MathConsts.DEGREES_TO_RADIANS);
        this._upAxis.x = -Math.sin(this._iCurrentPanAngle * MathConsts.DEGREES_TO_RADIANS) * Math.sin(this._iCurrentTiltAngle * MathConsts.DEGREES_TO_RADIANS);
        this._upAxis.y = Math.cos(this._iCurrentTiltAngle * MathConsts.DEGREES_TO_RADIANS);
        this._upAxis.z = -Math.cos(this._iCurrentPanAngle * MathConsts.DEGREES_TO_RADIANS) * Math.sin(this._iCurrentTiltAngle * MathConsts.DEGREES_TO_RADIANS);
        if (this._pTargetObject) {
            if (this._pLookAtPosition)
                this._pTargetObject.lookAt(this._pLookAtPosition, this._upAxis);
            else if (this._pLookAtObject)
                this._pTargetObject.lookAt(this._pLookAtObject.scene ? this._pLookAtObject.scenePosition : this._pLookAtObject.transform.position, this._upAxis);
        }
    };
    return HoverController;
})(LookAtController);
module.exports = HoverController;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1kaXNwbGF5L2xpYi9jb250cm9sbGVycy9ob3ZlcmNvbnRyb2xsZXIudHMiXSwibmFtZXMiOlsiSG92ZXJDb250cm9sbGVyIiwiSG92ZXJDb250cm9sbGVyLmNvbnN0cnVjdG9yIiwiSG92ZXJDb250cm9sbGVyLnN0ZXBzIiwiSG92ZXJDb250cm9sbGVyLnBhbkFuZ2xlIiwiSG92ZXJDb250cm9sbGVyLnRpbHRBbmdsZSIsIkhvdmVyQ29udHJvbGxlci5kaXN0YW5jZSIsIkhvdmVyQ29udHJvbGxlci5taW5QYW5BbmdsZSIsIkhvdmVyQ29udHJvbGxlci5tYXhQYW5BbmdsZSIsIkhvdmVyQ29udHJvbGxlci5taW5UaWx0QW5nbGUiLCJIb3ZlckNvbnRyb2xsZXIubWF4VGlsdEFuZ2xlIiwiSG92ZXJDb250cm9sbGVyLnlGYWN0b3IiLCJIb3ZlckNvbnRyb2xsZXIud3JhcFBhbkFuZ2xlIiwiSG92ZXJDb250cm9sbGVyLnVwZGF0ZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsSUFBTyxVQUFVLFdBQWMsaUNBQWlDLENBQUMsQ0FBQztBQUNsRSxJQUFPLFFBQVEsV0FBZSwrQkFBK0IsQ0FBQyxDQUFDO0FBRy9ELElBQU8sZ0JBQWdCLFdBQWEsaURBQWlELENBQUMsQ0FBQztBQUV2RixBQUtBOzs7O0dBREc7SUFDRyxlQUFlO0lBQVNBLFVBQXhCQSxlQUFlQSxVQUF5QkE7SUEwTjdDQTs7T0FFR0E7SUFDSEEsU0E3TktBLGVBQWVBLENBNk5SQSxZQUFpQ0EsRUFBRUEsWUFBaUNBLEVBQUVBLFFBQW1CQSxFQUFFQSxTQUFxQkEsRUFBRUEsUUFBc0JBLEVBQUVBLFlBQXlCQSxFQUFFQSxZQUF3QkEsRUFBRUEsV0FBeUJBLEVBQUVBLFdBQXlCQSxFQUFFQSxLQUFnQkEsRUFBRUEsT0FBa0JBLEVBQUVBLFlBQTRCQTtRQUF2VEMsNEJBQWlDQSxHQUFqQ0EsbUJBQWlDQTtRQUFFQSw0QkFBaUNBLEdBQWpDQSxtQkFBaUNBO1FBQUVBLHdCQUFtQkEsR0FB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Q0EsQ0FBQ0E7UUFDRkEsQ0FBQ0E7UUFFREEsSUFBSUEsR0FBR0EsR0FBWUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsR0FBRUEsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsUUFBUUEsR0FBR0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsR0FBRUEsSUFBSUEsQ0FBQ0EsY0FBY0EsR0FBR0EsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0E7UUFDMUlBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLFFBQVFBLEdBQUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLElBQUlBLENBQUNBLGlCQUFpQkEsR0FBQ0EsVUFBVUEsQ0FBQ0Esa0JBQWtCQSxDQUFDQSxHQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxJQUFJQSxDQUFDQSxrQkFBa0JBLEdBQUNBLFVBQVVBLENBQUNBLGtCQUFrQkEsQ0FBQ0EsQ0FBQ0E7UUFDM0tBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLFFBQVFBLEdBQUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLElBQUlBLENBQUNBLGtCQUFrQkEsR0FBQ0EsVUFBVUEsQ0FBQ0Esa0JBQWtCQSxDQUFDQSxHQUFDQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQTtRQUN6SEEsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsUUFBUUEsR0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxHQUFDQSxVQUFVQSxDQUFDQSxrQkFBa0JBLENBQUNBLEdBQUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLElBQUlBLENBQUNBLGtCQUFrQkEsR0FBQ0EsVUFBVUEsQ0FBQ0Esa0JBQWtCQSxDQUFDQSxDQUFDQTtRQUUzS0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxHQUFDQSxVQUFVQSxDQUFDQSxrQkFBa0JBLENBQUNBLEdBQUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLElBQUlBLENBQUNBLGtCQUFrQkEsR0FBQ0EsVUFBVUEsQ0FBQ0Esa0JBQWtCQSxDQUFDQSxDQUFDQTtRQUNqSkEsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxHQUFDQSxVQUFVQSxDQUFDQSxrQkFBa0JBLENBQUNBLENBQUNBO1FBQ2pGQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxJQUFJQSxDQUFDQSxpQkFBaUJBLEdBQUNBLFVBQVVBLENBQUNBLGtCQUFrQkEsQ0FBQ0EsR0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxHQUFDQSxVQUFVQSxDQUFDQSxrQkFBa0JBLENBQUNBLENBQUNBO1FBRWpKQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxjQUFjQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUN6QkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxDQUFDQTtnQkFDekJBLElBQUlBLENBQUNBLGNBQWNBLENBQUNBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLGdCQUFnQkEsRUFBRUEsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0E7WUFDakVBLElBQUlBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLGNBQWNBLENBQUNBO2dCQUM1QkEsSUFBSUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsS0FBS0EsR0FBRUEsSUFBSUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsYUFBYUEsR0FBR0EsSUFBSUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsU0FBU0EsQ0FBQ0EsUUFBUUEsRUFBRUEsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0E7UUFDbEpBLENBQUNBO0lBQ0ZBLENBQUNBO0lBQ0ZaLHNCQUFDQTtBQUFEQSxDQWpUQSxBQWlUQ0EsRUFqVDZCLGdCQUFnQixFQWlUN0M7QUFFRCxBQUF5QixpQkFBaEIsZUFBZSxDQUFDIiwiZmlsZSI6ImNvbnRyb2xsZXJzL0hvdmVyQ29udHJvbGxlci5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgTWF0aENvbnN0c1x0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vTWF0aENvbnN0c1wiKTtcbmltcG9ydCBWZWN0b3IzRFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9WZWN0b3IzRFwiKTtcblxuaW1wb3J0IERpc3BsYXlPYmplY3RcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvYmFzZS9EaXNwbGF5T2JqZWN0XCIpO1xuaW1wb3J0IExvb2tBdENvbnRyb2xsZXJcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvY29udHJvbGxlcnMvTG9va0F0Q29udHJvbGxlclwiKTtcblxuLyoqXG4gKiBFeHRlbmRlZCBjYW1lcmEgdXNlZCB0byBob3ZlciByb3VuZCBhIHNwZWNpZmllZCB0YXJnZXQgb2JqZWN0LlxuICpcbiAqIEBzZWUgICAgYXdheS5jb250YWluZXJzLlZpZXdcbiAqL1xuY2xhc3MgSG92ZXJDb250cm9sbGVyIGV4dGVuZHMgTG9va0F0Q29udHJvbGxlclxue1xuXHRwdWJsaWMgX2lDdXJyZW50UGFuQW5nbGU6bnVtYmVyID0gMDtcblx0cHVibGljIF9pQ3VycmVudFRpbHRBbmdsZTpudW1iZXIgPSA5MDtcblxuXHRwcml2YXRlIF9wYW5BbmdsZTpudW1iZXIgPSAwO1xuXHRwcml2YXRlIF90aWx0QW5nbGU6bnVtYmVyID0gOTA7XG5cdHByaXZhdGUgX2Rpc3RhbmNlOm51bWJlciA9IDEwMDA7XG5cdHByaXZhdGUgX21pblBhbkFuZ2xlOm51bWJlciA9IC1JbmZpbml0eTtcblx0cHJpdmF0ZSBfbWF4UGFuQW5nbGU6bnVtYmVyID0gSW5maW5pdHk7XG5cdHByaXZhdGUgX21pblRpbHRBbmdsZTpudW1iZXIgPSAtOTA7XG5cdHByaXZhdGUgX21heFRpbHRBbmdsZTpudW1iZXIgPSA5MDtcblx0cHJpdmF0ZSBfc3RlcHM6bnVtYmVyID0gODtcblx0cHJpdmF0ZSBfeUZhY3RvcjpudW1iZXIgPSAyO1xuXHRwcml2YXRlIF93cmFwUGFuQW5nbGU6Ym9vbGVhbiA9IGZhbHNlO1xuXHRwcml2YXRlIF91cEF4aXM6VmVjdG9yM0QgPSBuZXcgVmVjdG9yM0QoKTtcblxuXHQvKipcblx0ICogRnJhY3Rpb25hbCBzdGVwIHRha2VuIGVhY2ggdGltZSB0aGUgPGNvZGU+aG92ZXIoKTwvY29kZT4gbWV0aG9kIGlzIGNhbGxlZC4gRGVmYXVsdHMgdG8gOC5cblx0ICpcblx0ICogQWZmZWN0cyB0aGUgc3BlZWQgYXQgd2hpY2ggdGhlIDxjb2RlPnRpbHRBbmdsZTwvY29kZT4gYW5kIDxjb2RlPnBhbkFuZ2xlPC9jb2RlPiByZXNvbHZlIHRvIHRoZWlyIHRhcmdldHMuXG5cdCAqXG5cdCAqIEBzZWUgICAgI3RpbHRBbmdsZVxuXHQgKiBAc2VlICAgICNwYW5BbmdsZVxuXHQgKi9cblx0cHVibGljIGdldCBzdGVwcygpOm51bWJlclxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuX3N0ZXBzO1xuXHR9XG5cblx0cHVibGljIHNldCBzdGVwcyh2YWw6bnVtYmVyKVxuXHR7XG5cdFx0dmFsID0gKHZhbCA8IDEpPyAxIDogdmFsO1xuXG5cdFx0aWYgKHRoaXMuX3N0ZXBzID09IHZhbClcblx0XHRcdHJldHVybjtcblxuXHRcdHRoaXMuX3N0ZXBzID0gdmFsO1xuXG5cdFx0dGhpcy5wTm90aWZ5VXBkYXRlKCk7XG5cdH1cblxuXHQvKipcblx0ICogUm90YXRpb24gb2YgdGhlIGNhbWVyYSBpbiBkZWdyZWVzIGFyb3VuZCB0aGUgeSBheGlzLiBEZWZhdWx0cyB0byAwLlxuXHQgKi9cblx0cHVibGljIGdldCBwYW5BbmdsZSgpOm51bWJlclxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuX3BhbkFuZ2xlO1xuXHR9XG5cblx0cHVibGljIHNldCBwYW5BbmdsZSh2YWw6bnVtYmVyKVxuXHR7XG5cdFx0dmFsID0gTWF0aC5tYXgodGhpcy5fbWluUGFuQW5nbGUsIE1hdGgubWluKHRoaXMuX21heFBhbkFuZ2xlLCB2YWwpKTtcblxuXHRcdGlmICh0aGlzLl9wYW5BbmdsZSA9PSB2YWwpXG5cdFx0XHRyZXR1cm47XG5cblx0XHR0aGlzLl9wYW5BbmdsZSA9IHZhbDtcblxuXHRcdHRoaXMucE5vdGlmeVVwZGF0ZSgpO1xuXHR9XG5cblx0LyoqXG5cdCAqIEVsZXZhdGlvbiBhbmdsZSBvZiB0aGUgY2FtZXJhIGluIGRlZ3JlZXMuIERlZmF1bHRzIHRvIDkwLlxuXHQgKi9cblx0cHVibGljIGdldCB0aWx0QW5nbGUoKTpudW1iZXJcblx0e1xuXHRcdHJldHVybiB0aGlzLl90aWx0QW5nbGU7XG5cdH1cblxuXHRwdWJsaWMgc2V0IHRpbHRBbmdsZSh2YWw6bnVtYmVyKVxuXHR7XG5cdFx0dmFsID0gTWF0aC5tYXgodGhpcy5fbWluVGlsdEFuZ2xlLCBNYXRoLm1pbih0aGlzLl9tYXhUaWx0QW5nbGUsIHZhbCkpO1xuXG5cdFx0aWYgKHRoaXMuX3RpbHRBbmdsZSA9PSB2YWwpXG5cdFx0XHRyZXR1cm47XG5cblx0XHR0aGlzLl90aWx0QW5nbGUgPSB2YWw7XG5cblx0XHR0aGlzLnBOb3RpZnlVcGRhdGUoKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBEaXN0YW5jZSBiZXR3ZWVuIHRoZSBjYW1lcmEgYW5kIHRoZSBzcGVjaWZpZWQgdGFyZ2V0LiBEZWZhdWx0cyB0byAxMDAwLlxuXHQgKi9cblx0cHVibGljIGdldCBkaXN0YW5jZSgpOm51bWJlclxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuX2Rpc3RhbmNlO1xuXHR9XG5cblx0cHVibGljIHNldCBkaXN0YW5jZSh2YWw6bnVtYmVyKVxuXHR7XG5cdFx0aWYgKHRoaXMuX2Rpc3RhbmNlID09IHZhbClcblx0XHRcdHJldHVybjtcblxuXHRcdHRoaXMuX2Rpc3RhbmNlID0gdmFsO1xuXG5cdFx0dGhpcy5wTm90aWZ5VXBkYXRlKCk7XG5cdH1cblxuXHQvKipcblx0ICogTWluaW11bSBib3VuZHMgZm9yIHRoZSA8Y29kZT5wYW5BbmdsZTwvY29kZT4uIERlZmF1bHRzIHRvIC1JbmZpbml0eS5cblx0ICpcblx0ICogQHNlZSAgICAjcGFuQW5nbGVcblx0ICovXG5cdHB1YmxpYyBnZXQgbWluUGFuQW5nbGUoKTpudW1iZXJcblx0e1xuXHRcdHJldHVybiB0aGlzLl9taW5QYW5BbmdsZTtcblx0fVxuXG5cdHB1YmxpYyBzZXQgbWluUGFuQW5nbGUodmFsOm51bWJlcilcblx0e1xuXHRcdGlmICh0aGlzLl9taW5QYW5BbmdsZSA9PSB2YWwpXG5cdFx0XHRyZXR1cm47XG5cblx0XHR0aGlzLl9taW5QYW5BbmdsZSA9IHZhbDtcblxuXHRcdHRoaXMucGFuQW5nbGUgPSBNYXRoLm1heCh0aGlzLl9taW5QYW5BbmdsZSwgTWF0aC5taW4odGhpcy5fbWF4UGFuQW5nbGUsIHRoaXMuX3BhbkFuZ2xlKSk7XG5cdH1cblxuXHQvKipcblx0ICogTWF4aW11bSBib3VuZHMgZm9yIHRoZSA8Y29kZT5wYW5BbmdsZTwvY29kZT4uIERlZmF1bHRzIHRvIEluZmluaXR5LlxuXHQgKlxuXHQgKiBAc2VlICAgICNwYW5BbmdsZVxuXHQgKi9cblx0cHVibGljIGdldCBtYXhQYW5BbmdsZSgpOm51bWJlclxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuX21heFBhbkFuZ2xlO1xuXHR9XG5cblx0cHVibGljIHNldCBtYXhQYW5BbmdsZSh2YWw6bnVtYmVyKVxuXHR7XG5cdFx0aWYgKHRoaXMuX21heFBhbkFuZ2xlID09IHZhbClcblx0XHRcdHJldHVybjtcblxuXHRcdHRoaXMuX21heFBhbkFuZ2xlID0gdmFsO1xuXG5cdFx0dGhpcy5wYW5BbmdsZSA9IE1hdGgubWF4KHRoaXMuX21pblBhbkFuZ2xlLCBNYXRoLm1pbih0aGlzLl9tYXhQYW5BbmdsZSwgdGhpcy5fcGFuQW5nbGUpKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBNaW5pbXVtIGJvdW5kcyBmb3IgdGhlIDxjb2RlPnRpbHRBbmdsZTwvY29kZT4uIERlZmF1bHRzIHRvIC05MC5cblx0ICpcblx0ICogQHNlZSAgICAjdGlsdEFuZ2xlXG5cdCAqL1xuXHRwdWJsaWMgZ2V0IG1pblRpbHRBbmdsZSgpOm51bWJlclxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuX21pblRpbHRBbmdsZTtcblx0fVxuXG5cdHB1YmxpYyBzZXQgbWluVGlsdEFuZ2xlKHZhbDpudW1iZXIpXG5cdHtcblx0XHRpZiAodGhpcy5fbWluVGlsdEFuZ2xlID09IHZhbClcblx0XHRcdHJldHVybjtcblxuXHRcdHRoaXMuX21pblRpbHRBbmdsZSA9IHZhbDtcblxuXHRcdHRoaXMudGlsdEFuZ2xlID0gTWF0aC5tYXgodGhpcy5fbWluVGlsdEFuZ2xlLCBNYXRoLm1pbih0aGlzLl9tYXhUaWx0QW5nbGUsIHRoaXMuX3RpbHRBbmdsZSkpO1xuXHR9XG5cblx0LyoqXG5cdCAqIE1heGltdW0gYm91bmRzIGZvciB0aGUgPGNvZGU+dGlsdEFuZ2xlPC9jb2RlPi4gRGVmYXVsdHMgdG8gOTAuXG5cdCAqXG5cdCAqIEBzZWUgICAgI3RpbHRBbmdsZVxuXHQgKi9cblx0cHVibGljIGdldCBtYXhUaWx0QW5nbGUoKTpudW1iZXJcblx0e1xuXHRcdHJldHVybiB0aGlzLl9tYXhUaWx0QW5nbGU7XG5cdH1cblxuXHRwdWJsaWMgc2V0IG1heFRpbHRBbmdsZSh2YWw6bnVtYmVyKVxuXHR7XG5cdFx0aWYgKHRoaXMuX21heFRpbHRBbmdsZSA9PSB2YWwpXG5cdFx0XHRyZXR1cm47XG5cblx0XHR0aGlzLl9tYXhUaWx0QW5nbGUgPSB2YWw7XG5cblx0XHR0aGlzLnRpbHRBbmdsZSA9IE1hdGgubWF4KHRoaXMuX21pblRpbHRBbmdsZSwgTWF0aC5taW4odGhpcy5fbWF4VGlsdEFuZ2xlLCB0aGlzLl90aWx0QW5nbGUpKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBGcmFjdGlvbmFsIGRpZmZlcmVuY2UgaW4gZGlzdGFuY2UgYmV0d2VlbiB0aGUgaG9yaXpvbnRhbCBjYW1lcmEgb3JpZW50YXRpb24gYW5kIHZlcnRpY2FsIGNhbWVyYSBvcmllbnRhdGlvbi4gRGVmYXVsdHMgdG8gMi5cblx0ICpcblx0ICogQHNlZSAgICAjZGlzdGFuY2Vcblx0ICovXG5cdHB1YmxpYyBnZXQgeUZhY3RvcigpOm51bWJlclxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuX3lGYWN0b3I7XG5cdH1cblxuXHRwdWJsaWMgc2V0IHlGYWN0b3IodmFsOm51bWJlcilcblx0e1xuXHRcdGlmICh0aGlzLl95RmFjdG9yID09IHZhbClcblx0XHRcdHJldHVybjtcblxuXHRcdHRoaXMuX3lGYWN0b3IgPSB2YWw7XG5cblx0XHR0aGlzLnBOb3RpZnlVcGRhdGUoKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBEZWZpbmVzIHdoZXRoZXIgdGhlIHZhbHVlIG9mIHRoZSBwYW4gYW5nbGUgd3JhcHMgd2hlbiBvdmVyIDM2MCBkZWdyZWVzIG9yIHVuZGVyIDAgZGVncmVlcy4gRGVmYXVsdHMgdG8gZmFsc2UuXG5cdCAqL1xuXHRwdWJsaWMgZ2V0IHdyYXBQYW5BbmdsZSgpOmJvb2xlYW5cblx0e1xuXHRcdHJldHVybiB0aGlzLl93cmFwUGFuQW5nbGU7XG5cdH1cblxuXHRwdWJsaWMgc2V0IHdyYXBQYW5BbmdsZSh2YWw6Ym9vbGVhbilcblx0e1xuXHRcdGlmICh0aGlzLl93cmFwUGFuQW5nbGUgPT0gdmFsKVxuXHRcdFx0cmV0dXJuO1xuXG5cdFx0dGhpcy5fd3JhcFBhbkFuZ2xlID0gdmFsO1xuXG5cdFx0dGhpcy5wTm90aWZ5VXBkYXRlKCk7XG5cdH1cblxuXHQvKipcblx0ICogQ3JlYXRlcyBhIG5ldyA8Y29kZT5Ib3ZlckNvbnRyb2xsZXI8L2NvZGU+IG9iamVjdC5cblx0ICovXG5cdGNvbnN0cnVjdG9yKHRhcmdldE9iamVjdDpEaXNwbGF5T2JqZWN0ID0gbnVsbCwgbG9va0F0T2JqZWN0OkRpc3BsYXlPYmplY3QgPSBudWxsLCBwYW5BbmdsZTpudW1iZXIgPSAwLCB0aWx0QW5nbGU6bnVtYmVyID0gOTAsIGRpc3RhbmNlOm51bWJlciA9IDEwMDAsIG1pblRpbHRBbmdsZTpudW1iZXIgPSAtOTAsIG1heFRpbHRBbmdsZTpudW1iZXIgPSA5MCwgbWluUGFuQW5nbGU6bnVtYmVyID0gbnVsbCwgbWF4UGFuQW5nbGU6bnVtYmVyID0gbnVsbCwgc3RlcHM6bnVtYmVyID0gOCwgeUZhY3RvcjpudW1iZXIgPSAyLCB3cmFwUGFuQW5nbGU6Ym9vbGVhbiA9IGZhbHNlKVxuXHR7XG5cdFx0c3VwZXIodGFyZ2V0T2JqZWN0LCBsb29rQXRPYmplY3QpO1xuXG5cdFx0dGhpcy5kaXN0YW5jZSA9IGRpc3RhbmNlO1xuXHRcdHRoaXMucGFuQW5nbGUgPSBwYW5BbmdsZTtcblx0XHR0aGlzLnRpbHRBbmdsZSA9IHRpbHRBbmdsZTtcblx0XHR0aGlzLm1pblBhbkFuZ2xlID0gKCBtaW5QYW5BbmdsZSAhPSBudWxsICk/IG1pblBhbkFuZ2xlIDogLUluZmluaXR5O1xuXHRcdHRoaXMubWF4UGFuQW5nbGUgPSAoIG1heFBhbkFuZ2xlICE9IG51bGwgKT8gbWF4UGFuQW5nbGUgOiBJbmZpbml0eTtcblx0XHR0aGlzLm1pblRpbHRBbmdsZSA9IG1pblRpbHRBbmdsZTtcblx0XHR0aGlzLm1heFRpbHRBbmdsZSA9IG1heFRpbHRBbmdsZTtcblx0XHR0aGlzLnN0ZXBzID0gc3RlcHM7XG5cdFx0dGhpcy55RmFjdG9yID0geUZhY3Rvcjtcblx0XHR0aGlzLndyYXBQYW5BbmdsZSA9IHdyYXBQYW5BbmdsZTtcblxuXHRcdC8vdmFsdWVzIHBhc3NlZCBpbiBjb250cnVzdG9yIGFyZSBhcHBsaWVkIGltbWVkaWF0ZWx5XG5cdFx0dGhpcy5faUN1cnJlbnRQYW5BbmdsZSA9IHRoaXMuX3BhbkFuZ2xlO1xuXHRcdHRoaXMuX2lDdXJyZW50VGlsdEFuZ2xlID0gdGhpcy5fdGlsdEFuZ2xlO1xuXHR9XG5cblx0LyoqXG5cdCAqIFVwZGF0ZXMgdGhlIGN1cnJlbnQgdGlsdCBhbmdsZSBhbmQgcGFuIGFuZ2xlIHZhbHVlcy5cblx0ICpcblx0ICogVmFsdWVzIGFyZSBjYWxjdWxhdGVkIHVzaW5nIHRoZSBkZWZpbmVkIDxjb2RlPnRpbHRBbmdsZTwvY29kZT4sIDxjb2RlPnBhbkFuZ2xlPC9jb2RlPiBhbmQgPGNvZGU+c3RlcHM8L2NvZGU+IHZhcmlhYmxlcy5cblx0ICpcblx0ICogQHBhcmFtIGludGVycG9sYXRlICAgSWYgdGhlIHVwZGF0ZSB0byBhIHRhcmdldCBwYW4tIG9yIHRpbHRBbmdsZSBpcyBpbnRlcnBvbGF0ZWQuIERlZmF1bHQgaXMgdHJ1ZS5cblx0ICpcblx0ICogQHNlZSAgICAjdGlsdEFuZ2xlXG5cdCAqIEBzZWUgICAgI3BhbkFuZ2xlXG5cdCAqIEBzZWUgICAgI3N0ZXBzXG5cdCAqL1xuXHRwdWJsaWMgdXBkYXRlKGludGVycG9sYXRlOmJvb2xlYW4gPSB0cnVlKVxuXHR7XG5cdFx0aWYgKHRoaXMuX3RpbHRBbmdsZSAhPSB0aGlzLl9pQ3VycmVudFRpbHRBbmdsZSB8fCB0aGlzLl9wYW5BbmdsZSAhPSB0aGlzLl9pQ3VycmVudFBhbkFuZ2xlKSB7XG5cblx0XHRcdHRoaXMucE5vdGlmeVVwZGF0ZSgpO1xuXG5cdFx0XHRpZiAodGhpcy5fd3JhcFBhbkFuZ2xlKSB7XG5cdFx0XHRcdGlmICh0aGlzLl9wYW5BbmdsZSA8IDApIHtcblx0XHRcdFx0XHR0aGlzLl9pQ3VycmVudFBhbkFuZ2xlICs9IHRoaXMuX3BhbkFuZ2xlJTM2MCArIDM2MCAtIHRoaXMuX3BhbkFuZ2xlO1xuXHRcdFx0XHRcdHRoaXMuX3BhbkFuZ2xlID0gdGhpcy5fcGFuQW5nbGUlMzYwICsgMzYwO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX2lDdXJyZW50UGFuQW5nbGUgKz0gdGhpcy5fcGFuQW5nbGUlMzYwIC0gdGhpcy5fcGFuQW5nbGU7XG5cdFx0XHRcdFx0dGhpcy5fcGFuQW5nbGUgPSB0aGlzLl9wYW5BbmdsZSUzNjA7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHR3aGlsZSAodGhpcy5fcGFuQW5nbGUgLSB0aGlzLl9pQ3VycmVudFBhbkFuZ2xlIDwgLTE4MClcblx0XHRcdFx0XHR0aGlzLl9pQ3VycmVudFBhbkFuZ2xlIC09IDM2MDtcblxuXHRcdFx0XHR3aGlsZSAodGhpcy5fcGFuQW5nbGUgLSB0aGlzLl9pQ3VycmVudFBhbkFuZ2xlID4gMTgwKVxuXHRcdFx0XHRcdHRoaXMuX2lDdXJyZW50UGFuQW5nbGUgKz0gMzYwO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoaW50ZXJwb2xhdGUpIHtcblx0XHRcdFx0dGhpcy5faUN1cnJlbnRUaWx0QW5nbGUgKz0gKHRoaXMuX3RpbHRBbmdsZSAtIHRoaXMuX2lDdXJyZW50VGlsdEFuZ2xlKS8odGhpcy5zdGVwcyArIDEpO1xuXHRcdFx0XHR0aGlzLl9pQ3VycmVudFBhbkFuZ2xlICs9ICh0aGlzLl9wYW5BbmdsZSAtIHRoaXMuX2lDdXJyZW50UGFuQW5nbGUpLyh0aGlzLnN0ZXBzICsgMSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9pQ3VycmVudFBhbkFuZ2xlID0gdGhpcy5fcGFuQW5nbGU7XG5cdFx0XHRcdHRoaXMuX2lDdXJyZW50VGlsdEFuZ2xlID0gdGhpcy5fdGlsdEFuZ2xlO1xuXHRcdFx0fVxuXG5cdFx0XHQvL3NuYXAgY29vcmRzIGlmIGFuZ2xlIGRpZmZlcmVuY2VzIGFyZSBjbG9zZVxuXHRcdFx0aWYgKChNYXRoLmFicyh0aGlzLnRpbHRBbmdsZSAtIHRoaXMuX2lDdXJyZW50VGlsdEFuZ2xlKSA8IDAuMDEpICYmIChNYXRoLmFicyh0aGlzLl9wYW5BbmdsZSAtIHRoaXMuX2lDdXJyZW50UGFuQW5nbGUpIDwgMC4wMSkpIHtcblx0XHRcdFx0dGhpcy5faUN1cnJlbnRUaWx0QW5nbGUgPSB0aGlzLl90aWx0QW5nbGU7XG5cdFx0XHRcdHRoaXMuX2lDdXJyZW50UGFuQW5nbGUgPSB0aGlzLl9wYW5BbmdsZTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHR2YXIgcG9zOlZlY3RvcjNEID0gKHRoaXMubG9va0F0T2JqZWN0KT8gdGhpcy5sb29rQXRPYmplY3QudHJhbnNmb3JtLnBvc2l0aW9uIDogKHRoaXMubG9va0F0UG9zaXRpb24pPyB0aGlzLmxvb2tBdFBvc2l0aW9uIDogdGhpcy5fcE9yaWdpbjtcblx0XHR0aGlzLnRhcmdldE9iamVjdC54ID0gcG9zLnggKyB0aGlzLmRpc3RhbmNlKk1hdGguc2luKHRoaXMuX2lDdXJyZW50UGFuQW5nbGUqTWF0aENvbnN0cy5ERUdSRUVTX1RPX1JBRElBTlMpKk1hdGguY29zKHRoaXMuX2lDdXJyZW50VGlsdEFuZ2xlKk1hdGhDb25zdHMuREVHUkVFU19UT19SQURJQU5TKTtcblx0XHR0aGlzLnRhcmdldE9iamVjdC55ID0gcG9zLnkgKyB0aGlzLmRpc3RhbmNlKk1hdGguc2luKHRoaXMuX2lDdXJyZW50VGlsdEFuZ2xlKk1hdGhDb25zdHMuREVHUkVFU19UT19SQURJQU5TKSp0aGlzLnlGYWN0b3I7XG5cdFx0dGhpcy50YXJnZXRPYmplY3QueiA9IHBvcy56ICsgdGhpcy5kaXN0YW5jZSpNYXRoLmNvcyh0aGlzLl9pQ3VycmVudFBhbkFuZ2xlKk1hdGhDb25zdHMuREVHUkVFU19UT19SQURJQU5TKSpNYXRoLmNvcyh0aGlzLl9pQ3VycmVudFRpbHRBbmdsZSpNYXRoQ29uc3RzLkRFR1JFRVNfVE9fUkFESUFOUyk7XG5cblx0XHR0aGlzLl91cEF4aXMueCA9IC1NYXRoLnNpbih0aGlzLl9pQ3VycmVudFBhbkFuZ2xlKk1hdGhDb25zdHMuREVHUkVFU19UT19SQURJQU5TKSpNYXRoLnNpbih0aGlzLl9pQ3VycmVudFRpbHRBbmdsZSpNYXRoQ29uc3RzLkRFR1JFRVNfVE9fUkFESUFOUyk7XG5cdFx0dGhpcy5fdXBBeGlzLnkgPSBNYXRoLmNvcyh0aGlzLl9pQ3VycmVudFRpbHRBbmdsZSpNYXRoQ29uc3RzLkRFR1JFRVNfVE9fUkFESUFOUyk7XG5cdFx0dGhpcy5fdXBBeGlzLnogPSAtTWF0aC5jb3ModGhpcy5faUN1cnJlbnRQYW5BbmdsZSpNYXRoQ29uc3RzLkRFR1JFRVNfVE9fUkFESUFOUykqTWF0aC5zaW4odGhpcy5faUN1cnJlbnRUaWx0QW5nbGUqTWF0aENvbnN0cy5ERUdSRUVTX1RPX1JBRElBTlMpO1xuXG5cdFx0aWYgKHRoaXMuX3BUYXJnZXRPYmplY3QpIHtcblx0XHRcdGlmICh0aGlzLl9wTG9va0F0UG9zaXRpb24pXG5cdFx0XHRcdHRoaXMuX3BUYXJnZXRPYmplY3QubG9va0F0KHRoaXMuX3BMb29rQXRQb3NpdGlvbiwgdGhpcy5fdXBBeGlzKTtcblx0XHRcdGVsc2UgaWYgKHRoaXMuX3BMb29rQXRPYmplY3QpXG5cdFx0XHRcdHRoaXMuX3BUYXJnZXRPYmplY3QubG9va0F0KHRoaXMuX3BMb29rQXRPYmplY3Quc2NlbmU/IHRoaXMuX3BMb29rQXRPYmplY3Quc2NlbmVQb3NpdGlvbiA6IHRoaXMuX3BMb29rQXRPYmplY3QudHJhbnNmb3JtLnBvc2l0aW9uLCB0aGlzLl91cEF4aXMpO1xuXHRcdH1cblx0fVxufVxuXG5leHBvcnQgPSBIb3ZlckNvbnRyb2xsZXI7Il19