var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var PlaneClassification = require("awayjs-core/lib/geom/PlaneClassification");
var BoundingVolumeBase = require("awayjs-display/lib/bounds/BoundingVolumeBase");
var PrimitiveSpherePrefab = require("awayjs-display/lib/prefabs/PrimitiveSpherePrefab");
var BoundingSphere = (function (_super) {
    __extends(BoundingSphere, _super);
    function BoundingSphere(entity) {
        _super.call(this, entity);
        this._radius = 0;
        this._centerX = 0;
        this._centerY = 0;
        this._centerZ = 0;
    }
    BoundingSphere.prototype.nullify = function () {
        this._centerX = this._centerY = this._centerZ = 0;
        this._radius = 0;
    };
    BoundingSphere.prototype.isInFrustum = function (planes, numPlanes) {
        if (this._pInvalidated)
            this._pUpdate();
        for (var i = 0; i < numPlanes; ++i) {
            var plane = planes[i];
            var flippedExtentX = plane.a < 0 ? -this._radius : this._radius;
            var flippedExtentY = plane.b < 0 ? -this._radius : this._radius;
            var flippedExtentZ = plane.c < 0 ? -this._radius : this._radius;
            var projDist = plane.a * (this._centerX + flippedExtentX) + plane.b * (this._centerY + flippedExtentY) + plane.c * (this._centerZ + flippedExtentZ) - plane.d;
            if (projDist < 0) {
                return false;
            }
        }
        return true;
    };
    BoundingSphere.prototype.rayIntersection = function (position, direction, targetNormal) {
        if (this._pInvalidated)
            this._pUpdate();
        return this._sphere.rayIntersection(position, direction, targetNormal);
    };
    //@override
    BoundingSphere.prototype.classifyToPlane = function (plane) {
        var a = plane.a;
        var b = plane.b;
        var c = plane.c;
        var dd = a * this._centerX + b * this._centerY + c * this._centerZ - plane.d;
        if (a < 0)
            a = -a;
        if (b < 0)
            b = -b;
        if (c < 0)
            c = -c;
        var rr = (a + b + c) * this._radius;
        return dd > rr ? PlaneClassification.FRONT : dd < -rr ? PlaneClassification.BACK : PlaneClassification.INTERSECT;
    };
    BoundingSphere.prototype._pUpdate = function () {
        _super.prototype._pUpdate.call(this);
        this._sphere = this._pEntity.getSphere();
        var matrix = this._pEntity.sceneTransform;
        var cx = this._sphere.x;
        var cy = this._sphere.y;
        var cz = this._sphere.z;
        var r = this._sphere.radius;
        var raw = new Array(16);
        matrix.copyRawDataTo(raw);
        var m11 = raw[0], m12 = raw[4], m13 = raw[8], m14 = raw[12];
        var m21 = raw[1], m22 = raw[5], m23 = raw[9], m24 = raw[13];
        var m31 = raw[2], m32 = raw[6], m33 = raw[10], m34 = raw[14];
        this._centerX = cx * m11 + cy * m12 + cz * m13 + m14;
        this._centerY = cx * m21 + cy * m22 + cz * m23 + m24;
        this._centerZ = cx * m31 + cy * m32 + cz * m33 + m34;
        var rx = m11 + m12 + m13;
        var ry = m21 + m22 + m23;
        var rz = m31 + m32 + m33;
        this._radius = r * Math.sqrt((rx * rx + ry * ry + rz * rz) / 3);
        if (this._prefab) {
            this._prefab.radius = r;
            this._pBoundsPrimitive.x = cx;
            this._pBoundsPrimitive.y = cy;
            this._pBoundsPrimitive.z = cz;
            this._pBoundsPrimitive.transform.matrix3D = matrix;
        }
    };
    BoundingSphere.prototype._pCreateBoundsPrimitive = function () {
        this._prefab = new PrimitiveSpherePrefab();
        this._prefab.geometryType = "lineSubGeometry";
        return this._prefab.getNewObject();
    };
    return BoundingSphere;
})(BoundingVolumeBase);
module.exports = BoundingSphere;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1kaXNwbGF5L2xpYi9ib3VuZHMvQm91bmRpbmdTcGhlcmUudHMiXSwibmFtZXMiOlsiQm91bmRpbmdTcGhlcmUiLCJCb3VuZGluZ1NwaGVyZS5jb25zdHJ1Y3RvciIsIkJvdW5kaW5nU3BoZXJlLm51bGxpZnkiLCJCb3VuZGluZ1NwaGVyZS5pc0luRnJ1c3R1bSIsIkJvdW5kaW5nU3BoZXJlLnJheUludGVyc2VjdGlvbiIsIkJvdW5kaW5nU3BoZXJlLmNsYXNzaWZ5VG9QbGFuZSIsIkJvdW5kaW5nU3BoZXJlLl9wVXBkYXRlIiwiQm91bmRpbmdTcGhlcmUuX3BDcmVhdGVCb3VuZHNQcmltaXRpdmUiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUVBLElBQU8sbUJBQW1CLFdBQWEsMENBQTBDLENBQUMsQ0FBQztBQUtuRixJQUFPLGtCQUFrQixXQUFhLDhDQUE4QyxDQUFDLENBQUM7QUFHdEYsSUFBTyxxQkFBcUIsV0FBWSxrREFBa0QsQ0FBQyxDQUFDO0FBRTVGLElBQU0sY0FBYztJQUFTQSxVQUF2QkEsY0FBY0EsVUFBMkJBO0lBUzlDQSxTQVRLQSxjQUFjQSxDQVNQQSxNQUFjQTtRQUV6QkMsa0JBQU1BLE1BQU1BLENBQUNBLENBQUNBO1FBUlBBLFlBQU9BLEdBQVVBLENBQUNBLENBQUNBO1FBQ25CQSxhQUFRQSxHQUFVQSxDQUFDQSxDQUFDQTtRQUNwQkEsYUFBUUEsR0FBVUEsQ0FBQ0EsQ0FBQ0E7UUFDcEJBLGFBQVFBLEdBQVVBLENBQUNBLENBQUNBO0lBTTVCQSxDQUFDQTtJQUVNRCxnQ0FBT0EsR0FBZEE7UUFFQ0UsSUFBSUEsQ0FBQ0EsUUFBUUEsR0FBR0EsSUFBSUEsQ0FBQ0EsUUFBUUEsR0FBR0EsSUFBSUEsQ0FBQ0EsUUFBUUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDbERBLElBQUlBLENBQUNBLE9BQU9BLEdBQUdBLENBQUNBLENBQUNBO0lBQ2xCQSxDQUFDQTtJQUVNRixvQ0FBV0EsR0FBbEJBLFVBQW1CQSxNQUFxQkEsRUFBRUEsU0FB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QUFHQSxHQUFVQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxFQUFFQSxHQUFHQSxHQUFVQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxFQUFFQSxHQUFHQSxHQUFVQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxFQUFFQSxHQUFHQSxHQUFVQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQTtRQUN4RkEsSUFBSUEsR0FBR0EsR0FBVUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsR0FBR0EsR0FBVUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsR0FBR0EsR0FBVUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsR0FBR0EsR0FBVUEsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0E7UUFDeEZBLElBQUlBLEdBQUdBLEdBQVVBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEVBQUVBLEdBQUdBLEdBQVVBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEVBQUVBLEdBQUdBLEdBQVVBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEVBQUVBLEdBQUdBLEdBQVVBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBO1FBRXpGQSxJQUFJQSxDQUFDQSxRQUFRQSxHQUFHQSxFQUFFQSxHQUFDQSxHQUFHQSxHQUFHQSxFQUFFQSxHQUFDQSxHQUFHQSxHQUFHQSxFQUFFQSxHQUFDQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQTtRQUMvQ0EsSUFBSUEsQ0FBQ0EsUUFBUUEsR0FBR0EsRUFBRUEsR0FBQ0EsR0FBR0EsR0FBR0EsRUFBRUEsR0FBQ0EsR0FBR0EsR0FBR0EsRUFBRUEsR0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0E7UUFDL0NBLElBQUlBLENBQUNBLFFBQVFBLEdBQUdBLEVBQUVBLEdBQUNBLEdBQUdBLEdBQUdBLEVBQUVBLEdBQUNBLEdBQUdBLEdBQUdBLEVBQUVBLEdBQUNBLEdBQUdBLEdBQUdBLEdBQUdBLENBQUNBO1FBRS9DQSxJQUFJQSxFQUFFQSxHQUFVQSxHQUFHQSxHQUFHQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQTtRQUNoQ0EsSUFBSUEsRUFBRUEsR0FBVUEsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0E7UUFDaENBLElBQUlBLEVBQUVBLEdBQVVBLEdBQUdBLEdBQUdBLEdBQUdBLEdBQUdBLEdBQUdBLENBQUNBO1FBQ2hDQSxJQUFJQSxDQUFDQSxPQUFPQSxHQUFHQSxDQUFDQSxHQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxFQUFFQSxHQUFDQSxFQUFFQSxHQUFHQSxFQUFFQSxHQUFDQSxFQUFFQSxHQUFHQSxFQUFFQSxHQUFDQSxFQUFFQSxDQUFDQSxHQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUV0REEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDbEJBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLE1BQU1BLEdBQUdBLENBQUNBLENBQUNBO1lBQ3hCQSxJQUFJQSxDQUFDQSxpQkFBaUJBLENBQUNBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBO1lBQzlCQSxJQUFJQSxDQUFDQSxpQkFBaUJBLENBQUNBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBO1lBQzlCQSxJQUFJQSxDQUFDQSxpQkFBaUJBLENBQUNBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBO1lBQzlCQSxJQUFJQSxDQUFDQSxpQkFBaUJBLENBQUNBLFNBQVNBLENBQUNBLFFBQVFBLEdBQUdBLE1BQU1BLENBQUNBO1FBQ3BEQSxDQUFDQTtJQUNGQSxDQUFDQTtJQUVNTixnREFBdUJBLEdBQTlCQTtRQUVDTyxJQUFJQSxDQUFDQSxPQUFPQSxHQUFHQSxJQUFJQSxxQkFBcUJBLEVBQUVBLENBQUNBO1FBQzNDQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxZQUFZQSxHQUFHQSxpQkFBaUJBLENBQUNBO1FBRTlDQSxNQUFNQSxDQUFRQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxZQUFZQSxFQUFFQSxDQUFDQTtJQUMzQ0EsQ0FBQ0E7SUFDRlAscUJBQUNBO0FBQURBLENBaEhBLEFBZ0hDQSxFQWhINEIsa0JBQWtCLEVBZ0g5QztBQUVELEFBQXdCLGlCQUFmLGNBQWMsQ0FBQyIsImZpbGUiOiJib3VuZHMvQm91bmRpbmdTcGhlcmUuanMiLCJzb3VyY2VSb290IjoiLi4vIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IE1hdHJpeDNEXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vTWF0cml4M0RcIik7XG5pbXBvcnQgTWF0cml4M0RVdGlsc1x0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vTWF0cml4M0RVdGlsc1wiKTtcbmltcG9ydCBQbGFuZUNsYXNzaWZpY2F0aW9uXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vUGxhbmVDbGFzc2lmaWNhdGlvblwiKTtcbmltcG9ydCBQbGFuZTNEXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vUGxhbmUzRFwiKTtcbmltcG9ydCBTcGhlcmVcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9TcGhlcmVcIik7XG5pbXBvcnQgVmVjdG9yM0RcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9WZWN0b3IzRFwiKTtcblxuaW1wb3J0IEJvdW5kaW5nVm9sdW1lQmFzZVx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9ib3VuZHMvQm91bmRpbmdWb2x1bWVCYXNlXCIpO1xuaW1wb3J0IElFbnRpdHlcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvZW50aXRpZXMvSUVudGl0eVwiKTtcbmltcG9ydCBNZXNoXHRcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvZW50aXRpZXMvTWVzaFwiKTtcbmltcG9ydCBQcmltaXRpdmVTcGhlcmVQcmVmYWJcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL3ByZWZhYnMvUHJpbWl0aXZlU3BoZXJlUHJlZmFiXCIpO1xuXG5jbGFzcyBCb3VuZGluZ1NwaGVyZSBleHRlbmRzIEJvdW5kaW5nVm9sdW1lQmFzZVxue1xuXHRwcml2YXRlIF9zcGhlcmU6U3BoZXJlO1xuXHRwcml2YXRlIF9yYWRpdXM6bnVtYmVyID0gMDtcblx0cHJpdmF0ZSBfY2VudGVyWDpudW1iZXIgPSAwO1xuXHRwcml2YXRlIF9jZW50ZXJZOm51bWJlciA9IDA7XG5cdHByaXZhdGUgX2NlbnRlclo6bnVtYmVyID0gMDtcblx0cHJpdmF0ZSBfcHJlZmFiOlByaW1pdGl2ZVNwaGVyZVByZWZhYjtcblxuXHRjb25zdHJ1Y3RvcihlbnRpdHk6SUVudGl0eSlcblx0e1xuXHRcdHN1cGVyKGVudGl0eSk7XG5cdH1cblxuXHRwdWJsaWMgbnVsbGlmeSgpXG5cdHtcblx0XHR0aGlzLl9jZW50ZXJYID0gdGhpcy5fY2VudGVyWSA9IHRoaXMuX2NlbnRlclogPSAwO1xuXHRcdHRoaXMuX3JhZGl1cyA9IDA7XG5cdH1cblxuXHRwdWJsaWMgaXNJbkZydXN0dW0ocGxhbmVzOkFycmF5PFBsYW5lM0Q+LCBudW1QbGFuZXM6bnVtYmVyKTpib29sZWFuXG5cdHtcblx0XHRpZih0aGlzLl9wSW52YWxpZGF0ZWQpXG5cdFx0XHR0aGlzLl9wVXBkYXRlKCk7XG5cblx0XHRmb3IgKHZhciBpOm51bWJlciA9IDA7IGkgPCBudW1QbGFuZXM7ICsraSkge1xuXHRcdFx0dmFyIHBsYW5lOlBsYW5lM0QgPSBwbGFuZXNbaV07XG5cdFx0XHR2YXIgZmxpcHBlZEV4dGVudFg6bnVtYmVyID0gcGxhbmUuYSA8IDA/IC10aGlzLl9yYWRpdXMgOiB0aGlzLl9yYWRpdXM7XG5cdFx0XHR2YXIgZmxpcHBlZEV4dGVudFk6bnVtYmVyID0gcGxhbmUuYiA8IDA/IC10aGlzLl9yYWRpdXMgOiB0aGlzLl9yYWRpdXM7XG5cdFx0XHR2YXIgZmxpcHBlZEV4dGVudFo6bnVtYmVyID0gcGxhbmUuYyA8IDA/IC10aGlzLl9yYWRpdXMgOiB0aGlzLl9yYWRpdXM7XG5cdFx0XHR2YXIgcHJvakRpc3Q6bnVtYmVyID0gcGxhbmUuYSooIHRoaXMuX2NlbnRlclggKyBmbGlwcGVkRXh0ZW50WCApICsgcGxhbmUuYiooIHRoaXMuX2NlbnRlclkgKyBmbGlwcGVkRXh0ZW50WSkgKyBwbGFuZS5jKiggdGhpcy5fY2VudGVyWiArIGZsaXBwZWRFeHRlbnRaICkgLSBwbGFuZS5kO1xuXHRcdFx0aWYgKHByb2pEaXN0IDwgMCkge1xuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0cHVibGljIHJheUludGVyc2VjdGlvbihwb3NpdGlvbjpWZWN0b3IzRCwgZGlyZWN0aW9uOlZlY3RvcjNELCB0YXJnZXROb3JtYWw6VmVjdG9yM0QpOm51bWJlclxuXHR7XG5cdFx0aWYodGhpcy5fcEludmFsaWRhdGVkKVxuXHRcdFx0dGhpcy5fcFVwZGF0ZSgpO1xuXG5cdFx0cmV0dXJuIHRoaXMuX3NwaGVyZS5yYXlJbnRlcnNlY3Rpb24ocG9zaXRpb24sIGRpcmVjdGlvbiwgdGFyZ2V0Tm9ybWFsKTtcblx0fVxuXG5cdC8vQG92ZXJyaWRlXG5cdHB1YmxpYyBjbGFzc2lmeVRvUGxhbmUocGxhbmU6UGxhbmUzRCk6bnVtYmVyXG5cdHtcblx0XHR2YXIgYTpudW1iZXIgPSBwbGFuZS5hO1xuXHRcdHZhciBiOm51bWJlciA9IHBsYW5lLmI7XG5cdFx0dmFyIGM6bnVtYmVyID0gcGxhbmUuYztcblx0XHR2YXIgZGQ6bnVtYmVyID0gYSp0aGlzLl9jZW50ZXJYICsgYip0aGlzLl9jZW50ZXJZICsgYyp0aGlzLl9jZW50ZXJaIC0gcGxhbmUuZDtcblxuXHRcdGlmIChhIDwgMClcblx0XHRcdGEgPSAtYTtcblxuXHRcdGlmIChiIDwgMClcblx0XHRcdGIgPSAtYjtcblxuXHRcdGlmIChjIDwgMClcblx0XHRcdGMgPSAtYztcblxuXHRcdHZhciBycjpOdW1iZXIgPSAoYSArIGIgKyBjKSp0aGlzLl9yYWRpdXM7XG5cblx0XHRyZXR1cm4gZGQgPiBycj8gUGxhbmVDbGFzc2lmaWNhdGlvbi5GUk9OVCA6IGRkIDwgLXJyPyBQbGFuZUNsYXNzaWZpY2F0aW9uLkJBQ0sgOiBQbGFuZUNsYXNzaWZpY2F0aW9uLklOVEVSU0VDVDtcblx0fVxuXG5cdHB1YmxpYyBfcFVwZGF0ZSgpXG5cdHtcblx0XHRzdXBlci5fcFVwZGF0ZSgpO1xuXG5cdFx0dGhpcy5fc3BoZXJlID0gdGhpcy5fcEVudGl0eS5nZXRTcGhlcmUoKTtcblx0XHR2YXIgbWF0cml4Ok1hdHJpeDNEID0gdGhpcy5fcEVudGl0eS5zY2VuZVRyYW5zZm9ybTtcblxuXHRcdHZhciBjeDpudW1iZXIgPSB0aGlzLl9zcGhlcmUueDtcblx0XHR2YXIgY3k6bnVtYmVyID0gdGhpcy5fc3BoZXJlLnk7XG5cdFx0dmFyIGN6Om51bWJlciA9IHRoaXMuX3NwaGVyZS56O1xuXHRcdHZhciByOm51bWJlciA9IHRoaXMuX3NwaGVyZS5yYWRpdXM7XG5cblx0XHR2YXIgcmF3OkFycmF5PG51bWJlcj4gPSBuZXcgQXJyYXk8bnVtYmVyPigxNik7XG5cdFx0bWF0cml4LmNvcHlSYXdEYXRhVG8ocmF3KTtcblxuXHRcdHZhciBtMTE6bnVtYmVyID0gcmF3WzBdLCBtMTI6bnVtYmVyID0gcmF3WzRdLCBtMTM6bnVtYmVyID0gcmF3WzhdLCBtMTQ6bnVtYmVyID0gcmF3WzEyXTtcblx0XHR2YXIgbTIxOm51bWJlciA9IHJhd1sxXSwgbTIyOm51bWJlciA9IHJhd1s1XSwgbTIzOm51bWJlciA9IHJhd1s5XSwgbTI0Om51bWJlciA9IHJhd1sxM107XG5cdFx0dmFyIG0zMTpudW1iZXIgPSByYXdbMl0sIG0zMjpudW1iZXIgPSByYXdbNl0sIG0zMzpudW1iZXIgPSByYXdbMTBdLCBtMzQ6bnVtYmVyID0gcmF3WzE0XTtcblxuXHRcdHRoaXMuX2NlbnRlclggPSBjeCptMTEgKyBjeSptMTIgKyBjeiptMTMgKyBtMTQ7XG5cdFx0dGhpcy5fY2VudGVyWSA9IGN4Km0yMSArIGN5Km0yMiArIGN6Km0yMyArIG0yNDtcblx0XHR0aGlzLl9jZW50ZXJaID0gY3gqbTMxICsgY3kqbTMyICsgY3oqbTMzICsgbTM0O1xuXG5cdFx0dmFyIHJ4Om51bWJlciA9IG0xMSArIG0xMiArIG0xMztcblx0XHR2YXIgcnk6bnVtYmVyID0gbTIxICsgbTIyICsgbTIzO1xuXHRcdHZhciByejpudW1iZXIgPSBtMzEgKyBtMzIgKyBtMzM7XG5cdFx0dGhpcy5fcmFkaXVzID0gcipNYXRoLnNxcnQoKHJ4KnJ4ICsgcnkqcnkgKyByeipyeikvMyk7XG5cblx0XHRpZiAodGhpcy5fcHJlZmFiKSB7XG5cdFx0XHR0aGlzLl9wcmVmYWIucmFkaXVzID0gcjtcblx0XHRcdHRoaXMuX3BCb3VuZHNQcmltaXRpdmUueCA9IGN4O1xuXHRcdFx0dGhpcy5fcEJvdW5kc1ByaW1pdGl2ZS55ID0gY3k7XG5cdFx0XHR0aGlzLl9wQm91bmRzUHJpbWl0aXZlLnogPSBjejtcblx0XHRcdHRoaXMuX3BCb3VuZHNQcmltaXRpdmUudHJhbnNmb3JtLm1hdHJpeDNEID0gbWF0cml4O1xuXHRcdH1cblx0fVxuXG5cdHB1YmxpYyBfcENyZWF0ZUJvdW5kc1ByaW1pdGl2ZSgpOk1lc2hcblx0e1xuXHRcdHRoaXMuX3ByZWZhYiA9IG5ldyBQcmltaXRpdmVTcGhlcmVQcmVmYWIoKTtcblx0XHR0aGlzLl9wcmVmYWIuZ2VvbWV0cnlUeXBlID0gXCJsaW5lU3ViR2VvbWV0cnlcIjtcblxuXHRcdHJldHVybiA8TWVzaD4gdGhpcy5fcHJlZmFiLmdldE5ld09iamVjdCgpO1xuXHR9XG59XG5cbmV4cG9ydCA9IEJvdW5kaW5nU3BoZXJlOyJdfQ==