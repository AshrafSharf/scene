var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var PlaneClassification = require("awayjs-core/lib/geom/PlaneClassification");
var BoundingVolumeBase = require("awayjs-display/lib/bounds/BoundingVolumeBase");
var PrimitiveSpherePrefab = require("awayjs-display/lib/prefabs/PrimitiveSpherePrefab");
var BoundingSphere = (function (_super) {
    __extends(BoundingSphere, _super);
    function BoundingSphere(entity) {
        _super.call(this, entity);
        this._radius = 0;
        this._centerX = 0;
        this._centerY = 0;
        this._centerZ = 0;
    }
    BoundingSphere.prototype.nullify = function () {
        this._centerX = this._centerY = this._centerZ = 0;
        this._radius = 0;
    };
    BoundingSphere.prototype.isInFrustum = function (planes, numPlanes) {
        if (this._pInvalidated)
            this._pUpdate();
        for (var i = 0; i < numPlanes; ++i) {
            var plane = planes[i];
            var flippedExtentX = plane.a < 0 ? -this._radius : this._radius;
            var flippedExtentY = plane.b < 0 ? -this._radius : this._radius;
            var flippedExtentZ = plane.c < 0 ? -this._radius : this._radius;
            var projDist = plane.a * (this._centerX + flippedExtentX) + plane.b * (this._centerY + flippedExtentY) + plane.c * (this._centerZ + flippedExtentZ) - plane.d;
            if (projDist < 0) {
                return false;
            }
        }
        return true;
    };
    BoundingSphere.prototype.rayIntersection = function (position, direction, targetNormal) {
        if (this._pInvalidated)
            this._pUpdate();
        return this._sphere.rayIntersection(position, direction, targetNormal);
    };
    //@override
    BoundingSphere.prototype.classifyToPlane = function (plane) {
        var a = plane.a;
        var b = plane.b;
        var c = plane.c;
        var dd = a * this._centerX + b * this._centerY + c * this._centerZ - plane.d;
        if (a < 0)
            a = -a;
        if (b < 0)
            b = -b;
        if (c < 0)
            c = -c;
        var rr = (a + b + c) * this._radius;
        return dd > rr ? PlaneClassification.FRONT : dd < -rr ? PlaneClassification.BACK : PlaneClassification.INTERSECT;
    };
    BoundingSphere.prototype._pUpdate = function () {
        _super.prototype._pUpdate.call(this);
        this._sphere = this._pEntity.getSphere();
        var matrix = this._pEntity.sceneTransform;
        var cx = this._sphere.x;
        var cy = this._sphere.y;
        var cz = this._sphere.z;
        var r = this._sphere.radius;
        var raw = new Array(16);
        matrix.copyRawDataTo(raw);
        var m11 = raw[0], m12 = raw[4], m13 = raw[8], m14 = raw[12];
        var m21 = raw[1], m22 = raw[5], m23 = raw[9], m24 = raw[13];
        var m31 = raw[2], m32 = raw[6], m33 = raw[10], m34 = raw[14];
        this._centerX = cx * m11 + cy * m12 + cz * m13 + m14;
        this._centerY = cx * m21 + cy * m22 + cz * m23 + m24;
        this._centerZ = cx * m31 + cy * m32 + cz * m33 + m34;
        var rx = m11 + m12 + m13;
        var ry = m21 + m22 + m23;
        var rz = m31 + m32 + m33;
        this._radius = r * Math.sqrt((rx * rx + ry * ry + rz * rz) / 3);
        if (this._prefab) {
            this._prefab.radius = r;
            this._pBoundsPrimitive.x = cx;
            this._pBoundsPrimitive.y = cy;
            this._pBoundsPrimitive.z = cz;
            this._pBoundsPrimitive.transform.matrix3D = matrix;
        }
    };
    BoundingSphere.prototype._pCreateBoundsPrimitive = function () {
        this._prefab = new PrimitiveSpherePrefab();
        this._prefab.geometryType = "lineSubGeometry";
        return this._prefab.getNewObject();
    };
    return BoundingSphere;
})(BoundingVolumeBase);
module.exports = BoundingSphere;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1kaXNwbGF5L2xpYi9ib3VuZHMvQm91bmRpbmdTcGhlcmUudHMiXSwibmFtZXMiOlsiQm91bmRpbmdTcGhlcmUiLCJCb3VuZGluZ1NwaGVyZS5jb25zdHJ1Y3RvciIsIkJvdW5kaW5nU3BoZXJlLm51bGxpZnkiLCJCb3VuZGluZ1NwaGVyZS5pc0luRnJ1c3R1bSIsIkJvdW5kaW5nU3BoZXJlLnJheUludGVyc2VjdGlvbiIsIkJvdW5kaW5nU3BoZXJlLmNsYXNzaWZ5VG9QbGFuZSIsIkJvdW5kaW5nU3BoZXJlLl9wVXBkYXRlIiwiQm91bmRpbmdTcGhlcmUuX3BDcmVhdGVCb3VuZHNQcmltaXRpdmUiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUVBLElBQU8sbUJBQW1CLFdBQWEsMENBQTBDLENBQUMsQ0FBQztBQUtuRixJQUFPLGtCQUFrQixXQUFhLDhDQUE4QyxDQUFDLENBQUM7QUFHdEYsSUFBTyxxQkFBcUIsV0FBWSxrREFBa0QsQ0FBQyxDQUFDO0FBRTVGLElBQU0sY0FBYztJQUFTQSxVQUF2QkEsY0FBY0EsVUFBMkJBO0lBUzlDQSxTQVRLQSxjQUFjQSxDQVNQQSxNQUFjQTtRQUV6QkMsa0JBQU1BLE1BQU1BLENBQUNBLENBQUNBO1FBUlBBLFlBQU9BLEdBQVVBLENBQUNBLENBQUNBO1FBQ25CQSxhQUFRQSxHQUFVQSxDQUFDQSxDQUFDQTtRQUNwQkEsYUFBUUEsR0FBVUEsQ0FBQ0EsQ0FBQ0E7UUFDcEJBLGFBQVFBLEdBQVVBLENBQUNBLENBQUNBO0lBTTVCQSxDQUFDQTtJQUVNRCxnQ0FBT0EsR0FBZEE7UUFFQ0UsSUFBSUEsQ0FBQ0EsUUFBUUEsR0FBR0EsSUFBSUEsQ0FBQ0EsUUFBUUEsR0FBR0EsSUFBSUEsQ0FBQ0EsUUFBUUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDbERBLElBQUlBLENBQUNBLE9BQU9BLEdBQUdBLENBQUNBLENBQUNBO0lBQ2xCQSxDQUFDQTtJQUVNRixvQ0FBV0EsR0FBbEJBLFVBQW1CQSxNQUFxQkEsRUFBRUEsU0FB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QUFHQSxHQUFVQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxFQUFFQSxHQUFHQSxHQUFVQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxFQUFFQSxHQUFHQSxHQUFVQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxFQUFFQSxHQUFHQSxHQUFVQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQTtRQUN4RkEsSUFBSUEsR0FBR0EsR0FBVUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsR0FBR0EsR0FBVUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsR0FBR0EsR0FBVUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsR0FBR0EsR0FBVUEsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0E7UUFDeEZBLElBQUlBLEdBQUdBLEdBQVVBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEVBQUVBLEdBQUdBLEdBQVVBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEVBQUVBLEdBQUdBLEdBQVVBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEVBQUVBLEdBQUdBLEdBQVVBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBO1FBRXpGQSxJQUFJQSxDQUFDQSxRQUFRQSxHQUFHQSxFQUFFQSxHQUFDQSxHQUFHQSxHQUFHQSxFQUFFQSxHQUFDQSxHQUFHQSxHQUFHQSxFQUFFQSxHQUFDQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQTtRQUMvQ0EsSUFBSUEsQ0FBQ0EsUUFBUUEsR0FBR0EsRUFBRUEsR0FBQ0EsR0FBR0EsR0FBR0EsRUFBRUEsR0FBQ0EsR0FBR0EsR0FBR0EsRUFBRUEsR0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0E7UUFDL0NBLElBQUlBLENBQUNBLFFBQVFBLEdBQUdBLEVBQUVBLEdBQUNBLEdBQUdBLEdBQUdBLEVBQUVBLEdBQUNBLEdBQUdBLEdBQUdBLEVBQUVBLEdBQUNBLEdBQUdBLEdBQUdBLEdBQUdBLENBQUNBO1FBRS9DQSxJQUFJQSxFQUFFQSxHQUFVQSxHQUFHQSxHQUFHQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQTtRQUNoQ0EsSUFBSUEsRUFBRUEsR0FBVUEsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0E7UUFDaENBLElBQUlBLEVBQUVBLEdBQVVBLEdBQUdBLEdBQUdBLEdBQUdBLEdBQUdBLEdBQUdBLENBQUNBO1FBQ2hDQSxJQUFJQSxDQUFDQSxPQUFPQSxHQUFHQSxDQUFDQSxHQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxFQUFFQSxHQUFDQSxFQUFFQSxHQUFHQSxFQUFFQSxHQUFDQSxFQUFFQSxHQUFHQSxFQUFFQSxHQUFDQSxFQUFFQSxDQUFDQSxHQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUV0REEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDbEJBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLE1BQU1BLEdBQUdBLENBQUNBLENBQUNBO1lBQ3hCQSxJQUFJQSxDQUFDQSxpQkFBaUJBLENBQUNBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBO1lBQzlCQSxJQUFJQSxDQUFDQSxpQkFBaUJBLENBQUNBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBO1lBQzlCQSxJQUFJQSxDQUFDQSxpQkFBaUJBLENBQUNBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBO1lBQzlCQSxJQUFJQSxDQUFDQSxpQkFBaUJBLENBQUNBLFNBQVNBLENBQUNBLFFBQVFBLEdBQUdBLE1BQU1BLENBQUNBO1FBQ3BEQSxDQUFDQTtJQUNGQSxDQUFDQTtJQUVNTixnREFBdUJBLEdBQTlCQTtRQUVDTyxJQUFJQSxDQUFDQSxPQUFPQSxHQUFHQSxJQUFJQSxxQkFBcUJBLEVBQUVBLENBQUNBO1FBQzNDQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxZQUFZQSxHQUFHQSxpQkFBaUJBLENBQUNBO1FBRTlDQSxNQUFNQSxDQUFRQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxZQUFZQSxFQUFFQSxDQUFDQTtJQUMzQ0EsQ0FBQ0E7SUFDRlAscUJBQUNBO0FBQURBLENBaEhBLEFBZ0hDQSxFQWhINEIsa0JBQWtCLEVBZ0g5QztBQUVELEFBQXdCLGlCQUFmLGNBQWMsQ0FBQyIsImZpbGUiOiJib3VuZHMvQm91bmRpbmdTcGhlcmUuanMiLCJzb3VyY2VSb290IjoiLi4vIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IE1hdHJpeDNEXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vTWF0cml4M0RcIik7XHJcbmltcG9ydCBNYXRyaXgzRFV0aWxzXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9NYXRyaXgzRFV0aWxzXCIpO1xyXG5pbXBvcnQgUGxhbmVDbGFzc2lmaWNhdGlvblx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9nZW9tL1BsYW5lQ2xhc3NpZmljYXRpb25cIik7XHJcbmltcG9ydCBQbGFuZTNEXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vUGxhbmUzRFwiKTtcclxuaW1wb3J0IFNwaGVyZVx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9nZW9tL1NwaGVyZVwiKTtcclxuaW1wb3J0IFZlY3RvcjNEXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vVmVjdG9yM0RcIik7XHJcblxyXG5pbXBvcnQgQm91bmRpbmdWb2x1bWVCYXNlXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2JvdW5kcy9Cb3VuZGluZ1ZvbHVtZUJhc2VcIik7XHJcbmltcG9ydCBJRW50aXR5XHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL0lFbnRpdHlcIik7XHJcbmltcG9ydCBNZXNoXHRcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvZW50aXRpZXMvTWVzaFwiKTtcclxuaW1wb3J0IFByaW1pdGl2ZVNwaGVyZVByZWZhYlx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvcHJlZmFicy9QcmltaXRpdmVTcGhlcmVQcmVmYWJcIik7XHJcblxyXG5jbGFzcyBCb3VuZGluZ1NwaGVyZSBleHRlbmRzIEJvdW5kaW5nVm9sdW1lQmFzZVxyXG57XHJcblx0cHJpdmF0ZSBfc3BoZXJlOlNwaGVyZTtcclxuXHRwcml2YXRlIF9yYWRpdXM6bnVtYmVyID0gMDtcclxuXHRwcml2YXRlIF9jZW50ZXJYOm51bWJlciA9IDA7XHJcblx0cHJpdmF0ZSBfY2VudGVyWTpudW1iZXIgPSAwO1xyXG5cdHByaXZhdGUgX2NlbnRlclo6bnVtYmVyID0gMDtcclxuXHRwcml2YXRlIF9wcmVmYWI6UHJpbWl0aXZlU3BoZXJlUHJlZmFiO1xyXG5cclxuXHRjb25zdHJ1Y3RvcihlbnRpdHk6SUVudGl0eSlcclxuXHR7XHJcblx0XHRzdXBlcihlbnRpdHkpO1xyXG5cdH1cclxuXHJcblx0cHVibGljIG51bGxpZnkoKVxyXG5cdHtcclxuXHRcdHRoaXMuX2NlbnRlclggPSB0aGlzLl9jZW50ZXJZID0gdGhpcy5fY2VudGVyWiA9IDA7XHJcblx0XHR0aGlzLl9yYWRpdXMgPSAwO1xyXG5cdH1cclxuXHJcblx0cHVibGljIGlzSW5GcnVzdHVtKHBsYW5lczpBcnJheTxQbGFuZTNEPiwgbnVtUGxhbmVzOm51bWJlcik6Ym9vbGVhblxyXG5cdHtcclxuXHRcdGlmKHRoaXMuX3BJbnZhbGlkYXRlZClcclxuXHRcdFx0dGhpcy5fcFVwZGF0ZSgpO1xyXG5cclxuXHRcdGZvciAodmFyIGk6bnVtYmVyID0gMDsgaSA8IG51bVBsYW5lczsgKytpKSB7XHJcblx0XHRcdHZhciBwbGFuZTpQbGFuZTNEID0gcGxhbmVzW2ldO1xyXG5cdFx0XHR2YXIgZmxpcHBlZEV4dGVudFg6bnVtYmVyID0gcGxhbmUuYSA8IDA/IC10aGlzLl9yYWRpdXMgOiB0aGlzLl9yYWRpdXM7XHJcblx0XHRcdHZhciBmbGlwcGVkRXh0ZW50WTpudW1iZXIgPSBwbGFuZS5iIDwgMD8gLXRoaXMuX3JhZGl1cyA6IHRoaXMuX3JhZGl1cztcclxuXHRcdFx0dmFyIGZsaXBwZWRFeHRlbnRaOm51bWJlciA9IHBsYW5lLmMgPCAwPyAtdGhpcy5fcmFkaXVzIDogdGhpcy5fcmFkaXVzO1xyXG5cdFx0XHR2YXIgcHJvakRpc3Q6bnVtYmVyID0gcGxhbmUuYSooIHRoaXMuX2NlbnRlclggKyBmbGlwcGVkRXh0ZW50WCApICsgcGxhbmUuYiooIHRoaXMuX2NlbnRlclkgKyBmbGlwcGVkRXh0ZW50WSkgKyBwbGFuZS5jKiggdGhpcy5fY2VudGVyWiArIGZsaXBwZWRFeHRlbnRaICkgLSBwbGFuZS5kO1xyXG5cdFx0XHRpZiAocHJvakRpc3QgPCAwKSB7XHJcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gdHJ1ZTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyByYXlJbnRlcnNlY3Rpb24ocG9zaXRpb246VmVjdG9yM0QsIGRpcmVjdGlvbjpWZWN0b3IzRCwgdGFyZ2V0Tm9ybWFsOlZlY3RvcjNEKTpudW1iZXJcclxuXHR7XHJcblx0XHRpZih0aGlzLl9wSW52YWxpZGF0ZWQpXHJcblx0XHRcdHRoaXMuX3BVcGRhdGUoKTtcclxuXHJcblx0XHRyZXR1cm4gdGhpcy5fc3BoZXJlLnJheUludGVyc2VjdGlvbihwb3NpdGlvbiwgZGlyZWN0aW9uLCB0YXJnZXROb3JtYWwpO1xyXG5cdH1cclxuXHJcblx0Ly9Ab3ZlcnJpZGVcclxuXHRwdWJsaWMgY2xhc3NpZnlUb1BsYW5lKHBsYW5lOlBsYW5lM0QpOm51bWJlclxyXG5cdHtcclxuXHRcdHZhciBhOm51bWJlciA9IHBsYW5lLmE7XHJcblx0XHR2YXIgYjpudW1iZXIgPSBwbGFuZS5iO1xyXG5cdFx0dmFyIGM6bnVtYmVyID0gcGxhbmUuYztcclxuXHRcdHZhciBkZDpudW1iZXIgPSBhKnRoaXMuX2NlbnRlclggKyBiKnRoaXMuX2NlbnRlclkgKyBjKnRoaXMuX2NlbnRlclogLSBwbGFuZS5kO1xyXG5cclxuXHRcdGlmIChhIDwgMClcclxuXHRcdFx0YSA9IC1hO1xyXG5cclxuXHRcdGlmIChiIDwgMClcclxuXHRcdFx0YiA9IC1iO1xyXG5cclxuXHRcdGlmIChjIDwgMClcclxuXHRcdFx0YyA9IC1jO1xyXG5cclxuXHRcdHZhciBycjpOdW1iZXIgPSAoYSArIGIgKyBjKSp0aGlzLl9yYWRpdXM7XHJcblxyXG5cdFx0cmV0dXJuIGRkID4gcnI/IFBsYW5lQ2xhc3NpZmljYXRpb24uRlJPTlQgOiBkZCA8IC1ycj8gUGxhbmVDbGFzc2lmaWNhdGlvbi5CQUNLIDogUGxhbmVDbGFzc2lmaWNhdGlvbi5JTlRFUlNFQ1Q7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgX3BVcGRhdGUoKVxyXG5cdHtcclxuXHRcdHN1cGVyLl9wVXBkYXRlKCk7XHJcblxyXG5cdFx0dGhpcy5fc3BoZXJlID0gdGhpcy5fcEVudGl0eS5nZXRTcGhlcmUoKTtcclxuXHRcdHZhciBtYXRyaXg6TWF0cml4M0QgPSB0aGlzLl9wRW50aXR5LnNjZW5lVHJhbnNmb3JtO1xyXG5cclxuXHRcdHZhciBjeDpudW1iZXIgPSB0aGlzLl9zcGhlcmUueDtcclxuXHRcdHZhciBjeTpudW1iZXIgPSB0aGlzLl9zcGhlcmUueTtcclxuXHRcdHZhciBjejpudW1iZXIgPSB0aGlzLl9zcGhlcmUuejtcclxuXHRcdHZhciByOm51bWJlciA9IHRoaXMuX3NwaGVyZS5yYWRpdXM7XHJcblxyXG5cdFx0dmFyIHJhdzpBcnJheTxudW1iZXI+ID0gbmV3IEFycmF5PG51bWJlcj4oMTYpO1xyXG5cdFx0bWF0cml4LmNvcHlSYXdEYXRhVG8ocmF3KTtcclxuXHJcblx0XHR2YXIgbTExOm51bWJlciA9IHJhd1swXSwgbTEyOm51bWJlciA9IHJhd1s0XSwgbTEzOm51bWJlciA9IHJhd1s4XSwgbTE0Om51bWJlciA9IHJhd1sxMl07XHJcblx0XHR2YXIgbTIxOm51bWJlciA9IHJhd1sxXSwgbTIyOm51bWJlciA9IHJhd1s1XSwgbTIzOm51bWJlciA9IHJhd1s5XSwgbTI0Om51bWJlciA9IHJhd1sxM107XHJcblx0XHR2YXIgbTMxOm51bWJlciA9IHJhd1syXSwgbTMyOm51bWJlciA9IHJhd1s2XSwgbTMzOm51bWJlciA9IHJhd1sxMF0sIG0zNDpudW1iZXIgPSByYXdbMTRdO1xyXG5cclxuXHRcdHRoaXMuX2NlbnRlclggPSBjeCptMTEgKyBjeSptMTIgKyBjeiptMTMgKyBtMTQ7XHJcblx0XHR0aGlzLl9jZW50ZXJZID0gY3gqbTIxICsgY3kqbTIyICsgY3oqbTIzICsgbTI0O1xyXG5cdFx0dGhpcy5fY2VudGVyWiA9IGN4Km0zMSArIGN5Km0zMiArIGN6Km0zMyArIG0zNDtcclxuXHJcblx0XHR2YXIgcng6bnVtYmVyID0gbTExICsgbTEyICsgbTEzO1xyXG5cdFx0dmFyIHJ5Om51bWJlciA9IG0yMSArIG0yMiArIG0yMztcclxuXHRcdHZhciByejpudW1iZXIgPSBtMzEgKyBtMzIgKyBtMzM7XHJcblx0XHR0aGlzLl9yYWRpdXMgPSByKk1hdGguc3FydCgocngqcnggKyByeSpyeSArIHJ6KnJ6KS8zKTtcclxuXHJcblx0XHRpZiAodGhpcy5fcHJlZmFiKSB7XHJcblx0XHRcdHRoaXMuX3ByZWZhYi5yYWRpdXMgPSByO1xyXG5cdFx0XHR0aGlzLl9wQm91bmRzUHJpbWl0aXZlLnggPSBjeDtcclxuXHRcdFx0dGhpcy5fcEJvdW5kc1ByaW1pdGl2ZS55ID0gY3k7XHJcblx0XHRcdHRoaXMuX3BCb3VuZHNQcmltaXRpdmUueiA9IGN6O1xyXG5cdFx0XHR0aGlzLl9wQm91bmRzUHJpbWl0aXZlLnRyYW5zZm9ybS5tYXRyaXgzRCA9IG1hdHJpeDtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdHB1YmxpYyBfcENyZWF0ZUJvdW5kc1ByaW1pdGl2ZSgpOk1lc2hcclxuXHR7XHJcblx0XHR0aGlzLl9wcmVmYWIgPSBuZXcgUHJpbWl0aXZlU3BoZXJlUHJlZmFiKCk7XHJcblx0XHR0aGlzLl9wcmVmYWIuZ2VvbWV0cnlUeXBlID0gXCJsaW5lU3ViR2VvbWV0cnlcIjtcclxuXHJcblx0XHRyZXR1cm4gPE1lc2g+IHRoaXMuX3ByZWZhYi5nZXROZXdPYmplY3QoKTtcclxuXHR9XHJcbn1cclxuXHJcbmV4cG9ydCA9IEJvdW5kaW5nU3BoZXJlOyJdfQ==