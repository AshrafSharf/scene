var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Matrix3DUtils = require("awayjs-core/lib/geom/Matrix3DUtils");
var PlaneClassification = require("awayjs-core/lib/geom/PlaneClassification");
var BoundingVolumeBase = require("awayjs-display/lib/bounds/BoundingVolumeBase");
var PrimitiveCubePrefab = require("awayjs-display/lib/prefabs/PrimitiveCubePrefab");
/**
 * AxisAlignedBoundingBox represents a bounding box volume that has its planes aligned to the local coordinate axes of the bounded object.
 * This is useful for most meshes.
 */
var AxisAlignedBoundingBox = (function (_super) {
    __extends(AxisAlignedBoundingBox, _super);
    /**
     * Creates a new <code>AxisAlignedBoundingBox</code> object.
     */
    function AxisAlignedBoundingBox(entity) {
        _super.call(this, entity);
        this._x = 0;
        this._y = 0;
        this._z = 0;
        this._width = 0;
        this._height = 0;
        this._depth = 0;
        this._centerX = 0;
        this._centerY = 0;
        this._centerZ = 0;
        this._halfExtentsX = 0;
        this._halfExtentsY = 0;
        this._halfExtentsZ = 0;
    }
    /**
     * @inheritDoc
     */
    AxisAlignedBoundingBox.prototype.nullify = function () {
        this._x = this._y = this._z = 0;
        this._width = this._height = this._depth = 0;
        this._centerX = this._centerY = this._centerZ = 0;
        this._halfExtentsX = this._halfExtentsY = this._halfExtentsZ = 0;
    };
    /**
     * @inheritDoc
     */
    AxisAlignedBoundingBox.prototype.isInFrustum = function (planes, numPlanes) {
        if (this._pInvalidated)
            this._pUpdate();
        for (var i = 0; i < numPlanes; ++i) {
            var plane = planes[i];
            var a = plane.a;
            var b = plane.b;
            var c = plane.c;
            var flippedExtentX = a < 0 ? -this._halfExtentsX : this._halfExtentsX;
            var flippedExtentY = b < 0 ? -this._halfExtentsY : this._halfExtentsY;
            var flippedExtentZ = c < 0 ? -this._halfExtentsZ : this._halfExtentsZ;
            var projDist = a * (this._centerX + flippedExtentX) + b * (this._centerY + flippedExtentY) + c * (this._centerZ + flippedExtentZ) - plane.d;
            if (projDist < 0)
                return false;
        }
        return true;
    };
    AxisAlignedBoundingBox.prototype.rayIntersection = function (position, direction, targetNormal) {
        if (this._pInvalidated)
            this._pUpdate();
        return this._box.rayIntersection(position, direction, targetNormal);
    };
    AxisAlignedBoundingBox.prototype.classifyToPlane = function (plane) {
        var a = plane.a;
        var b = plane.b;
        var c = plane.c;
        var centerDistance = a * this._centerX + b * this._centerY + c * this._centerZ - plane.d;
        if (a < 0)
            a = -a;
        if (b < 0)
            b = -b;
        if (c < 0)
            c = -c;
        var boundOffset = a * this._halfExtentsX + b * this._halfExtentsY + c * this._halfExtentsZ;
        return centerDistance > boundOffset ? PlaneClassification.FRONT : centerDistance < -boundOffset ? PlaneClassification.BACK : PlaneClassification.INTERSECT;
    };
    AxisAlignedBoundingBox.prototype._pUpdate = function () {
        _super.prototype._pUpdate.call(this);
        this._box = this._pEntity.getBox();
        var matrix = this._pEntity.sceneTransform;
        var hx = this._box.width / 2;
        var hy = this._box.height / 2;
        var hz = this._box.depth / 2;
        var cx = this._box.x + hx;
        var cy = this._box.y + hy;
        var cz = this._box.z + hz;
        var raw = Matrix3DUtils.RAW_DATA_CONTAINER;
        matrix.copyRawDataTo(raw);
        var m11 = raw[0], m12 = raw[4], m13 = raw[8], m14 = raw[12];
        var m21 = raw[1], m22 = raw[5], m23 = raw[9], m24 = raw[13];
        var m31 = raw[2], m32 = raw[6], m33 = raw[10], m34 = raw[14];
        this._centerX = cx * m11 + cy * m12 + cz * m13 + m14;
        this._centerY = cx * m21 + cy * m22 + cz * m23 + m24;
        this._centerZ = cx * m31 + cy * m32 + cz * m33 + m34;
        this._halfExtentsX = Math.abs(hx * m11 + hy * m12 + hz * m13);
        this._halfExtentsY = Math.abs(hx * m21 + hy * m22 + hz * m23);
        this._halfExtentsZ = Math.abs(hx * m31 + hy * m32 + hz * m33);
        if (this._prefab) {
            this._prefab.width = this._box.width;
            this._prefab.height = this._box.height;
            this._prefab.depth = this._box.depth;
            this._pBoundsPrimitive.transform.matrix3D = matrix;
        }
        this._width = this._halfExtentsX * 2;
        this._height = this._halfExtentsY * 2;
        this._depth = this._halfExtentsZ * 2;
        this._x = this._centerX - this._halfExtentsX;
        this._y = this._centerY - this._halfExtentsY;
        this._z = this._centerZ - this._halfExtentsZ;
    };
    AxisAlignedBoundingBox.prototype._pCreateBoundsPrimitive = function () {
        this._prefab = new PrimitiveCubePrefab();
        this._prefab.geometryType = "lineSubGeometry";
        return this._prefab.getNewObject();
    };
    return AxisAlignedBoundingBox;
})(BoundingVolumeBase);
module.exports = AxisAlignedBoundingBox;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1kaXNwbGF5L2xpYi9ib3VuZHMvQXhpc0FsaWduZWRCb3VuZGluZ0JveC50cyJdLCJuYW1lcyI6WyJBeGlzQWxpZ25lZEJvdW5kaW5nQm94IiwiQXhpc0FsaWduZWRCb3VuZGluZ0JveC5jb25zdHJ1Y3RvciIsIkF4aXNBbGlnbmVkQm91bmRpbmdCb3gubnVsbGlmeSIsIkF4aXNBbGlnbmVkQm91bmRpbmdCb3guaXNJbkZydXN0dW0iLCJBeGlzQWxpZ25lZEJvdW5kaW5nQm94LnJheUludGVyc2VjdGlvbiIsIkF4aXNBbGlnbmVkQm91bmRpbmdCb3guY2xhc3NpZnlUb1BsYW5lIiwiQXhpc0FsaWduZWRCb3VuZGluZ0JveC5fcFVwZGF0ZSIsIkF4aXNBbGlnbmVkQm91bmRpbmdCb3guX3BDcmVhdGVCb3VuZHNQcmltaXRpdmUiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUVBLElBQU8sYUFBYSxXQUFjLG9DQUFvQyxDQUFDLENBQUM7QUFDeEUsSUFBTyxtQkFBbUIsV0FBYSwwQ0FBMEMsQ0FBQyxDQUFDO0FBSW5GLElBQU8sa0JBQWtCLFdBQWEsOENBQThDLENBQUMsQ0FBQztBQUd0RixJQUFPLG1CQUFtQixXQUFhLGdEQUFnRCxDQUFDLENBQUM7QUFHekYsQUFJQTs7O0dBREc7SUFDRyxzQkFBc0I7SUFBU0EsVUFBL0JBLHNCQUFzQkEsVUFBMkJBO0lBaUJ0REE7O09BRUdBO0lBQ0hBLFNBcEJLQSxzQkFBc0JBLENBb0JmQSxNQUFjQTtRQUV6QkMsa0JBQU1BLE1BQU1BLENBQUNBLENBQUNBO1FBbkJQQSxPQUFFQSxHQUFVQSxDQUFDQSxDQUFDQTtRQUNkQSxPQUFFQSxHQUFVQSxDQUFDQSxDQUFDQTtRQUNkQSxPQUFFQSxHQUFVQSxDQUFDQSxDQUFDQTtRQUNkQSxXQUFNQSxHQUFVQSxDQUFDQSxDQUFDQTtRQUNsQkEsWUFBT0EsR0FBVUEsQ0FBQ0EsQ0FBQ0E7UUFDbkJBLFdBQU1BLEdBQVVBLENBQUNBLENBQUNBO1FBQ2xCQSxhQUFRQSxHQUFV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QSxDQUFDQSxJQUFJQSxDQUFDQSxhQUFhQSxDQUFDQTtZQUNyQkEsSUFBSUEsQ0FBQ0EsUUFBUUEsRUFBRUEsQ0FBQ0E7UUFFakJBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLGVBQWVBLENBQUNBLFFBQVFBLEVBQUVBLFNBQVNBLEVBQUVBLFlBQVlBLENBQUNBLENBQUNBO0lBQ3JFQSxDQUFDQTtJQUlNSixnREFBZUEsR0FBdEJBLFVBQXVCQSxLQUFhQTtRQUVuQ0ssSUFBSUEsQ0FBQ0EsR0FBVUEsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDdkJBLElBQUlBLENBQUNBLEdBQVVBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBO1FBQ3ZCQSxJQUFJQSxDQUFDQSxHQUFVQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUN2QkEsSUFBSUEsY0FBY0EsR0FBVUEsQ0FBQ0EsR0FBQ0EsSUFBSUEsQ0FBQ0EsUUFBUUEsR0FBR0EsQ0FBQ0EsR0FBQ0EsSUFBSUEsQ0FBQ0EsUUFBUUEsR0FBR0EsQ0FBQ0EsR0FBQ0EsSUFBSUEsQ0FBQ0EsUUFBUUEsR0FBR0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFFMUZBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1lBQ1RBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO1FBRVJBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1lBQ1RBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO1FBRVJBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1lBQ1RBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO1FBRVJBLElBQUlBLFdBQVdBLEdBQVVBLENBQUNBLEdBQUNBLElBQUlBLENBQUNBLGFBQWFBLEdBQUdBLENBQUNBLEdBQUNBLElBQUlBLENBQUNBLGFBQWFBLEdBQUdBLENBQUNBLEdBQUNBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBO1FBRTVGQSxNQUFNQSxDQUFDQSxjQUFjQSxHQUFHQSxXQUFXQSxHQUFFQSxtQkFBbUJBLENBQUNBLEtBQUtBLEdBQUdBLGNBQWNBLEdBQUdBLENBQUNBLFdBQVdBLEdBQUVBLG1CQUFtQkEsQ0FBQ0EsSUFBSUEsR0FBR0EsbUJBQW1CQSxDQUFDQSxTQUFTQSxDQUFDQTtJQUMxSkEsQ0FBQ0E7SUFFTUwseUNBQVFBLEdBQWZBO1FBRUNNLGdCQUFLQSxDQUFDQSxRQUFRQSxXQUFFQSxDQUFDQTtRQUVqQkEsSUFBSUEsQ0FBQ0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0E7UUFDbkNBLElBQUlBLE1BQU1BLEdBQVlBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLGNBQWNBLENBQUNBO1FBQ25EQSxJQUFJQSxFQUFFQSxHQUFVQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFDQSxDQUFDQSxDQUFDQTtRQUNsQ0EsSUFBSUEsRUFBRUEsR0FBVUEsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsR0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDbkNBLElBQUlBLEVBQUVBLEdBQVVBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLEdBQUNBLENBQUNBLENBQUNBO1FBQ2xDQSxJQUFJQSxFQUFFQSxHQUFVQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQTtRQUNqQ0EsSUFBSUEsRUFBRUEsR0FBVUEsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0E7UUFDakNBLElBQUlBLEVBQUVBLEdBQVVBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBO1FBQ2pDQSxJQUFJQSxHQUFHQSxHQUFZQSxhQUFhQSxDQUFDQSxrQkFBa0JBLENBQUNBO1FBRXBEQSxNQUFNQSxDQUFDQSxhQUFhQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUUxQkEsSUFBSUEsR0FBR0EsR0FBVUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsR0FBR0EsR0FBVUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsR0FBR0EsR0FBVUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsR0FBR0EsR0FBVUEsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0E7UUFDeEZBLElBQUlBLEdBQUdBLEdBQVVBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEVBQUVBLEdBQUdBLEdBQVVBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEVBQUVBLEdBQUdBLEdBQVVBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEVBQUVBLEdBQUdBLEdBQVVBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBO1FBQ3hGQSxJQUFJQSxHQUFHQSxHQUFVQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxFQUFFQSxHQUFHQSxHQUFVQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxFQUFFQSxHQUFHQSxHQUFVQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFFQSxHQUFHQSxHQUFVQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQTtRQUV6RkEsSUFBSUEsQ0FBQ0EsUUFBUUEsR0FBR0EsRUFBRUEsR0FBQ0EsR0FBR0EsR0FBR0EsRUFBRUEsR0FBQ0EsR0FBR0EsR0FBR0EsRUFBRUEsR0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0E7UUFDL0NBLElBQUlBLENBQUNBLFFBQVFBLEdBQUdBLEVBQUVBLEdBQUNBLEdBQUdBLEdBQUdBLEVBQUVBLEdBQUNBLEdBQUdBLEdBQUdBLEVBQUVBLEdBQUNBLEdBQUdBLEdBQUdBLEdBQUdBLENBQUNBO1FBQy9DQSxJQUFJQSxDQUFDQSxRQUFRQSxHQUFHQSxFQUFFQSxHQUFDQSxHQUFHQSxHQUFHQSxFQUFFQSxHQUFDQSxHQUFHQSxHQUFHQSxFQUFFQSxHQUFDQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQTtRQUUvQ0EsSUFBSUEsQ0FBQ0EsYUFBYUEsR0FBR0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsR0FBQ0EsR0FBR0EsR0FBR0EsRUFBRUEsR0FBQ0EsR0FBR0EsR0FBR0EsRUFBRUEsR0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDeERBLElBQUlBLENBQUNBLGFBQWFBLEdBQUdBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLEdBQUNBLEdBQUdBLEdBQUdBLEVBQUVBLEdBQUNBLEdBQUdBLEdBQUdBLEVBQUVBLEdBQUNBLEdBQUdBLENBQUNBLENBQUNBO1FBQ3hEQSxJQUFJQSxDQUFDQSxhQUFhQSxHQUFHQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxHQUFDQSxHQUFHQSxHQUFHQSxFQUFFQSxHQUFDQSxHQUFHQSxHQUFHQSxFQUFFQSxHQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUV4REEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDbEJBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLEtBQUtBLEdBQUdBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBO1lBQ3JDQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxNQUFNQSxHQUFHQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQTtZQUN2Q0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0E7WUFDckNBLElBQUlBLENBQUNBLGlCQUFpQkEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsUUFBUUEsR0FBR0EsTUFBTUEsQ0FBQ0E7UUFDcERBLENBQUNBO1FBRURBLElBQUlBLENBQUNBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBLGFBQWFBLEdBQUNBLENBQUNBLENBQUNBO1FBQ25DQSxJQUFJQSxDQUFDQSxPQUFPQSxHQUFHQSxJQUFJQSxDQUFDQSxhQUFhQSxHQUFDQSxDQUFDQSxDQUFDQTtRQUNwQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsR0FBR0EsSUFBSUEsQ0FBQ0EsYUFBYUEsR0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFFbkNBLElBQUlBLENBQUNBLEVBQUVBLEdBQUdBLElBQUlBLENBQUNBLFFBQVFBLEdBQUdBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBO1FBQzdDQSxJQUFJQSxDQUFDQSxFQUFFQSxHQUFHQSxJQUFJQSxDQUFDQSxRQUFRQSxHQUFHQSxJQUFJQSxDQUFDQSxhQUFhQSxDQUFDQTtRQUM3Q0EsSUFBSUEsQ0FBQ0EsRUFBRUEsR0FBR0EsSUFBSUEsQ0FBQ0EsUUFBUUEsR0FBR0EsSUFBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0E7SUFDOUNBLENBQUNBO0lBRU1OLHdEQUF1QkEsR0FBOUJBO1FBRUNPLElBQUlBLENBQUNBLE9BQU9BLEdBQUdBLElBQUlBLG1CQUFtQkEsRUFBRUEsQ0FBQ0E7UUFDekNBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLFlBQVlBLEdBQUdBLGlCQUFpQkEsQ0FBQ0E7UUFFOUNBLE1BQU1BLENBQVFBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLFlBQVlBLEVBQUVBLENBQUNBO0lBQzNDQSxDQUFDQTtJQUNGUCw2QkFBQ0E7QUFBREEsQ0FoSkEsQUFnSkNBLEVBaEpvQyxrQkFBa0IsRUFnSnREO0FBRUQsQUFBZ0MsaUJBQXZCLHNCQUFzQixDQUFDIiwiZmlsZSI6ImJvdW5kcy9BeGlzQWxpZ25lZEJvdW5kaW5nQm94LmpzIiwic291cmNlUm9vdCI6Ii4uLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBCb3hcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9Cb3hcIik7XHJcbmltcG9ydCBNYXRyaXgzRFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9nZW9tL01hdHJpeDNEXCIpO1xyXG5pbXBvcnQgTWF0cml4M0RVdGlsc1x0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vTWF0cml4M0RVdGlsc1wiKTtcclxuaW1wb3J0IFBsYW5lQ2xhc3NpZmljYXRpb25cdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9QbGFuZUNsYXNzaWZpY2F0aW9uXCIpO1xyXG5pbXBvcnQgUGxhbmUzRFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9nZW9tL1BsYW5lM0RcIik7XHJcbmltcG9ydCBWZWN0b3IzRFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9nZW9tL1ZlY3RvcjNEXCIpO1xyXG5cclxuaW1wb3J0IEJvdW5kaW5nVm9sdW1lQmFzZVx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9ib3VuZHMvQm91bmRpbmdWb2x1bWVCYXNlXCIpO1xyXG5pbXBvcnQgSUVudGl0eVx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9JRW50aXR5XCIpO1xyXG5pbXBvcnQgTWVzaFx0XHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL01lc2hcIik7XHJcbmltcG9ydCBQcmltaXRpdmVDdWJlUHJlZmFiXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL3ByZWZhYnMvUHJpbWl0aXZlQ3ViZVByZWZhYlwiKTtcclxuXHJcblxyXG4vKipcclxuICogQXhpc0FsaWduZWRCb3VuZGluZ0JveCByZXByZXNlbnRzIGEgYm91bmRpbmcgYm94IHZvbHVtZSB0aGF0IGhhcyBpdHMgcGxhbmVzIGFsaWduZWQgdG8gdGhlIGxvY2FsIGNvb3JkaW5hdGUgYXhlcyBvZiB0aGUgYm91bmRlZCBvYmplY3QuXHJcbiAqIFRoaXMgaXMgdXNlZnVsIGZvciBtb3N0IG1lc2hlcy5cclxuICovXHJcbmNsYXNzIEF4aXNBbGlnbmVkQm91bmRpbmdCb3ggZXh0ZW5kcyBCb3VuZGluZ1ZvbHVtZUJhc2Vcclxue1xyXG5cdHByaXZhdGUgX2JveDpCb3g7XHJcblx0cHJpdmF0ZSBfeDpudW1iZXIgPSAwO1xyXG5cdHByaXZhdGUgX3k6bnVtYmVyID0gMDtcclxuXHRwcml2YXRlIF96Om51bWJlciA9IDA7XHJcblx0cHJpdmF0ZSBfd2lkdGg6bnVtYmVyID0gMDtcclxuXHRwcml2YXRlIF9oZWlnaHQ6bnVtYmVyID0gMDtcclxuXHRwcml2YXRlIF9kZXB0aDpudW1iZXIgPSAwO1xyXG5cdHByaXZhdGUgX2NlbnRlclg6bnVtYmVyID0gMDtcclxuXHRwcml2YXRlIF9jZW50ZXJZOm51bWJlciA9IDA7XHJcblx0cHJpdmF0ZSBfY2VudGVyWjpudW1iZXIgPSAwO1xyXG5cdHByaXZhdGUgX2hhbGZFeHRlbnRzWDpudW1iZXIgPSAwO1xyXG5cdHByaXZhdGUgX2hhbGZFeHRlbnRzWTpudW1iZXIgPSAwO1xyXG5cdHByaXZhdGUgX2hhbGZFeHRlbnRzWjpudW1iZXIgPSAwO1xyXG5cdHByaXZhdGUgX3ByZWZhYjpQcmltaXRpdmVDdWJlUHJlZmFiO1xyXG5cclxuXHQvKipcclxuXHQgKiBDcmVhdGVzIGEgbmV3IDxjb2RlPkF4aXNBbGlnbmVkQm91bmRpbmdCb3g8L2NvZGU+IG9iamVjdC5cclxuXHQgKi9cclxuXHRjb25zdHJ1Y3RvcihlbnRpdHk6SUVudGl0eSlcclxuXHR7XHJcblx0XHRzdXBlcihlbnRpdHkpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQGluaGVyaXREb2NcclxuXHQgKi9cclxuXHRwdWJsaWMgbnVsbGlmeSgpXHJcblx0e1xyXG5cdFx0dGhpcy5feCA9IHRoaXMuX3kgPSB0aGlzLl96ID0gMDtcclxuXHRcdHRoaXMuX3dpZHRoID0gdGhpcy5faGVpZ2h0ID0gdGhpcy5fZGVwdGggPSAwO1xyXG5cdFx0dGhpcy5fY2VudGVyWCA9IHRoaXMuX2NlbnRlclkgPSB0aGlzLl9jZW50ZXJaID0gMDtcclxuXHRcdHRoaXMuX2hhbGZFeHRlbnRzWCA9IHRoaXMuX2hhbGZFeHRlbnRzWSA9IHRoaXMuX2hhbGZFeHRlbnRzWiA9IDA7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAaW5oZXJpdERvY1xyXG5cdCAqL1xyXG5cdHB1YmxpYyBpc0luRnJ1c3R1bShwbGFuZXM6QXJyYXk8UGxhbmUzRD4sIG51bVBsYW5lczpudW1iZXIpOmJvb2xlYW5cclxuXHR7XHJcblx0XHRpZih0aGlzLl9wSW52YWxpZGF0ZWQpXHJcblx0XHRcdHRoaXMuX3BVcGRhdGUoKTtcclxuXHJcblx0XHRmb3IgKHZhciBpOm51bWJlciA9IDA7IGkgPCBudW1QbGFuZXM7ICsraSkge1xyXG5cclxuXHRcdFx0dmFyIHBsYW5lOlBsYW5lM0QgPSBwbGFuZXNbaV07XHJcblx0XHRcdHZhciBhOm51bWJlciA9IHBsYW5lLmE7XHJcblx0XHRcdHZhciBiOm51bWJlciA9IHBsYW5lLmI7XHJcblx0XHRcdHZhciBjOm51bWJlciA9IHBsYW5lLmM7XHJcblx0XHRcdHZhciBmbGlwcGVkRXh0ZW50WDpudW1iZXIgPSBhIDwgMD8gLXRoaXMuX2hhbGZFeHRlbnRzWCA6IHRoaXMuX2hhbGZFeHRlbnRzWDtcclxuXHRcdFx0dmFyIGZsaXBwZWRFeHRlbnRZOm51bWJlciA9IGIgPCAwPyAtdGhpcy5faGFsZkV4dGVudHNZIDogdGhpcy5faGFsZkV4dGVudHNZO1xyXG5cdFx0XHR2YXIgZmxpcHBlZEV4dGVudFo6bnVtYmVyID0gYyA8IDA/IC10aGlzLl9oYWxmRXh0ZW50c1ogOiB0aGlzLl9oYWxmRXh0ZW50c1o7XHJcblx0XHRcdHZhciBwcm9qRGlzdDpudW1iZXIgPSBhKih0aGlzLl9jZW50ZXJYICsgZmxpcHBlZEV4dGVudFgpICsgYioodGhpcy5fY2VudGVyWSArIGZsaXBwZWRFeHRlbnRZKSArIGMqKHRoaXMuX2NlbnRlclogKyBmbGlwcGVkRXh0ZW50WikgLSBwbGFuZS5kO1xyXG5cclxuXHRcdFx0aWYgKHByb2pEaXN0IDwgMClcclxuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIHRydWU7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgcmF5SW50ZXJzZWN0aW9uKHBvc2l0aW9uOlZlY3RvcjNELCBkaXJlY3Rpb246VmVjdG9yM0QsIHRhcmdldE5vcm1hbDpWZWN0b3IzRCk6bnVtYmVyXHJcblx0e1xyXG5cdFx0aWYodGhpcy5fcEludmFsaWRhdGVkKVxyXG5cdFx0XHR0aGlzLl9wVXBkYXRlKCk7XHJcblxyXG5cdFx0cmV0dXJuIHRoaXMuX2JveC5yYXlJbnRlcnNlY3Rpb24ocG9zaXRpb24sIGRpcmVjdGlvbiwgdGFyZ2V0Tm9ybWFsKTtcclxuXHR9XHJcblxyXG5cclxuXHJcblx0cHVibGljIGNsYXNzaWZ5VG9QbGFuZShwbGFuZTpQbGFuZTNEKTpudW1iZXJcclxuXHR7XHJcblx0XHR2YXIgYTpudW1iZXIgPSBwbGFuZS5hO1xyXG5cdFx0dmFyIGI6bnVtYmVyID0gcGxhbmUuYjtcclxuXHRcdHZhciBjOm51bWJlciA9IHBsYW5lLmM7XHJcblx0XHR2YXIgY2VudGVyRGlzdGFuY2U6bnVtYmVyID0gYSp0aGlzLl9jZW50ZXJYICsgYip0aGlzLl9jZW50ZXJZICsgYyp0aGlzLl9jZW50ZXJaIC0gcGxhbmUuZDtcclxuXHJcblx0XHRpZiAoYSA8IDApXHJcblx0XHRcdGEgPSAtYTtcclxuXHJcblx0XHRpZiAoYiA8IDApXHJcblx0XHRcdGIgPSAtYjtcclxuXHJcblx0XHRpZiAoYyA8IDApXHJcblx0XHRcdGMgPSAtYztcclxuXHJcblx0XHR2YXIgYm91bmRPZmZzZXQ6bnVtYmVyID0gYSp0aGlzLl9oYWxmRXh0ZW50c1ggKyBiKnRoaXMuX2hhbGZFeHRlbnRzWSArIGMqdGhpcy5faGFsZkV4dGVudHNaO1xyXG5cclxuXHRcdHJldHVybiBjZW50ZXJEaXN0YW5jZSA+IGJvdW5kT2Zmc2V0PyBQbGFuZUNsYXNzaWZpY2F0aW9uLkZST05UIDogY2VudGVyRGlzdGFuY2UgPCAtYm91bmRPZmZzZXQ/IFBsYW5lQ2xhc3NpZmljYXRpb24uQkFDSyA6IFBsYW5lQ2xhc3NpZmljYXRpb24uSU5URVJTRUNUO1xyXG5cdH1cclxuXHJcblx0cHVibGljIF9wVXBkYXRlKClcclxuXHR7XHJcblx0XHRzdXBlci5fcFVwZGF0ZSgpO1xyXG5cclxuXHRcdHRoaXMuX2JveCA9IHRoaXMuX3BFbnRpdHkuZ2V0Qm94KCk7XHJcblx0XHR2YXIgbWF0cml4Ok1hdHJpeDNEID0gdGhpcy5fcEVudGl0eS5zY2VuZVRyYW5zZm9ybTtcclxuXHRcdHZhciBoeDpudW1iZXIgPSB0aGlzLl9ib3gud2lkdGgvMjtcclxuXHRcdHZhciBoeTpudW1iZXIgPSB0aGlzLl9ib3guaGVpZ2h0LzI7XHJcblx0XHR2YXIgaHo6bnVtYmVyID0gdGhpcy5fYm94LmRlcHRoLzI7XHJcblx0XHR2YXIgY3g6bnVtYmVyID0gdGhpcy5fYm94LnggKyBoeDtcclxuXHRcdHZhciBjeTpudW1iZXIgPSB0aGlzLl9ib3gueSArIGh5O1xyXG5cdFx0dmFyIGN6Om51bWJlciA9IHRoaXMuX2JveC56ICsgaHo7XHJcblx0XHR2YXIgcmF3Om51bWJlcltdID0gTWF0cml4M0RVdGlscy5SQVdfREFUQV9DT05UQUlORVI7XHJcblxyXG5cdFx0bWF0cml4LmNvcHlSYXdEYXRhVG8ocmF3KTtcclxuXHJcblx0XHR2YXIgbTExOm51bWJlciA9IHJhd1swXSwgbTEyOm51bWJlciA9IHJhd1s0XSwgbTEzOm51bWJlciA9IHJhd1s4XSwgbTE0Om51bWJlciA9IHJhd1sxMl07XHJcblx0XHR2YXIgbTIxOm51bWJlciA9IHJhd1sxXSwgbTIyOm51bWJlciA9IHJhd1s1XSwgbTIzOm51bWJlciA9IHJhd1s5XSwgbTI0Om51bWJlciA9IHJhd1sxM107XHJcblx0XHR2YXIgbTMxOm51bWJlciA9IHJhd1syXSwgbTMyOm51bWJlciA9IHJhd1s2XSwgbTMzOm51bWJlciA9IHJhd1sxMF0sIG0zNDpudW1iZXIgPSByYXdbMTRdO1xyXG5cclxuXHRcdHRoaXMuX2NlbnRlclggPSBjeCptMTEgKyBjeSptMTIgKyBjeiptMTMgKyBtMTQ7XHJcblx0XHR0aGlzLl9jZW50ZXJZID0gY3gqbTIxICsgY3kqbTIyICsgY3oqbTIzICsgbTI0O1xyXG5cdFx0dGhpcy5fY2VudGVyWiA9IGN4Km0zMSArIGN5Km0zMiArIGN6Km0zMyArIG0zNDtcclxuXHJcblx0XHR0aGlzLl9oYWxmRXh0ZW50c1ggPSBNYXRoLmFicyhoeCptMTEgKyBoeSptMTIgKyBoeiptMTMpO1xyXG5cdFx0dGhpcy5faGFsZkV4dGVudHNZID0gTWF0aC5hYnMoaHgqbTIxICsgaHkqbTIyICsgaHoqbTIzKTtcclxuXHRcdHRoaXMuX2hhbGZFeHRlbnRzWiA9IE1hdGguYWJzKGh4Km0zMSArIGh5Km0zMiArIGh6Km0zMyk7XHJcblxyXG5cdFx0aWYgKHRoaXMuX3ByZWZhYikge1xyXG5cdFx0XHR0aGlzLl9wcmVmYWIud2lkdGggPSB0aGlzLl9ib3gud2lkdGg7XHJcblx0XHRcdHRoaXMuX3ByZWZhYi5oZWlnaHQgPSB0aGlzLl9ib3guaGVpZ2h0O1xyXG5cdFx0XHR0aGlzLl9wcmVmYWIuZGVwdGggPSB0aGlzLl9ib3guZGVwdGg7XHJcblx0XHRcdHRoaXMuX3BCb3VuZHNQcmltaXRpdmUudHJhbnNmb3JtLm1hdHJpeDNEID0gbWF0cml4O1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMuX3dpZHRoID0gdGhpcy5faGFsZkV4dGVudHNYKjI7XHJcblx0XHR0aGlzLl9oZWlnaHQgPSB0aGlzLl9oYWxmRXh0ZW50c1kqMjtcclxuXHRcdHRoaXMuX2RlcHRoID0gdGhpcy5faGFsZkV4dGVudHNaKjI7XHJcblxyXG5cdFx0dGhpcy5feCA9IHRoaXMuX2NlbnRlclggLSB0aGlzLl9oYWxmRXh0ZW50c1g7XHJcblx0XHR0aGlzLl95ID0gdGhpcy5fY2VudGVyWSAtIHRoaXMuX2hhbGZFeHRlbnRzWTtcclxuXHRcdHRoaXMuX3ogPSB0aGlzLl9jZW50ZXJaIC0gdGhpcy5faGFsZkV4dGVudHNaO1xyXG5cdH1cclxuXHJcblx0cHVibGljIF9wQ3JlYXRlQm91bmRzUHJpbWl0aXZlKCk6TWVzaFxyXG5cdHtcclxuXHRcdHRoaXMuX3ByZWZhYiA9IG5ldyBQcmltaXRpdmVDdWJlUHJlZmFiKCk7XHJcblx0XHR0aGlzLl9wcmVmYWIuZ2VvbWV0cnlUeXBlID0gXCJsaW5lU3ViR2VvbWV0cnlcIjtcclxuXHJcblx0XHRyZXR1cm4gPE1lc2g+IHRoaXMuX3ByZWZhYi5nZXROZXdPYmplY3QoKTtcclxuXHR9XHJcbn1cclxuXHJcbmV4cG9ydCA9IEF4aXNBbGlnbmVkQm91bmRpbmdCb3g7Il19