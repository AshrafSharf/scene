var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Matrix3DUtils = require("awayjs-core/lib/geom/Matrix3DUtils");
var PlaneClassification = require("awayjs-core/lib/geom/PlaneClassification");
var BoundingVolumeBase = require("awayjs-display/lib/bounds/BoundingVolumeBase");
var PrimitiveCubePrefab = require("awayjs-display/lib/prefabs/PrimitiveCubePrefab");
/**
 * AxisAlignedBoundingBox represents a bounding box volume that has its planes aligned to the local coordinate axes of the bounded object.
 * This is useful for most meshes.
 */
var AxisAlignedBoundingBox = (function (_super) {
    __extends(AxisAlignedBoundingBox, _super);
    /**
     * Creates a new <code>AxisAlignedBoundingBox</code> object.
     */
    function AxisAlignedBoundingBox(entity) {
        _super.call(this, entity);
        this._x = 0;
        this._y = 0;
        this._z = 0;
        this._width = 0;
        this._height = 0;
        this._depth = 0;
        this._centerX = 0;
        this._centerY = 0;
        this._centerZ = 0;
        this._halfExtentsX = 0;
        this._halfExtentsY = 0;
        this._halfExtentsZ = 0;
    }
    /**
     * @inheritDoc
     */
    AxisAlignedBoundingBox.prototype.nullify = function () {
        this._x = this._y = this._z = 0;
        this._width = this._height = this._depth = 0;
        this._centerX = this._centerY = this._centerZ = 0;
        this._halfExtentsX = this._halfExtentsY = this._halfExtentsZ = 0;
    };
    /**
     * @inheritDoc
     */
    AxisAlignedBoundingBox.prototype.isInFrustum = function (planes, numPlanes) {
        if (this._pInvalidated)
            this._pUpdate();
        for (var i = 0; i < numPlanes; ++i) {
            var plane = planes[i];
            var a = plane.a;
            var b = plane.b;
            var c = plane.c;
            var flippedExtentX = a < 0 ? -this._halfExtentsX : this._halfExtentsX;
            var flippedExtentY = b < 0 ? -this._halfExtentsY : this._halfExtentsY;
            var flippedExtentZ = c < 0 ? -this._halfExtentsZ : this._halfExtentsZ;
            var projDist = a * (this._centerX + flippedExtentX) + b * (this._centerY + flippedExtentY) + c * (this._centerZ + flippedExtentZ) - plane.d;
            if (projDist < 0)
                return false;
        }
        return true;
    };
    AxisAlignedBoundingBox.prototype.rayIntersection = function (position, direction, targetNormal) {
        if (this._pInvalidated)
            this._pUpdate();
        return this._box.rayIntersection(position, direction, targetNormal);
    };
    AxisAlignedBoundingBox.prototype.classifyToPlane = function (plane) {
        var a = plane.a;
        var b = plane.b;
        var c = plane.c;
        var centerDistance = a * this._centerX + b * this._centerY + c * this._centerZ - plane.d;
        if (a < 0)
            a = -a;
        if (b < 0)
            b = -b;
        if (c < 0)
            c = -c;
        var boundOffset = a * this._halfExtentsX + b * this._halfExtentsY + c * this._halfExtentsZ;
        return centerDistance > boundOffset ? PlaneClassification.FRONT : centerDistance < -boundOffset ? PlaneClassification.BACK : PlaneClassification.INTERSECT;
    };
    AxisAlignedBoundingBox.prototype._pUpdate = function () {
        _super.prototype._pUpdate.call(this);
        this._box = this._pEntity.getBox();
        var matrix = this._pEntity.sceneTransform;
        var hx = this._box.width / 2;
        var hy = this._box.height / 2;
        var hz = this._box.depth / 2;
        var cx = this._box.x + hx;
        var cy = this._box.y + hy;
        var cz = this._box.z + hz;
        var raw = Matrix3DUtils.RAW_DATA_CONTAINER;
        matrix.copyRawDataTo(raw);
        var m11 = raw[0], m12 = raw[4], m13 = raw[8], m14 = raw[12];
        var m21 = raw[1], m22 = raw[5], m23 = raw[9], m24 = raw[13];
        var m31 = raw[2], m32 = raw[6], m33 = raw[10], m34 = raw[14];
        this._centerX = cx * m11 + cy * m12 + cz * m13 + m14;
        this._centerY = cx * m21 + cy * m22 + cz * m23 + m24;
        this._centerZ = cx * m31 + cy * m32 + cz * m33 + m34;
        this._halfExtentsX = Math.abs(hx * m11 + hy * m12 + hz * m13);
        this._halfExtentsY = Math.abs(hx * m21 + hy * m22 + hz * m23);
        this._halfExtentsZ = Math.abs(hx * m31 + hy * m32 + hz * m33);
        if (this._prefab) {
            this._prefab.width = this._box.width;
            this._prefab.height = this._box.height;
            this._prefab.depth = this._box.depth;
            this._pBoundsPrimitive.transform.matrix3D = matrix;
        }
        this._width = this._halfExtentsX * 2;
        this._height = this._halfExtentsY * 2;
        this._depth = this._halfExtentsZ * 2;
        this._x = this._centerX - this._halfExtentsX;
        this._y = this._centerY - this._halfExtentsY;
        this._z = this._centerZ - this._halfExtentsZ;
    };
    AxisAlignedBoundingBox.prototype._pCreateBoundsPrimitive = function () {
        this._prefab = new PrimitiveCubePrefab();
        this._prefab.geometryType = "lineSubGeometry";
        return this._prefab.getNewObject();
    };
    return AxisAlignedBoundingBox;
})(BoundingVolumeBase);
module.exports = AxisAlignedBoundingBox;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1kaXNwbGF5L2xpYi9ib3VuZHMvQXhpc0FsaWduZWRCb3VuZGluZ0JveC50cyJdLCJuYW1lcyI6WyJBeGlzQWxpZ25lZEJvdW5kaW5nQm94IiwiQXhpc0FsaWduZWRCb3VuZGluZ0JveC5jb25zdHJ1Y3RvciIsIkF4aXNBbGlnbmVkQm91bmRpbmdCb3gubnVsbGlmeSIsIkF4aXNBbGlnbmVkQm91bmRpbmdCb3guaXNJbkZydXN0dW0iLCJBeGlzQWxpZ25lZEJvdW5kaW5nQm94LnJheUludGVyc2VjdGlvbiIsIkF4aXNBbGlnbmVkQm91bmRpbmdCb3guY2xhc3NpZnlUb1BsYW5lIiwiQXhpc0FsaWduZWRCb3VuZGluZ0JveC5fcFVwZGF0ZSIsIkF4aXNBbGlnbmVkQm91bmRpbmdCb3guX3BDcmVhdGVCb3VuZHNQcmltaXRpdmUiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUVBLElBQU8sYUFBYSxXQUFjLG9DQUFvQyxDQUFDLENBQUM7QUFDeEUsSUFBTyxtQkFBbUIsV0FBYSwwQ0FBMEMsQ0FBQyxDQUFDO0FBSW5GLElBQU8sa0JBQWtCLFdBQWEsOENBQThDLENBQUMsQ0FBQztBQUd0RixJQUFPLG1CQUFtQixXQUFhLGdEQUFnRCxDQUFDLENBQUM7QUFHekYsQUFJQTs7O0dBREc7SUFDRyxzQkFBc0I7SUFBU0EsVUFBL0JBLHNCQUFzQkEsVUFBMkJBO0lBaUJ0REE7O09BRUdBO0lBQ0hBLFNBcEJLQSxzQkFBc0JBLENBb0JmQSxNQUFjQTtRQUV6QkMsa0JBQU1BLE1BQU1BLENBQUNBLENBQUNBO1FBbkJQQSxPQUFFQSxHQUFVQSxDQUFDQSxDQUFDQTtRQUNkQSxPQUFFQSxHQUFVQSxDQUFDQSxDQUFDQTtRQUNkQSxPQUFFQSxHQUFVQSxDQUFDQSxDQUFDQTtRQUNkQSxXQUFNQSxHQUFVQSxDQUFDQSxDQUFDQTtRQUNsQkEsWUFBT0EsR0FBVUEsQ0FBQ0EsQ0FBQ0E7UUFDbkJBLFdBQU1BLEdBQVVBLENBQUNBLENBQUNBO1FBQ2xCQSxhQUFRQSxHQUFV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QSxDQUFDQSxJQUFJQSxDQUFDQSxhQUFhQSxDQUFDQTtZQUNyQkEsSUFBSUEsQ0FBQ0EsUUFBUUEsRUFBRUEsQ0FBQ0E7UUFFakJBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLGVBQWVBLENBQUNBLFFBQVFBLEVBQUVBLFNBQVNBLEVBQUVBLFlBQVlBLENBQUNBLENBQUNBO0lBQ3JFQSxDQUFDQTtJQUlNSixnREFBZUEsR0FBdEJBLFVBQXVCQSxLQUFhQTtRQUVuQ0ssSUFBSUEsQ0FBQ0EsR0FBVUEsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDdkJBLElBQUlBLENBQUNBLEdBQVVBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBO1FBQ3ZCQSxJQUFJQSxDQUFDQSxHQUFVQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUN2QkEsSUFBSUEsY0FBY0EsR0FBVUEsQ0FBQ0EsR0FBQ0EsSUFBSUEsQ0FBQ0EsUUFBUUEsR0FBR0EsQ0FBQ0EsR0FBQ0EsSUFBSUEsQ0FBQ0EsUUFBUUEsR0FBR0EsQ0FBQ0EsR0FBQ0EsSUFBSUEsQ0FBQ0EsUUFBUUEsR0FBR0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFFMUZBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1lBQ1RBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO1FBRVJBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1lBQ1RBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO1FBRVJBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1lBQ1RBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO1FBRVJBLElBQUlBLFdBQVdBLEdBQVVBLENBQUNBLEdBQUNBLElBQUlBLENBQUNBLGFBQWFBLEdBQUdBLENBQUNBLEdBQUNBLElBQUlBLENBQUNBLGFBQWFBLEdBQUdBLENBQUNBLEdBQUNBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBO1FBRTVGQSxNQUFNQSxDQUFDQSxjQUFjQSxHQUFHQSxXQUFXQSxHQUFFQSxtQkFBbUJBLENBQUNBLEtBQUtBLEdBQUdBLGNBQWNBLEdBQUdBLENBQUNBLFdBQVdBLEdBQUVBLG1CQUFtQkEsQ0FBQ0EsSUFBSUEsR0FBR0EsbUJBQW1CQSxDQUFDQSxTQUFTQSxDQUFDQTtJQUMxSkEsQ0FBQ0E7SUFFTUwseUNBQVFBLEdBQWZBO1FBRUNNLGdCQUFLQSxDQUFDQSxRQUFRQSxXQUFFQSxDQUFDQTtRQUVqQkEsSUFBSUEsQ0FBQ0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0E7UUFDbkNBLElBQUlBLE1BQU1BLEdBQVlBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLGNBQWNBLENBQUNBO1FBQ25EQSxJQUFJQSxFQUFFQSxHQUFVQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFDQSxDQUFDQSxDQUFDQTtRQUNsQ0EsSUFBSUEsRUFBRUEsR0FBVUEsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsR0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDbkNBLElBQUlBLEVBQUVBLEdBQVVBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLEdBQUNBLENBQUNBLENBQUNBO1FBQ2xDQSxJQUFJQSxFQUFFQSxHQUFVQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQTtRQUNqQ0EsSUFBSUEsRUFBRUEsR0FBVUEsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0E7UUFDakNBLElBQUlBLEVBQUVBLEdBQVVBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBO1FBQ2pDQSxJQUFJQSxHQUFHQSxHQUFZQSxhQUFhQSxDQUFDQSxrQkFBa0JBLENBQUNBO1FBRXBEQSxNQUFNQSxDQUFDQSxhQUFhQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUUxQkEsSUFBSUEsR0FBR0EsR0FBVUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsR0FBR0EsR0FBVUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsR0FBR0EsR0FBVUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsR0FBR0EsR0FBVUEsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0E7UUFDeEZBLElBQUlBLEdBQUdBLEdBQVVBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEVBQUVBLEdBQUdBLEdBQVVBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEVBQUVBLEdBQUdBLEdBQVVBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEVBQUVBLEdBQUdBLEdBQVVBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBO1FBQ3hGQSxJQUFJQSxHQUFHQSxHQUFVQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxFQUFFQSxHQUFHQSxHQUFVQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxFQUFFQSxHQUFHQSxHQUFVQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFFQSxHQUFHQSxHQUFVQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQTtRQUV6RkEsSUFBSUEsQ0FBQ0EsUUFBUUEsR0FBR0EsRUFBRUEsR0FBQ0EsR0FBR0EsR0FBR0EsRUFBRUEsR0FBQ0EsR0FBR0EsR0FBR0EsRUFBRUEsR0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0E7UUFDL0NBLElBQUlBLENBQUNBLFFBQVFBLEdBQUdBLEVBQUVBLEdBQUNBLEdBQUdBLEdBQUdBLEVBQUVBLEdBQUNBLEdBQUdBLEdBQUdBLEVBQUVBLEdBQUNBLEdBQUdBLEdBQUdBLEdBQUdBLENBQUNBO1FBQy9DQSxJQUFJQSxDQUFDQSxRQUFRQSxHQUFHQSxFQUFFQSxHQUFDQSxHQUFHQSxHQUFHQSxFQUFFQSxHQUFDQSxHQUFHQSxHQUFHQSxFQUFFQSxHQUFDQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQTtRQUUvQ0EsSUFBSUEsQ0FBQ0EsYUFBYUEsR0FBR0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsR0FBQ0EsR0FBR0EsR0FBR0EsRUFBRUEsR0FBQ0EsR0FBR0EsR0FBR0EsRUFBRUEsR0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDeERBLElBQUlBLENBQUNBLGFBQWFBLEdBQUdBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLEdBQUNBLEdBQUdBLEdBQUdBLEVBQUVBLEdBQUNBLEdBQUdBLEdBQUdBLEVBQUVBLEdBQUNBLEdBQUdBLENBQUNBLENBQUNBO1FBQ3hEQSxJQUFJQSxDQUFDQSxhQUFhQSxHQUFHQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxHQUFDQSxHQUFHQSxHQUFHQSxFQUFFQSxHQUFDQSxHQUFHQSxHQUFHQSxFQUFFQSxHQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUV4REEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDbEJBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLEtBQUtBLEdBQUdBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBO1lBQ3JDQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxNQUFNQSxHQUFHQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQTtZQUN2Q0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0E7WUFDckNBLElBQUlBLENBQUNBLGlCQUFpQkEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsUUFBUUEsR0FBR0EsTUFBTUEsQ0FBQ0E7UUFDcERBLENBQUNBO1FBRURBLElBQUlBLENBQUNBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBLGFBQWFBLEdBQUNBLENBQUNBLENBQUNBO1FBQ25DQSxJQUFJQSxDQUFDQSxPQUFPQSxHQUFHQSxJQUFJQSxDQUFDQSxhQUFhQSxHQUFDQSxDQUFDQSxDQUFDQTtRQUNwQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsR0FBR0EsSUFBSUEsQ0FBQ0EsYUFBYUEsR0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFFbkNBLElBQUlBLENBQUNBLEVBQUVBLEdBQUdBLElBQUlBLENBQUNBLFFBQVFBLEdBQUdBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBO1FBQzdDQSxJQUFJQSxDQUFDQSxFQUFFQSxHQUFHQSxJQUFJQSxDQUFDQSxRQUFRQSxHQUFHQSxJQUFJQSxDQUFDQSxhQUFhQSxDQUFDQTtRQUM3Q0EsSUFBSUEsQ0FBQ0EsRUFBRUEsR0FBR0EsSUFBSUEsQ0FBQ0EsUUFBUUEsR0FBR0EsSUFBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0E7SUFDOUNBLENBQUNBO0lBRU1OLHdEQUF1QkEsR0FBOUJBO1FBRUNPLElBQUlBLENBQUNBLE9BQU9BLEdBQUdBLElBQUlBLG1CQUFtQkEsRUFBRUEsQ0FBQ0E7UUFDekNBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLFlBQVlBLEdBQUdBLGlCQUFpQkEsQ0FBQ0E7UUFFOUNBLE1BQU1BLENBQVFBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLFlBQVlBLEVBQUVBLENBQUNBO0lBQzNDQSxDQUFDQTtJQUNGUCw2QkFBQ0E7QUFBREEsQ0FoSkEsQUFnSkNBLEVBaEpvQyxrQkFBa0IsRUFnSnREO0FBRUQsQUFBZ0MsaUJBQXZCLHNCQUFzQixDQUFDIiwiZmlsZSI6ImJvdW5kcy9BeGlzQWxpZ25lZEJvdW5kaW5nQm94LmpzIiwic291cmNlUm9vdCI6Ii4uLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBCb3hcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9Cb3hcIik7XG5pbXBvcnQgTWF0cml4M0RcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9NYXRyaXgzRFwiKTtcbmltcG9ydCBNYXRyaXgzRFV0aWxzXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9NYXRyaXgzRFV0aWxzXCIpO1xuaW1wb3J0IFBsYW5lQ2xhc3NpZmljYXRpb25cdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9QbGFuZUNsYXNzaWZpY2F0aW9uXCIpO1xuaW1wb3J0IFBsYW5lM0RcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9QbGFuZTNEXCIpO1xuaW1wb3J0IFZlY3RvcjNEXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vVmVjdG9yM0RcIik7XG5cbmltcG9ydCBCb3VuZGluZ1ZvbHVtZUJhc2VcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvYm91bmRzL0JvdW5kaW5nVm9sdW1lQmFzZVwiKTtcbmltcG9ydCBJRW50aXR5XHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL0lFbnRpdHlcIik7XG5pbXBvcnQgTWVzaFx0XHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL01lc2hcIik7XG5pbXBvcnQgUHJpbWl0aXZlQ3ViZVByZWZhYlx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9wcmVmYWJzL1ByaW1pdGl2ZUN1YmVQcmVmYWJcIik7XG5cblxuLyoqXG4gKiBBeGlzQWxpZ25lZEJvdW5kaW5nQm94IHJlcHJlc2VudHMgYSBib3VuZGluZyBib3ggdm9sdW1lIHRoYXQgaGFzIGl0cyBwbGFuZXMgYWxpZ25lZCB0byB0aGUgbG9jYWwgY29vcmRpbmF0ZSBheGVzIG9mIHRoZSBib3VuZGVkIG9iamVjdC5cbiAqIFRoaXMgaXMgdXNlZnVsIGZvciBtb3N0IG1lc2hlcy5cbiAqL1xuY2xhc3MgQXhpc0FsaWduZWRCb3VuZGluZ0JveCBleHRlbmRzIEJvdW5kaW5nVm9sdW1lQmFzZVxue1xuXHRwcml2YXRlIF9ib3g6Qm94O1xuXHRwcml2YXRlIF94Om51bWJlciA9IDA7XG5cdHByaXZhdGUgX3k6bnVtYmVyID0gMDtcblx0cHJpdmF0ZSBfejpudW1iZXIgPSAwO1xuXHRwcml2YXRlIF93aWR0aDpudW1iZXIgPSAwO1xuXHRwcml2YXRlIF9oZWlnaHQ6bnVtYmVyID0gMDtcblx0cHJpdmF0ZSBfZGVwdGg6bnVtYmVyID0gMDtcblx0cHJpdmF0ZSBfY2VudGVyWDpudW1iZXIgPSAwO1xuXHRwcml2YXRlIF9jZW50ZXJZOm51bWJlciA9IDA7XG5cdHByaXZhdGUgX2NlbnRlclo6bnVtYmVyID0gMDtcblx0cHJpdmF0ZSBfaGFsZkV4dGVudHNYOm51bWJlciA9IDA7XG5cdHByaXZhdGUgX2hhbGZFeHRlbnRzWTpudW1iZXIgPSAwO1xuXHRwcml2YXRlIF9oYWxmRXh0ZW50c1o6bnVtYmVyID0gMDtcblx0cHJpdmF0ZSBfcHJlZmFiOlByaW1pdGl2ZUN1YmVQcmVmYWI7XG5cblx0LyoqXG5cdCAqIENyZWF0ZXMgYSBuZXcgPGNvZGU+QXhpc0FsaWduZWRCb3VuZGluZ0JveDwvY29kZT4gb2JqZWN0LlxuXHQgKi9cblx0Y29uc3RydWN0b3IoZW50aXR5OklFbnRpdHkpXG5cdHtcblx0XHRzdXBlcihlbnRpdHkpO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqL1xuXHRwdWJsaWMgbnVsbGlmeSgpXG5cdHtcblx0XHR0aGlzLl94ID0gdGhpcy5feSA9IHRoaXMuX3ogPSAwO1xuXHRcdHRoaXMuX3dpZHRoID0gdGhpcy5faGVpZ2h0ID0gdGhpcy5fZGVwdGggPSAwO1xuXHRcdHRoaXMuX2NlbnRlclggPSB0aGlzLl9jZW50ZXJZID0gdGhpcy5fY2VudGVyWiA9IDA7XG5cdFx0dGhpcy5faGFsZkV4dGVudHNYID0gdGhpcy5faGFsZkV4dGVudHNZID0gdGhpcy5faGFsZkV4dGVudHNaID0gMDtcblx0fVxuXG5cdC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi9cblx0cHVibGljIGlzSW5GcnVzdHVtKHBsYW5lczpBcnJheTxQbGFuZTNEPiwgbnVtUGxhbmVzOm51bWJlcik6Ym9vbGVhblxuXHR7XG5cdFx0aWYodGhpcy5fcEludmFsaWRhdGVkKVxuXHRcdFx0dGhpcy5fcFVwZGF0ZSgpO1xuXG5cdFx0Zm9yICh2YXIgaTpudW1iZXIgPSAwOyBpIDwgbnVtUGxhbmVzOyArK2kpIHtcblxuXHRcdFx0dmFyIHBsYW5lOlBsYW5lM0QgPSBwbGFuZXNbaV07XG5cdFx0XHR2YXIgYTpudW1iZXIgPSBwbGFuZS5hO1xuXHRcdFx0dmFyIGI6bnVtYmVyID0gcGxhbmUuYjtcblx0XHRcdHZhciBjOm51bWJlciA9IHBsYW5lLmM7XG5cdFx0XHR2YXIgZmxpcHBlZEV4dGVudFg6bnVtYmVyID0gYSA8IDA/IC10aGlzLl9oYWxmRXh0ZW50c1ggOiB0aGlzLl9oYWxmRXh0ZW50c1g7XG5cdFx0XHR2YXIgZmxpcHBlZEV4dGVudFk6bnVtYmVyID0gYiA8IDA/IC10aGlzLl9oYWxmRXh0ZW50c1kgOiB0aGlzLl9oYWxmRXh0ZW50c1k7XG5cdFx0XHR2YXIgZmxpcHBlZEV4dGVudFo6bnVtYmVyID0gYyA8IDA/IC10aGlzLl9oYWxmRXh0ZW50c1ogOiB0aGlzLl9oYWxmRXh0ZW50c1o7XG5cdFx0XHR2YXIgcHJvakRpc3Q6bnVtYmVyID0gYSoodGhpcy5fY2VudGVyWCArIGZsaXBwZWRFeHRlbnRYKSArIGIqKHRoaXMuX2NlbnRlclkgKyBmbGlwcGVkRXh0ZW50WSkgKyBjKih0aGlzLl9jZW50ZXJaICsgZmxpcHBlZEV4dGVudFopIC0gcGxhbmUuZDtcblxuXHRcdFx0aWYgKHByb2pEaXN0IDwgMClcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblxuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0cHVibGljIHJheUludGVyc2VjdGlvbihwb3NpdGlvbjpWZWN0b3IzRCwgZGlyZWN0aW9uOlZlY3RvcjNELCB0YXJnZXROb3JtYWw6VmVjdG9yM0QpOm51bWJlclxuXHR7XG5cdFx0aWYodGhpcy5fcEludmFsaWRhdGVkKVxuXHRcdFx0dGhpcy5fcFVwZGF0ZSgpO1xuXG5cdFx0cmV0dXJuIHRoaXMuX2JveC5yYXlJbnRlcnNlY3Rpb24ocG9zaXRpb24sIGRpcmVjdGlvbiwgdGFyZ2V0Tm9ybWFsKTtcblx0fVxuXG5cblxuXHRwdWJsaWMgY2xhc3NpZnlUb1BsYW5lKHBsYW5lOlBsYW5lM0QpOm51bWJlclxuXHR7XG5cdFx0dmFyIGE6bnVtYmVyID0gcGxhbmUuYTtcblx0XHR2YXIgYjpudW1iZXIgPSBwbGFuZS5iO1xuXHRcdHZhciBjOm51bWJlciA9IHBsYW5lLmM7XG5cdFx0dmFyIGNlbnRlckRpc3RhbmNlOm51bWJlciA9IGEqdGhpcy5fY2VudGVyWCArIGIqdGhpcy5fY2VudGVyWSArIGMqdGhpcy5fY2VudGVyWiAtIHBsYW5lLmQ7XG5cblx0XHRpZiAoYSA8IDApXG5cdFx0XHRhID0gLWE7XG5cblx0XHRpZiAoYiA8IDApXG5cdFx0XHRiID0gLWI7XG5cblx0XHRpZiAoYyA8IDApXG5cdFx0XHRjID0gLWM7XG5cblx0XHR2YXIgYm91bmRPZmZzZXQ6bnVtYmVyID0gYSp0aGlzLl9oYWxmRXh0ZW50c1ggKyBiKnRoaXMuX2hhbGZFeHRlbnRzWSArIGMqdGhpcy5faGFsZkV4dGVudHNaO1xuXG5cdFx0cmV0dXJuIGNlbnRlckRpc3RhbmNlID4gYm91bmRPZmZzZXQ/IFBsYW5lQ2xhc3NpZmljYXRpb24uRlJPTlQgOiBjZW50ZXJEaXN0YW5jZSA8IC1ib3VuZE9mZnNldD8gUGxhbmVDbGFzc2lmaWNhdGlvbi5CQUNLIDogUGxhbmVDbGFzc2lmaWNhdGlvbi5JTlRFUlNFQ1Q7XG5cdH1cblxuXHRwdWJsaWMgX3BVcGRhdGUoKVxuXHR7XG5cdFx0c3VwZXIuX3BVcGRhdGUoKTtcblxuXHRcdHRoaXMuX2JveCA9IHRoaXMuX3BFbnRpdHkuZ2V0Qm94KCk7XG5cdFx0dmFyIG1hdHJpeDpNYXRyaXgzRCA9IHRoaXMuX3BFbnRpdHkuc2NlbmVUcmFuc2Zvcm07XG5cdFx0dmFyIGh4Om51bWJlciA9IHRoaXMuX2JveC53aWR0aC8yO1xuXHRcdHZhciBoeTpudW1iZXIgPSB0aGlzLl9ib3guaGVpZ2h0LzI7XG5cdFx0dmFyIGh6Om51bWJlciA9IHRoaXMuX2JveC5kZXB0aC8yO1xuXHRcdHZhciBjeDpudW1iZXIgPSB0aGlzLl9ib3gueCArIGh4O1xuXHRcdHZhciBjeTpudW1iZXIgPSB0aGlzLl9ib3gueSArIGh5O1xuXHRcdHZhciBjejpudW1iZXIgPSB0aGlzLl9ib3gueiArIGh6O1xuXHRcdHZhciByYXc6bnVtYmVyW10gPSBNYXRyaXgzRFV0aWxzLlJBV19EQVRBX0NPTlRBSU5FUjtcblxuXHRcdG1hdHJpeC5jb3B5UmF3RGF0YVRvKHJhdyk7XG5cblx0XHR2YXIgbTExOm51bWJlciA9IHJhd1swXSwgbTEyOm51bWJlciA9IHJhd1s0XSwgbTEzOm51bWJlciA9IHJhd1s4XSwgbTE0Om51bWJlciA9IHJhd1sxMl07XG5cdFx0dmFyIG0yMTpudW1iZXIgPSByYXdbMV0sIG0yMjpudW1iZXIgPSByYXdbNV0sIG0yMzpudW1iZXIgPSByYXdbOV0sIG0yNDpudW1iZXIgPSByYXdbMTNdO1xuXHRcdHZhciBtMzE6bnVtYmVyID0gcmF3WzJdLCBtMzI6bnVtYmVyID0gcmF3WzZdLCBtMzM6bnVtYmVyID0gcmF3WzEwXSwgbTM0Om51bWJlciA9IHJhd1sxNF07XG5cblx0XHR0aGlzLl9jZW50ZXJYID0gY3gqbTExICsgY3kqbTEyICsgY3oqbTEzICsgbTE0O1xuXHRcdHRoaXMuX2NlbnRlclkgPSBjeCptMjEgKyBjeSptMjIgKyBjeiptMjMgKyBtMjQ7XG5cdFx0dGhpcy5fY2VudGVyWiA9IGN4Km0zMSArIGN5Km0zMiArIGN6Km0zMyArIG0zNDtcblxuXHRcdHRoaXMuX2hhbGZFeHRlbnRzWCA9IE1hdGguYWJzKGh4Km0xMSArIGh5Km0xMiArIGh6Km0xMyk7XG5cdFx0dGhpcy5faGFsZkV4dGVudHNZID0gTWF0aC5hYnMoaHgqbTIxICsgaHkqbTIyICsgaHoqbTIzKTtcblx0XHR0aGlzLl9oYWxmRXh0ZW50c1ogPSBNYXRoLmFicyhoeCptMzEgKyBoeSptMzIgKyBoeiptMzMpO1xuXG5cdFx0aWYgKHRoaXMuX3ByZWZhYikge1xuXHRcdFx0dGhpcy5fcHJlZmFiLndpZHRoID0gdGhpcy5fYm94LndpZHRoO1xuXHRcdFx0dGhpcy5fcHJlZmFiLmhlaWdodCA9IHRoaXMuX2JveC5oZWlnaHQ7XG5cdFx0XHR0aGlzLl9wcmVmYWIuZGVwdGggPSB0aGlzLl9ib3guZGVwdGg7XG5cdFx0XHR0aGlzLl9wQm91bmRzUHJpbWl0aXZlLnRyYW5zZm9ybS5tYXRyaXgzRCA9IG1hdHJpeDtcblx0XHR9XG5cblx0XHR0aGlzLl93aWR0aCA9IHRoaXMuX2hhbGZFeHRlbnRzWCoyO1xuXHRcdHRoaXMuX2hlaWdodCA9IHRoaXMuX2hhbGZFeHRlbnRzWSoyO1xuXHRcdHRoaXMuX2RlcHRoID0gdGhpcy5faGFsZkV4dGVudHNaKjI7XG5cblx0XHR0aGlzLl94ID0gdGhpcy5fY2VudGVyWCAtIHRoaXMuX2hhbGZFeHRlbnRzWDtcblx0XHR0aGlzLl95ID0gdGhpcy5fY2VudGVyWSAtIHRoaXMuX2hhbGZFeHRlbnRzWTtcblx0XHR0aGlzLl96ID0gdGhpcy5fY2VudGVyWiAtIHRoaXMuX2hhbGZFeHRlbnRzWjtcblx0fVxuXG5cdHB1YmxpYyBfcENyZWF0ZUJvdW5kc1ByaW1pdGl2ZSgpOk1lc2hcblx0e1xuXHRcdHRoaXMuX3ByZWZhYiA9IG5ldyBQcmltaXRpdmVDdWJlUHJlZmFiKCk7XG5cdFx0dGhpcy5fcHJlZmFiLmdlb21ldHJ5VHlwZSA9IFwibGluZVN1Ykdlb21ldHJ5XCI7XG5cblx0XHRyZXR1cm4gPE1lc2g+IHRoaXMuX3ByZWZhYi5nZXROZXdPYmplY3QoKTtcblx0fVxufVxuXG5leHBvcnQgPSBBeGlzQWxpZ25lZEJvdW5kaW5nQm94OyJdfQ==