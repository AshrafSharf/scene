var AbstractMethodError = require("awayjs-core/lib/errors/AbstractMethodError");
var ShadowCasterCollector = require("awayjs-display/lib/traverse/ShadowCasterCollector");
var RenderTexture = require("awayjs-core/lib/textures/RenderTexture");
var ShadowMapperBase = (function () {
    function ShadowMapperBase() {
        this._pDepthMapSize = 2048;
        this._autoUpdateShadows = true;
        this._pCasterCollector = this.pCreateCasterCollector();
    }
    ShadowMapperBase.prototype.pCreateCasterCollector = function () {
        return new ShadowCasterCollector();
    };
    Object.defineProperty(ShadowMapperBase.prototype, "autoUpdateShadows", {
        get: function () {
            return this._autoUpdateShadows;
        },
        set: function (value) {
            this._autoUpdateShadows = value;
        },
        enumerable: true,
        configurable: true
    });
    ShadowMapperBase.prototype.updateShadows = function () {
        this._iShadowsInvalid = true;
    };
    ShadowMapperBase.prototype.iSetDepthMap = function (depthMap) {
        if (this._depthMap == depthMap)
            return;
        if (this._depthMap && !this._explicitDepthMap)
            this._depthMap.dispose();
        this._depthMap = depthMap;
        if (this._depthMap) {
            this._explicitDepthMap = true;
            this._pDepthMapSize = this._depthMap.size;
        }
        else {
            this._explicitDepthMap = false;
        }
    };
    Object.defineProperty(ShadowMapperBase.prototype, "light", {
        get: function () {
            return this._pLight;
        },
        set: function (value) {
            this._pLight = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ShadowMapperBase.prototype, "depthMap", {
        get: function () {
            if (!this._depthMap)
                this._depthMap = this.pCreateDepthTexture();
            return this._depthMap;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ShadowMapperBase.prototype, "depthMapSize", {
        get: function () {
            return this._pDepthMapSize;
        },
        set: function (value) {
            if (value == this._pDepthMapSize)
                return;
            this._pSetDepthMapSize(value);
        },
        enumerable: true,
        configurable: true
    });
    ShadowMapperBase.prototype.dispose = function () {
        this._pCasterCollector = null;
        if (this._depthMap && !this._explicitDepthMap)
            this._depthMap.dispose();
        this._depthMap = null;
    };
    ShadowMapperBase.prototype.pCreateDepthTexture = function () {
        return new RenderTexture(this._pDepthMapSize, this._pDepthMapSize);
    };
    ShadowMapperBase.prototype.iRenderDepthMap = function (entityCollector, renderer) {
        this._iShadowsInvalid = false;
        this.pUpdateDepthProjection(entityCollector.camera);
        if (!this._depthMap)
            this._depthMap = this.pCreateDepthTexture();
        this.pDrawDepthMap(this._depthMap, entityCollector.scene, renderer);
    };
    ShadowMapperBase.prototype.pUpdateDepthProjection = function (viewCamera) {
        throw new AbstractMethodError();
    };
    ShadowMapperBase.prototype.pDrawDepthMap = function (target, scene, renderer) {
        throw new AbstractMethodError();
    };
    ShadowMapperBase.prototype._pSetDepthMapSize = function (value) {
        this._pDepthMapSize = value;
        if (this._explicitDepthMap) {
            throw Error("Cannot set depth map size for the current renderer.");
        }
        else if (this._depthMap) {
            this._depthMap.dispose();
            this._depthMap = null;
        }
    };
    return ShadowMapperBase;
})();
module.exports = ShadowMapperBase;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1kaXNwbGF5L2xpYi9tYXRlcmlhbHMvc2hhZG93bWFwcGVycy9TaGFkb3dNYXBwZXJCYXNlLnRzIl0sIm5hbWVzIjpbIlNoYWRvd01hcHBlckJhc2UiLCJTaGFkb3dNYXBwZXJCYXNlLmNvbnN0cnVjdG9yIiwiU2hhZG93TWFwcGVyQmFzZS5wQ3JlYXRlQ2FzdGVyQ29sbGVjdG9yIiwiU2hhZG93TWFwcGVyQmFzZS5hdXRvVXBkYXRlU2hhZG93cyIsIlNoYWRvd01hcHBlckJhc2UudXBkYXRlU2hhZG93cyIsIlNoYWRvd01hcHBlckJhc2UuaVNldERlcHRoTWFwIiwiU2hhZG93TWFwcGVyQmFzZS5saWdodCIsIlNoYWRvd01hcHBlckJhc2UuZGVwdGhNYXAiLCJTaGFkb3dNYXBwZXJCYXNlLmRlcHRoTWFwU2l6ZSIsIlNoYWRvd01hcHBlckJhc2UuZGlzcG9zZSIsIlNoYWRvd01hcHBlckJhc2UucENyZWF0ZURlcHRoVGV4dHVyZSIsIlNoYWRvd01hcHBlckJhc2UuaVJlbmRlckRlcHRoTWFwIiwiU2hhZG93TWFwcGVyQmFzZS5wVXBkYXRlRGVwdGhQcm9qZWN0aW9uIiwiU2hhZG93TWFwcGVyQmFzZS5wRHJhd0RlcHRoTWFwIiwiU2hhZG93TWFwcGVyQmFzZS5fcFNldERlcHRoTWFwU2l6ZSJdLCJtYXBwaW5ncyI6IkFBQUEsSUFBTyxtQkFBbUIsV0FBYSw0Q0FBNEMsQ0FBQyxDQUFDO0FBTXJGLElBQU8scUJBQXFCLFdBQVksbURBQW1ELENBQUMsQ0FBQztBQUU3RixJQUFPLGFBQWEsV0FBYyx3Q0FBd0MsQ0FBQyxDQUFDO0FBRzVFLElBQU0sZ0JBQWdCO0lBWXJCQSxTQVpLQSxnQkFBZ0JBO1FBTWRDLG1CQUFjQSxHQUFVQSxJQUFJQSxDQUFDQTtRQUc1QkEsdUJBQWtCQSxHQUFXQSxJQUFJQSxDQUFDQTtRQUt6Q0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxHQUFHQSxJQUFJQSxDQUFDQSxzQkFBc0JBLEVBQUVBLENBQUNBO0lBQ3hEQSxDQUFD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LENBQUNBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLENBQUNBLENBQUNBO1lBQzNCQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxPQUFPQSxFQUFFQSxDQUFDQTtZQUN6QkEsSUFBSUEsQ0FBQ0EsU0FBU0EsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFDdkJBLENBQUNBO0lBQ0ZBLENBQUNBO0lBQ0ZkLHVCQUFDQTtBQUFEQSxDQXRJQSxBQXNJQ0EsSUFBQTtBQUVELEFBQTBCLGlCQUFqQixnQkFBZ0IsQ0FBQyIsImZpbGUiOiJtYXRlcmlhbHMvc2hhZG93bWFwcGVycy9TaGFkb3dNYXBwZXJCYXNlLmpzIiwic291cmNlUm9vdCI6Ii4uLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBBYnN0cmFjdE1ldGhvZEVycm9yXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2Vycm9ycy9BYnN0cmFjdE1ldGhvZEVycm9yXCIpO1xuXG5pbXBvcnQgU2NlbmVcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvY29udGFpbmVycy9TY2VuZVwiKTtcbmltcG9ydCBMaWdodEJhc2VcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2Jhc2UvTGlnaHRCYXNlXCIpO1xuaW1wb3J0IElSZW5kZXJlclx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvcmVuZGVyL0lSZW5kZXJlclwiKTtcbmltcG9ydCBFbnRpdHlDb2xsZWN0b3JcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi90cmF2ZXJzZS9FbnRpdHlDb2xsZWN0b3JcIik7XG5pbXBvcnQgU2hhZG93Q2FzdGVyQ29sbGVjdG9yXHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi90cmF2ZXJzZS9TaGFkb3dDYXN0ZXJDb2xsZWN0b3JcIik7XG5pbXBvcnQgQ2FtZXJhXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL0NhbWVyYVwiKTtcbmltcG9ydCBSZW5kZXJUZXh0dXJlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvdGV4dHVyZXMvUmVuZGVyVGV4dHVyZVwiKTtcbmltcG9ydCBUZXh0dXJlQmFzZVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvdGV4dHVyZXMvVGV4dHVyZUJhc2VcIik7XG5cbmNsYXNzIFNoYWRvd01hcHBlckJhc2VcbntcblxuXHRwdWJsaWMgX3BDYXN0ZXJDb2xsZWN0b3I6U2hhZG93Q2FzdGVyQ29sbGVjdG9yO1xuXG5cdHByaXZhdGUgX2RlcHRoTWFwOlRleHR1cmVCYXNlO1xuXHRwdWJsaWMgX3BEZXB0aE1hcFNpemU6bnVtYmVyID0gMjA0ODtcblx0cHVibGljIF9wTGlnaHQ6TGlnaHRCYXNlO1xuXHRwcml2YXRlIF9leHBsaWNpdERlcHRoTWFwOmJvb2xlYW47XG5cdHByaXZhdGUgX2F1dG9VcGRhdGVTaGFkb3dzOmJvb2xlYW4gPSB0cnVlO1xuXHRwdWJsaWMgX2lTaGFkb3dzSW52YWxpZDpib29sZWFuO1xuXG5cdGNvbnN0cnVjdG9yKClcblx0e1xuXHRcdHRoaXMuX3BDYXN0ZXJDb2xsZWN0b3IgPSB0aGlzLnBDcmVhdGVDYXN0ZXJDb2xsZWN0b3IoKTtcblx0fVxuXG5cdHB1YmxpYyBwQ3JlYXRlQ2FzdGVyQ29sbGVjdG9yKClcblx0e1xuXHRcdHJldHVybiBuZXcgU2hhZG93Q2FzdGVyQ29sbGVjdG9yKCk7XG5cdH1cblxuXHRwdWJsaWMgZ2V0IGF1dG9VcGRhdGVTaGFkb3dzKCk6Ym9vbGVhblxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuX2F1dG9VcGRhdGVTaGFkb3dzO1xuXHR9XG5cblx0cHVibGljIHNldCBhdXRvVXBkYXRlU2hhZG93cyh2YWx1ZTpib29sZWFuKVxuXHR7XG5cdFx0dGhpcy5fYXV0b1VwZGF0ZVNoYWRvd3MgPSB2YWx1ZTtcblx0fVxuXG5cdHB1YmxpYyB1cGRhdGVTaGFkb3dzKClcblx0e1xuXHRcdHRoaXMuX2lTaGFkb3dzSW52YWxpZCA9IHRydWU7XG5cdH1cblxuXHRwdWJsaWMgaVNldERlcHRoTWFwKGRlcHRoTWFwOlRleHR1cmVCYXNlKVxuXHR7XG5cdFx0aWYgKHRoaXMuX2RlcHRoTWFwID09IGRlcHRoTWFwKVxuXHRcdFx0cmV0dXJuO1xuXG5cdFx0aWYgKHRoaXMuX2RlcHRoTWFwICYmICF0aGlzLl9leHBsaWNpdERlcHRoTWFwKVxuXHRcdFx0dGhpcy5fZGVwdGhNYXAuZGlzcG9zZSgpO1xuXG5cdFx0dGhpcy5fZGVwdGhNYXAgPSBkZXB0aE1hcDtcblxuXHRcdGlmICh0aGlzLl9kZXB0aE1hcCkge1xuXHRcdFx0dGhpcy5fZXhwbGljaXREZXB0aE1hcCA9IHRydWU7XG5cdFx0XHR0aGlzLl9wRGVwdGhNYXBTaXplID0gdGhpcy5fZGVwdGhNYXAuc2l6ZTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dGhpcy5fZXhwbGljaXREZXB0aE1hcCA9IGZhbHNlO1xuXHRcdH1cblx0fVxuXG5cdHB1YmxpYyBnZXQgbGlnaHQoKTpMaWdodEJhc2Vcblx0e1xuXHRcdHJldHVybiB0aGlzLl9wTGlnaHQ7XG5cdH1cblxuXHRwdWJsaWMgc2V0IGxpZ2h0KHZhbHVlOkxpZ2h0QmFzZSlcblx0e1xuXHRcdHRoaXMuX3BMaWdodCA9IHZhbHVlO1xuXHR9XG5cblx0cHVibGljIGdldCBkZXB0aE1hcCgpOlRleHR1cmVCYXNlXG5cdHtcblx0XHRpZiAoIXRoaXMuX2RlcHRoTWFwKVxuXHRcdFx0dGhpcy5fZGVwdGhNYXAgPSB0aGlzLnBDcmVhdGVEZXB0aFRleHR1cmUoKTtcblxuXHRcdHJldHVybiB0aGlzLl9kZXB0aE1hcDtcblx0fVxuXG5cdHB1YmxpYyBnZXQgZGVwdGhNYXBTaXplKCk6bnVtYmVyXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5fcERlcHRoTWFwU2l6ZTtcblx0fVxuXG5cdHB1YmxpYyBzZXQgZGVwdGhNYXBTaXplKHZhbHVlOm51bWJlcilcblx0e1xuXHRcdGlmICh2YWx1ZSA9PSB0aGlzLl9wRGVwdGhNYXBTaXplKVxuXHRcdFx0cmV0dXJuO1xuXG5cdFx0dGhpcy5fcFNldERlcHRoTWFwU2l6ZSh2YWx1ZSk7XG5cdH1cblxuXHRwdWJsaWMgZGlzcG9zZSgpXG5cdHtcblx0XHR0aGlzLl9wQ2FzdGVyQ29sbGVjdG9yID0gbnVsbDtcblxuXHRcdGlmICh0aGlzLl9kZXB0aE1hcCAmJiAhdGhpcy5fZXhwbGljaXREZXB0aE1hcClcblx0XHRcdHRoaXMuX2RlcHRoTWFwLmRpc3Bvc2UoKTtcblxuXHRcdHRoaXMuX2RlcHRoTWFwID0gbnVsbDtcblx0fVxuXG5cdHB1YmxpYyBwQ3JlYXRlRGVwdGhUZXh0dXJlKCk6VGV4dHVyZUJhc2Vcblx0e1xuXHRcdHJldHVybiBuZXcgUmVuZGVyVGV4dHVyZSh0aGlzLl9wRGVwdGhNYXBTaXplLCB0aGlzLl9wRGVwdGhNYXBTaXplKTtcblx0fVxuXG5cdHB1YmxpYyBpUmVuZGVyRGVwdGhNYXAoZW50aXR5Q29sbGVjdG9yOkVudGl0eUNvbGxlY3RvciwgcmVuZGVyZXI6SVJlbmRlcmVyKVxuXHR7XG5cdFx0dGhpcy5faVNoYWRvd3NJbnZhbGlkID0gZmFsc2U7XG5cblx0XHR0aGlzLnBVcGRhdGVEZXB0aFByb2plY3Rpb24oZW50aXR5Q29sbGVjdG9yLmNhbWVyYSk7XG5cblx0XHRpZiAoIXRoaXMuX2RlcHRoTWFwKVxuXHRcdFx0dGhpcy5fZGVwdGhNYXAgPSB0aGlzLnBDcmVhdGVEZXB0aFRleHR1cmUoKTtcblxuXHRcdHRoaXMucERyYXdEZXB0aE1hcCh0aGlzLl9kZXB0aE1hcCwgZW50aXR5Q29sbGVjdG9yLnNjZW5lLCByZW5kZXJlcik7XG5cdH1cblxuXHRwdWJsaWMgcFVwZGF0ZURlcHRoUHJvamVjdGlvbih2aWV3Q2FtZXJhOkNhbWVyYSlcblx0e1xuXHRcdHRocm93IG5ldyBBYnN0cmFjdE1ldGhvZEVycm9yKCk7XG5cdH1cblxuXHRwdWJsaWMgcERyYXdEZXB0aE1hcCh0YXJnZXQ6VGV4dHVyZUJhc2UsIHNjZW5lOlNjZW5lLCByZW5kZXJlcjpJUmVuZGVyZXIpXG5cdHtcblx0XHR0aHJvdyBuZXcgQWJzdHJhY3RNZXRob2RFcnJvcigpO1xuXHR9XG5cblx0cHVibGljIF9wU2V0RGVwdGhNYXBTaXplKHZhbHVlKVxuXHR7XG5cdFx0dGhpcy5fcERlcHRoTWFwU2l6ZSA9IHZhbHVlO1xuXG5cdFx0aWYgKHRoaXMuX2V4cGxpY2l0RGVwdGhNYXApIHtcblx0XHRcdHRocm93IEVycm9yKFwiQ2Fubm90IHNldCBkZXB0aCBtYXAgc2l6ZSBmb3IgdGhlIGN1cnJlbnQgcmVuZGVyZXIuXCIpO1xuXHRcdH0gZWxzZSBpZiAodGhpcy5fZGVwdGhNYXApIHtcblx0XHRcdHRoaXMuX2RlcHRoTWFwLmRpc3Bvc2UoKTtcblx0XHRcdHRoaXMuX2RlcHRoTWFwID0gbnVsbDtcblx0XHR9XG5cdH1cbn1cblxuZXhwb3J0ID0gU2hhZG93TWFwcGVyQmFzZTsiXX0=