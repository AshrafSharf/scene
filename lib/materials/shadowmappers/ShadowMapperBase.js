var AbstractMethodError = require("awayjs-core/lib/errors/AbstractMethodError");
var ShadowCasterCollector = require("awayjs-display/lib/traverse/ShadowCasterCollector");
var RenderTexture = require("awayjs-core/lib/textures/RenderTexture");
var ShadowMapperBase = (function () {
    function ShadowMapperBase() {
        this._pDepthMapSize = 2048;
        this._autoUpdateShadows = true;
        this._pCasterCollector = this.pCreateCasterCollector();
    }
    ShadowMapperBase.prototype.pCreateCasterCollector = function () {
        return new ShadowCasterCollector();
    };
    Object.defineProperty(ShadowMapperBase.prototype, "autoUpdateShadows", {
        get: function () {
            return this._autoUpdateShadows;
        },
        set: function (value) {
            this._autoUpdateShadows = value;
        },
        enumerable: true,
        configurable: true
    });
    ShadowMapperBase.prototype.updateShadows = function () {
        this._iShadowsInvalid = true;
    };
    ShadowMapperBase.prototype.iSetDepthMap = function (depthMap) {
        if (this._depthMap == depthMap)
            return;
        if (this._depthMap && !this._explicitDepthMap)
            this._depthMap.dispose();
        this._depthMap = depthMap;
        if (this._depthMap) {
            this._explicitDepthMap = true;
            this._pDepthMapSize = this._depthMap.size;
        }
        else {
            this._explicitDepthMap = false;
        }
    };
    Object.defineProperty(ShadowMapperBase.prototype, "light", {
        get: function () {
            return this._pLight;
        },
        set: function (value) {
            this._pLight = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ShadowMapperBase.prototype, "depthMap", {
        get: function () {
            if (!this._depthMap)
                this._depthMap = this.pCreateDepthTexture();
            return this._depthMap;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ShadowMapperBase.prototype, "depthMapSize", {
        get: function () {
            return this._pDepthMapSize;
        },
        set: function (value) {
            if (value == this._pDepthMapSize)
                return;
            this._pSetDepthMapSize(value);
        },
        enumerable: true,
        configurable: true
    });
    ShadowMapperBase.prototype.dispose = function () {
        this._pCasterCollector = null;
        if (this._depthMap && !this._explicitDepthMap)
            this._depthMap.dispose();
        this._depthMap = null;
    };
    ShadowMapperBase.prototype.pCreateDepthTexture = function () {
        return new RenderTexture(this._pDepthMapSize, this._pDepthMapSize);
    };
    ShadowMapperBase.prototype.iRenderDepthMap = function (entityCollector, renderer) {
        this._iShadowsInvalid = false;
        this.pUpdateDepthProjection(entityCollector.camera);
        if (!this._depthMap)
            this._depthMap = this.pCreateDepthTexture();
        this.pDrawDepthMap(this._depthMap, entityCollector.scene, renderer);
    };
    ShadowMapperBase.prototype.pUpdateDepthProjection = function (viewCamera) {
        throw new AbstractMethodError();
    };
    ShadowMapperBase.prototype.pDrawDepthMap = function (target, scene, renderer) {
        throw new AbstractMethodError();
    };
    ShadowMapperBase.prototype._pSetDepthMapSize = function (value) {
        this._pDepthMapSize = value;
        if (this._explicitDepthMap) {
            throw Error("Cannot set depth map size for the current renderer.");
        }
        else if (this._depthMap) {
            this._depthMap.dispose();
            this._depthMap = null;
        }
    };
    return ShadowMapperBase;
})();
module.exports = ShadowMapperBase;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1kaXNwbGF5L2xpYi9tYXRlcmlhbHMvc2hhZG93bWFwcGVycy9TaGFkb3dNYXBwZXJCYXNlLnRzIl0sIm5hbWVzIjpbIlNoYWRvd01hcHBlckJhc2UiLCJTaGFkb3dNYXBwZXJCYXNlLmNvbnN0cnVjdG9yIiwiU2hhZG93TWFwcGVyQmFzZS5wQ3JlYXRlQ2FzdGVyQ29sbGVjdG9yIiwiU2hhZG93TWFwcGVyQmFzZS5hdXRvVXBkYXRlU2hhZG93cyIsIlNoYWRvd01hcHBlckJhc2UudXBkYXRlU2hhZG93cyIsIlNoYWRvd01hcHBlckJhc2UuaVNldERlcHRoTWFwIiwiU2hhZG93TWFwcGVyQmFzZS5saWdodCIsIlNoYWRvd01hcHBlckJhc2UuZGVwdGhNYXAiLCJTaGFkb3dNYXBwZXJCYXNlLmRlcHRoTWFwU2l6ZSIsIlNoYWRvd01hcHBlckJhc2UuZGlzcG9zZSIsIlNoYWRvd01hcHBlckJhc2UucENyZWF0ZURlcHRoVGV4dHVyZSIsIlNoYWRvd01hcHBlckJhc2UuaVJlbmRlckRlcHRoTWFwIiwiU2hhZG93TWFwcGVyQmFzZS5wVXBkYXRlRGVwdGhQcm9qZWN0aW9uIiwiU2hhZG93TWFwcGVyQmFzZS5wRHJhd0RlcHRoTWFwIiwiU2hhZG93TWFwcGVyQmFzZS5fcFNldERlcHRoTWFwU2l6ZSJdLCJtYXBwaW5ncyI6IkFBQUEsSUFBTyxtQkFBbUIsV0FBYSw0Q0FBNEMsQ0FBQyxDQUFDO0FBTXJGLElBQU8scUJBQXFCLFdBQVksbURBQW1ELENBQUMsQ0FBQztBQUU3RixJQUFPLGFBQWEsV0FBYyx3Q0FBd0MsQ0FBQyxDQUFDO0FBRzVFLElBQU0sZ0JBQWdCO0lBWXJCQSxTQVpLQSxnQkFBZ0JBO1FBTWRDLG1CQUFjQSxHQUFVQSxJQUFJQSxDQUFDQTtRQUc1QkEsdUJBQWtCQSxHQUFXQSxJQUFJQSxDQUFDQTtRQUt6Q0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxHQUFHQSxJQUFJQSxDQUFDQSxzQkFBc0JBLEVBQUVBLENBQUNBO0lBQ3hEQSxDQUFD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LENBQUNBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLENBQUNBLENBQUNBO1lBQzNCQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxPQUFPQSxFQUFFQSxDQUFDQTtZQUN6QkEsSUFBSUEsQ0FBQ0EsU0FBU0EsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFDdkJBLENBQUNBO0lBQ0ZBLENBQUNBO0lBQ0ZkLHVCQUFDQTtBQUFEQSxDQXRJQSxBQXNJQ0EsSUFBQTtBQUVELEFBQTBCLGlCQUFqQixnQkFBZ0IsQ0FBQyIsImZpbGUiOiJtYXRlcmlhbHMvc2hhZG93bWFwcGVycy9TaGFkb3dNYXBwZXJCYXNlLmpzIiwic291cmNlUm9vdCI6Ii4uLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBBYnN0cmFjdE1ldGhvZEVycm9yXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2Vycm9ycy9BYnN0cmFjdE1ldGhvZEVycm9yXCIpO1xuXG5pbXBvcnQgU2NlbmVcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvY29udGFpbmVycy9TY2VuZVwiKTtcbmltcG9ydCBMaWdodEJhc2VcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2Jhc2UvTGlnaHRCYXNlXCIpO1xuaW1wb3J0IElSZW5kZXJlclx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvcmVuZGVyL0lSZW5kZXJlclwiKTtcbmltcG9ydCBFbnRpdHlDb2xsZWN0b3JcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi90cmF2ZXJzZS9FbnRpdHlDb2xsZWN0b3JcIik7XG5pbXBvcnQgU2hhZG93Q2FzdGVyQ29sbGVjdG9yXHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi90cmF2ZXJzZS9TaGFkb3dDYXN0ZXJDb2xsZWN0b3JcIik7XG5pbXBvcnQgQ2FtZXJhXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL0NhbWVyYVwiKTtcbmltcG9ydCBSZW5kZXJUZXh0dXJlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvdGV4dHVyZXMvUmVuZGVyVGV4dHVyZVwiKTtcbmltcG9ydCBUZXh0dXJlUHJveHlCYXNlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvdGV4dHVyZXMvVGV4dHVyZVByb3h5QmFzZVwiKTtcblxuY2xhc3MgU2hhZG93TWFwcGVyQmFzZVxue1xuXG5cdHB1YmxpYyBfcENhc3RlckNvbGxlY3RvcjpTaGFkb3dDYXN0ZXJDb2xsZWN0b3I7XG5cblx0cHJpdmF0ZSBfZGVwdGhNYXA6VGV4dHVyZVByb3h5QmFzZTtcblx0cHVibGljIF9wRGVwdGhNYXBTaXplOm51bWJlciA9IDIwNDg7XG5cdHB1YmxpYyBfcExpZ2h0OkxpZ2h0QmFzZTtcblx0cHJpdmF0ZSBfZXhwbGljaXREZXB0aE1hcDpib29sZWFuO1xuXHRwcml2YXRlIF9hdXRvVXBkYXRlU2hhZG93czpib29sZWFuID0gdHJ1ZTtcblx0cHVibGljIF9pU2hhZG93c0ludmFsaWQ6Ym9vbGVhbjtcblxuXHRjb25zdHJ1Y3RvcigpXG5cdHtcblx0XHR0aGlzLl9wQ2FzdGVyQ29sbGVjdG9yID0gdGhpcy5wQ3JlYXRlQ2FzdGVyQ29sbGVjdG9yKCk7XG5cdH1cblxuXHRwdWJsaWMgcENyZWF0ZUNhc3RlckNvbGxlY3RvcigpXG5cdHtcblx0XHRyZXR1cm4gbmV3IFNoYWRvd0Nhc3RlckNvbGxlY3RvcigpO1xuXHR9XG5cblx0cHVibGljIGdldCBhdXRvVXBkYXRlU2hhZG93cygpOmJvb2xlYW5cblx0e1xuXHRcdHJldHVybiB0aGlzLl9hdXRvVXBkYXRlU2hhZG93cztcblx0fVxuXG5cdHB1YmxpYyBzZXQgYXV0b1VwZGF0ZVNoYWRvd3ModmFsdWU6Ym9vbGVhbilcblx0e1xuXHRcdHRoaXMuX2F1dG9VcGRhdGVTaGFkb3dzID0gdmFsdWU7XG5cdH1cblxuXHRwdWJsaWMgdXBkYXRlU2hhZG93cygpXG5cdHtcblx0XHR0aGlzLl9pU2hhZG93c0ludmFsaWQgPSB0cnVlO1xuXHR9XG5cblx0cHVibGljIGlTZXREZXB0aE1hcChkZXB0aE1hcDpUZXh0dXJlUHJveHlCYXNlKVxuXHR7XG5cdFx0aWYgKHRoaXMuX2RlcHRoTWFwID09IGRlcHRoTWFwKVxuXHRcdFx0cmV0dXJuO1xuXG5cdFx0aWYgKHRoaXMuX2RlcHRoTWFwICYmICF0aGlzLl9leHBsaWNpdERlcHRoTWFwKVxuXHRcdFx0dGhpcy5fZGVwdGhNYXAuZGlzcG9zZSgpO1xuXG5cdFx0dGhpcy5fZGVwdGhNYXAgPSBkZXB0aE1hcDtcblxuXHRcdGlmICh0aGlzLl9kZXB0aE1hcCkge1xuXHRcdFx0dGhpcy5fZXhwbGljaXREZXB0aE1hcCA9IHRydWU7XG5cdFx0XHR0aGlzLl9wRGVwdGhNYXBTaXplID0gdGhpcy5fZGVwdGhNYXAuc2l6ZTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dGhpcy5fZXhwbGljaXREZXB0aE1hcCA9IGZhbHNlO1xuXHRcdH1cblx0fVxuXG5cdHB1YmxpYyBnZXQgbGlnaHQoKTpMaWdodEJhc2Vcblx0e1xuXHRcdHJldHVybiB0aGlzLl9wTGlnaHQ7XG5cdH1cblxuXHRwdWJsaWMgc2V0IGxpZ2h0KHZhbHVlOkxpZ2h0QmFzZSlcblx0e1xuXHRcdHRoaXMuX3BMaWdodCA9IHZhbHVlO1xuXHR9XG5cblx0cHVibGljIGdldCBkZXB0aE1hcCgpOlRleHR1cmVQcm94eUJhc2Vcblx0e1xuXHRcdGlmICghdGhpcy5fZGVwdGhNYXApXG5cdFx0XHR0aGlzLl9kZXB0aE1hcCA9IHRoaXMucENyZWF0ZURlcHRoVGV4dHVyZSgpO1xuXG5cdFx0cmV0dXJuIHRoaXMuX2RlcHRoTWFwO1xuXHR9XG5cblx0cHVibGljIGdldCBkZXB0aE1hcFNpemUoKTpudW1iZXJcblx0e1xuXHRcdHJldHVybiB0aGlzLl9wRGVwdGhNYXBTaXplO1xuXHR9XG5cblx0cHVibGljIHNldCBkZXB0aE1hcFNpemUodmFsdWU6bnVtYmVyKVxuXHR7XG5cdFx0aWYgKHZhbHVlID09IHRoaXMuX3BEZXB0aE1hcFNpemUpXG5cdFx0XHRyZXR1cm47XG5cblx0XHR0aGlzLl9wU2V0RGVwdGhNYXBTaXplKHZhbHVlKTtcblx0fVxuXG5cdHB1YmxpYyBkaXNwb3NlKClcblx0e1xuXHRcdHRoaXMuX3BDYXN0ZXJDb2xsZWN0b3IgPSBudWxsO1xuXG5cdFx0aWYgKHRoaXMuX2RlcHRoTWFwICYmICF0aGlzLl9leHBsaWNpdERlcHRoTWFwKVxuXHRcdFx0dGhpcy5fZGVwdGhNYXAuZGlzcG9zZSgpO1xuXG5cdFx0dGhpcy5fZGVwdGhNYXAgPSBudWxsO1xuXHR9XG5cblx0cHVibGljIHBDcmVhdGVEZXB0aFRleHR1cmUoKTpUZXh0dXJlUHJveHlCYXNlXG5cdHtcblx0XHRyZXR1cm4gbmV3IFJlbmRlclRleHR1cmUodGhpcy5fcERlcHRoTWFwU2l6ZSwgdGhpcy5fcERlcHRoTWFwU2l6ZSk7XG5cdH1cblxuXHRwdWJsaWMgaVJlbmRlckRlcHRoTWFwKGVudGl0eUNvbGxlY3RvcjpFbnRpdHlDb2xsZWN0b3IsIHJlbmRlcmVyOklSZW5kZXJlcilcblx0e1xuXHRcdHRoaXMuX2lTaGFkb3dzSW52YWxpZCA9IGZhbHNlO1xuXG5cdFx0dGhpcy5wVXBkYXRlRGVwdGhQcm9qZWN0aW9uKGVudGl0eUNvbGxlY3Rvci5jYW1lcmEpO1xuXG5cdFx0aWYgKCF0aGlzLl9kZXB0aE1hcClcblx0XHRcdHRoaXMuX2RlcHRoTWFwID0gdGhpcy5wQ3JlYXRlRGVwdGhUZXh0dXJlKCk7XG5cblx0XHR0aGlzLnBEcmF3RGVwdGhNYXAodGhpcy5fZGVwdGhNYXAsIGVudGl0eUNvbGxlY3Rvci5zY2VuZSwgcmVuZGVyZXIpO1xuXHR9XG5cblx0cHVibGljIHBVcGRhdGVEZXB0aFByb2plY3Rpb24odmlld0NhbWVyYTpDYW1lcmEpXG5cdHtcblx0XHR0aHJvdyBuZXcgQWJzdHJhY3RNZXRob2RFcnJvcigpO1xuXHR9XG5cblx0cHVibGljIHBEcmF3RGVwdGhNYXAodGFyZ2V0OlRleHR1cmVQcm94eUJhc2UsIHNjZW5lOlNjZW5lLCByZW5kZXJlcjpJUmVuZGVyZXIpXG5cdHtcblx0XHR0aHJvdyBuZXcgQWJzdHJhY3RNZXRob2RFcnJvcigpO1xuXHR9XG5cblx0cHVibGljIF9wU2V0RGVwdGhNYXBTaXplKHZhbHVlKVxuXHR7XG5cdFx0dGhpcy5fcERlcHRoTWFwU2l6ZSA9IHZhbHVlO1xuXG5cdFx0aWYgKHRoaXMuX2V4cGxpY2l0RGVwdGhNYXApIHtcblx0XHRcdHRocm93IEVycm9yKFwiQ2Fubm90IHNldCBkZXB0aCBtYXAgc2l6ZSBmb3IgdGhlIGN1cnJlbnQgcmVuZGVyZXIuXCIpO1xuXHRcdH0gZWxzZSBpZiAodGhpcy5fZGVwdGhNYXApIHtcblx0XHRcdHRoaXMuX2RlcHRoTWFwLmRpc3Bvc2UoKTtcblx0XHRcdHRoaXMuX2RlcHRoTWFwID0gbnVsbDtcblx0XHR9XG5cdH1cbn1cblxuZXhwb3J0ID0gU2hhZG93TWFwcGVyQmFzZTsiXX0=