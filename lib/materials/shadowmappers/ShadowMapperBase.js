var AbstractMethodError = require("awayjs-core/lib/errors/AbstractMethodError");
var ShadowCasterCollector = require("awayjs-display/lib/traverse/ShadowCasterCollector");
var RenderTexture = require("awayjs-core/lib/textures/RenderTexture");
var ShadowMapperBase = (function () {
    function ShadowMapperBase() {
        this._pDepthMapSize = 2048;
        this._autoUpdateShadows = true;
        this._pCasterCollector = this.pCreateCasterCollector();
    }
    ShadowMapperBase.prototype.pCreateCasterCollector = function () {
        return new ShadowCasterCollector();
    };
    Object.defineProperty(ShadowMapperBase.prototype, "autoUpdateShadows", {
        get: function () {
            return this._autoUpdateShadows;
        },
        set: function (value) {
            this._autoUpdateShadows = value;
        },
        enumerable: true,
        configurable: true
    });
    ShadowMapperBase.prototype.updateShadows = function () {
        this._iShadowsInvalid = true;
    };
    ShadowMapperBase.prototype.iSetDepthMap = function (depthMap) {
        if (this._depthMap == depthMap)
            return;
        if (this._depthMap && !this._explicitDepthMap)
            this._depthMap.dispose();
        this._depthMap = depthMap;
        if (this._depthMap) {
            this._explicitDepthMap = true;
            this._pDepthMapSize = this._depthMap.size;
        }
        else {
            this._explicitDepthMap = false;
        }
    };
    Object.defineProperty(ShadowMapperBase.prototype, "light", {
        get: function () {
            return this._pLight;
        },
        set: function (value) {
            this._pLight = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ShadowMapperBase.prototype, "depthMap", {
        get: function () {
            if (!this._depthMap)
                this._depthMap = this.pCreateDepthTexture();
            return this._depthMap;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ShadowMapperBase.prototype, "depthMapSize", {
        get: function () {
            return this._pDepthMapSize;
        },
        set: function (value) {
            if (value == this._pDepthMapSize)
                return;
            this._pSetDepthMapSize(value);
        },
        enumerable: true,
        configurable: true
    });
    ShadowMapperBase.prototype.dispose = function () {
        this._pCasterCollector = null;
        if (this._depthMap && !this._explicitDepthMap)
            this._depthMap.dispose();
        this._depthMap = null;
    };
    ShadowMapperBase.prototype.pCreateDepthTexture = function () {
        return new RenderTexture(this._pDepthMapSize, this._pDepthMapSize);
    };
    ShadowMapperBase.prototype.iRenderDepthMap = function (entityCollector, renderer) {
        this._iShadowsInvalid = false;
        this.pUpdateDepthProjection(entityCollector.camera);
        if (!this._depthMap)
            this._depthMap = this.pCreateDepthTexture();
        this.pDrawDepthMap(this._depthMap, entityCollector.scene, renderer);
    };
    ShadowMapperBase.prototype.pUpdateDepthProjection = function (viewCamera) {
        throw new AbstractMethodError();
    };
    ShadowMapperBase.prototype.pDrawDepthMap = function (target, scene, renderer) {
        throw new AbstractMethodError();
    };
    ShadowMapperBase.prototype._pSetDepthMapSize = function (value) {
        this._pDepthMapSize = value;
        if (this._explicitDepthMap) {
            throw Error("Cannot set depth map size for the current renderer.");
        }
        else if (this._depthMap) {
            this._depthMap.dispose();
            this._depthMap = null;
        }
    };
    return ShadowMapperBase;
})();
module.exports = ShadowMapperBase;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1kaXNwbGF5L2xpYi9tYXRlcmlhbHMvc2hhZG93bWFwcGVycy9TaGFkb3dNYXBwZXJCYXNlLnRzIl0sIm5hbWVzIjpbIlNoYWRvd01hcHBlckJhc2UiLCJTaGFkb3dNYXBwZXJCYXNlLmNvbnN0cnVjdG9yIiwiU2hhZG93TWFwcGVyQmFzZS5wQ3JlYXRlQ2FzdGVyQ29sbGVjdG9yIiwiU2hhZG93TWFwcGVyQmFzZS5hdXRvVXBkYXRlU2hhZG93cyIsIlNoYWRvd01hcHBlckJhc2UudXBkYXRlU2hhZG93cyIsIlNoYWRvd01hcHBlckJhc2UuaVNldERlcHRoTWFwIiwiU2hhZG93TWFwcGVyQmFzZS5saWdodCIsIlNoYWRvd01hcHBlckJhc2UuZGVwdGhNYXAiLCJTaGFkb3dNYXBwZXJCYXNlLmRlcHRoTWFwU2l6ZSIsIlNoYWRvd01hcHBlckJhc2UuZGlzcG9zZSIsIlNoYWRvd01hcHBlckJhc2UucENyZWF0ZURlcHRoVGV4dHVyZSIsIlNoYWRvd01hcHBlckJhc2UuaVJlbmRlckRlcHRoTWFwIiwiU2hhZG93TWFwcGVyQmFzZS5wVXBkYXRlRGVwdGhQcm9qZWN0aW9uIiwiU2hhZG93TWFwcGVyQmFzZS5wRHJhd0RlcHRoTWFwIiwiU2hhZG93TWFwcGVyQmFzZS5fcFNldERlcHRoTWFwU2l6ZSJdLCJtYXBwaW5ncyI6IkFBQUEsSUFBTyxtQkFBbUIsV0FBYSw0Q0FBNEMsQ0FBQyxDQUFDO0FBTXJGLElBQU8scUJBQXFCLFdBQVksbURBQW1ELENBQUMsQ0FBQztBQUU3RixJQUFPLGFBQWEsV0FBYyx3Q0FBd0MsQ0FBQyxDQUFDO0FBRzVFLElBQU0sZ0JBQWdCO0lBWXJCQSxTQVpLQSxnQkFBZ0JBO1FBTWRDLG1CQUFjQSxHQUFVQSxJQUFJQSxDQUFDQTtRQUc1QkEsdUJBQWtCQSxHQUFXQSxJQUFJQSxDQUFDQTtRQUt6Q0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxHQUFHQSxJQUFJQSxDQUFDQSxzQkFBc0JBLEVBQUVBLENBQUNBO0lBQ3hEQSxDQUFDQTtJQUVNRCxpREFBc0JBLEdBQTdCQTtRQUVDRSxNQUFNQSxDQUFDQSxJQUFJQSxxQkFBcUJBLEVBQUVBLENBQUNBO0lBQ3BDQSxDQUFDQTtJQUVERixzQkFBV0EsK0NBQWlCQTthQUE1QkE7WUFFQ0csTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxDQUFDQTtRQUNoQ0EsQ0FBQ0E7YUFFREgsVUFBNkJBLEtBQWFBO1lBRXpDRyxJQUFJQSxDQUFDQSxrQkFBa0JBLEdBQUdBLEtBQUtBLENBQUNBO1FBQ2pDQSxDQUFDQTs7O09BTEFIO0lBT01BLHdDQUFhQSxHQUFwQkE7UUFFQ0ksSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxHQUFHQSxJQUFJQSxDQUFDQTtJQUM5QkEsQ0FBQ0E7SUFFTUosdUNBQVlBLEdBQW5CQSxVQUFvQkEsUUFBeUJBO1FBRTVDSyxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxTQUFTQSxJQUFJQSxRQUFRQSxDQUFDQTtZQUM5QkEsTUFBTUEsQ0FBQ0E7UUFFUkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsU0FBU0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQTtZQUM3Q0EsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsT0FBT0EsRUFBRUEsQ0FBQ0E7UUFFMUJBLElBQUlBLENBQUNBLFNBQVNBLEdBQUdBLFFBQVFBLENBQUNBO1FBRTFCQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNwQkEsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxHQUFHQSxJQUFJQSxDQUFDQTtZQUM5QkEsSUFBSUEsQ0FBQ0EsY0FBY0EsR0FBR0EsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsSUFBSUEsQ0FBQ0E7UUFDM0NBLENBQUNBO1FBQUNBLElBQUlBLENBQUNBLENBQUNBO1lBQ1BBLElBQUlBLENBQUNBLGlCQUFpQkEsR0FBR0EsS0FBS0EsQ0FBQ0E7UUFDaENBLENBQUNBO0lBQ0ZBLENBQUNBO0lBRURMLHNCQUFXQSxtQ0FBS0E7YUFBaEJBO1lBRUNNLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBO1FBQ3JCQSxDQUFDQTthQUVETixVQUFpQkEsS0FBZUE7WUFFL0JNLElBQUlBLENBQUNBLE9BQU9BLEdBQUdBLEtBQUtBLENBQUNBO1FBQ3RCQSxDQUFDQTs7O09BTEFOO0lBT0RBLHNCQUFXQSxzQ0FBUUE7YUFBbkJBO1lBRUNPLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBO2dCQUNuQkEsSUFBSUEsQ0FBQ0EsU0FBU0EsR0FBR0EsSUFBSUEsQ0FBQ0EsbUJBQW1CQSxFQUFFQSxDQUFDQTtZQUU3Q0EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0E7UUFDdkJBLENBQUNBOzs7T0FBQVA7SUFFREEsc0JBQVdBLDBDQUFZQTthQUF2QkE7WUFFQ1EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsY0FBY0EsQ0FBQ0E7UUFDNUJBLENBQUNBO2FBRURSLFVBQXdCQSxLQUFZQTtZQUVuQ1EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsS0FBS0EsSUFBSUEsSUFBSUEsQ0FBQ0EsY0FBY0EsQ0FBQ0E7Z0JBQ2hDQSxNQUFNQSxDQUFDQTtZQUVSQSxJQUFJQSxDQUFDQSxpQkFBaUJBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBO1FBQy9CQSxDQUFDQTs7O09BUkFSO0lBVU1BLGtDQUFPQSxHQUFkQTtRQUVDUyxJQUFJQSxDQUFDQSxpQkFBaUJBLEdBQUdBLElBQUlBLENBQUNBO1FBRTlCQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxTQUFTQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxpQkFBaUJBLENBQUNBO1lBQzdDQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxPQUFPQSxFQUFFQSxDQUFDQTtRQUUxQkEsSUFBSUEsQ0FBQ0EsU0FBU0EsR0FBR0EsSUFBSUEsQ0FBQ0E7SUFDdkJBLENBQUNBO0lBRU1ULDhDQUFtQkEsR0FBMUJBO1FBRUNVLE1BQU1BLENBQUNBLElBQUlBLGFBQWFBLENBQUNBLElBQUlBLENBQUNBLGNBQWNBLEVBQUVBLElBQUlBLENBQUNBLGNBQWNBLENBQUNBLENBQUNBO0lBQ3BFQSxDQUFDQTtJQUVNViwwQ0FBZUEsR0FBdEJBLFVBQXVCQSxlQUErQkEsRUFBRUEsUUFBa0JBO1FBRXpFVyxJQUFJQSxDQUFDQSxnQkFBZ0JBLEdBQUdBLEtBQUtBLENBQUNBO1FBRTlCQSxJQUFJQSxDQUFDQSxzQkFBc0JBLENBQUNBLGVBQWVBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO1FBRXBEQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQTtZQUNuQkEsSUFBSUEsQ0FBQ0EsU0FBU0EsR0FBR0EsSUFBSUEsQ0FBQ0EsbUJBQW1CQSxFQUFFQSxDQUFDQTtRQUU3Q0EsSUFBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsU0FBU0EsRUFBRUEsZUFBZUEsQ0FBQ0EsS0FBS0EsRUFBRUEsUUFBUUEsQ0FBQ0EsQ0FBQ0E7SUFDckVBLENBQUNBO0lBRU1YLGlEQUFzQkEsR0FBN0JBLFVBQThCQSxVQUFpQkE7UUFFOUNZLE1BQU1BLElBQUlBLG1CQUFtQkEsRUFBRUEsQ0FBQ0E7SUFDakNBLENBQUNBO0lBRU1aLHdDQUFhQSxHQUFwQkEsVUFBcUJBLE1BQXVCQSxFQUFFQSxLQUFXQSxFQUFFQSxRQUFrQkE7UUFFNUVhLE1BQU1BLElBQUlBLG1CQUFtQkEsRUFBRUEsQ0FBQ0E7SUFDakNBLENBQUNBO0lBRU1iLDRDQUFpQkEsR0FBeEJBLFVBQXlCQSxLQUFLQTtRQUU3QmMsSUFBSUEsQ0FBQ0EsY0FBY0EsR0FBR0EsS0FBS0EsQ0FBQ0E7UUFFNUJBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLGlCQUFpQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDNUJBLE1BQU1BLEtBQUtBLENBQUNBLHFEQUFxREEsQ0FBQ0EsQ0FBQ0E7UUFDcEVBLENBQUNBO1FBQUNBLElBQUlBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLENBQUNBLENBQUNBO1lBQzNCQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxPQUFPQSxFQUFFQSxDQUFDQTtZQUN6QkEsSUFBSUEsQ0FBQ0EsU0FBU0EsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFDdkJBLENBQUNBO0lBQ0ZBLENBQUNBO0lBQ0ZkLHVCQUFDQTtBQUFEQSxDQXRJQSxBQXNJQ0EsSUFBQTtBQUVELEFBQTBCLGlCQUFqQixnQkFBZ0IsQ0FBQyIsImZpbGUiOiJtYXRlcmlhbHMvc2hhZG93bWFwcGVycy9TaGFkb3dNYXBwZXJCYXNlLmpzIiwic291cmNlUm9vdCI6Ii4uLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBBYnN0cmFjdE1ldGhvZEVycm9yXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2Vycm9ycy9BYnN0cmFjdE1ldGhvZEVycm9yXCIpO1xyXG5cclxuaW1wb3J0IFNjZW5lXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2NvbnRhaW5lcnMvU2NlbmVcIik7XHJcbmltcG9ydCBMaWdodEJhc2VcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2Jhc2UvTGlnaHRCYXNlXCIpO1xyXG5pbXBvcnQgSVJlbmRlcmVyXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9yZW5kZXIvSVJlbmRlcmVyXCIpO1xyXG5pbXBvcnQgRW50aXR5Q29sbGVjdG9yXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvdHJhdmVyc2UvRW50aXR5Q29sbGVjdG9yXCIpO1xyXG5pbXBvcnQgU2hhZG93Q2FzdGVyQ29sbGVjdG9yXHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi90cmF2ZXJzZS9TaGFkb3dDYXN0ZXJDb2xsZWN0b3JcIik7XHJcbmltcG9ydCBDYW1lcmFcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvZW50aXRpZXMvQ2FtZXJhXCIpO1xyXG5pbXBvcnQgUmVuZGVyVGV4dHVyZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL3RleHR1cmVzL1JlbmRlclRleHR1cmVcIik7XHJcbmltcG9ydCBUZXh0dXJlUHJveHlCYXNlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvdGV4dHVyZXMvVGV4dHVyZVByb3h5QmFzZVwiKTtcclxuXHJcbmNsYXNzIFNoYWRvd01hcHBlckJhc2Vcclxue1xyXG5cclxuXHRwdWJsaWMgX3BDYXN0ZXJDb2xsZWN0b3I6U2hhZG93Q2FzdGVyQ29sbGVjdG9yO1xyXG5cclxuXHRwcml2YXRlIF9kZXB0aE1hcDpUZXh0dXJlUHJveHlCYXNlO1xyXG5cdHB1YmxpYyBfcERlcHRoTWFwU2l6ZTpudW1iZXIgPSAyMDQ4O1xyXG5cdHB1YmxpYyBfcExpZ2h0OkxpZ2h0QmFzZTtcclxuXHRwcml2YXRlIF9leHBsaWNpdERlcHRoTWFwOmJvb2xlYW47XHJcblx0cHJpdmF0ZSBfYXV0b1VwZGF0ZVNoYWRvd3M6Ym9vbGVhbiA9IHRydWU7XHJcblx0cHVibGljIF9pU2hhZG93c0ludmFsaWQ6Ym9vbGVhbjtcclxuXHJcblx0Y29uc3RydWN0b3IoKVxyXG5cdHtcclxuXHRcdHRoaXMuX3BDYXN0ZXJDb2xsZWN0b3IgPSB0aGlzLnBDcmVhdGVDYXN0ZXJDb2xsZWN0b3IoKTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBwQ3JlYXRlQ2FzdGVyQ29sbGVjdG9yKClcclxuXHR7XHJcblx0XHRyZXR1cm4gbmV3IFNoYWRvd0Nhc3RlckNvbGxlY3RvcigpO1xyXG5cdH1cclxuXHJcblx0cHVibGljIGdldCBhdXRvVXBkYXRlU2hhZG93cygpOmJvb2xlYW5cclxuXHR7XHJcblx0XHRyZXR1cm4gdGhpcy5fYXV0b1VwZGF0ZVNoYWRvd3M7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgc2V0IGF1dG9VcGRhdGVTaGFkb3dzKHZhbHVlOmJvb2xlYW4pXHJcblx0e1xyXG5cdFx0dGhpcy5fYXV0b1VwZGF0ZVNoYWRvd3MgPSB2YWx1ZTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyB1cGRhdGVTaGFkb3dzKClcclxuXHR7XHJcblx0XHR0aGlzLl9pU2hhZG93c0ludmFsaWQgPSB0cnVlO1xyXG5cdH1cclxuXHJcblx0cHVibGljIGlTZXREZXB0aE1hcChkZXB0aE1hcDpUZXh0dXJlUHJveHlCYXNlKVxyXG5cdHtcclxuXHRcdGlmICh0aGlzLl9kZXB0aE1hcCA9PSBkZXB0aE1hcClcclxuXHRcdFx0cmV0dXJuO1xyXG5cclxuXHRcdGlmICh0aGlzLl9kZXB0aE1hcCAmJiAhdGhpcy5fZXhwbGljaXREZXB0aE1hcClcclxuXHRcdFx0dGhpcy5fZGVwdGhNYXAuZGlzcG9zZSgpO1xyXG5cclxuXHRcdHRoaXMuX2RlcHRoTWFwID0gZGVwdGhNYXA7XHJcblxyXG5cdFx0aWYgKHRoaXMuX2RlcHRoTWFwKSB7XHJcblx0XHRcdHRoaXMuX2V4cGxpY2l0RGVwdGhNYXAgPSB0cnVlO1xyXG5cdFx0XHR0aGlzLl9wRGVwdGhNYXBTaXplID0gdGhpcy5fZGVwdGhNYXAuc2l6ZTtcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdHRoaXMuX2V4cGxpY2l0RGVwdGhNYXAgPSBmYWxzZTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdHB1YmxpYyBnZXQgbGlnaHQoKTpMaWdodEJhc2VcclxuXHR7XHJcblx0XHRyZXR1cm4gdGhpcy5fcExpZ2h0O1xyXG5cdH1cclxuXHJcblx0cHVibGljIHNldCBsaWdodCh2YWx1ZTpMaWdodEJhc2UpXHJcblx0e1xyXG5cdFx0dGhpcy5fcExpZ2h0ID0gdmFsdWU7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgZ2V0IGRlcHRoTWFwKCk6VGV4dHVyZVByb3h5QmFzZVxyXG5cdHtcclxuXHRcdGlmICghdGhpcy5fZGVwdGhNYXApXHJcblx0XHRcdHRoaXMuX2RlcHRoTWFwID0gdGhpcy5wQ3JlYXRlRGVwdGhUZXh0dXJlKCk7XHJcblxyXG5cdFx0cmV0dXJuIHRoaXMuX2RlcHRoTWFwO1xyXG5cdH1cclxuXHJcblx0cHVibGljIGdldCBkZXB0aE1hcFNpemUoKTpudW1iZXJcclxuXHR7XHJcblx0XHRyZXR1cm4gdGhpcy5fcERlcHRoTWFwU2l6ZTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBzZXQgZGVwdGhNYXBTaXplKHZhbHVlOm51bWJlcilcclxuXHR7XHJcblx0XHRpZiAodmFsdWUgPT0gdGhpcy5fcERlcHRoTWFwU2l6ZSlcclxuXHRcdFx0cmV0dXJuO1xyXG5cclxuXHRcdHRoaXMuX3BTZXREZXB0aE1hcFNpemUodmFsdWUpO1xyXG5cdH1cclxuXHJcblx0cHVibGljIGRpc3Bvc2UoKVxyXG5cdHtcclxuXHRcdHRoaXMuX3BDYXN0ZXJDb2xsZWN0b3IgPSBudWxsO1xyXG5cclxuXHRcdGlmICh0aGlzLl9kZXB0aE1hcCAmJiAhdGhpcy5fZXhwbGljaXREZXB0aE1hcClcclxuXHRcdFx0dGhpcy5fZGVwdGhNYXAuZGlzcG9zZSgpO1xyXG5cclxuXHRcdHRoaXMuX2RlcHRoTWFwID0gbnVsbDtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBwQ3JlYXRlRGVwdGhUZXh0dXJlKCk6VGV4dHVyZVByb3h5QmFzZVxyXG5cdHtcclxuXHRcdHJldHVybiBuZXcgUmVuZGVyVGV4dHVyZSh0aGlzLl9wRGVwdGhNYXBTaXplLCB0aGlzLl9wRGVwdGhNYXBTaXplKTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBpUmVuZGVyRGVwdGhNYXAoZW50aXR5Q29sbGVjdG9yOkVudGl0eUNvbGxlY3RvciwgcmVuZGVyZXI6SVJlbmRlcmVyKVxyXG5cdHtcclxuXHRcdHRoaXMuX2lTaGFkb3dzSW52YWxpZCA9IGZhbHNlO1xyXG5cclxuXHRcdHRoaXMucFVwZGF0ZURlcHRoUHJvamVjdGlvbihlbnRpdHlDb2xsZWN0b3IuY2FtZXJhKTtcclxuXHJcblx0XHRpZiAoIXRoaXMuX2RlcHRoTWFwKVxyXG5cdFx0XHR0aGlzLl9kZXB0aE1hcCA9IHRoaXMucENyZWF0ZURlcHRoVGV4dHVyZSgpO1xyXG5cclxuXHRcdHRoaXMucERyYXdEZXB0aE1hcCh0aGlzLl9kZXB0aE1hcCwgZW50aXR5Q29sbGVjdG9yLnNjZW5lLCByZW5kZXJlcik7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgcFVwZGF0ZURlcHRoUHJvamVjdGlvbih2aWV3Q2FtZXJhOkNhbWVyYSlcclxuXHR7XHJcblx0XHR0aHJvdyBuZXcgQWJzdHJhY3RNZXRob2RFcnJvcigpO1xyXG5cdH1cclxuXHJcblx0cHVibGljIHBEcmF3RGVwdGhNYXAodGFyZ2V0OlRleHR1cmVQcm94eUJhc2UsIHNjZW5lOlNjZW5lLCByZW5kZXJlcjpJUmVuZGVyZXIpXHJcblx0e1xyXG5cdFx0dGhyb3cgbmV3IEFic3RyYWN0TWV0aG9kRXJyb3IoKTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBfcFNldERlcHRoTWFwU2l6ZSh2YWx1ZSlcclxuXHR7XHJcblx0XHR0aGlzLl9wRGVwdGhNYXBTaXplID0gdmFsdWU7XHJcblxyXG5cdFx0aWYgKHRoaXMuX2V4cGxpY2l0RGVwdGhNYXApIHtcclxuXHRcdFx0dGhyb3cgRXJyb3IoXCJDYW5ub3Qgc2V0IGRlcHRoIG1hcCBzaXplIGZvciB0aGUgY3VycmVudCByZW5kZXJlci5cIik7XHJcblx0XHR9IGVsc2UgaWYgKHRoaXMuX2RlcHRoTWFwKSB7XHJcblx0XHRcdHRoaXMuX2RlcHRoTWFwLmRpc3Bvc2UoKTtcclxuXHRcdFx0dGhpcy5fZGVwdGhNYXAgPSBudWxsO1xyXG5cdFx0fVxyXG5cdH1cclxufVxyXG5cclxuZXhwb3J0ID0gU2hhZG93TWFwcGVyQmFzZTsiXX0=