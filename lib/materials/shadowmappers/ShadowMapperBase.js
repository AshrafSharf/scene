var AbstractMethodError = require("awayjs-core/lib/errors/AbstractMethodError");
var ShadowCasterCollector = require("awayjs-display/lib/traverse/ShadowCasterCollector");
var RenderTexture = require("awayjs-core/lib/textures/RenderTexture");
var ShadowMapperBase = (function () {
    function ShadowMapperBase() {
        this._pDepthMapSize = 2048;
        this._autoUpdateShadows = true;
        this._pCasterCollector = this.pCreateCasterCollector();
    }
    ShadowMapperBase.prototype.pCreateCasterCollector = function () {
        return new ShadowCasterCollector();
    };
    Object.defineProperty(ShadowMapperBase.prototype, "autoUpdateShadows", {
        get: function () {
            return this._autoUpdateShadows;
        },
        set: function (value) {
            this._autoUpdateShadows = value;
        },
        enumerable: true,
        configurable: true
    });
    ShadowMapperBase.prototype.updateShadows = function () {
        this._iShadowsInvalid = true;
    };
    ShadowMapperBase.prototype.iSetDepthMap = function (depthMap) {
        if (this._depthMap == depthMap)
            return;
        if (this._depthMap && !this._explicitDepthMap)
            this._depthMap.dispose();
        this._depthMap = depthMap;
        if (this._depthMap) {
            this._explicitDepthMap = true;
            this._pDepthMapSize = this._depthMap.size;
        }
        else {
            this._explicitDepthMap = false;
        }
    };
    Object.defineProperty(ShadowMapperBase.prototype, "light", {
        get: function () {
            return this._pLight;
        },
        set: function (value) {
            this._pLight = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ShadowMapperBase.prototype, "depthMap", {
        get: function () {
            if (!this._depthMap)
                this._depthMap = this.pCreateDepthTexture();
            return this._depthMap;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ShadowMapperBase.prototype, "depthMapSize", {
        get: function () {
            return this._pDepthMapSize;
        },
        set: function (value) {
            if (value == this._pDepthMapSize)
                return;
            this._pSetDepthMapSize(value);
        },
        enumerable: true,
        configurable: true
    });
    ShadowMapperBase.prototype.dispose = function () {
        this._pCasterCollector = null;
        if (this._depthMap && !this._explicitDepthMap)
            this._depthMap.dispose();
        this._depthMap = null;
    };
    ShadowMapperBase.prototype.pCreateDepthTexture = function () {
        return new RenderTexture(this._pDepthMapSize, this._pDepthMapSize);
    };
    ShadowMapperBase.prototype.iRenderDepthMap = function (entityCollector, renderer) {
        this._iShadowsInvalid = false;
        this.pUpdateDepthProjection(entityCollector.camera);
        if (!this._depthMap)
            this._depthMap = this.pCreateDepthTexture();
        this.pDrawDepthMap(this._depthMap, entityCollector.scene, renderer);
    };
    ShadowMapperBase.prototype.pUpdateDepthProjection = function (viewCamera) {
        throw new AbstractMethodError();
    };
    ShadowMapperBase.prototype.pDrawDepthMap = function (target, scene, renderer) {
        throw new AbstractMethodError();
    };
    ShadowMapperBase.prototype._pSetDepthMapSize = function (value) {
        this._pDepthMapSize = value;
        if (this._explicitDepthMap) {
            throw Error("Cannot set depth map size for the current renderer.");
        }
        else if (this._depthMap) {
            this._depthMap.dispose();
            this._depthMap = null;
        }
    };
    return ShadowMapperBase;
})();
module.exports = ShadowMapperBase;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1kaXNwbGF5L2xpYi9tYXRlcmlhbHMvc2hhZG93bWFwcGVycy9TaGFkb3dNYXBwZXJCYXNlLnRzIl0sIm5hbWVzIjpbIlNoYWRvd01hcHBlckJhc2UiLCJTaGFkb3dNYXBwZXJCYXNlLmNvbnN0cnVjdG9yIiwiU2hhZG93TWFwcGVyQmFzZS5wQ3JlYXRlQ2FzdGVyQ29sbGVjdG9yIiwiU2hhZG93TWFwcGVyQmFzZS5hdXRvVXBkYXRlU2hhZG93cyIsIlNoYWRvd01hcHBlckJhc2UudXBkYXRlU2hhZG93cyIsIlNoYWRvd01hcHBlckJhc2UuaVNldERlcHRoTWFwIiwiU2hhZG93TWFwcGVyQmFzZS5saWdodCIsIlNoYWRvd01hcHBlckJhc2UuZGVwdGhNYXAiLCJTaGFkb3dNYXBwZXJCYXNlLmRlcHRoTWFwU2l6ZSIsIlNoYWRvd01hcHBlckJhc2UuZGlzcG9zZSIsIlNoYWRvd01hcHBlckJhc2UucENyZWF0ZURlcHRoVGV4dHVyZSIsIlNoYWRvd01hcHBlckJhc2UuaVJlbmRlckRlcHRoTWFwIiwiU2hhZG93TWFwcGVyQmFzZS5wVXBkYXRlRGVwdGhQcm9qZWN0aW9uIiwiU2hhZG93TWFwcGVyQmFzZS5wRHJhd0RlcHRoTWFwIiwiU2hhZG93TWFwcGVyQmFzZS5fcFNldERlcHRoTWFwU2l6ZSJdLCJtYXBwaW5ncyI6IkFBQUEsSUFBTyxtQkFBbUIsV0FBYSw0Q0FBNEMsQ0FBQyxDQUFDO0FBTXJGLElBQU8scUJBQXFCLFdBQVksbURBQW1ELENBQUMsQ0FBQztBQUU3RixJQUFPLGFBQWEsV0FBYyx3Q0FBd0MsQ0FBQyxDQUFDO0FBRzVFLElBQU0sZ0JBQWdCO0lBWXJCQSxTQVpLQSxnQkFBZ0JBO1FBTWRDLG1CQUFjQSxHQUFVQSxJQUFJQSxDQUFDQTtRQUc1QkEsdUJBQWtCQSxHQUFXQSxJQUFJQSxDQUFDQTtRQUt6Q0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxHQUFHQSxJQUFJQSxDQUFDQSxzQkFBc0JBLEVBQUVBLENBQUNBO0lBQ3hEQSxDQUFD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LENBQUNBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLENBQUNBLENBQUNBO1lBQzNCQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxPQUFPQSxFQUFFQSxDQUFDQTtZQUN6QkEsSUFBSUEsQ0FBQ0EsU0FBU0EsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFDdkJBLENBQUNBO0lBQ0ZBLENBQUNBO0lBQ0ZkLHVCQUFDQTtBQUFEQSxDQXRJQSxBQXNJQ0EsSUFBQTtBQUVELEFBQTBCLGlCQUFqQixnQkFBZ0IsQ0FBQyIsImZpbGUiOiJtYXRlcmlhbHMvc2hhZG93bWFwcGVycy9TaGFkb3dNYXBwZXJCYXNlLmpzIiwic291cmNlUm9vdCI6Ii4uLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBBYnN0cmFjdE1ldGhvZEVycm9yXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2Vycm9ycy9BYnN0cmFjdE1ldGhvZEVycm9yXCIpO1xyXG5cclxuaW1wb3J0IFNjZW5lXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2NvbnRhaW5lcnMvU2NlbmVcIik7XHJcbmltcG9ydCBMaWdodEJhc2VcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2Jhc2UvTGlnaHRCYXNlXCIpO1xyXG5pbXBvcnQgSVJlbmRlcmVyXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9yZW5kZXIvSVJlbmRlcmVyXCIpO1xyXG5pbXBvcnQgRW50aXR5Q29sbGVjdG9yXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvdHJhdmVyc2UvRW50aXR5Q29sbGVjdG9yXCIpO1xyXG5pbXBvcnQgU2hhZG93Q2FzdGVyQ29sbGVjdG9yXHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi90cmF2ZXJzZS9TaGFkb3dDYXN0ZXJDb2xsZWN0b3JcIik7XHJcbmltcG9ydCBDYW1lcmFcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvZW50aXRpZXMvQ2FtZXJhXCIpO1xyXG5pbXBvcnQgUmVuZGVyVGV4dHVyZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL3RleHR1cmVzL1JlbmRlclRleHR1cmVcIik7XHJcbmltcG9ydCBUZXh0dXJlQmFzZVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvdGV4dHVyZXMvVGV4dHVyZUJhc2VcIik7XHJcblxyXG5jbGFzcyBTaGFkb3dNYXBwZXJCYXNlXHJcbntcclxuXHJcblx0cHVibGljIF9wQ2FzdGVyQ29sbGVjdG9yOlNoYWRvd0Nhc3RlckNvbGxlY3RvcjtcclxuXHJcblx0cHJpdmF0ZSBfZGVwdGhNYXA6VGV4dHVyZUJhc2U7XHJcblx0cHVibGljIF9wRGVwdGhNYXBTaXplOm51bWJlciA9IDIwNDg7XHJcblx0cHVibGljIF9wTGlnaHQ6TGlnaHRCYXNlO1xyXG5cdHByaXZhdGUgX2V4cGxpY2l0RGVwdGhNYXA6Ym9vbGVhbjtcclxuXHRwcml2YXRlIF9hdXRvVXBkYXRlU2hhZG93czpib29sZWFuID0gdHJ1ZTtcclxuXHRwdWJsaWMgX2lTaGFkb3dzSW52YWxpZDpib29sZWFuO1xyXG5cclxuXHRjb25zdHJ1Y3RvcigpXHJcblx0e1xyXG5cdFx0dGhpcy5fcENhc3RlckNvbGxlY3RvciA9IHRoaXMucENyZWF0ZUNhc3RlckNvbGxlY3RvcigpO1xyXG5cdH1cclxuXHJcblx0cHVibGljIHBDcmVhdGVDYXN0ZXJDb2xsZWN0b3IoKVxyXG5cdHtcclxuXHRcdHJldHVybiBuZXcgU2hhZG93Q2FzdGVyQ29sbGVjdG9yKCk7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgZ2V0IGF1dG9VcGRhdGVTaGFkb3dzKCk6Ym9vbGVhblxyXG5cdHtcclxuXHRcdHJldHVybiB0aGlzLl9hdXRvVXBkYXRlU2hhZG93cztcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBzZXQgYXV0b1VwZGF0ZVNoYWRvd3ModmFsdWU6Ym9vbGVhbilcclxuXHR7XHJcblx0XHR0aGlzLl9hdXRvVXBkYXRlU2hhZG93cyA9IHZhbHVlO1xyXG5cdH1cclxuXHJcblx0cHVibGljIHVwZGF0ZVNoYWRvd3MoKVxyXG5cdHtcclxuXHRcdHRoaXMuX2lTaGFkb3dzSW52YWxpZCA9IHRydWU7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgaVNldERlcHRoTWFwKGRlcHRoTWFwOlRleHR1cmVCYXNlKVxyXG5cdHtcclxuXHRcdGlmICh0aGlzLl9kZXB0aE1hcCA9PSBkZXB0aE1hcClcclxuXHRcdFx0cmV0dXJuO1xyXG5cclxuXHRcdGlmICh0aGlzLl9kZXB0aE1hcCAmJiAhdGhpcy5fZXhwbGljaXREZXB0aE1hcClcclxuXHRcdFx0dGhpcy5fZGVwdGhNYXAuZGlzcG9zZSgpO1xyXG5cclxuXHRcdHRoaXMuX2RlcHRoTWFwID0gZGVwdGhNYXA7XHJcblxyXG5cdFx0aWYgKHRoaXMuX2RlcHRoTWFwKSB7XHJcblx0XHRcdHRoaXMuX2V4cGxpY2l0RGVwdGhNYXAgPSB0cnVlO1xyXG5cdFx0XHR0aGlzLl9wRGVwdGhNYXBTaXplID0gdGhpcy5fZGVwdGhNYXAuc2l6ZTtcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdHRoaXMuX2V4cGxpY2l0RGVwdGhNYXAgPSBmYWxzZTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdHB1YmxpYyBnZXQgbGlnaHQoKTpMaWdodEJhc2VcclxuXHR7XHJcblx0XHRyZXR1cm4gdGhpcy5fcExpZ2h0O1xyXG5cdH1cclxuXHJcblx0cHVibGljIHNldCBsaWdodCh2YWx1ZTpMaWdodEJhc2UpXHJcblx0e1xyXG5cdFx0dGhpcy5fcExpZ2h0ID0gdmFsdWU7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgZ2V0IGRlcHRoTWFwKCk6VGV4dHVyZUJhc2VcclxuXHR7XHJcblx0XHRpZiAoIXRoaXMuX2RlcHRoTWFwKVxyXG5cdFx0XHR0aGlzLl9kZXB0aE1hcCA9IHRoaXMucENyZWF0ZURlcHRoVGV4dHVyZSgpO1xyXG5cclxuXHRcdHJldHVybiB0aGlzLl9kZXB0aE1hcDtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBnZXQgZGVwdGhNYXBTaXplKCk6bnVtYmVyXHJcblx0e1xyXG5cdFx0cmV0dXJuIHRoaXMuX3BEZXB0aE1hcFNpemU7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgc2V0IGRlcHRoTWFwU2l6ZSh2YWx1ZTpudW1iZXIpXHJcblx0e1xyXG5cdFx0aWYgKHZhbHVlID09IHRoaXMuX3BEZXB0aE1hcFNpemUpXHJcblx0XHRcdHJldHVybjtcclxuXHJcblx0XHR0aGlzLl9wU2V0RGVwdGhNYXBTaXplKHZhbHVlKTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBkaXNwb3NlKClcclxuXHR7XHJcblx0XHR0aGlzLl9wQ2FzdGVyQ29sbGVjdG9yID0gbnVsbDtcclxuXHJcblx0XHRpZiAodGhpcy5fZGVwdGhNYXAgJiYgIXRoaXMuX2V4cGxpY2l0RGVwdGhNYXApXHJcblx0XHRcdHRoaXMuX2RlcHRoTWFwLmRpc3Bvc2UoKTtcclxuXHJcblx0XHR0aGlzLl9kZXB0aE1hcCA9IG51bGw7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgcENyZWF0ZURlcHRoVGV4dHVyZSgpOlRleHR1cmVCYXNlXHJcblx0e1xyXG5cdFx0cmV0dXJuIG5ldyBSZW5kZXJUZXh0dXJlKHRoaXMuX3BEZXB0aE1hcFNpemUsIHRoaXMuX3BEZXB0aE1hcFNpemUpO1xyXG5cdH1cclxuXHJcblx0cHVibGljIGlSZW5kZXJEZXB0aE1hcChlbnRpdHlDb2xsZWN0b3I6RW50aXR5Q29sbGVjdG9yLCByZW5kZXJlcjpJUmVuZGVyZXIpXHJcblx0e1xyXG5cdFx0dGhpcy5faVNoYWRvd3NJbnZhbGlkID0gZmFsc2U7XHJcblxyXG5cdFx0dGhpcy5wVXBkYXRlRGVwdGhQcm9qZWN0aW9uKGVudGl0eUNvbGxlY3Rvci5jYW1lcmEpO1xyXG5cclxuXHRcdGlmICghdGhpcy5fZGVwdGhNYXApXHJcblx0XHRcdHRoaXMuX2RlcHRoTWFwID0gdGhpcy5wQ3JlYXRlRGVwdGhUZXh0dXJlKCk7XHJcblxyXG5cdFx0dGhpcy5wRHJhd0RlcHRoTWFwKHRoaXMuX2RlcHRoTWFwLCBlbnRpdHlDb2xsZWN0b3Iuc2NlbmUsIHJlbmRlcmVyKTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBwVXBkYXRlRGVwdGhQcm9qZWN0aW9uKHZpZXdDYW1lcmE6Q2FtZXJhKVxyXG5cdHtcclxuXHRcdHRocm93IG5ldyBBYnN0cmFjdE1ldGhvZEVycm9yKCk7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgcERyYXdEZXB0aE1hcCh0YXJnZXQ6VGV4dHVyZUJhc2UsIHNjZW5lOlNjZW5lLCByZW5kZXJlcjpJUmVuZGVyZXIpXHJcblx0e1xyXG5cdFx0dGhyb3cgbmV3IEFic3RyYWN0TWV0aG9kRXJyb3IoKTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBfcFNldERlcHRoTWFwU2l6ZSh2YWx1ZSlcclxuXHR7XHJcblx0XHR0aGlzLl9wRGVwdGhNYXBTaXplID0gdmFsdWU7XHJcblxyXG5cdFx0aWYgKHRoaXMuX2V4cGxpY2l0RGVwdGhNYXApIHtcclxuXHRcdFx0dGhyb3cgRXJyb3IoXCJDYW5ub3Qgc2V0IGRlcHRoIG1hcCBzaXplIGZvciB0aGUgY3VycmVudCByZW5kZXJlci5cIik7XHJcblx0XHR9IGVsc2UgaWYgKHRoaXMuX2RlcHRoTWFwKSB7XHJcblx0XHRcdHRoaXMuX2RlcHRoTWFwLmRpc3Bvc2UoKTtcclxuXHRcdFx0dGhpcy5fZGVwdGhNYXAgPSBudWxsO1xyXG5cdFx0fVxyXG5cdH1cclxufVxyXG5cclxuZXhwb3J0ID0gU2hhZG93TWFwcGVyQmFzZTsiXX0=