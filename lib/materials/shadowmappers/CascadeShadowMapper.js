var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Matrix3DUtils = require("awayjs-core/lib/geom/Matrix3DUtils");
var Rectangle = require("awayjs-core/lib/geom/Rectangle");
var Event = require("awayjs-core/lib/events/Event");
var EventDispatcher = require("awayjs-core/lib/events/EventDispatcher");
var FreeMatrixProjection = require("awayjs-core/lib/projections/FreeMatrixProjection");
var Camera = require("awayjs-display/lib/entities/Camera");
var DirectionalShadowMapper = require("awayjs-display/lib/materials/shadowmappers/DirectionalShadowMapper");
var CascadeShadowMapper = (function (_super) {
    __extends(CascadeShadowMapper, _super);
    function CascadeShadowMapper(numCascades) {
        if (numCascades === void 0) { numCascades = 3; }
        _super.call(this);
        this._pScissorRectsInvalid = true;
        if (numCascades < 1 || numCascades > 4)
            throw new Error("numCascades must be an integer between 1 and 4");
        this._numCascades = numCascades;
        this._changeDispatcher = new EventDispatcher(this);
        this.init();
    }
    CascadeShadowMapper.prototype.getSplitRatio = function (index /*uint*/) {
        return this._splitRatios[index];
    };
    CascadeShadowMapper.prototype.setSplitRatio = function (index /*uint*/, value) {
        if (value < 0)
            value = 0;
        else if (value > 1)
            value = 1;
        if (index >= this._numCascades)
            throw new Error("index must be smaller than the number of cascades!");
        this._splitRatios[index] = value;
    };
    CascadeShadowMapper.prototype.getDepthProjections = function (partition /*uint*/) {
        return this._depthCameras[partition].viewProjection;
    };
    CascadeShadowMapper.prototype.init = function () {
        this._splitRatios = new Array(this._numCascades);
        this._nearPlaneDistances = new Array(this._numCascades);
        var s = 1;
        for (var i = this._numCascades - 1; i >= 0; --i) {
            this._splitRatios[i] = s;
            s *= .4;
        }
        this._texOffsetsX = Array(-1, 1, -1, 1);
        this._texOffsetsY = Array(1, 1, -1, -1);
        this._pScissorRects = new Array(4);
        this._depthLenses = new Array();
        this._depthCameras = new Array();
        for (i = 0; i < this._numCascades; ++i) {
            this._depthLenses[i] = new FreeMatrixProjection();
            this._depthCameras[i] = new Camera(this._depthLenses[i]);
        }
    };
    CascadeShadowMapper.prototype._pSetDepthMapSize = function (value /*uint*/) {
        _super.prototype._pSetDepthMapSize.call(this, value);
        this.invalidateScissorRects();
    };
    CascadeShadowMapper.prototype.invalidateScissorRects = function () {
        this._pScissorRectsInvalid = true;
    };
    Object.defineProperty(CascadeShadowMapper.prototype, "numCascades", {
        get: function () {
            return this._numCascades;
        },
        set: function (value /*int*/) {
            if (value == this._numCascades)
                return;
            if (value < 1 || value > 4)
                throw new Error("numCascades must be an integer between 1 and 4");
            this._numCascades = value;
            this.invalidateScissorRects();
            this.init();
            this.dispatchEvent(new Event(Event.CHANGE));
        },
        enumerable: true,
        configurable: true
    });
    CascadeShadowMapper.prototype.pDrawDepthMap = function (target, scene, renderer) {
        if (this._pScissorRectsInvalid)
            this.updateScissorRects();
        this._pCasterCollector.cullPlanes = this._pCullPlanes;
        this._pCasterCollector.camera = this._pOverallDepthCamera;
        this._pCasterCollector.clear();
        scene.traversePartitions(this._pCasterCollector);
        renderer._iRenderCascades(this._pCasterCollector, target, this._numCascades, this._pScissorRects, this._depthCameras);
    };
    CascadeShadowMapper.prototype.updateScissorRects = function () {
        var half = this._pDepthMapSize * .5;
        this._pScissorRects[0] = new Rectangle(0, 0, half, half);
        this._pScissorRects[1] = new Rectangle(half, 0, half, half);
        this._pScissorRects[2] = new Rectangle(0, half, half, half);
        this._pScissorRects[3] = new Rectangle(half, half, half, half);
        this._pScissorRectsInvalid = false;
    };
    CascadeShadowMapper.prototype.pUpdateDepthProjection = function (viewCamera) {
        var matrix;
        var projection = viewCamera.projection;
        var projectionNear = projection.near;
        var projectionRange = projection.far - projectionNear;
        this.pUpdateProjectionFromFrustumCorners(viewCamera, viewCamera.projection.frustumCorners, this._pMatrix);
        this._pMatrix.appendScale(.96, .96, 1);
        this._pOverallDepthProjection.matrix = this._pMatrix;
        this.pUpdateCullPlanes(viewCamera);
        for (var i = 0; i < this._numCascades; ++i) {
            matrix = this._depthLenses[i].matrix;
            this._nearPlaneDistances[i] = projectionNear + this._splitRatios[i] * projectionRange;
            this._depthCameras[i].transform = this._pOverallDepthCamera.transform;
            this.updateProjectionPartition(matrix, this._splitRatios[i], this._texOffsetsX[i], this._texOffsetsY[i]);
            this._depthLenses[i].matrix = matrix;
        }
    };
    CascadeShadowMapper.prototype.updateProjectionPartition = function (matrix, splitRatio, texOffsetX, texOffsetY) {
        var raw = Matrix3DUtils.RAW_DATA_CONTAINER;
        var xN, yN, zN;
        var xF, yF, zF;
        var minX = Number.POSITIVE_INFINITY, minY = Number.POSITIVE_INFINITY, minZ;
        var maxX = Number.NEGATIVE_INFINITY, maxY = Number.NEGATIVE_INFINITY, maxZ = Number.NEGATIVE_INFINITY;
        var i = 0;
        while (i < 12) {
            xN = this._pLocalFrustum[i];
            yN = this._pLocalFrustum[i + 1];
            zN = this._pLocalFrustum[i + 2];
            xF = xN + (this._pLocalFrustum[i + 12] - xN) * splitRatio;
            yF = yN + (this._pLocalFrustum[i + 13] - yN) * splitRatio;
            zF = zN + (this._pLocalFrustum[i + 14] - zN) * splitRatio;
            if (xN < minX)
                minX = xN;
            if (xN > maxX)
                maxX = xN;
            if (yN < minY)
                minY = yN;
            if (yN > maxY)
                maxY = yN;
            if (zN > maxZ)
                maxZ = zN;
            if (xF < minX)
                minX = xF;
            if (xF > maxX)
                maxX = xF;
            if (yF < minY)
                minY = yF;
            if (yF > maxY)
                maxY = yF;
            if (zF > maxZ)
                maxZ = zF;
            i += 3;
        }
        minZ = 1;
        var w = (maxX - minX);
        var h = (maxY - minY);
        var d = 1 / (maxZ - minZ);
        if (minX < 0)
            minX -= this._pSnap; // because int() rounds up for < 0
        if (minY < 0)
            minY -= this._pSnap;
        minX = Math.floor(minX / this._pSnap) * this._pSnap;
        minY = Math.floor(minY / this._pSnap) * this._pSnap;
        var snap2 = 2 * this._pSnap;
        w = Math.floor(w / snap2 + 1) * snap2;
        h = Math.floor(h / snap2 + 1) * snap2;
        maxX = minX + w;
        maxY = minY + h;
        w = 1 / w;
        h = 1 / h;
        raw[0] = 2 * w;
        raw[5] = 2 * h;
        raw[10] = d;
        raw[12] = -(maxX + minX) * w;
        raw[13] = -(maxY + minY) * h;
        raw[14] = -minZ * d;
        raw[15] = 1;
        raw[1] = raw[2] = raw[3] = raw[4] = raw[6] = raw[7] = raw[8] = raw[9] = raw[11] = 0;
        matrix.copyRawDataFrom(raw);
        matrix.appendScale(.96, .96, 1);
        matrix.appendTranslation(texOffsetX, texOffsetY, 0);
        matrix.appendScale(.5, .5, 1);
    };
    CascadeShadowMapper.prototype.addEventListener = function (type, listener) {
        this._changeDispatcher.addEventListener(type, listener);
    };
    CascadeShadowMapper.prototype.removeEventListener = function (type, listener) {
        this._changeDispatcher.removeEventListener(type, listener);
    };
    CascadeShadowMapper.prototype.dispatchEvent = function (event) {
        return this._changeDispatcher.dispatchEvent(event);
    };
    CascadeShadowMapper.prototype.hasEventListener = function (type) {
        return this._changeDispatcher.hasEventListener(type);
    };
    Object.defineProperty(CascadeShadowMapper.prototype, "_iNearPlaneDistances", {
        get: function () {
            return this._nearPlaneDistances;
        },
        enumerable: true,
        configurable: true
    });
    return CascadeShadowMapper;
})(DirectionalShadowMapper);
module.exports = CascadeShadowMapper;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1kaXNwbGF5L2xpYi9tYXRlcmlhbHMvc2hhZG93bWFwcGVycy9jYXNjYWRlc2hhZG93bWFwcGVyLnRzIl0sIm5hbWVzIjpbIkNhc2NhZGVTaGFkb3dNYXBwZXIiLCJDYXNjYWRlU2hhZG93TWFwcGVyLmNvbnN0cnVjdG9yIiwiQ2FzY2FkZVNoYWRvd01hcHBlci5nZXRTcGxpdFJhdGlvIiwiQ2FzY2FkZVNoYWRvd01hcHBlci5zZXRTcGxpdFJhdGlvIiwiQ2FzY2FkZVNoYWRvd01hcHBlci5nZXREZXB0aFByb2plY3Rpb25zIiwiQ2FzY2FkZVNoYWRvd01hcHBlci5pbml0IiwiQ2FzY2FkZVNoYWRvd01hcHBlci5fcFNldERlcHRoTWFwU2l6ZSIsIkNhc2NhZGVTaGFkb3dNYXBwZXIuaW52YWxpZGF0ZVNjaXNzb3JSZWN0cyIsIkNhc2NhZGVTaGFkb3dNYXBwZXIubnVtQ2FzY2FkZXMiLCJDYXNjYWRlU2hhZG93TWFwcGVyLnBEcmF3RGVwdGhNYXAiLCJDYXNjYWRlU2hhZG93TWFwcGVyLnVwZGF0ZVNjaXNzb3JSZWN0cyIsIkNhc2NhZGVTaGFkb3dNYXBwZXIucFVwZGF0ZURlcHRoUHJvamVjdGlvbiIsIkNhc2NhZGVTaGFkb3dNYXBwZXIudXBkYXRlUHJvamVjdGlvblBhcnRpdGlvbiIsIkNhc2NhZGVTaGFkb3dNYXBwZXIuYWRkRXZlbnRMaXN0ZW5lciIsIkNhc2NhZGVTaGFkb3dNYXBwZXIucmVtb3ZlRXZlbnRMaXN0ZW5lciIsIkNhc2NhZGVTaGFkb3dNYXBwZXIuZGlzcGF0Y2hFdmVudCIsIkNhc2NhZGVTaGFkb3dNYXBwZXIuaGFzRXZlbnRMaXN0ZW5lciIsIkNhc2NhZGVTaGFkb3dNYXBwZXIuX2lOZWFyUGxhbmVEaXN0YW5jZXMiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUNBLElBQU8sYUFBYSxXQUFjLG9DQUFvQyxDQUFDLENBQUM7QUFDeEUsSUFBTyxTQUFTLFdBQWUsZ0NBQWdDLENBQUMsQ0FBQztBQUNqRSxJQUFPLEtBQUssV0FB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Y0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDaENBLEVBQUVBLEdBQUdBLElBQUlBLENBQUNBLGNBQWNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO1lBQ2hDQSxFQUFFQSxHQUFHQSxFQUFFQSxHQUFHQSxDQUFDQSxJQUFJQSxDQUFDQSxjQUFjQSxDQUFDQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQSxHQUFDQSxVQUFVQSxDQUFDQTtZQUN4REEsRUFBRUEsR0FBR0EsRUFBRUEsR0FBR0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0EsR0FBQ0EsVUFBVUEsQ0FBQ0E7WUFDeERBLEVBQUVBLEdBQUdBLEVBQUVBLEdBQUdBLENBQUNBLElBQUlBLENBQUNBLGNBQWNBLENBQUNBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBLEdBQUNBLFVBQVVBLENBQUNBO1lBQ3hEQSxFQUFFQSxDQUFDQSxDQUFDQSxFQUFFQSxHQUFHQSxJQUFJQSxDQUFDQTtnQkFDYkEsSUFBSUEsR0FBR0EsRUFBRUEsQ0FBQ0E7WUFDWEEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsR0FBR0EsSUFBSUEsQ0FBQ0E7Z0JBQ2JBLElBQUlBLEdBQUdBLEVBQUVBLENBQUNBO1lBQ1hBLEVBQUVBLENBQUNBLENBQUNBLEVBQUVBLEdBQUdBLElBQUlBLENBQUNBO2dCQUNiQSxJQUFJQSxHQUFHQSxFQUFFQSxDQUFDQTtZQUNYQSxFQUFFQSxDQUFDQSxDQUFDQSxFQUFFQSxHQUFHQSxJQUFJQSxDQUFDQTtnQkFDYkEsSUFBSUEsR0FBR0EsRUFBRUEsQ0FBQ0E7WUFDWEEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsR0FBR0EsSUFBSUEsQ0FBQ0E7Z0JBQ2JBLElBQUlBLEdBQUdBLEVBQUVBLENBQUNBO1lBQ1hBLEVBQUVBLENBQUNBLENBQUNBLEVBQUVBLEdBQUdBLElBQUlBLENBQUNBO2dCQUNiQSxJQUFJQSxHQUFHQSxFQUFFQSxDQUFDQTtZQUNYQSxFQUFFQSxDQUFDQSxDQUFDQSxFQUFFQSxHQUFHQSxJQUFJQSxDQUFDQTtnQkFDYkEsSUFBSUEsR0FBR0EsRUFBRUEsQ0FBQ0E7WUFDWEEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsR0FBR0EsSUFBSUEsQ0FBQ0E7Z0JBQ2JBLElBQUlBLEdBQUdBLEVBQUVBLENBQUNBO1lBQ1hBLEVBQUVBLENBQUNBLENBQUNBLEVBQUVBLEdBQUdBLElBQUlBLENBQUNBO2dCQUNiQSxJQUFJQSxHQUFHQSxFQUFFQSxDQUFDQTtZQUNYQSxFQUFFQSxDQUFDQSxDQUFDQSxFQUFFQSxHQUFHQSxJQUFJQSxDQUFDQTtnQkFDYkEsSUFBSUEsR0FBR0EsRUFBRUEsQ0FBQ0E7WUFDWEEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDUkEsQ0FBQ0E7UUFFREEsSUFBSUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFFVEEsSUFBSUEsQ0FBQ0EsR0FBVUEsQ0FBQ0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDN0JBLElBQUlBLENBQUNBLEdBQVVBLENBQUNBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBLENBQUNBO1FBQzdCQSxJQUFJQSxDQUFDQSxHQUFVQSxDQUFDQSxHQUFDQSxDQUFDQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUUvQkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7WUFDWkEsSUFBSUEsSUFBSUEsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0Esa0NBQWtDQTtRQUN4REEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7WUFDWkEsSUFBSUEsSUFBSUEsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7UUFDckJBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLElBQUlBLEdBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLEdBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBO1FBQ2hEQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxHQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxHQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQTtRQUVoREEsSUFBSUEsS0FBS0EsR0FBVUEsQ0FBQ0EsR0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7UUFDakNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBLEdBQUNBLEtBQUtBLEdBQUdBLENBQUNBLENBQUNBLEdBQUNBLEtBQUtBLENBQUNBO1FBQ2xDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQSxHQUFDQSxLQUFLQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFDQSxLQUFLQSxDQUFDQTtRQUVsQ0EsSUFBSUEsR0FBR0EsSUFBSUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDaEJBLElBQUlBLEdBQUdBLElBQUlBLEdBQUdBLENBQUNBLENBQUNBO1FBRWhCQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFDQSxDQUFDQSxDQUFDQTtRQUNSQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFDQSxDQUFDQSxDQUFDQTtRQUVSQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFDQSxDQUFDQSxDQUFDQTtRQUNiQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFDQSxDQUFDQSxDQUFDQTtRQUNiQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUNaQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxHQUFDQSxDQUFDQSxDQUFDQTtRQUMzQkEsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDM0JBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLENBQUNBLElBQUlBLEdBQUNBLENBQUNBLENBQUNBO1FBQ2xCQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUNaQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUVwRkEsTUFBTUEsQ0FBQ0EsZUFBZUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDNUJBLE1BQU1BLENBQUNBLFdBQVdBLENBQUNBLEdBQUdBLEVBQUVBLEdBQUdBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1FBQ2hDQSxNQUFNQSxDQUFDQSxpQkFBaUJBLENBQUNBLFVBQVVBLEVBQUVBLFVBQVVBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1FBQ3BEQSxNQUFNQSxDQUFDQSxXQUFXQSxDQUFDQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtJQUMvQkEsQ0FBQ0E7SUFFTVosOENBQWdCQSxHQUF2QkEsVUFBd0JBLElBQVdBLEVBQUVBLFFBQWlCQTtRQUVyRGEsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxnQkFBZ0JBLENBQUNBLElBQUlBLEVBQUVBLFFBQVFBLENBQUNBLENBQUNBO0lBQ3pEQSxDQUFDQTtJQUVNYixpREFBbUJBLEdBQTFCQSxVQUEyQkEsSUFBV0EsRUFBRUEsUUFBaUJBO1FBRXhEYyxJQUFJQSxDQUFDQSxpQkFBaUJBLENBQUNBLG1CQUFtQkEsQ0FBQ0EsSUFBSUEsRUFBRUEsUUFBUUEsQ0FBQ0EsQ0FBQ0E7SUFDNURBLENBQUNBO0lBRU1kLDJDQUFhQSxHQUFwQkEsVUFBcUJBLEtBQVdBO1FBRS9CZSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxpQkFBaUJBLENBQUNBLGFBQWFBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBO0lBQ3BEQSxDQUFDQTtJQUVNZiw4Q0FBZ0JBLEdBQXZCQSxVQUF3QkEsSUFBV0E7UUFFbENnQixNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxpQkFBaUJBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7SUFDdERBLENBQUNBO0lBRURoQixzQkFBSUEscURBQW9CQTthQUF4QkE7WUFFQ2lCLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLG1CQUFtQkEsQ0FBQ0E7UUFDakNBLENBQUNBOzs7T0FBQWpCO0lBQ0ZBLDBCQUFDQTtBQUFEQSxDQS9QQSxBQStQQ0EsRUEvUGlDLHVCQUF1QixFQStQeEQ7QUFFRCxBQUE2QixpQkFBcEIsbUJBQW1CLENBQUMiLCJmaWxlIjoibWF0ZXJpYWxzL3NoYWRvd21hcHBlcnMvQ2FzY2FkZVNoYWRvd01hcHBlci5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgTWF0cml4M0RcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9NYXRyaXgzRFwiKTtcbmltcG9ydCBNYXRyaXgzRFV0aWxzXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9NYXRyaXgzRFV0aWxzXCIpO1xuaW1wb3J0IFJlY3RhbmdsZVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9SZWN0YW5nbGVcIik7XG5pbXBvcnQgRXZlbnRcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZXZlbnRzL0V2ZW50XCIpO1xuaW1wb3J0IEV2ZW50RGlzcGF0Y2hlclx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2V2ZW50cy9FdmVudERpc3BhdGNoZXJcIik7XG5pbXBvcnQgSUV2ZW50RGlzcGF0Y2hlclx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2V2ZW50cy9JRXZlbnREaXNwYXRjaGVyXCIpO1xuaW1wb3J0IEZyZWVNYXRyaXhQcm9qZWN0aW9uXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL3Byb2plY3Rpb25zL0ZyZWVNYXRyaXhQcm9qZWN0aW9uXCIpO1xuaW1wb3J0IElQcm9qZWN0aW9uXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9wcm9qZWN0aW9ucy9JUHJvamVjdGlvblwiKTtcblxuaW1wb3J0IFNjZW5lXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2NvbnRhaW5lcnMvU2NlbmVcIik7XG5pbXBvcnQgSVJlbmRlcmVyXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9yZW5kZXIvSVJlbmRlcmVyXCIpO1xuaW1wb3J0IENhbWVyYVx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9DYW1lcmFcIik7XG5pbXBvcnQgRGlyZWN0aW9uYWxTaGFkb3dNYXBwZXJcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL21hdGVyaWFscy9zaGFkb3dtYXBwZXJzL0RpcmVjdGlvbmFsU2hhZG93TWFwcGVyXCIpO1xuaW1wb3J0IFJlbmRlclRleHR1cmVcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi90ZXh0dXJlcy9SZW5kZXJUZXh0dXJlXCIpO1xuaW1wb3J0IFRleHR1cmVQcm94eUJhc2VcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi90ZXh0dXJlcy9UZXh0dXJlUHJveHlCYXNlXCIpO1xuXG5jbGFzcyBDYXNjYWRlU2hhZG93TWFwcGVyIGV4dGVuZHMgRGlyZWN0aW9uYWxTaGFkb3dNYXBwZXIgaW1wbGVtZW50cyBJRXZlbnREaXNwYXRjaGVyXG57XG5cdHB1YmxpYyBfcFNjaXNzb3JSZWN0czpSZWN0YW5nbGVbXTtcblx0cHJpdmF0ZSBfcFNjaXNzb3JSZWN0c0ludmFsaWQ6Ym9vbGVhbiA9IHRydWU7XG5cdHByaXZhdGUgX3NwbGl0UmF0aW9zOm51bWJlcltdO1xuXG5cdHByaXZhdGUgX251bUNhc2NhZGVzOm51bWJlciAvKmludCovO1xuXHRwcml2YXRlIF9kZXB0aENhbWVyYXM6QXJyYXk8Q2FtZXJhPjtcblx0cHJpdmF0ZSBfZGVwdGhMZW5zZXM6QXJyYXk8RnJlZU1hdHJpeFByb2plY3Rpb24+O1xuXG5cdHByaXZhdGUgX3RleE9mZnNldHNYOkFycmF5PG51bWJlcj47XG5cdHByaXZhdGUgX3RleE9mZnNldHNZOkFycmF5PG51bWJlcj47XG5cblx0cHJpdmF0ZSBfY2hhbmdlRGlzcGF0Y2hlcjpFdmVudERpc3BhdGNoZXI7XG5cdHByaXZhdGUgX25lYXJQbGFuZURpc3RhbmNlczpudW1iZXJbXTtcblxuXHRjb25zdHJ1Y3RvcihudW1DYXNjYWRlczpudW1iZXIgLyp1aW50Ki8gPSAzKVxuXHR7XG5cdFx0c3VwZXIoKTtcblxuXHRcdGlmIChudW1DYXNjYWRlcyA8IDEgfHwgbnVtQ2FzY2FkZXMgPiA0KVxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKFwibnVtQ2FzY2FkZXMgbXVzdCBiZSBhbiBpbnRlZ2VyIGJldHdlZW4gMSBhbmQgNFwiKTtcblxuXHRcdHRoaXMuX251bUNhc2NhZGVzID0gbnVtQ2FzY2FkZXM7XG5cdFx0dGhpcy5fY2hhbmdlRGlzcGF0Y2hlciA9IG5ldyBFdmVudERpc3BhdGNoZXIodGhpcyk7XG5cdFx0dGhpcy5pbml0KCk7XG5cdH1cblxuXHRwdWJsaWMgZ2V0U3BsaXRSYXRpbyhpbmRleDpudW1iZXIgLyp1aW50Ki8pOm51bWJlclxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuX3NwbGl0UmF0aW9zW2luZGV4XTtcblx0fVxuXG5cdHB1YmxpYyBzZXRTcGxpdFJhdGlvKGluZGV4Om51bWJlciAvKnVpbnQqLywgdmFsdWU6bnVtYmVyKVxuXHR7XG5cdFx0aWYgKHZhbHVlIDwgMClcblx0XHRcdHZhbHVlID0gMDtcblx0XHRlbHNlIGlmICh2YWx1ZSA+IDEpXG5cdFx0XHR2YWx1ZSA9IDE7XG5cblx0XHRpZiAoaW5kZXggPj0gdGhpcy5fbnVtQ2FzY2FkZXMpXG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJpbmRleCBtdXN0IGJlIHNtYWxsZXIgdGhhbiB0aGUgbnVtYmVyIG9mIGNhc2NhZGVzIVwiKTtcblxuXHRcdHRoaXMuX3NwbGl0UmF0aW9zW2luZGV4XSA9IHZhbHVlO1xuXHR9XG5cblx0cHVibGljIGdldERlcHRoUHJvamVjdGlvbnMocGFydGl0aW9uOm51bWJlciAvKnVpbnQqLyk6TWF0cml4M0Rcblx0e1xuXHRcdHJldHVybiB0aGlzLl9kZXB0aENhbWVyYXNbcGFydGl0aW9uXS52aWV3UHJvamVjdGlvbjtcblx0fVxuXG5cdHByaXZhdGUgaW5pdCgpXG5cdHtcblx0XHR0aGlzLl9zcGxpdFJhdGlvcyA9IG5ldyBBcnJheTxudW1iZXI+KHRoaXMuX251bUNhc2NhZGVzKTtcblx0XHR0aGlzLl9uZWFyUGxhbmVEaXN0YW5jZXMgPSBuZXcgQXJyYXk8bnVtYmVyPih0aGlzLl9udW1DYXNjYWRlcyk7XG5cblx0XHR2YXIgczpudW1iZXIgPSAxO1xuXHRcdGZvciAodmFyIGk6bnVtYmVyIC8qaW50Ki8gPSB0aGlzLl9udW1DYXNjYWRlcyAtIDE7IGkgPj0gMDsgLS1pKSB7XG5cdFx0XHR0aGlzLl9zcGxpdFJhdGlvc1tpXSA9IHM7XG5cdFx0XHRzICo9IC40O1xuXHRcdH1cblxuXHRcdHRoaXMuX3RleE9mZnNldHNYID0gQXJyYXk8bnVtYmVyPigtMSwgMSwgLTEsIDEpO1xuXHRcdHRoaXMuX3RleE9mZnNldHNZID0gQXJyYXk8bnVtYmVyPigxLCAxLCAtMSwgLTEpO1xuXHRcdHRoaXMuX3BTY2lzc29yUmVjdHMgPSBuZXcgQXJyYXk8UmVjdGFuZ2xlPig0KTtcblx0XHR0aGlzLl9kZXB0aExlbnNlcyA9IG5ldyBBcnJheTxGcmVlTWF0cml4UHJvamVjdGlvbj4oKTtcblx0XHR0aGlzLl9kZXB0aENhbWVyYXMgPSBuZXcgQXJyYXk8Q2FtZXJhPigpO1xuXG5cdFx0Zm9yIChpID0gMDsgaSA8IHRoaXMuX251bUNhc2NhZGVzOyArK2kpIHtcblx0XHRcdHRoaXMuX2RlcHRoTGVuc2VzW2ldID0gbmV3IEZyZWVNYXRyaXhQcm9qZWN0aW9uKCk7XG5cdFx0XHR0aGlzLl9kZXB0aENhbWVyYXNbaV0gPSBuZXcgQ2FtZXJhKHRoaXMuX2RlcHRoTGVuc2VzW2ldKTtcblx0XHR9XG5cdH1cblxuXHRwdWJsaWMgX3BTZXREZXB0aE1hcFNpemUodmFsdWU6bnVtYmVyIC8qdWludCovKVxuXHR7XG5cdFx0c3VwZXIuX3BTZXREZXB0aE1hcFNpemUodmFsdWUpO1xuXG5cdFx0dGhpcy5pbnZhbGlkYXRlU2Npc3NvclJlY3RzKCk7XG5cdH1cblxuXHRwcml2YXRlIGludmFsaWRhdGVTY2lzc29yUmVjdHMoKVxuXHR7XG5cdFx0dGhpcy5fcFNjaXNzb3JSZWN0c0ludmFsaWQgPSB0cnVlO1xuXHR9XG5cblx0cHVibGljIGdldCBudW1DYXNjYWRlcygpOm51bWJlciAvKmludCovXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5fbnVtQ2FzY2FkZXM7XG5cdH1cblxuXHRwdWJsaWMgc2V0IG51bUNhc2NhZGVzKHZhbHVlOm51bWJlciAvKmludCovKVxuXHR7XG5cdFx0aWYgKHZhbHVlID09IHRoaXMuX251bUNhc2NhZGVzKVxuXHRcdFx0cmV0dXJuO1xuXG5cdFx0aWYgKHZhbHVlIDwgMSB8fCB2YWx1ZSA+IDQpXG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJudW1DYXNjYWRlcyBtdXN0IGJlIGFuIGludGVnZXIgYmV0d2VlbiAxIGFuZCA0XCIpO1xuXG5cdFx0dGhpcy5fbnVtQ2FzY2FkZXMgPSB2YWx1ZTtcblx0XHR0aGlzLmludmFsaWRhdGVTY2lzc29yUmVjdHMoKTtcblx0XHR0aGlzLmluaXQoKTtcblx0XHR0aGlzLmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KEV2ZW50LkNIQU5HRSkpO1xuXHR9XG5cblx0cHVibGljIHBEcmF3RGVwdGhNYXAodGFyZ2V0OlJlbmRlclRleHR1cmUsIHNjZW5lOlNjZW5lLCByZW5kZXJlcjpJUmVuZGVyZXIpXG5cdHtcblx0XHRpZiAodGhpcy5fcFNjaXNzb3JSZWN0c0ludmFsaWQpXG5cdFx0XHR0aGlzLnVwZGF0ZVNjaXNzb3JSZWN0cygpO1xuXG5cdFx0dGhpcy5fcENhc3RlckNvbGxlY3Rvci5jdWxsUGxhbmVzID0gdGhpcy5fcEN1bGxQbGFuZXM7XG5cdFx0dGhpcy5fcENhc3RlckNvbGxlY3Rvci5jYW1lcmEgPSB0aGlzLl9wT3ZlcmFsbERlcHRoQ2FtZXJhO1xuXHRcdHRoaXMuX3BDYXN0ZXJDb2xsZWN0b3IuY2xlYXIoKTtcblx0XHRzY2VuZS50cmF2ZXJzZVBhcnRpdGlvbnModGhpcy5fcENhc3RlckNvbGxlY3Rvcik7XG5cblx0XHRyZW5kZXJlci5faVJlbmRlckNhc2NhZGVzKHRoaXMuX3BDYXN0ZXJDb2xsZWN0b3IsIHRhcmdldCwgdGhpcy5fbnVtQ2FzY2FkZXMsIHRoaXMuX3BTY2lzc29yUmVjdHMsIHRoaXMuX2RlcHRoQ2FtZXJhcyk7XG5cdH1cblxuXHRwcml2YXRlIHVwZGF0ZVNjaXNzb3JSZWN0cygpXG5cdHtcblx0XHR2YXIgaGFsZjpudW1iZXIgPSB0aGlzLl9wRGVwdGhNYXBTaXplKi41O1xuXG5cdFx0dGhpcy5fcFNjaXNzb3JSZWN0c1swXSA9IG5ldyBSZWN0YW5nbGUoMCwgMCwgaGFsZiwgaGFsZik7XG5cdFx0dGhpcy5fcFNjaXNzb3JSZWN0c1sxXSA9IG5ldyBSZWN0YW5nbGUoaGFsZiwgMCwgaGFsZiwgaGFsZik7XG5cdFx0dGhpcy5fcFNjaXNzb3JSZWN0c1syXSA9IG5ldyBSZWN0YW5nbGUoMCwgaGFsZiwgaGFsZiwgaGFsZik7XG5cdFx0dGhpcy5fcFNjaXNzb3JSZWN0c1szXSA9IG5ldyBSZWN0YW5nbGUoaGFsZiwgaGFsZiwgaGFsZiwgaGFsZik7XG5cblx0XHR0aGlzLl9wU2Npc3NvclJlY3RzSW52YWxpZCA9IGZhbHNlO1xuXHR9XG5cblx0cHVibGljIHBVcGRhdGVEZXB0aFByb2plY3Rpb24odmlld0NhbWVyYTpDYW1lcmEpXG5cdHtcblx0XHR2YXIgbWF0cml4Ok1hdHJpeDNEO1xuXHRcdHZhciBwcm9qZWN0aW9uOklQcm9qZWN0aW9uID0gdmlld0NhbWVyYS5wcm9qZWN0aW9uO1xuXHRcdHZhciBwcm9qZWN0aW9uTmVhcjpudW1iZXIgPSBwcm9qZWN0aW9uLm5lYXI7XG5cdFx0dmFyIHByb2plY3Rpb25SYW5nZTpudW1iZXIgPSBwcm9qZWN0aW9uLmZhciAtIHByb2plY3Rpb25OZWFyO1xuXG5cdFx0dGhpcy5wVXBkYXRlUHJvamVjdGlvbkZyb21GcnVzdHVtQ29ybmVycyh2aWV3Q2FtZXJhLCB2aWV3Q2FtZXJhLnByb2plY3Rpb24uZnJ1c3R1bUNvcm5lcnMsIHRoaXMuX3BNYXRyaXgpO1xuXHRcdHRoaXMuX3BNYXRyaXguYXBwZW5kU2NhbGUoLjk2LCAuOTYsIDEpO1xuXHRcdHRoaXMuX3BPdmVyYWxsRGVwdGhQcm9qZWN0aW9uLm1hdHJpeCA9IHRoaXMuX3BNYXRyaXg7XG5cdFx0dGhpcy5wVXBkYXRlQ3VsbFBsYW5lcyh2aWV3Q2FtZXJhKTtcblxuXHRcdGZvciAodmFyIGk6bnVtYmVyIC8qaW50Ki8gPSAwOyBpIDwgdGhpcy5fbnVtQ2FzY2FkZXM7ICsraSkge1xuXHRcdFx0bWF0cml4ID0gdGhpcy5fZGVwdGhMZW5zZXNbaV0ubWF0cml4O1xuXG5cdFx0XHR0aGlzLl9uZWFyUGxhbmVEaXN0YW5jZXNbaV0gPSBwcm9qZWN0aW9uTmVhciArIHRoaXMuX3NwbGl0UmF0aW9zW2ldKnByb2plY3Rpb25SYW5nZTtcblx0XHRcdHRoaXMuX2RlcHRoQ2FtZXJhc1tpXS50cmFuc2Zvcm0gPSB0aGlzLl9wT3ZlcmFsbERlcHRoQ2FtZXJhLnRyYW5zZm9ybTtcblxuXHRcdFx0dGhpcy51cGRhdGVQcm9qZWN0aW9uUGFydGl0aW9uKG1hdHJpeCwgdGhpcy5fc3BsaXRSYXRpb3NbaV0sIHRoaXMuX3RleE9mZnNldHNYW2ldLCB0aGlzLl90ZXhPZmZzZXRzWVtpXSk7XG5cblx0XHRcdHRoaXMuX2RlcHRoTGVuc2VzW2ldLm1hdHJpeCA9IG1hdHJpeDtcblx0XHR9XG5cdH1cblxuXHRwcml2YXRlIHVwZGF0ZVByb2plY3Rpb25QYXJ0aXRpb24obWF0cml4Ok1hdHJpeDNELCBzcGxpdFJhdGlvOm51bWJlciwgdGV4T2Zmc2V0WDpudW1iZXIsIHRleE9mZnNldFk6bnVtYmVyKVxuXHR7XG5cdFx0dmFyIHJhdzpBcnJheTxudW1iZXI+ID0gTWF0cml4M0RVdGlscy5SQVdfREFUQV9DT05UQUlORVI7XG5cdFx0dmFyIHhOOm51bWJlciwgeU46bnVtYmVyLCB6TjpudW1iZXI7XG5cdFx0dmFyIHhGOm51bWJlciwgeUY6bnVtYmVyLCB6RjpudW1iZXI7XG5cdFx0dmFyIG1pblg6bnVtYmVyID0gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZLCBtaW5ZOm51bWJlciA9IE51bWJlci5QT1NJVElWRV9JTkZJTklUWSwgbWluWjpudW1iZXI7XG5cdFx0dmFyIG1heFg6bnVtYmVyID0gTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZLCBtYXhZOm51bWJlciA9IE51bWJlci5ORUdBVElWRV9JTkZJTklUWSwgbWF4WjpudW1iZXIgPSBOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFk7XG5cdFx0dmFyIGk6bnVtYmVyIC8qdWludCovID0gMDtcblxuXHRcdHdoaWxlIChpIDwgMTIpIHtcblx0XHRcdHhOID0gdGhpcy5fcExvY2FsRnJ1c3R1bVtpXTtcblx0XHRcdHlOID0gdGhpcy5fcExvY2FsRnJ1c3R1bVtpICsgMV07XG5cdFx0XHR6TiA9IHRoaXMuX3BMb2NhbEZydXN0dW1baSArIDJdO1xuXHRcdFx0eEYgPSB4TiArICh0aGlzLl9wTG9jYWxGcnVzdHVtW2kgKyAxMl0gLSB4Tikqc3BsaXRSYXRpbztcblx0XHRcdHlGID0geU4gKyAodGhpcy5fcExvY2FsRnJ1c3R1bVtpICsgMTNdIC0geU4pKnNwbGl0UmF0aW87XG5cdFx0XHR6RiA9IHpOICsgKHRoaXMuX3BMb2NhbEZydXN0dW1baSArIDE0XSAtIHpOKSpzcGxpdFJhdGlvO1xuXHRcdFx0aWYgKHhOIDwgbWluWClcblx0XHRcdFx0bWluWCA9IHhOO1xuXHRcdFx0aWYgKHhOID4gbWF4WClcblx0XHRcdFx0bWF4WCA9IHhOO1xuXHRcdFx0aWYgKHlOIDwgbWluWSlcblx0XHRcdFx0bWluWSA9IHlOO1xuXHRcdFx0aWYgKHlOID4gbWF4WSlcblx0XHRcdFx0bWF4WSA9IHlOO1xuXHRcdFx0aWYgKHpOID4gbWF4Wilcblx0XHRcdFx0bWF4WiA9IHpOO1xuXHRcdFx0aWYgKHhGIDwgbWluWClcblx0XHRcdFx0bWluWCA9IHhGO1xuXHRcdFx0aWYgKHhGID4gbWF4WClcblx0XHRcdFx0bWF4WCA9IHhGO1xuXHRcdFx0aWYgKHlGIDwgbWluWSlcblx0XHRcdFx0bWluWSA9IHlGO1xuXHRcdFx0aWYgKHlGID4gbWF4WSlcblx0XHRcdFx0bWF4WSA9IHlGO1xuXHRcdFx0aWYgKHpGID4gbWF4Wilcblx0XHRcdFx0bWF4WiA9IHpGO1xuXHRcdFx0aSArPSAzO1xuXHRcdH1cblxuXHRcdG1pblogPSAxO1xuXG5cdFx0dmFyIHc6bnVtYmVyID0gKG1heFggLSBtaW5YKTtcblx0XHR2YXIgaDpudW1iZXIgPSAobWF4WSAtIG1pblkpO1xuXHRcdHZhciBkOm51bWJlciA9IDEvKG1heFogLSBtaW5aKTtcblxuXHRcdGlmIChtaW5YIDwgMClcblx0XHRcdG1pblggLT0gdGhpcy5fcFNuYXA7IC8vIGJlY2F1c2UgaW50KCkgcm91bmRzIHVwIGZvciA8IDBcblx0XHRpZiAobWluWSA8IDApXG5cdFx0XHRtaW5ZIC09IHRoaXMuX3BTbmFwO1xuXHRcdG1pblggPSBNYXRoLmZsb29yKG1pblgvdGhpcy5fcFNuYXApKnRoaXMuX3BTbmFwO1xuXHRcdG1pblkgPSBNYXRoLmZsb29yKG1pblkvdGhpcy5fcFNuYXApKnRoaXMuX3BTbmFwO1xuXG5cdFx0dmFyIHNuYXAyOm51bWJlciA9IDIqdGhpcy5fcFNuYXA7XG5cdFx0dyA9IE1hdGguZmxvb3Iody9zbmFwMiArIDEpKnNuYXAyO1xuXHRcdGggPSBNYXRoLmZsb29yKGgvc25hcDIgKyAxKSpzbmFwMjtcblxuXHRcdG1heFggPSBtaW5YICsgdztcblx0XHRtYXhZID0gbWluWSArIGg7XG5cblx0XHR3ID0gMS93O1xuXHRcdGggPSAxL2g7XG5cblx0XHRyYXdbMF0gPSAyKnc7XG5cdFx0cmF3WzVdID0gMipoO1xuXHRcdHJhd1sxMF0gPSBkO1xuXHRcdHJhd1sxMl0gPSAtKG1heFggKyBtaW5YKSp3O1xuXHRcdHJhd1sxM10gPSAtKG1heFkgKyBtaW5ZKSpoO1xuXHRcdHJhd1sxNF0gPSAtbWluWipkO1xuXHRcdHJhd1sxNV0gPSAxO1xuXHRcdHJhd1sxXSA9IHJhd1syXSA9IHJhd1szXSA9IHJhd1s0XSA9IHJhd1s2XSA9IHJhd1s3XSA9IHJhd1s4XSA9IHJhd1s5XSA9IHJhd1sxMV0gPSAwO1xuXG5cdFx0bWF0cml4LmNvcHlSYXdEYXRhRnJvbShyYXcpO1xuXHRcdG1hdHJpeC5hcHBlbmRTY2FsZSguOTYsIC45NiwgMSk7XG5cdFx0bWF0cml4LmFwcGVuZFRyYW5zbGF0aW9uKHRleE9mZnNldFgsIHRleE9mZnNldFksIDApO1xuXHRcdG1hdHJpeC5hcHBlbmRTY2FsZSguNSwgLjUsIDEpO1xuXHR9XG5cblx0cHVibGljIGFkZEV2ZW50TGlzdGVuZXIodHlwZTpzdHJpbmcsIGxpc3RlbmVyOkZ1bmN0aW9uKVxuXHR7XG5cdFx0dGhpcy5fY2hhbmdlRGlzcGF0Y2hlci5hZGRFdmVudExpc3RlbmVyKHR5cGUsIGxpc3RlbmVyKTtcblx0fVxuXG5cdHB1YmxpYyByZW1vdmVFdmVudExpc3RlbmVyKHR5cGU6c3RyaW5nLCBsaXN0ZW5lcjpGdW5jdGlvbilcblx0e1xuXHRcdHRoaXMuX2NoYW5nZURpc3BhdGNoZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcik7XG5cdH1cblxuXHRwdWJsaWMgZGlzcGF0Y2hFdmVudChldmVudDpFdmVudClcblx0e1xuXHRcdHJldHVybiB0aGlzLl9jaGFuZ2VEaXNwYXRjaGVyLmRpc3BhdGNoRXZlbnQoZXZlbnQpO1xuXHR9XG5cblx0cHVibGljIGhhc0V2ZW50TGlzdGVuZXIodHlwZTpzdHJpbmcpOmJvb2xlYW5cblx0e1xuXHRcdHJldHVybiB0aGlzLl9jaGFuZ2VEaXNwYXRjaGVyLmhhc0V2ZW50TGlzdGVuZXIodHlwZSk7XG5cdH1cblxuXHRnZXQgX2lOZWFyUGxhbmVEaXN0YW5jZXMoKTpBcnJheTxudW1iZXI+XG5cdHtcblx0XHRyZXR1cm4gdGhpcy5fbmVhclBsYW5lRGlzdGFuY2VzO1xuXHR9XG59XG5cbmV4cG9ydCA9IENhc2NhZGVTaGFkb3dNYXBwZXI7Il19