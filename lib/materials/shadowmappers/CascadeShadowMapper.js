var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Matrix3DUtils = require("awayjs-core/lib/geom/Matrix3DUtils");
var Rectangle = require("awayjs-core/lib/geom/Rectangle");
var Event = require("awayjs-core/lib/events/Event");
var EventDispatcher = require("awayjs-core/lib/events/EventDispatcher");
var FreeMatrixProjection = require("awayjs-core/lib/projections/FreeMatrixProjection");
var Camera = require("awayjs-display/lib/entities/Camera");
var DirectionalShadowMapper = require("awayjs-display/lib/materials/shadowmappers/DirectionalShadowMapper");
var CascadeShadowMapper = (function (_super) {
    __extends(CascadeShadowMapper, _super);
    function CascadeShadowMapper(numCascades) {
        if (numCascades === void 0) { numCascades = 3; }
        _super.call(this);
        this._pScissorRectsInvalid = true;
        if (numCascades < 1 || numCascades > 4)
            throw new Error("numCascades must be an integer between 1 and 4");
        this._numCascades = numCascades;
        this._changeDispatcher = new EventDispatcher(this);
        this.init();
    }
    CascadeShadowMapper.prototype.getSplitRatio = function (index /*uint*/) {
        return this._splitRatios[index];
    };
    CascadeShadowMapper.prototype.setSplitRatio = function (index /*uint*/, value) {
        if (value < 0)
            value = 0;
        else if (value > 1)
            value = 1;
        if (index >= this._numCascades)
            throw new Error("index must be smaller than the number of cascades!");
        this._splitRatios[index] = value;
    };
    CascadeShadowMapper.prototype.getDepthProjections = function (partition /*uint*/) {
        return this._depthCameras[partition].viewProjection;
    };
    CascadeShadowMapper.prototype.init = function () {
        this._splitRatios = new Array(this._numCascades);
        this._nearPlaneDistances = new Array(this._numCascades);
        var s = 1;
        for (var i = this._numCascades - 1; i >= 0; --i) {
            this._splitRatios[i] = s;
            s *= .4;
        }
        this._texOffsetsX = Array(-1, 1, -1, 1);
        this._texOffsetsY = Array(1, 1, -1, -1);
        this._pScissorRects = new Array(4);
        this._depthLenses = new Array();
        this._depthCameras = new Array();
        for (i = 0; i < this._numCascades; ++i) {
            this._depthLenses[i] = new FreeMatrixProjection();
            this._depthCameras[i] = new Camera(this._depthLenses[i]);
        }
    };
    CascadeShadowMapper.prototype._pSetDepthMapSize = function (value /*uint*/) {
        _super.prototype._pSetDepthMapSize.call(this, value);
        this.invalidateScissorRects();
    };
    CascadeShadowMapper.prototype.invalidateScissorRects = function () {
        this._pScissorRectsInvalid = true;
    };
    Object.defineProperty(CascadeShadowMapper.prototype, "numCascades", {
        get: function () {
            return this._numCascades;
        },
        set: function (value /*int*/) {
            if (value == this._numCascades)
                return;
            if (value < 1 || value > 4)
                throw new Error("numCascades must be an integer between 1 and 4");
            this._numCascades = value;
            this.invalidateScissorRects();
            this.init();
            this.dispatchEvent(new Event(Event.CHANGE));
        },
        enumerable: true,
        configurable: true
    });
    CascadeShadowMapper.prototype.pDrawDepthMap = function (target, scene, renderer) {
        if (this._pScissorRectsInvalid)
            this.updateScissorRects();
        this._pCasterCollector.cullPlanes = this._pCullPlanes;
        this._pCasterCollector.camera = this._pOverallDepthCamera;
        this._pCasterCollector.clear();
        scene.traversePartitions(this._pCasterCollector);
        renderer._iRenderCascades(this._pCasterCollector, target, this._numCascades, this._pScissorRects, this._depthCameras);
    };
    CascadeShadowMapper.prototype.updateScissorRects = function () {
        var half = this._pDepthMapSize * .5;
        this._pScissorRects[0] = new Rectangle(0, 0, half, half);
        this._pScissorRects[1] = new Rectangle(half, 0, half, half);
        this._pScissorRects[2] = new Rectangle(0, half, half, half);
        this._pScissorRects[3] = new Rectangle(half, half, half, half);
        this._pScissorRectsInvalid = false;
    };
    CascadeShadowMapper.prototype.pUpdateDepthProjection = function (viewCamera) {
        var matrix;
        var projection = viewCamera.projection;
        var projectionNear = projection.near;
        var projectionRange = projection.far - projectionNear;
        this.pUpdateProjectionFromFrustumCorners(viewCamera, viewCamera.projection.frustumCorners, this._pMatrix);
        this._pMatrix.appendScale(.96, .96, 1);
        this._pOverallDepthProjection.matrix = this._pMatrix;
        this.pUpdateCullPlanes(viewCamera);
        for (var i = 0; i < this._numCascades; ++i) {
            matrix = this._depthLenses[i].matrix;
            this._nearPlaneDistances[i] = projectionNear + this._splitRatios[i] * projectionRange;
            this._depthCameras[i].transform.matrix3D = this._pOverallDepthCamera.transform.matrix3D;
            this.updateProjectionPartition(matrix, this._splitRatios[i], this._texOffsetsX[i], this._texOffsetsY[i]);
            this._depthLenses[i].matrix = matrix;
        }
    };
    CascadeShadowMapper.prototype.updateProjectionPartition = function (matrix, splitRatio, texOffsetX, texOffsetY) {
        var raw = Matrix3DUtils.RAW_DATA_CONTAINER;
        var xN, yN, zN;
        var xF, yF, zF;
        var minX = Number.POSITIVE_INFINITY, minY = Number.POSITIVE_INFINITY, minZ;
        var maxX = Number.NEGATIVE_INFINITY, maxY = Number.NEGATIVE_INFINITY, maxZ = Number.NEGATIVE_INFINITY;
        var i = 0;
        while (i < 12) {
            xN = this._pLocalFrustum[i];
            yN = this._pLocalFrustum[i + 1];
            zN = this._pLocalFrustum[i + 2];
            xF = xN + (this._pLocalFrustum[i + 12] - xN) * splitRatio;
            yF = yN + (this._pLocalFrustum[i + 13] - yN) * splitRatio;
            zF = zN + (this._pLocalFrustum[i + 14] - zN) * splitRatio;
            if (xN < minX)
                minX = xN;
            if (xN > maxX)
                maxX = xN;
            if (yN < minY)
                minY = yN;
            if (yN > maxY)
                maxY = yN;
            if (zN > maxZ)
                maxZ = zN;
            if (xF < minX)
                minX = xF;
            if (xF > maxX)
                maxX = xF;
            if (yF < minY)
                minY = yF;
            if (yF > maxY)
                maxY = yF;
            if (zF > maxZ)
                maxZ = zF;
            i += 3;
        }
        minZ = 1;
        var w = (maxX - minX);
        var h = (maxY - minY);
        var d = 1 / (maxZ - minZ);
        if (minX < 0)
            minX -= this._pSnap; // because int() rounds up for < 0
        if (minY < 0)
            minY -= this._pSnap;
        minX = Math.floor(minX / this._pSnap) * this._pSnap;
        minY = Math.floor(minY / this._pSnap) * this._pSnap;
        var snap2 = 2 * this._pSnap;
        w = Math.floor(w / snap2 + 1) * snap2;
        h = Math.floor(h / snap2 + 1) * snap2;
        maxX = minX + w;
        maxY = minY + h;
        w = 1 / w;
        h = 1 / h;
        raw[0] = 2 * w;
        raw[5] = 2 * h;
        raw[10] = d;
        raw[12] = -(maxX + minX) * w;
        raw[13] = -(maxY + minY) * h;
        raw[14] = -minZ * d;
        raw[15] = 1;
        raw[1] = raw[2] = raw[3] = raw[4] = raw[6] = raw[7] = raw[8] = raw[9] = raw[11] = 0;
        matrix.copyRawDataFrom(raw);
        matrix.appendScale(.96, .96, 1);
        matrix.appendTranslation(texOffsetX, texOffsetY, 0);
        matrix.appendScale(.5, .5, 1);
    };
    CascadeShadowMapper.prototype.addEventListener = function (type, listener) {
        this._changeDispatcher.addEventListener(type, listener);
    };
    CascadeShadowMapper.prototype.removeEventListener = function (type, listener) {
        this._changeDispatcher.removeEventListener(type, listener);
    };
    CascadeShadowMapper.prototype.dispatchEvent = function (event) {
        return this._changeDispatcher.dispatchEvent(event);
    };
    CascadeShadowMapper.prototype.hasEventListener = function (type) {
        return this._changeDispatcher.hasEventListener(type);
    };
    Object.defineProperty(CascadeShadowMapper.prototype, "_iNearPlaneDistances", {
        get: function () {
            return this._nearPlaneDistances;
        },
        enumerable: true,
        configurable: true
    });
    return CascadeShadowMapper;
})(DirectionalShadowMapper);
module.exports = CascadeShadowMapper;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1kaXNwbGF5L2xpYi9tYXRlcmlhbHMvc2hhZG93bWFwcGVycy9DYXNjYWRlU2hhZG93TWFwcGVyLnRzIl0sIm5hbWVzIjpbIkNhc2NhZGVTaGFkb3dNYXBwZXIiLCJDYXNjYWRlU2hhZG93TWFwcGVyLmNvbnN0cnVjdG9yIiwiQ2FzY2FkZVNoYWRvd01hcHBlci5nZXRTcGxpdFJhdGlvIiwiQ2FzY2FkZVNoYWRvd01hcHBlci5zZXRTcGxpdFJhdGlvIiwiQ2FzY2FkZVNoYWRvd01hcHBlci5nZXREZXB0aFByb2plY3Rpb25zIiwiQ2FzY2FkZVNoYWRvd01hcHBlci5pbml0IiwiQ2FzY2FkZVNoYWRvd01hcHBlci5fcFNldERlcHRoTWFwU2l6ZSIsIkNhc2NhZGVTaGFkb3dNYXBwZXIuaW52YWxpZGF0ZVNjaXNzb3JSZWN0cyIsIkNhc2NhZGVTaGFkb3dNYXBwZXIubnVtQ2FzY2FkZXMiLCJDYXNjYWRlU2hhZG93TWFwcGVyLnBEcmF3RGVwdGhNYXAiLCJDYXNjYWRlU2hhZG93TWFwcGVyLnVwZGF0ZVNjaXNzb3JSZWN0cyIsIkNhc2NhZGVTaGFkb3dNYXBwZXIucFVwZGF0ZURlcHRoUHJvamVjdGlvbiIsIkNhc2NhZGVTaGFkb3dNYXBwZXIudXBkYXRlUHJvamVjdGlvblBhcnRpdGlvbiIsIkNhc2NhZGVTaGFkb3dNYXBwZXIuYWRkRXZlbnRMaXN0ZW5lciIsIkNhc2NhZGVTaGFkb3dNYXBwZXIucmVtb3ZlRXZlbnRMaXN0ZW5lciIsIkNhc2NhZGVTaGFkb3dNYXBwZXIuZGlzcGF0Y2hFdmVudCIsIkNhc2NhZGVTaGFkb3dNYXBwZXIuaGFzRXZlbnRMaXN0ZW5lciIsIkNhc2NhZGVTaGFkb3dNYXBwZXIuX2lOZWFyUGxhbmVEaXN0YW5jZXMiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUNBLElBQU8sYUFBYSxXQUFjLG9DQUFvQyxDQUFDLENBQUM7QUFDeEUsSUFBTyxTQUFTLFdBQWUsZ0NBQWdDLENBQUMsQ0FBQztBQUNqRSxJQUFPLEtBQUssV0FB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RUEsR0FBR0EsSUFBSUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDaENBLEVBQUVBLEdBQUdBLElBQUlBLENBQUNBLGNBQWNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO1lBQ2hDQSxFQUFFQSxHQUFHQSxFQUFFQSxHQUFHQSxDQUFDQSxJQUFJQSxDQUFDQSxjQUFjQSxDQUFDQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQSxHQUFDQSxVQUFVQSxDQUFDQTtZQUN4REEsRUFBRUEsR0FBR0EsRUFBRUEsR0FBR0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0EsR0FBQ0EsVUFBVUEsQ0FBQ0E7WUFDeERBLEVBQUVBLEdBQUdBLEVBQUVBLEdBQUdBLENBQUNBLElBQUlBLENBQUNBLGNBQWNBLENBQUNBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBLEdBQUNBLFVBQVVBLENBQUNBO1lBQ3hEQSxFQUFFQSxDQUFDQSxDQUFDQSxFQUFFQSxHQUFHQSxJQUFJQSxDQUFDQTtnQkFDYkEsSUFBSUEsR0FBR0EsRUFBRUEsQ0FBQ0E7WUFDWEEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsR0FBR0EsSUFBSUEsQ0FBQ0E7Z0JBQ2JBLElBQUlBLEdBQUdBLEVBQUVBLENBQUNBO1lBQ1hBLEVBQUVBLENBQUNBLENBQUNBLEVBQUVBLEdBQUdBLElBQUlBLENBQUNBO2dCQUNiQSxJQUFJQSxHQUFHQSxFQUFFQSxDQUFDQTtZQUNYQSxFQUFFQSxDQUFDQSxDQUFDQSxFQUFFQSxHQUFHQSxJQUFJQSxDQUFDQTtnQkFDYkEsSUFBSUEsR0FBR0EsRUFBRUEsQ0FBQ0E7WUFDWEEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsR0FBR0EsSUFBSUEsQ0FBQ0E7Z0JBQ2JBLElBQUlBLEdBQUdBLEVBQUVBLENBQUNBO1lBQ1hBLEVBQUVBLENBQUNBLENBQUNBLEVBQUVBLEdBQUdBLElBQUlBLENBQUNBO2dCQUNiQSxJQUFJQSxHQUFHQSxFQUFFQSxDQUFDQTtZQUNYQSxFQUFFQSxDQUFDQSxDQUFDQSxFQUFFQSxHQUFHQSxJQUFJQSxDQUFDQTtnQkFDYkEsSUFBSUEsR0FBR0EsRUFBRUEsQ0FBQ0E7WUFDWEEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsR0FBR0EsSUFBSUEsQ0FBQ0E7Z0JBQ2JBLElBQUlBLEdBQUdBLEVBQUVBLENBQUNBO1lBQ1hBLEVBQUVBLENBQUNBLENBQUNBLEVBQUVBLEdBQUdBLElBQUlBLENBQUNBO2dCQUNiQSxJQUFJQSxHQUFHQSxFQUFFQSxDQUFDQTtZQUNYQSxFQUFFQSxDQUFDQSxDQUFDQSxFQUFFQSxHQUFHQSxJQUFJQSxDQUFDQTtnQkFDYkEsSUFBSUEsR0FBR0EsRUFBRUEsQ0FBQ0E7WUFDWEEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDUkEsQ0FBQ0E7UUFFREEsSUFBSUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFFVEEsSUFBSUEsQ0FBQ0EsR0FBVUEsQ0FBQ0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDN0JBLElBQUlBLENBQUNBLEdBQVVBLENBQUNBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBLENBQUNBO1FBQzdCQSxJQUFJQSxDQUFDQSxHQUFVQSxDQUFDQSxHQUFDQSxDQUFDQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUUvQkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7WUFDWkEsSUFBSUEsSUFBSUEsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0Esa0NBQWtDQTtRQUN4REEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7WUFDWkEsSUFBSUEsSUFBSUEsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7UUFDckJBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLElBQUlBLEdBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLEdBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBO1FBQ2hEQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxHQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxHQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQTtRQUVoREEsSUFBSUEsS0FBS0EsR0FBVUEsQ0FBQ0EsR0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7UUFDakNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBLEdBQUNBLEtBQUtBLEdBQUdBLENBQUNBLENBQUNBLEdBQUNBLEtBQUtBLENBQUNBO1FBQ2xDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQSxHQUFDQSxLQUFLQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFDQSxLQUFLQSxDQUFDQTtRQUVsQ0EsSUFBSUEsR0FBR0EsSUFBSUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDaEJBLElBQUlBLEdBQUdBLElBQUlBLEdBQUdBLENBQUNBLENBQUNBO1FBRWhCQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFDQSxDQUFDQSxDQUFDQTtRQUNSQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFDQSxDQUFDQSxDQUFDQTtRQUVSQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFDQSxDQUFDQSxDQUFDQTtRQUNiQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFDQSxDQUFDQSxDQUFDQTtRQUNiQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUNaQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxHQUFDQSxDQUFDQSxDQUFDQTtRQUMzQkEsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDM0JBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLENBQUNBLElBQUlBLEdBQUNBLENBQUNBLENBQUNBO1FBQ2xCQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUNaQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUVwRkEsTUFBTUEsQ0FBQ0EsZUFBZUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDNUJBLE1BQU1BLENBQUNBLFdBQVdBLENBQUNBLEdBQUdBLEVBQUVBLEdBQUdBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1FBQ2hDQSxNQUFNQSxDQUFDQSxpQkFBaUJBLENBQUNBLFVBQVVBLEVBQUVBLFVBQVVBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1FBQ3BEQSxNQUFNQSxDQUFDQSxXQUFXQSxDQUFDQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtJQUMvQkEsQ0FBQ0E7SUFFTVosOENBQWdCQSxHQUF2QkEsVUFBd0JBLElBQVdBLEVBQUVBLFFBQWlCQTtRQUVyRGEsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxnQkFBZ0JBLENBQUNBLElBQUlBLEVBQUVBLFFBQVFBLENBQUNBLENBQUNBO0lBQ3pEQSxDQUFDQTtJQUVNYixpREFBbUJBLEdBQTFCQSxVQUEyQkEsSUFBV0EsRUFBRUEsUUFBaUJBO1FBRXhEYyxJQUFJQSxDQUFDQSxpQkFBaUJBLENBQUNBLG1CQUFtQkEsQ0FBQ0EsSUFBSUEsRUFBRUEsUUFBUUEsQ0FBQ0EsQ0FBQ0E7SUFDNURBLENBQUNBO0lBRU1kLDJDQUFhQSxHQUFwQkEsVUFBcUJBLEtBQVdBO1FBRS9CZSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxpQkFBaUJBLENBQUNBLGFBQWFBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBO0lBQ3BEQSxDQUFDQTtJQUVNZiw4Q0FBZ0JBLEdBQXZCQSxVQUF3QkEsSUFBV0E7UUFFbENnQixNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxpQkFBaUJBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7SUFDdERBLENBQUNBO0lBRURoQixzQkFBSUEscURBQW9CQTthQUF4QkE7WUFFQ2lCLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLG1CQUFtQkEsQ0FBQ0E7UUFDakNBLENBQUNBOzs7T0FBQWpCO0lBQ0ZBLDBCQUFDQTtBQUFEQSxDQS9QQSxBQStQQ0EsRUEvUGlDLHVCQUF1QixFQStQeEQ7QUFFRCxBQUE2QixpQkFBcEIsbUJBQW1CLENBQUMiLCJmaWxlIjoibWF0ZXJpYWxzL3NoYWRvd21hcHBlcnMvQ2FzY2FkZVNoYWRvd01hcHBlci5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgTWF0cml4M0RcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9NYXRyaXgzRFwiKTtcbmltcG9ydCBNYXRyaXgzRFV0aWxzXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9NYXRyaXgzRFV0aWxzXCIpO1xuaW1wb3J0IFJlY3RhbmdsZVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9SZWN0YW5nbGVcIik7XG5pbXBvcnQgRXZlbnRcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZXZlbnRzL0V2ZW50XCIpO1xuaW1wb3J0IEV2ZW50RGlzcGF0Y2hlclx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2V2ZW50cy9FdmVudERpc3BhdGNoZXJcIik7XG5pbXBvcnQgSUV2ZW50RGlzcGF0Y2hlclx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2V2ZW50cy9JRXZlbnREaXNwYXRjaGVyXCIpO1xuaW1wb3J0IEZyZWVNYXRyaXhQcm9qZWN0aW9uXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL3Byb2plY3Rpb25zL0ZyZWVNYXRyaXhQcm9qZWN0aW9uXCIpO1xuaW1wb3J0IElQcm9qZWN0aW9uXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9wcm9qZWN0aW9ucy9JUHJvamVjdGlvblwiKTtcblxuaW1wb3J0IFNjZW5lXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2NvbnRhaW5lcnMvU2NlbmVcIik7XG5pbXBvcnQgSVJlbmRlcmVyXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9yZW5kZXIvSVJlbmRlcmVyXCIpO1xuaW1wb3J0IENhbWVyYVx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9DYW1lcmFcIik7XG5pbXBvcnQgRGlyZWN0aW9uYWxTaGFkb3dNYXBwZXJcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL21hdGVyaWFscy9zaGFkb3dtYXBwZXJzL0RpcmVjdGlvbmFsU2hhZG93TWFwcGVyXCIpO1xuaW1wb3J0IFJlbmRlclRleHR1cmVcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi90ZXh0dXJlcy9SZW5kZXJUZXh0dXJlXCIpO1xuaW1wb3J0IFRleHR1cmVCYXNlXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi90ZXh0dXJlcy9UZXh0dXJlQmFzZVwiKTtcblxuY2xhc3MgQ2FzY2FkZVNoYWRvd01hcHBlciBleHRlbmRzIERpcmVjdGlvbmFsU2hhZG93TWFwcGVyIGltcGxlbWVudHMgSUV2ZW50RGlzcGF0Y2hlclxue1xuXHRwdWJsaWMgX3BTY2lzc29yUmVjdHM6UmVjdGFuZ2xlW107XG5cdHByaXZhdGUgX3BTY2lzc29yUmVjdHNJbnZhbGlkOmJvb2xlYW4gPSB0cnVlO1xuXHRwcml2YXRlIF9zcGxpdFJhdGlvczpudW1iZXJbXTtcblxuXHRwcml2YXRlIF9udW1DYXNjYWRlczpudW1iZXIgLyppbnQqLztcblx0cHJpdmF0ZSBfZGVwdGhDYW1lcmFzOkFycmF5PENhbWVyYT47XG5cdHByaXZhdGUgX2RlcHRoTGVuc2VzOkFycmF5PEZyZWVNYXRyaXhQcm9qZWN0aW9uPjtcblxuXHRwcml2YXRlIF90ZXhPZmZzZXRzWDpBcnJheTxudW1iZXI+O1xuXHRwcml2YXRlIF90ZXhPZmZzZXRzWTpBcnJheTxudW1iZXI+O1xuXG5cdHByaXZhdGUgX2NoYW5nZURpc3BhdGNoZXI6RXZlbnREaXNwYXRjaGVyO1xuXHRwcml2YXRlIF9uZWFyUGxhbmVEaXN0YW5jZXM6bnVtYmVyW107XG5cblx0Y29uc3RydWN0b3IobnVtQ2FzY2FkZXM6bnVtYmVyIC8qdWludCovID0gMylcblx0e1xuXHRcdHN1cGVyKCk7XG5cblx0XHRpZiAobnVtQ2FzY2FkZXMgPCAxIHx8IG51bUNhc2NhZGVzID4gNClcblx0XHRcdHRocm93IG5ldyBFcnJvcihcIm51bUNhc2NhZGVzIG11c3QgYmUgYW4gaW50ZWdlciBiZXR3ZWVuIDEgYW5kIDRcIik7XG5cblx0XHR0aGlzLl9udW1DYXNjYWRlcyA9IG51bUNhc2NhZGVzO1xuXHRcdHRoaXMuX2NoYW5nZURpc3BhdGNoZXIgPSBuZXcgRXZlbnREaXNwYXRjaGVyKHRoaXMpO1xuXHRcdHRoaXMuaW5pdCgpO1xuXHR9XG5cblx0cHVibGljIGdldFNwbGl0UmF0aW8oaW5kZXg6bnVtYmVyIC8qdWludCovKTpudW1iZXJcblx0e1xuXHRcdHJldHVybiB0aGlzLl9zcGxpdFJhdGlvc1tpbmRleF07XG5cdH1cblxuXHRwdWJsaWMgc2V0U3BsaXRSYXRpbyhpbmRleDpudW1iZXIgLyp1aW50Ki8sIHZhbHVlOm51bWJlcilcblx0e1xuXHRcdGlmICh2YWx1ZSA8IDApXG5cdFx0XHR2YWx1ZSA9IDA7XG5cdFx0ZWxzZSBpZiAodmFsdWUgPiAxKVxuXHRcdFx0dmFsdWUgPSAxO1xuXG5cdFx0aWYgKGluZGV4ID49IHRoaXMuX251bUNhc2NhZGVzKVxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiaW5kZXggbXVzdCBiZSBzbWFsbGVyIHRoYW4gdGhlIG51bWJlciBvZiBjYXNjYWRlcyFcIik7XG5cblx0XHR0aGlzLl9zcGxpdFJhdGlvc1tpbmRleF0gPSB2YWx1ZTtcblx0fVxuXG5cdHB1YmxpYyBnZXREZXB0aFByb2plY3Rpb25zKHBhcnRpdGlvbjpudW1iZXIgLyp1aW50Ki8pOk1hdHJpeDNEXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5fZGVwdGhDYW1lcmFzW3BhcnRpdGlvbl0udmlld1Byb2plY3Rpb247XG5cdH1cblxuXHRwcml2YXRlIGluaXQoKVxuXHR7XG5cdFx0dGhpcy5fc3BsaXRSYXRpb3MgPSBuZXcgQXJyYXk8bnVtYmVyPih0aGlzLl9udW1DYXNjYWRlcyk7XG5cdFx0dGhpcy5fbmVhclBsYW5lRGlzdGFuY2VzID0gbmV3IEFycmF5PG51bWJlcj4odGhpcy5fbnVtQ2FzY2FkZXMpO1xuXG5cdFx0dmFyIHM6bnVtYmVyID0gMTtcblx0XHRmb3IgKHZhciBpOm51bWJlciAvKmludCovID0gdGhpcy5fbnVtQ2FzY2FkZXMgLSAxOyBpID49IDA7IC0taSkge1xuXHRcdFx0dGhpcy5fc3BsaXRSYXRpb3NbaV0gPSBzO1xuXHRcdFx0cyAqPSAuNDtcblx0XHR9XG5cblx0XHR0aGlzLl90ZXhPZmZzZXRzWCA9IEFycmF5PG51bWJlcj4oLTEsIDEsIC0xLCAxKTtcblx0XHR0aGlzLl90ZXhPZmZzZXRzWSA9IEFycmF5PG51bWJlcj4oMSwgMSwgLTEsIC0xKTtcblx0XHR0aGlzLl9wU2Npc3NvclJlY3RzID0gbmV3IEFycmF5PFJlY3RhbmdsZT4oNCk7XG5cdFx0dGhpcy5fZGVwdGhMZW5zZXMgPSBuZXcgQXJyYXk8RnJlZU1hdHJpeFByb2plY3Rpb24+KCk7XG5cdFx0dGhpcy5fZGVwdGhDYW1lcmFzID0gbmV3IEFycmF5PENhbWVyYT4oKTtcblxuXHRcdGZvciAoaSA9IDA7IGkgPCB0aGlzLl9udW1DYXNjYWRlczsgKytpKSB7XG5cdFx0XHR0aGlzLl9kZXB0aExlbnNlc1tpXSA9IG5ldyBGcmVlTWF0cml4UHJvamVjdGlvbigpO1xuXHRcdFx0dGhpcy5fZGVwdGhDYW1lcmFzW2ldID0gbmV3IENhbWVyYSh0aGlzLl9kZXB0aExlbnNlc1tpXSk7XG5cdFx0fVxuXHR9XG5cblx0cHVibGljIF9wU2V0RGVwdGhNYXBTaXplKHZhbHVlOm51bWJlciAvKnVpbnQqLylcblx0e1xuXHRcdHN1cGVyLl9wU2V0RGVwdGhNYXBTaXplKHZhbHVlKTtcblxuXHRcdHRoaXMuaW52YWxpZGF0ZVNjaXNzb3JSZWN0cygpO1xuXHR9XG5cblx0cHJpdmF0ZSBpbnZhbGlkYXRlU2Npc3NvclJlY3RzKClcblx0e1xuXHRcdHRoaXMuX3BTY2lzc29yUmVjdHNJbnZhbGlkID0gdHJ1ZTtcblx0fVxuXG5cdHB1YmxpYyBnZXQgbnVtQ2FzY2FkZXMoKTpudW1iZXIgLyppbnQqL1xuXHR7XG5cdFx0cmV0dXJuIHRoaXMuX251bUNhc2NhZGVzO1xuXHR9XG5cblx0cHVibGljIHNldCBudW1DYXNjYWRlcyh2YWx1ZTpudW1iZXIgLyppbnQqLylcblx0e1xuXHRcdGlmICh2YWx1ZSA9PSB0aGlzLl9udW1DYXNjYWRlcylcblx0XHRcdHJldHVybjtcblxuXHRcdGlmICh2YWx1ZSA8IDEgfHwgdmFsdWUgPiA0KVxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKFwibnVtQ2FzY2FkZXMgbXVzdCBiZSBhbiBpbnRlZ2VyIGJldHdlZW4gMSBhbmQgNFwiKTtcblxuXHRcdHRoaXMuX251bUNhc2NhZGVzID0gdmFsdWU7XG5cdFx0dGhpcy5pbnZhbGlkYXRlU2Npc3NvclJlY3RzKCk7XG5cdFx0dGhpcy5pbml0KCk7XG5cdFx0dGhpcy5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudChFdmVudC5DSEFOR0UpKTtcblx0fVxuXG5cdHB1YmxpYyBwRHJhd0RlcHRoTWFwKHRhcmdldDpSZW5kZXJUZXh0dXJlLCBzY2VuZTpTY2VuZSwgcmVuZGVyZXI6SVJlbmRlcmVyKVxuXHR7XG5cdFx0aWYgKHRoaXMuX3BTY2lzc29yUmVjdHNJbnZhbGlkKVxuXHRcdFx0dGhpcy51cGRhdGVTY2lzc29yUmVjdHMoKTtcblxuXHRcdHRoaXMuX3BDYXN0ZXJDb2xsZWN0b3IuY3VsbFBsYW5lcyA9IHRoaXMuX3BDdWxsUGxhbmVzO1xuXHRcdHRoaXMuX3BDYXN0ZXJDb2xsZWN0b3IuY2FtZXJhID0gdGhpcy5fcE92ZXJhbGxEZXB0aENhbWVyYTtcblx0XHR0aGlzLl9wQ2FzdGVyQ29sbGVjdG9yLmNsZWFyKCk7XG5cdFx0c2NlbmUudHJhdmVyc2VQYXJ0aXRpb25zKHRoaXMuX3BDYXN0ZXJDb2xsZWN0b3IpO1xuXG5cdFx0cmVuZGVyZXIuX2lSZW5kZXJDYXNjYWRlcyh0aGlzLl9wQ2FzdGVyQ29sbGVjdG9yLCB0YXJnZXQsIHRoaXMuX251bUNhc2NhZGVzLCB0aGlzLl9wU2Npc3NvclJlY3RzLCB0aGlzLl9kZXB0aENhbWVyYXMpO1xuXHR9XG5cblx0cHJpdmF0ZSB1cGRhdGVTY2lzc29yUmVjdHMoKVxuXHR7XG5cdFx0dmFyIGhhbGY6bnVtYmVyID0gdGhpcy5fcERlcHRoTWFwU2l6ZSouNTtcblxuXHRcdHRoaXMuX3BTY2lzc29yUmVjdHNbMF0gPSBuZXcgUmVjdGFuZ2xlKDAsIDAsIGhhbGYsIGhhbGYpO1xuXHRcdHRoaXMuX3BTY2lzc29yUmVjdHNbMV0gPSBuZXcgUmVjdGFuZ2xlKGhhbGYsIDAsIGhhbGYsIGhhbGYpO1xuXHRcdHRoaXMuX3BTY2lzc29yUmVjdHNbMl0gPSBuZXcgUmVjdGFuZ2xlKDAsIGhhbGYsIGhhbGYsIGhhbGYpO1xuXHRcdHRoaXMuX3BTY2lzc29yUmVjdHNbM10gPSBuZXcgUmVjdGFuZ2xlKGhhbGYsIGhhbGYsIGhhbGYsIGhhbGYpO1xuXG5cdFx0dGhpcy5fcFNjaXNzb3JSZWN0c0ludmFsaWQgPSBmYWxzZTtcblx0fVxuXG5cdHB1YmxpYyBwVXBkYXRlRGVwdGhQcm9qZWN0aW9uKHZpZXdDYW1lcmE6Q2FtZXJhKVxuXHR7XG5cdFx0dmFyIG1hdHJpeDpNYXRyaXgzRDtcblx0XHR2YXIgcHJvamVjdGlvbjpJUHJvamVjdGlvbiA9IHZpZXdDYW1lcmEucHJvamVjdGlvbjtcblx0XHR2YXIgcHJvamVjdGlvbk5lYXI6bnVtYmVyID0gcHJvamVjdGlvbi5uZWFyO1xuXHRcdHZhciBwcm9qZWN0aW9uUmFuZ2U6bnVtYmVyID0gcHJvamVjdGlvbi5mYXIgLSBwcm9qZWN0aW9uTmVhcjtcblxuXHRcdHRoaXMucFVwZGF0ZVByb2plY3Rpb25Gcm9tRnJ1c3R1bUNvcm5lcnModmlld0NhbWVyYSwgdmlld0NhbWVyYS5wcm9qZWN0aW9uLmZydXN0dW1Db3JuZXJzLCB0aGlzLl9wTWF0cml4KTtcblx0XHR0aGlzLl9wTWF0cml4LmFwcGVuZFNjYWxlKC45NiwgLjk2LCAxKTtcblx0XHR0aGlzLl9wT3ZlcmFsbERlcHRoUHJvamVjdGlvbi5tYXRyaXggPSB0aGlzLl9wTWF0cml4O1xuXHRcdHRoaXMucFVwZGF0ZUN1bGxQbGFuZXModmlld0NhbWVyYSk7XG5cblx0XHRmb3IgKHZhciBpOm51bWJlciAvKmludCovID0gMDsgaSA8IHRoaXMuX251bUNhc2NhZGVzOyArK2kpIHtcblx0XHRcdG1hdHJpeCA9IHRoaXMuX2RlcHRoTGVuc2VzW2ldLm1hdHJpeDtcblxuXHRcdFx0dGhpcy5fbmVhclBsYW5lRGlzdGFuY2VzW2ldID0gcHJvamVjdGlvbk5lYXIgKyB0aGlzLl9zcGxpdFJhdGlvc1tpXSpwcm9qZWN0aW9uUmFuZ2U7XG5cdFx0XHR0aGlzLl9kZXB0aENhbWVyYXNbaV0udHJhbnNmb3JtLm1hdHJpeDNEID0gdGhpcy5fcE92ZXJhbGxEZXB0aENhbWVyYS50cmFuc2Zvcm0ubWF0cml4M0Q7XG5cblx0XHRcdHRoaXMudXBkYXRlUHJvamVjdGlvblBhcnRpdGlvbihtYXRyaXgsIHRoaXMuX3NwbGl0UmF0aW9zW2ldLCB0aGlzLl90ZXhPZmZzZXRzWFtpXSwgdGhpcy5fdGV4T2Zmc2V0c1lbaV0pO1xuXG5cdFx0XHR0aGlzLl9kZXB0aExlbnNlc1tpXS5tYXRyaXggPSBtYXRyaXg7XG5cdFx0fVxuXHR9XG5cblx0cHJpdmF0ZSB1cGRhdGVQcm9qZWN0aW9uUGFydGl0aW9uKG1hdHJpeDpNYXRyaXgzRCwgc3BsaXRSYXRpbzpudW1iZXIsIHRleE9mZnNldFg6bnVtYmVyLCB0ZXhPZmZzZXRZOm51bWJlcilcblx0e1xuXHRcdHZhciByYXc6QXJyYXk8bnVtYmVyPiA9IE1hdHJpeDNEVXRpbHMuUkFXX0RBVEFfQ09OVEFJTkVSO1xuXHRcdHZhciB4TjpudW1iZXIsIHlOOm51bWJlciwgek46bnVtYmVyO1xuXHRcdHZhciB4RjpudW1iZXIsIHlGOm51bWJlciwgekY6bnVtYmVyO1xuXHRcdHZhciBtaW5YOm51bWJlciA9IE51bWJlci5QT1NJVElWRV9JTkZJTklUWSwgbWluWTpudW1iZXIgPSBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksIG1pblo6bnVtYmVyO1xuXHRcdHZhciBtYXhYOm51bWJlciA9IE51bWJlci5ORUdBVElWRV9JTkZJTklUWSwgbWF4WTpudW1iZXIgPSBOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFksIG1heFo6bnVtYmVyID0gTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZO1xuXHRcdHZhciBpOm51bWJlciAvKnVpbnQqLyA9IDA7XG5cblx0XHR3aGlsZSAoaSA8IDEyKSB7XG5cdFx0XHR4TiA9IHRoaXMuX3BMb2NhbEZydXN0dW1baV07XG5cdFx0XHR5TiA9IHRoaXMuX3BMb2NhbEZydXN0dW1baSArIDFdO1xuXHRcdFx0ek4gPSB0aGlzLl9wTG9jYWxGcnVzdHVtW2kgKyAyXTtcblx0XHRcdHhGID0geE4gKyAodGhpcy5fcExvY2FsRnJ1c3R1bVtpICsgMTJdIC0geE4pKnNwbGl0UmF0aW87XG5cdFx0XHR5RiA9IHlOICsgKHRoaXMuX3BMb2NhbEZydXN0dW1baSArIDEzXSAtIHlOKSpzcGxpdFJhdGlvO1xuXHRcdFx0ekYgPSB6TiArICh0aGlzLl9wTG9jYWxGcnVzdHVtW2kgKyAxNF0gLSB6Tikqc3BsaXRSYXRpbztcblx0XHRcdGlmICh4TiA8IG1pblgpXG5cdFx0XHRcdG1pblggPSB4Tjtcblx0XHRcdGlmICh4TiA+IG1heFgpXG5cdFx0XHRcdG1heFggPSB4Tjtcblx0XHRcdGlmICh5TiA8IG1pblkpXG5cdFx0XHRcdG1pblkgPSB5Tjtcblx0XHRcdGlmICh5TiA+IG1heFkpXG5cdFx0XHRcdG1heFkgPSB5Tjtcblx0XHRcdGlmICh6TiA+IG1heFopXG5cdFx0XHRcdG1heFogPSB6Tjtcblx0XHRcdGlmICh4RiA8IG1pblgpXG5cdFx0XHRcdG1pblggPSB4Rjtcblx0XHRcdGlmICh4RiA+IG1heFgpXG5cdFx0XHRcdG1heFggPSB4Rjtcblx0XHRcdGlmICh5RiA8IG1pblkpXG5cdFx0XHRcdG1pblkgPSB5Rjtcblx0XHRcdGlmICh5RiA+IG1heFkpXG5cdFx0XHRcdG1heFkgPSB5Rjtcblx0XHRcdGlmICh6RiA+IG1heFopXG5cdFx0XHRcdG1heFogPSB6Rjtcblx0XHRcdGkgKz0gMztcblx0XHR9XG5cblx0XHRtaW5aID0gMTtcblxuXHRcdHZhciB3Om51bWJlciA9IChtYXhYIC0gbWluWCk7XG5cdFx0dmFyIGg6bnVtYmVyID0gKG1heFkgLSBtaW5ZKTtcblx0XHR2YXIgZDpudW1iZXIgPSAxLyhtYXhaIC0gbWluWik7XG5cblx0XHRpZiAobWluWCA8IDApXG5cdFx0XHRtaW5YIC09IHRoaXMuX3BTbmFwOyAvLyBiZWNhdXNlIGludCgpIHJvdW5kcyB1cCBmb3IgPCAwXG5cdFx0aWYgKG1pblkgPCAwKVxuXHRcdFx0bWluWSAtPSB0aGlzLl9wU25hcDtcblx0XHRtaW5YID0gTWF0aC5mbG9vcihtaW5YL3RoaXMuX3BTbmFwKSp0aGlzLl9wU25hcDtcblx0XHRtaW5ZID0gTWF0aC5mbG9vcihtaW5ZL3RoaXMuX3BTbmFwKSp0aGlzLl9wU25hcDtcblxuXHRcdHZhciBzbmFwMjpudW1iZXIgPSAyKnRoaXMuX3BTbmFwO1xuXHRcdHcgPSBNYXRoLmZsb29yKHcvc25hcDIgKyAxKSpzbmFwMjtcblx0XHRoID0gTWF0aC5mbG9vcihoL3NuYXAyICsgMSkqc25hcDI7XG5cblx0XHRtYXhYID0gbWluWCArIHc7XG5cdFx0bWF4WSA9IG1pblkgKyBoO1xuXG5cdFx0dyA9IDEvdztcblx0XHRoID0gMS9oO1xuXG5cdFx0cmF3WzBdID0gMip3O1xuXHRcdHJhd1s1XSA9IDIqaDtcblx0XHRyYXdbMTBdID0gZDtcblx0XHRyYXdbMTJdID0gLShtYXhYICsgbWluWCkqdztcblx0XHRyYXdbMTNdID0gLShtYXhZICsgbWluWSkqaDtcblx0XHRyYXdbMTRdID0gLW1pbloqZDtcblx0XHRyYXdbMTVdID0gMTtcblx0XHRyYXdbMV0gPSByYXdbMl0gPSByYXdbM10gPSByYXdbNF0gPSByYXdbNl0gPSByYXdbN10gPSByYXdbOF0gPSByYXdbOV0gPSByYXdbMTFdID0gMDtcblxuXHRcdG1hdHJpeC5jb3B5UmF3RGF0YUZyb20ocmF3KTtcblx0XHRtYXRyaXguYXBwZW5kU2NhbGUoLjk2LCAuOTYsIDEpO1xuXHRcdG1hdHJpeC5hcHBlbmRUcmFuc2xhdGlvbih0ZXhPZmZzZXRYLCB0ZXhPZmZzZXRZLCAwKTtcblx0XHRtYXRyaXguYXBwZW5kU2NhbGUoLjUsIC41LCAxKTtcblx0fVxuXG5cdHB1YmxpYyBhZGRFdmVudExpc3RlbmVyKHR5cGU6c3RyaW5nLCBsaXN0ZW5lcjpGdW5jdGlvbilcblx0e1xuXHRcdHRoaXMuX2NoYW5nZURpc3BhdGNoZXIuYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcik7XG5cdH1cblxuXHRwdWJsaWMgcmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlOnN0cmluZywgbGlzdGVuZXI6RnVuY3Rpb24pXG5cdHtcblx0XHR0aGlzLl9jaGFuZ2VEaXNwYXRjaGVyLnJlbW92ZUV2ZW50TGlzdGVuZXIodHlwZSwgbGlzdGVuZXIpO1xuXHR9XG5cblx0cHVibGljIGRpc3BhdGNoRXZlbnQoZXZlbnQ6RXZlbnQpXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5fY2hhbmdlRGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50KGV2ZW50KTtcblx0fVxuXG5cdHB1YmxpYyBoYXNFdmVudExpc3RlbmVyKHR5cGU6c3RyaW5nKTpib29sZWFuXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5fY2hhbmdlRGlzcGF0Y2hlci5oYXNFdmVudExpc3RlbmVyKHR5cGUpO1xuXHR9XG5cblx0Z2V0IF9pTmVhclBsYW5lRGlzdGFuY2VzKCk6QXJyYXk8bnVtYmVyPlxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuX25lYXJQbGFuZURpc3RhbmNlcztcblx0fVxufVxuXG5leHBvcnQgPSBDYXNjYWRlU2hhZG93TWFwcGVyOyJdfQ==