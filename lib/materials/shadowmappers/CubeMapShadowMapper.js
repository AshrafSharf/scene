var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var PartialImplementationError = require("awayjs-core/lib/errors/PartialImplementationError");
var Camera = require("awayjs-display/lib/entities/Camera");
var ShadowMapperBase = require("awayjs-display/lib/materials/shadowmappers/ShadowMapperBase");
var CubeMapShadowMapper = (function (_super) {
    __extends(CubeMapShadowMapper, _super);
    function CubeMapShadowMapper() {
        _super.call(this);
        this._pDepthMapSize = 512;
        this._needsRender = new Array();
        this.initCameras();
    }
    CubeMapShadowMapper.prototype.initCameras = function () {
        this._depthCameras = new Array();
        this._projections = new Array();
        // posX, negX, posY, negY, posZ, negZ
        this.addCamera(0, 90, 0);
        this.addCamera(0, -90, 0);
        this.addCamera(-90, 0, 0);
        this.addCamera(90, 0, 0);
        this.addCamera(0, 0, 0);
        this.addCamera(0, 180, 0);
    };
    CubeMapShadowMapper.prototype.addCamera = function (rotationX, rotationY, rotationZ) {
        var cam = new Camera();
        cam.rotationX = rotationX;
        cam.rotationY = rotationY;
        cam.rotationZ = rotationZ;
        cam.projection.near = .01;
        var projection = cam.projection;
        projection.fieldOfView = 90;
        this._projections.push(projection);
        cam.projection._iAspectRatio = 1;
        this._depthCameras.push(cam);
    };
    //@override
    CubeMapShadowMapper.prototype.pCreateDepthTexture = function () {
        throw new PartialImplementationError();
        /*
         return new RenderCubeTexture( this._depthMapSize );
         */
    };
    //@override
    CubeMapShadowMapper.prototype.pUpdateDepthProjection = function (viewCamera) {
        var light = (this._pLight);
        var maxDistance = light._pFallOff;
        var pos = this._pLight.scenePosition;
        for (var i = 0; i < 6; ++i) {
            this._projections[i].far = maxDistance;
            this._depthCameras[i].transform.position = pos;
            this._needsRender[i] = true;
        }
    };
    //@override
    CubeMapShadowMapper.prototype.pDrawDepthMap = function (target, scene, renderer) {
        for (var i = 0; i < 6; ++i) {
            if (this._needsRender[i]) {
                this._pCasterCollector.camera = this._depthCameras[i];
                this._pCasterCollector.clear();
                scene.traversePartitions(this._pCasterCollector);
                renderer._iRender(this._pCasterCollector, target, null, i);
            }
        }
    };
    return CubeMapShadowMapper;
})(ShadowMapperBase);
module.exports = CubeMapShadowMapper;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1kaXNwbGF5L2xpYi9tYXRlcmlhbHMvc2hhZG93bWFwcGVycy9DdWJlTWFwU2hhZG93TWFwcGVyLnRzIl0sIm5hbWVzIjpbIkN1YmVNYXBTaGFkb3dNYXBwZXIiLCJDdWJlTWFwU2hhZG93TWFwcGVyLmNvbnN0cnVjdG9yIiwiQ3ViZU1hcFNoYWRvd01hcHBlci5pbml0Q2FtZXJhcyIsIkN1YmVNYXBTaGFkb3dNYXBwZXIuYWRkQ2FtZXJhIiwiQ3ViZU1hcFNoYWRvd01hcHBlci5wQ3JlYXRlRGVwdGhUZXh0dXJlIiwiQ3ViZU1hcFNoYWRvd01hcHBlci5wVXBkYXRlRGVwdGhQcm9qZWN0aW9uIiwiQ3ViZU1hcFNoYWRvd01hcHBlci5wRHJhd0RlcHRoTWFwIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFDQSxJQUFPLDBCQUEwQixXQUFXLG1EQUFtRCxDQUFDLENBQUM7QUFJakcsSUFBTyxNQUFNLFdBQWdCLG9DQUFvQyxDQUFDLENBQUM7QUFFbkUsSUFBTyxnQkFBZ0IsV0FBYyw2REFBNkQsQ0FBQyxDQUFDO0FBS3BHLElBQU0sbUJBQW1CO0lBQVNBLFVBQTVCQSxtQkFBbUJBLFVBQXlCQTtJQU1qREEsU0FOS0EsbUJBQW1CQTtRQVF2QkMsaUJBQU9BLENBQUNBO1FBRVJBLElBQUlBLENBQUNBLGNBQWNBLEdBQUdBLEdBQUdBLENBQUNBO1FBQzFCQSxJQUFJQSxDQUFDQSxZQUFZQSxHQUFHQSxJQUFJQSxLQUFLQSxFQUFFQSxDQUFDQTtRQUNoQ0EsSUFBSUEsQ0FBQ0EsV0FBV0EsRUFBRUEsQ0FBQ0E7SUFDcEJBLENBQUNBO0lBRU9ELHlDQUFXQSxHQUFuQkE7UUFFQ0UsSUFBSUEsQ0FBQ0EsYUFBYUEsR0FBR0EsSUFBSUEsS0FBS0EsRUFBRUEsQ0FBQ0E7UUFDakNBLElBQUlBLENBQUNBLFlBQVlBLEdBQUdBLElBQUlBLEtBQUtBLEVBQUVBLENBQUNBO1FBRWhDQSxBQUNBQSxxQ0FEcUNBO1FBQ3JDQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQSxFQUFFQSxFQUFFQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUN6QkEsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDMUJBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1FBQzFCQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUN6QkEsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDeEJBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLENBQUNBLEVBQUVBLEdBQUdBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO0lBQzNCQSxDQUFDQTtJQUVPRix1Q0FBU0EsR0FBakJBLFVBQWtCQSxTQUFnQkEsRUFBRUEsU0FBZ0JBLEVBQUVBLFNBQWdCQTtRQUVyRUcsSUFBSUEsR0FBR0EsR0FBVUEsSUFBSUEsTUFBTUEsRUFBRUEsQ0FBQ0E7UUFDOUJBLEdBQUdBLENBQUNBLFNBQVNBLEdBQUdBLFNBQVNBLENBQUNBO1FBQzFCQSxHQUFHQSxDQUFDQSxTQUFTQSxHQUFHQSxTQUFTQSxDQUFDQTtRQUMxQkEsR0FBR0EsQ0FBQ0EsU0FBU0EsR0FBR0EsU0FBU0EsQ0FBQ0E7UUFDMUJBLEdBQUdBLENBQUNBLFVBQVVBLENBQUNBLElBQUlBLEdBQUdBLEdBQUdBLENBQUNBO1FBRTFCQSxJQUFJQSxVQUFVQSxHQUFpREEsR0FBR0EsQ0FBQ0EsVUFBVUEsQ0FBQ0E7UUFDOUVBLFVBQVVBLENBQUNBLFdBQVdBLEdBQUdBLEVBQUVBLENBQUNBO1FBQzVCQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxDQUFDQTtRQUNuQ0EsR0FBR0EsQ0FBQ0EsVUFBVUEsQ0FBQ0EsYUFBYUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDakNBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO0lBQzlCQSxDQUFDQTtJQUVESCxXQUFXQTtJQUNKQSxpREFBbUJBLEdBQTFCQTtRQUVDSSxNQUFNQSxJQUFJQSwwQkFBMEJBLEVBQUVBLENBQUNBO1FBQ3ZDQTs7V0FFR0E7SUFDSkEsQ0FBQ0E7SUFFREosV0FBV0E7SUFDSkEsb0RBQXNCQSxHQUE3QkEsVUFBOEJBLFVBQWlCQTtRQUU5Q0ssSUFBSUEsS0FBS0EsR0FBMEJBLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLENBQUNBO1FBQ2xEQSxJQUFJQSxXQUFXQSxHQUFVQSxLQUFLQSxDQUFDQSxTQUFTQSxDQUFDQTtRQUN6Q0EsSUFBSUEsR0FBR0EsR0FBWUEsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsYUFBYUEsQ0FBQ0E7UUFHOUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQVVBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBO1lBQ25DQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxXQUFXQSxDQUFDQTtZQUN2Q0EsSUFBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsU0FBU0EsQ0FBQ0EsUUFBUUEsR0FBR0EsR0FBR0EsQ0FBQ0E7WUFDL0NBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBO1FBQzdCQSxDQUFDQTtJQUNGQSxDQUFDQTtJQUVETCxXQUFXQTtJQUNKQSwyQ0FBYUEsR0FBcEJBLFVBQXFCQSxNQUFvQkEsRUFBRUEsS0FBV0EsRUFBRUEsUUFBa0JBO1FBRXpFTSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFVQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQTtZQUNuQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQzFCQSxJQUFJQSxDQUFDQSxpQkFBaUJBLENBQUNBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO2dCQUN0REEsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxLQUFLQSxFQUFFQSxDQUFDQTtnQkFDL0JBLEtBQUtBLENBQUNBLGtCQUFrQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxDQUFDQTtnQkFDakRBLFFBQVFBLENBQUNBLFFBQVFBLENBQUNBLElBQUlBLENBQUNBLGlCQUFpQkEsRUFBRUEsTUFBTUEsRUFBRUEsSUFBSUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQUE7WUFDM0RBLENBQUNBO1FBQ0ZBLENBQUNBO0lBQ0ZBLENBQUNBO0lBQ0ZOLDBCQUFDQTtBQUFEQSxDQWhGQSxBQWdGQ0EsRUFoRmlDLGdCQUFnQixFQWdGakQ7QUFFRCxBQUE2QixpQkFBcEIsbUJBQW1CLENBQUMiLCJmaWxlIjoibWF0ZXJpYWxzL3NoYWRvd21hcHBlcnMvQ3ViZU1hcFNoYWRvd01hcHBlci5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgVmVjdG9yM0RcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9WZWN0b3IzRFwiKTtcclxuaW1wb3J0IFBhcnRpYWxJbXBsZW1lbnRhdGlvbkVycm9yXHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZXJyb3JzL1BhcnRpYWxJbXBsZW1lbnRhdGlvbkVycm9yXCIpO1xyXG5pbXBvcnQgUGVyc3BlY3RpdmVQcm9qZWN0aW9uXHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9wcm9qZWN0aW9ucy9QZXJzcGVjdGl2ZVByb2plY3Rpb25cIik7XHJcblxyXG5pbXBvcnQgU2NlbmVcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvY29udGFpbmVycy9TY2VuZVwiKTtcclxuaW1wb3J0IENhbWVyYVx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9DYW1lcmFcIik7XHJcbmltcG9ydCBQb2ludExpZ2h0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9Qb2ludExpZ2h0XCIpO1xyXG5pbXBvcnQgU2hhZG93TWFwcGVyQmFzZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL21hdGVyaWFscy9zaGFkb3dtYXBwZXJzL1NoYWRvd01hcHBlckJhc2VcIik7XHJcbmltcG9ydCBJUmVuZGVyZXJcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL3JlbmRlci9JUmVuZGVyZXJcIik7XHJcbmltcG9ydCBSZW5kZXJUZXh0dXJlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvdGV4dHVyZXMvUmVuZGVyVGV4dHVyZVwiKTtcclxuaW1wb3J0IFRleHR1cmVCYXNlXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi90ZXh0dXJlcy9UZXh0dXJlQmFzZVwiKTtcclxuXHJcbmNsYXNzIEN1YmVNYXBTaGFkb3dNYXBwZXIgZXh0ZW5kcyBTaGFkb3dNYXBwZXJCYXNlXHJcbntcclxuXHRwcml2YXRlIF9kZXB0aENhbWVyYXM6QXJyYXk8Q2FtZXJhPjtcclxuXHRwcml2YXRlIF9wcm9qZWN0aW9uczpBcnJheTxQZXJzcGVjdGl2ZVByb2plY3Rpb24+O1xyXG5cdHByaXZhdGUgX25lZWRzUmVuZGVyOkFycmF5PGJvb2xlYW4+O1xyXG5cclxuXHRjb25zdHJ1Y3RvcigpXHJcblx0e1xyXG5cdFx0c3VwZXIoKTtcclxuXHJcblx0XHR0aGlzLl9wRGVwdGhNYXBTaXplID0gNTEyO1xyXG5cdFx0dGhpcy5fbmVlZHNSZW5kZXIgPSBuZXcgQXJyYXkoKTtcclxuXHRcdHRoaXMuaW5pdENhbWVyYXMoKTtcclxuXHR9XHJcblxyXG5cdHByaXZhdGUgaW5pdENhbWVyYXMoKVxyXG5cdHtcclxuXHRcdHRoaXMuX2RlcHRoQ2FtZXJhcyA9IG5ldyBBcnJheSgpO1xyXG5cdFx0dGhpcy5fcHJvamVjdGlvbnMgPSBuZXcgQXJyYXkoKTtcclxuXHJcblx0XHQvLyBwb3NYLCBuZWdYLCBwb3NZLCBuZWdZLCBwb3NaLCBuZWdaXHJcblx0XHR0aGlzLmFkZENhbWVyYSgwLCA5MCwgMCk7XHJcblx0XHR0aGlzLmFkZENhbWVyYSgwLCAtOTAsIDApO1xyXG5cdFx0dGhpcy5hZGRDYW1lcmEoLTkwLCAwLCAwKTtcclxuXHRcdHRoaXMuYWRkQ2FtZXJhKDkwLCAwLCAwKTtcclxuXHRcdHRoaXMuYWRkQ2FtZXJhKDAsIDAsIDApO1xyXG5cdFx0dGhpcy5hZGRDYW1lcmEoMCwgMTgwLCAwKTtcclxuXHR9XHJcblxyXG5cdHByaXZhdGUgYWRkQ2FtZXJhKHJvdGF0aW9uWDpudW1iZXIsIHJvdGF0aW9uWTpudW1iZXIsIHJvdGF0aW9uWjpudW1iZXIpXHJcblx0e1xyXG5cdFx0dmFyIGNhbTpDYW1lcmEgPSBuZXcgQ2FtZXJhKCk7XHJcblx0XHRjYW0ucm90YXRpb25YID0gcm90YXRpb25YO1xyXG5cdFx0Y2FtLnJvdGF0aW9uWSA9IHJvdGF0aW9uWTtcclxuXHRcdGNhbS5yb3RhdGlvblogPSByb3RhdGlvblo7XHJcblx0XHRjYW0ucHJvamVjdGlvbi5uZWFyID0gLjAxO1xyXG5cclxuXHRcdHZhciBwcm9qZWN0aW9uOlBlcnNwZWN0aXZlUHJvamVjdGlvbiA9IDxQZXJzcGVjdGl2ZVByb2plY3Rpb24+IGNhbS5wcm9qZWN0aW9uO1xyXG5cdFx0cHJvamVjdGlvbi5maWVsZE9mVmlldyA9IDkwO1xyXG5cdFx0dGhpcy5fcHJvamVjdGlvbnMucHVzaChwcm9qZWN0aW9uKTtcclxuXHRcdGNhbS5wcm9qZWN0aW9uLl9pQXNwZWN0UmF0aW8gPSAxO1xyXG5cdFx0dGhpcy5fZGVwdGhDYW1lcmFzLnB1c2goY2FtKTtcclxuXHR9XHJcblxyXG5cdC8vQG92ZXJyaWRlXHJcblx0cHVibGljIHBDcmVhdGVEZXB0aFRleHR1cmUoKTpUZXh0dXJlQmFzZVxyXG5cdHtcclxuXHRcdHRocm93IG5ldyBQYXJ0aWFsSW1wbGVtZW50YXRpb25FcnJvcigpO1xyXG5cdFx0LypcclxuXHRcdCByZXR1cm4gbmV3IFJlbmRlckN1YmVUZXh0dXJlKCB0aGlzLl9kZXB0aE1hcFNpemUgKTtcclxuXHRcdCAqL1xyXG5cdH1cclxuXHJcblx0Ly9Ab3ZlcnJpZGVcclxuXHRwdWJsaWMgcFVwZGF0ZURlcHRoUHJvamVjdGlvbih2aWV3Q2FtZXJhOkNhbWVyYSlcclxuXHR7XHJcblx0XHR2YXIgbGlnaHQ6UG9pbnRMaWdodCA9IDxQb2ludExpZ2h0Pih0aGlzLl9wTGlnaHQpO1xyXG5cdFx0dmFyIG1heERpc3RhbmNlOm51bWJlciA9IGxpZ2h0Ll9wRmFsbE9mZjtcclxuXHRcdHZhciBwb3M6VmVjdG9yM0QgPSB0aGlzLl9wTGlnaHQuc2NlbmVQb3NpdGlvbjtcclxuXHJcblx0XHQvLyB0b2RvOiBmYWNlcyBvdXRzaWRlIGZydXN0dW0gd2hpY2ggYXJlIHBvaW50aW5nIGF3YXkgZnJvbSBjYW1lcmEgbmVlZCBub3QgYmUgcmVuZGVyZWQhXHJcblx0XHRmb3IgKHZhciBpOm51bWJlciA9IDA7IGkgPCA2OyArK2kpIHtcclxuXHRcdFx0dGhpcy5fcHJvamVjdGlvbnNbaV0uZmFyID0gbWF4RGlzdGFuY2U7XHJcblx0XHRcdHRoaXMuX2RlcHRoQ2FtZXJhc1tpXS50cmFuc2Zvcm0ucG9zaXRpb24gPSBwb3M7XHJcblx0XHRcdHRoaXMuX25lZWRzUmVuZGVyW2ldID0gdHJ1ZTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8vQG92ZXJyaWRlXHJcblx0cHVibGljIHBEcmF3RGVwdGhNYXAodGFyZ2V0OlJlbmRlclRleHR1cmUsIHNjZW5lOlNjZW5lLCByZW5kZXJlcjpJUmVuZGVyZXIpXHJcblx0e1xyXG5cdFx0Zm9yICh2YXIgaTpudW1iZXIgPSAwOyBpIDwgNjsgKytpKSB7XHJcblx0XHRcdGlmICh0aGlzLl9uZWVkc1JlbmRlcltpXSkge1xyXG5cdFx0XHRcdHRoaXMuX3BDYXN0ZXJDb2xsZWN0b3IuY2FtZXJhID0gdGhpcy5fZGVwdGhDYW1lcmFzW2ldO1xyXG5cdFx0XHRcdHRoaXMuX3BDYXN0ZXJDb2xsZWN0b3IuY2xlYXIoKTtcclxuXHRcdFx0XHRzY2VuZS50cmF2ZXJzZVBhcnRpdGlvbnModGhpcy5fcENhc3RlckNvbGxlY3Rvcik7XHJcblx0XHRcdFx0cmVuZGVyZXIuX2lSZW5kZXIodGhpcy5fcENhc3RlckNvbGxlY3RvciwgdGFyZ2V0LCBudWxsLCBpKVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG59XHJcblxyXG5leHBvcnQgPSBDdWJlTWFwU2hhZG93TWFwcGVyOyJdfQ==