var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var PartialImplementationError = require("awayjs-core/lib/errors/PartialImplementationError");
var Camera = require("awayjs-display/lib/entities/Camera");
var ShadowMapperBase = require("awayjs-display/lib/materials/shadowmappers/ShadowMapperBase");
var CubeMapShadowMapper = (function (_super) {
    __extends(CubeMapShadowMapper, _super);
    function CubeMapShadowMapper() {
        _super.call(this);
        this._pDepthMapSize = 512;
        this._needsRender = new Array();
        this.initCameras();
    }
    CubeMapShadowMapper.prototype.initCameras = function () {
        this._depthCameras = new Array();
        this._projections = new Array();
        // posX, negX, posY, negY, posZ, negZ
        this.addCamera(0, 90, 0);
        this.addCamera(0, -90, 0);
        this.addCamera(-90, 0, 0);
        this.addCamera(90, 0, 0);
        this.addCamera(0, 0, 0);
        this.addCamera(0, 180, 0);
    };
    CubeMapShadowMapper.prototype.addCamera = function (rotationX, rotationY, rotationZ) {
        var cam = new Camera();
        cam.rotationX = rotationX;
        cam.rotationY = rotationY;
        cam.rotationZ = rotationZ;
        cam.projection.near = .01;
        var projection = cam.projection;
        projection.fieldOfView = 90;
        this._projections.push(projection);
        cam.projection._iAspectRatio = 1;
        this._depthCameras.push(cam);
    };
    //@override
    CubeMapShadowMapper.prototype.pCreateDepthTexture = function () {
        throw new PartialImplementationError();
        /*
         return new RenderCubeTexture( this._depthMapSize );
         */
    };
    //@override
    CubeMapShadowMapper.prototype.pUpdateDepthProjection = function (viewCamera) {
        var light = (this._pLight);
        var maxDistance = light._pFallOff;
        var pos = this._pLight.scenePosition;
        for (var i = 0; i < 6; ++i) {
            this._projections[i].far = maxDistance;
            this._depthCameras[i].transform.position = pos;
            this._needsRender[i] = true;
        }
    };
    //@override
    CubeMapShadowMapper.prototype.pDrawDepthMap = function (target, scene, renderer) {
        for (var i = 0; i < 6; ++i) {
            if (this._needsRender[i]) {
                this._pCasterCollector.camera = this._depthCameras[i];
                this._pCasterCollector.clear();
                scene.traversePartitions(this._pCasterCollector);
                renderer._iRender(this._pCasterCollector, target, null, i);
            }
        }
    };
    return CubeMapShadowMapper;
})(ShadowMapperBase);
module.exports = CubeMapShadowMapper;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1kaXNwbGF5L2xpYi9tYXRlcmlhbHMvc2hhZG93bWFwcGVycy9DdWJlTWFwU2hhZG93TWFwcGVyLnRzIl0sIm5hbWVzIjpbIkN1YmVNYXBTaGFkb3dNYXBwZXIiLCJDdWJlTWFwU2hhZG93TWFwcGVyLmNvbnN0cnVjdG9yIiwiQ3ViZU1hcFNoYWRvd01hcHBlci5pbml0Q2FtZXJhcyIsIkN1YmVNYXBTaGFkb3dNYXBwZXIuYWRkQ2FtZXJhIiwiQ3ViZU1hcFNoYWRvd01hcHBlci5wQ3JlYXRlRGVwdGhUZXh0dXJlIiwiQ3ViZU1hcFNoYWRvd01hcHBlci5wVXBkYXRlRGVwdGhQcm9qZWN0aW9uIiwiQ3ViZU1hcFNoYWRvd01hcHBlci5wRHJhd0RlcHRoTWFwIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFDQSxJQUFPLDBCQUEwQixXQUFXLG1EQUFtRCxDQUFDLENBQUM7QUFJakcsSUFBTyxNQUFNLFdBQWdCLG9DQUFvQyxDQUFDLENBQUM7QUFFbkUsSUFBTyxnQkFBZ0IsV0FBYyw2REFBNkQsQ0FBQyxDQUFDO0FBS3BHLElBQU0sbUJBQW1CO0lBQVNBLFVBQTVCQSxtQkFBbUJBLFVBQXlCQTtJQU1qREEsU0FOS0EsbUJBQW1CQTtRQVF2QkMsaUJBQU9BLENBQUNBO1FBRVJBLElBQUlBLENBQUNBLGNBQWNBLEdBQUdBLEdBQUdBLENBQUNBO1FBQzFCQSxJQUFJQSxDQUFDQSxZQUFZQSxHQUFHQSxJQUFJQSxLQUFLQSxFQUFFQSxDQUFDQTtRQUNoQ0EsSUFBSUEsQ0FBQ0EsV0FBV0EsRUFBRUEsQ0FBQ0E7SUFDcEJBLENBQUNBO0lBRU9ELHlDQUFXQSxHQUFuQkE7UUFFQ0UsSUFBSUEsQ0FBQ0EsYUFBYUEsR0FBR0EsSUFBSUEsS0FBS0EsRUFBRUEsQ0FBQ0E7UUFDakNBLElBQUlBLENBQUNBLFlBQVlBLEdBQUdBLElBQUlBLEtBQUtBLEVBQUVBLENBQUNBO1FBRWhDQSxBQUNBQSxxQ0FEcUNBO1FBQ3JDQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQSxFQUFFQSxFQUFFQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUN6QkEsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDMUJBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1FBQzFCQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUN6QkEsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDeEJBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLENBQUNBLEVBQUVBLEdBQUdBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO0lBQzNCQSxDQUFDQTtJQUVPRix1Q0FBU0EsR0FBakJBLFVBQWtCQSxTQUFnQkEsRUFBRUEsU0FBZ0JBLEVBQUVBLFNBQWdCQTtRQUVyRUcsSUFBSUEsR0FBR0EsR0FBVUEsSUFBSUEsTUFBTUEsRUFBRUEsQ0FBQ0E7UUFDOUJBLEdBQUdBLENBQUNBLFNBQVNBLEdBQUdBLFNBQVNBLENBQUNBO1FBQzFCQSxHQUFHQSxDQUFDQSxTQUFTQSxHQUFHQSxTQUFTQSxDQUFDQTtRQUMxQkEsR0FBR0EsQ0FBQ0EsU0FBU0EsR0FBR0EsU0FBU0EsQ0FBQ0E7UUFDMUJBLEdBQUdBLENBQUNBLFVBQVVBLENBQUNBLElBQUlBLEdBQUdBLEdBQUdBLENBQUNBO1FBRTFCQSxJQUFJQSxVQUFVQSxHQUFpREEsR0FBR0EsQ0FBQ0EsVUFBVUEsQ0FBQ0E7UUFDOUVBLFVBQVVBLENBQUNBLFdBQVdBLEdBQUdBLEVBQUVBLENBQUNBO1FBQzVCQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxDQUFDQTtRQUNuQ0EsR0FBR0EsQ0FBQ0EsVUFBVUEsQ0FBQ0EsYUFBYUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDakNBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO0lBQzlCQSxDQUFDQTtJQUVESCxXQUFXQTtJQUNKQSxpREFBbUJBLEdBQTFCQTtRQUVDSSxNQUFNQSxJQUFJQSwwQkFBMEJBLEVBQUVBLENBQUNBO1FBQ3ZDQTs7V0FFR0E7SUFDSkEsQ0FBQ0E7SUFFREosV0FBV0E7SUFDSkEsb0RBQXNCQSxHQUE3QkEsVUFBOEJBLFVBQWlCQTtRQUU5Q0ssSUFBSUEsS0FBS0EsR0FBMEJBLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLENBQUNBO1FBQ2xEQSxJQUFJQSxXQUFXQSxHQUFVQSxLQUFLQSxDQUFDQSxTQUFTQSxDQUFDQTtRQUN6Q0EsSUFBSUEsR0FBR0EsR0FBWUEsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsYUFBYUEsQ0FBQ0E7UUFHOUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQVVBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBO1lBQ25DQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxXQUFXQSxDQUFDQTtZQUN2Q0EsSUFBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsU0FBU0EsQ0FBQ0EsUUFBUUEsR0FBR0EsR0FBR0EsQ0FBQ0E7WUFDL0NBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBO1FBQzdCQSxDQUFDQTtJQUNGQSxDQUFDQTtJQUVETCxXQUFXQTtJQUNKQSwyQ0FBYUEsR0FBcEJBLFVBQXFCQSxNQUFvQkEsRUFBRUEsS0FBV0EsRUFBRUEsUUFBa0JBO1FBRXpFTSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFVQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQTtZQUNuQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQzFCQSxJQUFJQSxDQUFDQSxpQkFBaUJBLENBQUNBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO2dCQUN0REEsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxLQUFLQSxFQUFFQSxDQUFDQTtnQkFDL0JBLEtBQUtBLENBQUNBLGtCQUFrQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxDQUFDQTtnQkFDakRBLFFBQVFBLENBQUNBLFFBQVFBLENBQUNBLElBQUlBLENBQUNBLGlCQUFpQkEsRUFBRUEsTUFBTUEsRUFBRUEsSUFBSUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQUE7WUFDM0RBLENBQUNBO1FBQ0ZBLENBQUNBO0lBQ0ZBLENBQUNBO0lBQ0ZOLDBCQUFDQTtBQUFEQSxDQWhGQSxBQWdGQ0EsRUFoRmlDLGdCQUFnQixFQWdGakQ7QUFFRCxBQUE2QixpQkFBcEIsbUJBQW1CLENBQUMiLCJmaWxlIjoibWF0ZXJpYWxzL3NoYWRvd21hcHBlcnMvQ3ViZU1hcFNoYWRvd01hcHBlci5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgVmVjdG9yM0RcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9WZWN0b3IzRFwiKTtcbmltcG9ydCBQYXJ0aWFsSW1wbGVtZW50YXRpb25FcnJvclx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2Vycm9ycy9QYXJ0aWFsSW1wbGVtZW50YXRpb25FcnJvclwiKTtcbmltcG9ydCBQZXJzcGVjdGl2ZVByb2plY3Rpb25cdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL3Byb2plY3Rpb25zL1BlcnNwZWN0aXZlUHJvamVjdGlvblwiKTtcblxuaW1wb3J0IFNjZW5lXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2NvbnRhaW5lcnMvU2NlbmVcIik7XG5pbXBvcnQgQ2FtZXJhXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL0NhbWVyYVwiKTtcbmltcG9ydCBQb2ludExpZ2h0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9Qb2ludExpZ2h0XCIpO1xuaW1wb3J0IFNoYWRvd01hcHBlckJhc2VcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9tYXRlcmlhbHMvc2hhZG93bWFwcGVycy9TaGFkb3dNYXBwZXJCYXNlXCIpO1xuaW1wb3J0IElSZW5kZXJlclx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvcmVuZGVyL0lSZW5kZXJlclwiKTtcbmltcG9ydCBSZW5kZXJUZXh0dXJlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvdGV4dHVyZXMvUmVuZGVyVGV4dHVyZVwiKTtcbmltcG9ydCBUZXh0dXJlUHJveHlCYXNlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvdGV4dHVyZXMvVGV4dHVyZVByb3h5QmFzZVwiKTtcblxuY2xhc3MgQ3ViZU1hcFNoYWRvd01hcHBlciBleHRlbmRzIFNoYWRvd01hcHBlckJhc2Vcbntcblx0cHJpdmF0ZSBfZGVwdGhDYW1lcmFzOkFycmF5PENhbWVyYT47XG5cdHByaXZhdGUgX3Byb2plY3Rpb25zOkFycmF5PFBlcnNwZWN0aXZlUHJvamVjdGlvbj47XG5cdHByaXZhdGUgX25lZWRzUmVuZGVyOkFycmF5PGJvb2xlYW4+O1xuXG5cdGNvbnN0cnVjdG9yKClcblx0e1xuXHRcdHN1cGVyKCk7XG5cblx0XHR0aGlzLl9wRGVwdGhNYXBTaXplID0gNTEyO1xuXHRcdHRoaXMuX25lZWRzUmVuZGVyID0gbmV3IEFycmF5KCk7XG5cdFx0dGhpcy5pbml0Q2FtZXJhcygpO1xuXHR9XG5cblx0cHJpdmF0ZSBpbml0Q2FtZXJhcygpXG5cdHtcblx0XHR0aGlzLl9kZXB0aENhbWVyYXMgPSBuZXcgQXJyYXkoKTtcblx0XHR0aGlzLl9wcm9qZWN0aW9ucyA9IG5ldyBBcnJheSgpO1xuXG5cdFx0Ly8gcG9zWCwgbmVnWCwgcG9zWSwgbmVnWSwgcG9zWiwgbmVnWlxuXHRcdHRoaXMuYWRkQ2FtZXJhKDAsIDkwLCAwKTtcblx0XHR0aGlzLmFkZENhbWVyYSgwLCAtOTAsIDApO1xuXHRcdHRoaXMuYWRkQ2FtZXJhKC05MCwgMCwgMCk7XG5cdFx0dGhpcy5hZGRDYW1lcmEoOTAsIDAsIDApO1xuXHRcdHRoaXMuYWRkQ2FtZXJhKDAsIDAsIDApO1xuXHRcdHRoaXMuYWRkQ2FtZXJhKDAsIDE4MCwgMCk7XG5cdH1cblxuXHRwcml2YXRlIGFkZENhbWVyYShyb3RhdGlvblg6bnVtYmVyLCByb3RhdGlvblk6bnVtYmVyLCByb3RhdGlvblo6bnVtYmVyKVxuXHR7XG5cdFx0dmFyIGNhbTpDYW1lcmEgPSBuZXcgQ2FtZXJhKCk7XG5cdFx0Y2FtLnJvdGF0aW9uWCA9IHJvdGF0aW9uWDtcblx0XHRjYW0ucm90YXRpb25ZID0gcm90YXRpb25ZO1xuXHRcdGNhbS5yb3RhdGlvblogPSByb3RhdGlvblo7XG5cdFx0Y2FtLnByb2plY3Rpb24ubmVhciA9IC4wMTtcblxuXHRcdHZhciBwcm9qZWN0aW9uOlBlcnNwZWN0aXZlUHJvamVjdGlvbiA9IDxQZXJzcGVjdGl2ZVByb2plY3Rpb24+IGNhbS5wcm9qZWN0aW9uO1xuXHRcdHByb2plY3Rpb24uZmllbGRPZlZpZXcgPSA5MDtcblx0XHR0aGlzLl9wcm9qZWN0aW9ucy5wdXNoKHByb2plY3Rpb24pO1xuXHRcdGNhbS5wcm9qZWN0aW9uLl9pQXNwZWN0UmF0aW8gPSAxO1xuXHRcdHRoaXMuX2RlcHRoQ2FtZXJhcy5wdXNoKGNhbSk7XG5cdH1cblxuXHQvL0BvdmVycmlkZVxuXHRwdWJsaWMgcENyZWF0ZURlcHRoVGV4dHVyZSgpOlRleHR1cmVQcm94eUJhc2Vcblx0e1xuXHRcdHRocm93IG5ldyBQYXJ0aWFsSW1wbGVtZW50YXRpb25FcnJvcigpO1xuXHRcdC8qXG5cdFx0IHJldHVybiBuZXcgUmVuZGVyQ3ViZVRleHR1cmUoIHRoaXMuX2RlcHRoTWFwU2l6ZSApO1xuXHRcdCAqL1xuXHR9XG5cblx0Ly9Ab3ZlcnJpZGVcblx0cHVibGljIHBVcGRhdGVEZXB0aFByb2plY3Rpb24odmlld0NhbWVyYTpDYW1lcmEpXG5cdHtcblx0XHR2YXIgbGlnaHQ6UG9pbnRMaWdodCA9IDxQb2ludExpZ2h0Pih0aGlzLl9wTGlnaHQpO1xuXHRcdHZhciBtYXhEaXN0YW5jZTpudW1iZXIgPSBsaWdodC5fcEZhbGxPZmY7XG5cdFx0dmFyIHBvczpWZWN0b3IzRCA9IHRoaXMuX3BMaWdodC5zY2VuZVBvc2l0aW9uO1xuXG5cdFx0Ly8gdG9kbzogZmFjZXMgb3V0c2lkZSBmcnVzdHVtIHdoaWNoIGFyZSBwb2ludGluZyBhd2F5IGZyb20gY2FtZXJhIG5lZWQgbm90IGJlIHJlbmRlcmVkIVxuXHRcdGZvciAodmFyIGk6bnVtYmVyID0gMDsgaSA8IDY7ICsraSkge1xuXHRcdFx0dGhpcy5fcHJvamVjdGlvbnNbaV0uZmFyID0gbWF4RGlzdGFuY2U7XG5cdFx0XHR0aGlzLl9kZXB0aENhbWVyYXNbaV0udHJhbnNmb3JtLnBvc2l0aW9uID0gcG9zO1xuXHRcdFx0dGhpcy5fbmVlZHNSZW5kZXJbaV0gPSB0cnVlO1xuXHRcdH1cblx0fVxuXG5cdC8vQG92ZXJyaWRlXG5cdHB1YmxpYyBwRHJhd0RlcHRoTWFwKHRhcmdldDpSZW5kZXJUZXh0dXJlLCBzY2VuZTpTY2VuZSwgcmVuZGVyZXI6SVJlbmRlcmVyKVxuXHR7XG5cdFx0Zm9yICh2YXIgaTpudW1iZXIgPSAwOyBpIDwgNjsgKytpKSB7XG5cdFx0XHRpZiAodGhpcy5fbmVlZHNSZW5kZXJbaV0pIHtcblx0XHRcdFx0dGhpcy5fcENhc3RlckNvbGxlY3Rvci5jYW1lcmEgPSB0aGlzLl9kZXB0aENhbWVyYXNbaV07XG5cdFx0XHRcdHRoaXMuX3BDYXN0ZXJDb2xsZWN0b3IuY2xlYXIoKTtcblx0XHRcdFx0c2NlbmUudHJhdmVyc2VQYXJ0aXRpb25zKHRoaXMuX3BDYXN0ZXJDb2xsZWN0b3IpO1xuXHRcdFx0XHRyZW5kZXJlci5faVJlbmRlcih0aGlzLl9wQ2FzdGVyQ29sbGVjdG9yLCB0YXJnZXQsIG51bGwsIGkpXG5cdFx0XHR9XG5cdFx0fVxuXHR9XG59XG5cbmV4cG9ydCA9IEN1YmVNYXBTaGFkb3dNYXBwZXI7Il19