var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var PartialImplementationError = require("awayjs-core/lib/errors/PartialImplementationError");
var Camera = require("awayjs-display/lib/entities/Camera");
var ShadowMapperBase = require("awayjs-display/lib/materials/shadowmappers/ShadowMapperBase");
var CubeMapShadowMapper = (function (_super) {
    __extends(CubeMapShadowMapper, _super);
    function CubeMapShadowMapper() {
        _super.call(this);
        this._pDepthMapSize = 512;
        this._needsRender = new Array();
        this.initCameras();
    }
    CubeMapShadowMapper.prototype.initCameras = function () {
        this._depthCameras = new Array();
        this._projections = new Array();
        // posX, negX, posY, negY, posZ, negZ
        this.addCamera(0, 90, 0);
        this.addCamera(0, -90, 0);
        this.addCamera(-90, 0, 0);
        this.addCamera(90, 0, 0);
        this.addCamera(0, 0, 0);
        this.addCamera(0, 180, 0);
    };
    CubeMapShadowMapper.prototype.addCamera = function (rotationX, rotationY, rotationZ) {
        var cam = new Camera();
        cam.rotationX = rotationX;
        cam.rotationY = rotationY;
        cam.rotationZ = rotationZ;
        cam.projection.near = .01;
        var projection = cam.projection;
        projection.fieldOfView = 90;
        this._projections.push(projection);
        cam.projection._iAspectRatio = 1;
        this._depthCameras.push(cam);
    };
    //@override
    CubeMapShadowMapper.prototype.pCreateDepthTexture = function () {
        throw new PartialImplementationError();
        /*
         return new RenderCubeTexture( this._depthMapSize );
         */
    };
    //@override
    CubeMapShadowMapper.prototype.pUpdateDepthProjection = function (viewCamera) {
        var light = (this._pLight);
        var maxDistance = light._pFallOff;
        var pos = this._pLight.scenePosition;
        for (var i = 0; i < 6; ++i) {
            this._projections[i].far = maxDistance;
            this._depthCameras[i].transform.position = pos;
            this._needsRender[i] = true;
        }
    };
    //@override
    CubeMapShadowMapper.prototype.pDrawDepthMap = function (target, scene, renderer) {
        for (var i = 0; i < 6; ++i) {
            if (this._needsRender[i]) {
                this._pCasterCollector.camera = this._depthCameras[i];
                this._pCasterCollector.clear();
                scene.traversePartitions(this._pCasterCollector);
                renderer._iRender(this._pCasterCollector, target, null, i);
            }
        }
    };
    return CubeMapShadowMapper;
})(ShadowMapperBase);
module.exports = CubeMapShadowMapper;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1kaXNwbGF5L2xpYi9tYXRlcmlhbHMvc2hhZG93bWFwcGVycy9DdWJlTWFwU2hhZG93TWFwcGVyLnRzIl0sIm5hbWVzIjpbIkN1YmVNYXBTaGFkb3dNYXBwZXIiLCJDdWJlTWFwU2hhZG93TWFwcGVyLmNvbnN0cnVjdG9yIiwiQ3ViZU1hcFNoYWRvd01hcHBlci5pbml0Q2FtZXJhcyIsIkN1YmVNYXBTaGFkb3dNYXBwZXIuYWRkQ2FtZXJhIiwiQ3ViZU1hcFNoYWRvd01hcHBlci5wQ3JlYXRlRGVwdGhUZXh0dXJlIiwiQ3ViZU1hcFNoYWRvd01hcHBlci5wVXBkYXRlRGVwdGhQcm9qZWN0aW9uIiwiQ3ViZU1hcFNoYWRvd01hcHBlci5wRHJhd0RlcHRoTWFwIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFDQSxJQUFPLDBCQUEwQixXQUFXLG1EQUFtRCxDQUFDLENBQUM7QUFJakcsSUFBTyxNQUFNLFdBQWdCLG9DQUFvQyxDQUFDLENBQUM7QUFFbkUsSUFBTyxnQkFBZ0IsV0FBYyw2REFBNkQsQ0FBQyxDQUFDO0FBS3BHLElBQU0sbUJBQW1CO0lBQVNBLFVBQTVCQSxtQkFBbUJBLFVBQXlCQTtJQU1qREEsU0FOS0EsbUJBQW1CQTtRQVF2QkMsaUJBQU9BLENBQUNBO1FBRVJBLElBQUlBLENBQUNBLGNBQWNBLEdBQUdBLEdBQUdBLENBQUNBO1FBQzFCQSxJQUFJQSxDQUFDQSxZQUFZQSxHQUFHQSxJQUFJQSxLQUFLQSxFQUFFQSxDQUFDQTtRQUNoQ0EsSUFBSUEsQ0FBQ0EsV0FBV0EsRUFBRUEsQ0FBQ0E7SUFDcEJBLENBQUNBO0lBRU9ELHlDQUFXQSxHQUFuQkE7UUFFQ0UsSUFBSUEsQ0FBQ0EsYUFBYUEsR0FBR0EsSUFBSUEsS0FBS0EsRUFBRUEsQ0FBQ0E7UUFDakNBLElBQUlBLENBQUNBLFlBQVlBLEdBQUdBLElBQUlBLEtBQUtBLEVBQUVBLENBQUNBO1FBRWhDQSxBQUNBQSxxQ0FEcUNBO1FBQ3JDQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQSxFQUFFQSxFQUFFQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUN6QkEsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDMUJBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1FBQzFCQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUN6QkEsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDeEJBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLENBQUNBLEVBQUVBLEdBQUdBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO0lBQzNCQSxDQUFDQTtJQUVPRix1Q0FBU0EsR0FBakJBLFVBQWtCQSxTQUFnQkEsRUFBRUEsU0FBZ0JBLEVBQUVBLFNBQWdCQTtRQUVyRUcsSUFBSUEsR0FBR0EsR0FBVUEsSUFBSUEsTUFBTUEsRUFBRUEsQ0FBQ0E7UUFDOUJBLEdBQUdBLENBQUNBLFNBQVNBLEdBQUdBLFNBQVNBLENBQUNBO1FBQzFCQSxHQUFHQSxDQUFDQSxTQUFTQSxHQUFHQSxTQUFTQSxDQUFDQTtRQUMxQkEsR0FBR0EsQ0FBQ0EsU0FBU0EsR0FBR0EsU0FBU0EsQ0FBQ0E7UUFDMUJBLEdBQUdBLENBQUNBLFVBQVVBLENBQUNBLElBQUlBLEdBQUdBLEdBQUdBLENBQUNBO1FBRTFCQSxJQUFJQSxVQUFVQSxHQUFpREEsR0FBR0EsQ0FBQ0EsVUFBVUEsQ0FBQ0E7UUFDOUVBLFVBQVVBLENBQUNBLFdBQVdBLEdBQUdBLEVBQUVBLENBQUNBO1FBQzVCQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxDQUFDQTtRQUNuQ0EsR0FBR0EsQ0FBQ0EsVUFBVUEsQ0FBQ0EsYUFBYUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDakNBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO0lBQzlCQSxDQUFDQTtJQUVESCxXQUFXQTtJQUNKQSxpREFBbUJBLEdBQTFCQTtRQUVDSSxNQUFNQSxJQUFJQSwwQkFBMEJBLEVBQUVBLENBQUNBO1FBQ3ZDQTs7V0FFR0E7SUFDSkEsQ0FBQ0E7SUFFREosV0FBV0E7SUFDSkEsb0RBQXNCQSxHQUE3QkEsVUFBOEJBLFVBQWlCQTtRQUU5Q0ssSUFBSUEsS0FBS0EsR0FBMEJBLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLENBQUNBO1FBQ2xEQSxJQUFJQSxXQUFXQSxHQUFVQSxLQUFLQSxDQUFDQSxTQUFTQSxDQUFDQTtRQUN6Q0EsSUFBSUEsR0FBR0EsR0FBWUEsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsYUFBYUEsQ0FBQ0E7UUFHOUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQVVBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBO1lBQ25DQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxXQUFXQSxDQUFDQTtZQUN2Q0EsSUFBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsU0FBU0EsQ0FBQ0EsUUFBUUEsR0FBR0EsR0FBR0EsQ0FBQ0E7WUFDL0NBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBO1FBQzdCQSxDQUFDQTtJQUNGQSxDQUFDQTtJQUVETCxXQUFXQTtJQUNKQSwyQ0FBYUEsR0FBcEJBLFVBQXFCQSxNQUFvQkEsRUFBRUEsS0FBV0EsRUFBRUEsUUFBa0JBO1FBRXpFTSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFVQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQTtZQUNuQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQzFCQSxJQUFJQSxDQUFDQSxpQkFBaUJBLENBQUNBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO2dCQUN0REEsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxLQUFLQSxFQUFFQSxDQUFDQTtnQkFDL0JBLEtBQUtBLENBQUNBLGtCQUFrQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxDQUFDQTtnQkFDakRBLFFBQVFBLENBQUNBLFFBQVFBLENBQUNBLElBQUlBLENBQUNBLGlCQUFpQkEsRUFBRUEsTUFBTUEsRUFBRUEsSUFBSUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQUE7WUFDM0RBLENBQUNBO1FBQ0ZBLENBQUNBO0lBQ0ZBLENBQUNBO0lBQ0ZOLDBCQUFDQTtBQUFEQSxDQWhGQSxBQWdGQ0EsRUFoRmlDLGdCQUFnQixFQWdGakQ7QUFFRCxBQUE2QixpQkFBcEIsbUJBQW1CLENBQUMiLCJmaWxlIjoibWF0ZXJpYWxzL3NoYWRvd21hcHBlcnMvQ3ViZU1hcFNoYWRvd01hcHBlci5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgVmVjdG9yM0RcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9WZWN0b3IzRFwiKTtcbmltcG9ydCBQYXJ0aWFsSW1wbGVtZW50YXRpb25FcnJvclx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2Vycm9ycy9QYXJ0aWFsSW1wbGVtZW50YXRpb25FcnJvclwiKTtcbmltcG9ydCBQZXJzcGVjdGl2ZVByb2plY3Rpb25cdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL3Byb2plY3Rpb25zL1BlcnNwZWN0aXZlUHJvamVjdGlvblwiKTtcblxuaW1wb3J0IFNjZW5lXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2NvbnRhaW5lcnMvU2NlbmVcIik7XG5pbXBvcnQgQ2FtZXJhXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL0NhbWVyYVwiKTtcbmltcG9ydCBQb2ludExpZ2h0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9Qb2ludExpZ2h0XCIpO1xuaW1wb3J0IFNoYWRvd01hcHBlckJhc2VcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9tYXRlcmlhbHMvc2hhZG93bWFwcGVycy9TaGFkb3dNYXBwZXJCYXNlXCIpO1xuaW1wb3J0IElSZW5kZXJlclx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvcmVuZGVyL0lSZW5kZXJlclwiKTtcbmltcG9ydCBSZW5kZXJUZXh0dXJlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvdGV4dHVyZXMvUmVuZGVyVGV4dHVyZVwiKTtcbmltcG9ydCBUZXh0dXJlQmFzZVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvdGV4dHVyZXMvVGV4dHVyZUJhc2VcIik7XG5cbmNsYXNzIEN1YmVNYXBTaGFkb3dNYXBwZXIgZXh0ZW5kcyBTaGFkb3dNYXBwZXJCYXNlXG57XG5cdHByaXZhdGUgX2RlcHRoQ2FtZXJhczpBcnJheTxDYW1lcmE+O1xuXHRwcml2YXRlIF9wcm9qZWN0aW9uczpBcnJheTxQZXJzcGVjdGl2ZVByb2plY3Rpb24+O1xuXHRwcml2YXRlIF9uZWVkc1JlbmRlcjpBcnJheTxib29sZWFuPjtcblxuXHRjb25zdHJ1Y3RvcigpXG5cdHtcblx0XHRzdXBlcigpO1xuXG5cdFx0dGhpcy5fcERlcHRoTWFwU2l6ZSA9IDUxMjtcblx0XHR0aGlzLl9uZWVkc1JlbmRlciA9IG5ldyBBcnJheSgpO1xuXHRcdHRoaXMuaW5pdENhbWVyYXMoKTtcblx0fVxuXG5cdHByaXZhdGUgaW5pdENhbWVyYXMoKVxuXHR7XG5cdFx0dGhpcy5fZGVwdGhDYW1lcmFzID0gbmV3IEFycmF5KCk7XG5cdFx0dGhpcy5fcHJvamVjdGlvbnMgPSBuZXcgQXJyYXkoKTtcblxuXHRcdC8vIHBvc1gsIG5lZ1gsIHBvc1ksIG5lZ1ksIHBvc1osIG5lZ1pcblx0XHR0aGlzLmFkZENhbWVyYSgwLCA5MCwgMCk7XG5cdFx0dGhpcy5hZGRDYW1lcmEoMCwgLTkwLCAwKTtcblx0XHR0aGlzLmFkZENhbWVyYSgtOTAsIDAsIDApO1xuXHRcdHRoaXMuYWRkQ2FtZXJhKDkwLCAwLCAwKTtcblx0XHR0aGlzLmFkZENhbWVyYSgwLCAwLCAwKTtcblx0XHR0aGlzLmFkZENhbWVyYSgwLCAxODAsIDApO1xuXHR9XG5cblx0cHJpdmF0ZSBhZGRDYW1lcmEocm90YXRpb25YOm51bWJlciwgcm90YXRpb25ZOm51bWJlciwgcm90YXRpb25aOm51bWJlcilcblx0e1xuXHRcdHZhciBjYW06Q2FtZXJhID0gbmV3IENhbWVyYSgpO1xuXHRcdGNhbS5yb3RhdGlvblggPSByb3RhdGlvblg7XG5cdFx0Y2FtLnJvdGF0aW9uWSA9IHJvdGF0aW9uWTtcblx0XHRjYW0ucm90YXRpb25aID0gcm90YXRpb25aO1xuXHRcdGNhbS5wcm9qZWN0aW9uLm5lYXIgPSAuMDE7XG5cblx0XHR2YXIgcHJvamVjdGlvbjpQZXJzcGVjdGl2ZVByb2plY3Rpb24gPSA8UGVyc3BlY3RpdmVQcm9qZWN0aW9uPiBjYW0ucHJvamVjdGlvbjtcblx0XHRwcm9qZWN0aW9uLmZpZWxkT2ZWaWV3ID0gOTA7XG5cdFx0dGhpcy5fcHJvamVjdGlvbnMucHVzaChwcm9qZWN0aW9uKTtcblx0XHRjYW0ucHJvamVjdGlvbi5faUFzcGVjdFJhdGlvID0gMTtcblx0XHR0aGlzLl9kZXB0aENhbWVyYXMucHVzaChjYW0pO1xuXHR9XG5cblx0Ly9Ab3ZlcnJpZGVcblx0cHVibGljIHBDcmVhdGVEZXB0aFRleHR1cmUoKTpUZXh0dXJlQmFzZVxuXHR7XG5cdFx0dGhyb3cgbmV3IFBhcnRpYWxJbXBsZW1lbnRhdGlvbkVycm9yKCk7XG5cdFx0Lypcblx0XHQgcmV0dXJuIG5ldyBSZW5kZXJDdWJlVGV4dHVyZSggdGhpcy5fZGVwdGhNYXBTaXplICk7XG5cdFx0ICovXG5cdH1cblxuXHQvL0BvdmVycmlkZVxuXHRwdWJsaWMgcFVwZGF0ZURlcHRoUHJvamVjdGlvbih2aWV3Q2FtZXJhOkNhbWVyYSlcblx0e1xuXHRcdHZhciBsaWdodDpQb2ludExpZ2h0ID0gPFBvaW50TGlnaHQ+KHRoaXMuX3BMaWdodCk7XG5cdFx0dmFyIG1heERpc3RhbmNlOm51bWJlciA9IGxpZ2h0Ll9wRmFsbE9mZjtcblx0XHR2YXIgcG9zOlZlY3RvcjNEID0gdGhpcy5fcExpZ2h0LnNjZW5lUG9zaXRpb247XG5cblx0XHQvLyB0b2RvOiBmYWNlcyBvdXRzaWRlIGZydXN0dW0gd2hpY2ggYXJlIHBvaW50aW5nIGF3YXkgZnJvbSBjYW1lcmEgbmVlZCBub3QgYmUgcmVuZGVyZWQhXG5cdFx0Zm9yICh2YXIgaTpudW1iZXIgPSAwOyBpIDwgNjsgKytpKSB7XG5cdFx0XHR0aGlzLl9wcm9qZWN0aW9uc1tpXS5mYXIgPSBtYXhEaXN0YW5jZTtcblx0XHRcdHRoaXMuX2RlcHRoQ2FtZXJhc1tpXS50cmFuc2Zvcm0ucG9zaXRpb24gPSBwb3M7XG5cdFx0XHR0aGlzLl9uZWVkc1JlbmRlcltpXSA9IHRydWU7XG5cdFx0fVxuXHR9XG5cblx0Ly9Ab3ZlcnJpZGVcblx0cHVibGljIHBEcmF3RGVwdGhNYXAodGFyZ2V0OlJlbmRlclRleHR1cmUsIHNjZW5lOlNjZW5lLCByZW5kZXJlcjpJUmVuZGVyZXIpXG5cdHtcblx0XHRmb3IgKHZhciBpOm51bWJlciA9IDA7IGkgPCA2OyArK2kpIHtcblx0XHRcdGlmICh0aGlzLl9uZWVkc1JlbmRlcltpXSkge1xuXHRcdFx0XHR0aGlzLl9wQ2FzdGVyQ29sbGVjdG9yLmNhbWVyYSA9IHRoaXMuX2RlcHRoQ2FtZXJhc1tpXTtcblx0XHRcdFx0dGhpcy5fcENhc3RlckNvbGxlY3Rvci5jbGVhcigpO1xuXHRcdFx0XHRzY2VuZS50cmF2ZXJzZVBhcnRpdGlvbnModGhpcy5fcENhc3RlckNvbGxlY3Rvcik7XG5cdFx0XHRcdHJlbmRlcmVyLl9pUmVuZGVyKHRoaXMuX3BDYXN0ZXJDb2xsZWN0b3IsIHRhcmdldCwgbnVsbCwgaSlcblx0XHRcdH1cblx0XHR9XG5cdH1cbn1cblxuZXhwb3J0ID0gQ3ViZU1hcFNoYWRvd01hcHBlcjsiXX0=