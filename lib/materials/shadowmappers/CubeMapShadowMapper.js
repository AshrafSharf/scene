var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var PartialImplementationError = require("awayjs-core/lib/errors/PartialImplementationError");
var Camera = require("awayjs-display/lib/entities/Camera");
var ShadowMapperBase = require("awayjs-display/lib/materials/shadowmappers/ShadowMapperBase");
var CubeMapShadowMapper = (function (_super) {
    __extends(CubeMapShadowMapper, _super);
    function CubeMapShadowMapper() {
        _super.call(this);
        this._pDepthMapSize = 512;
        this._needsRender = new Array();
        this.initCameras();
    }
    CubeMapShadowMapper.prototype.initCameras = function () {
        this._depthCameras = new Array();
        this._projections = new Array();
        // posX, negX, posY, negY, posZ, negZ
        this.addCamera(0, 90, 0);
        this.addCamera(0, -90, 0);
        this.addCamera(-90, 0, 0);
        this.addCamera(90, 0, 0);
        this.addCamera(0, 0, 0);
        this.addCamera(0, 180, 0);
    };
    CubeMapShadowMapper.prototype.addCamera = function (rotationX, rotationY, rotationZ) {
        var cam = new Camera();
        cam.rotationX = rotationX;
        cam.rotationY = rotationY;
        cam.rotationZ = rotationZ;
        cam.projection.near = .01;
        var projection = cam.projection;
        projection.fieldOfView = 90;
        this._projections.push(projection);
        cam.projection._iAspectRatio = 1;
        this._depthCameras.push(cam);
    };
    //@override
    CubeMapShadowMapper.prototype.pCreateDepthTexture = function () {
        throw new PartialImplementationError();
        /*
         return new RenderCubeTexture( this._depthMapSize );
         */
    };
    //@override
    CubeMapShadowMapper.prototype.pUpdateDepthProjection = function (viewCamera) {
        var light = (this._pLight);
        var maxDistance = light._pFallOff;
        var pos = this._pLight.scenePosition;
        for (var i = 0; i < 6; ++i) {
            this._projections[i].far = maxDistance;
            this._depthCameras[i].transform.position = pos;
            this._needsRender[i] = true;
        }
    };
    //@override
    CubeMapShadowMapper.prototype.pDrawDepthMap = function (target, scene, renderer) {
        for (var i = 0; i < 6; ++i) {
            if (this._needsRender[i]) {
                this._pCasterCollector.camera = this._depthCameras[i];
                this._pCasterCollector.clear();
                scene.traversePartitions(this._pCasterCollector);
                renderer._iRender(this._pCasterCollector, target, null, i);
            }
        }
    };
    return CubeMapShadowMapper;
})(ShadowMapperBase);
module.exports = CubeMapShadowMapper;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1kaXNwbGF5L2xpYi9tYXRlcmlhbHMvc2hhZG93bWFwcGVycy9DdWJlTWFwU2hhZG93TWFwcGVyLnRzIl0sIm5hbWVzIjpbIkN1YmVNYXBTaGFkb3dNYXBwZXIiLCJDdWJlTWFwU2hhZG93TWFwcGVyLmNvbnN0cnVjdG9yIiwiQ3ViZU1hcFNoYWRvd01hcHBlci5pbml0Q2FtZXJhcyIsIkN1YmVNYXBTaGFkb3dNYXBwZXIuYWRkQ2FtZXJhIiwiQ3ViZU1hcFNoYWRvd01hcHBlci5wQ3JlYXRlRGVwdGhUZXh0dXJlIiwiQ3ViZU1hcFNoYWRvd01hcHBlci5wVXBkYXRlRGVwdGhQcm9qZWN0aW9uIiwiQ3ViZU1hcFNoYWRvd01hcHBlci5wRHJhd0RlcHRoTWFwIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFDQSxJQUFPLDBCQUEwQixXQUFXLG1EQUFtRCxDQUFDLENBQUM7QUFJakcsSUFBTyxNQUFNLFdBQWdCLG9DQUFvQyxDQUFDLENBQUM7QUFFbkUsSUFBTyxnQkFBZ0IsV0FBYyw2REFBNkQsQ0FBQyxDQUFDO0FBS3BHLElBQU0sbUJBQW1CO0lBQVNBLFVBQTVCQSxtQkFBbUJBLFVBQXlCQTtJQU1qREEsU0FOS0EsbUJBQW1CQTtRQVF2QkMsaUJBQU9BLENBQUNBO1FBRVJBLElBQUlBLENBQUNBLGNBQWNBLEdBQUdBLEdBQUdBLENBQUNBO1FBQzFCQSxJQUFJQSxDQUFDQSxZQUFZQSxHQUFHQSxJQUFJQSxLQUFLQSxFQUFFQSxDQUFDQTtRQUNoQ0EsSUFBSUEsQ0FBQ0EsV0FBV0EsRUFBRUEsQ0FBQ0E7SUFDcEJBLENBQUNBO0lBRU9ELHlDQUFXQSxHQUFuQkE7UUFFQ0UsSUFBSUEsQ0FBQ0EsYUFBYUEsR0FBR0EsSUFBSUEsS0FBS0EsRUFBRUEsQ0FBQ0E7UUFDakNBLElBQUlBLENBQUNBLFlBQVlBLEdBQUdBLElBQUlBLEtBQUtBLEVBQUVBLENBQUNBO1FBRWhDQSxBQUNBQSxxQ0FEcUNBO1FBQ3JDQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQSxFQUFFQSxFQUFFQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUN6QkEsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDMUJBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1FBQzFCQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUN6QkEsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDeEJBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLENBQUNBLEVBQUVBLEdBQUdBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO0lBQzNCQSxDQUFDQTtJQUVPRix1Q0FBU0EsR0FBakJBLFVBQWtCQSxTQUFnQkEsRUFBRUEsU0FBZ0JBLEVBQUVBLFNBQWdCQTtRQUVyRUcsSUFBSUEsR0FBR0EsR0FBVUEsSUFBSUEsTUFBTUEsRUFBRUEsQ0FBQ0E7UUFDOUJBLEdBQUdBLENBQUNBLFNBQVNBLEdBQUdBLFNBQVNBLENBQUNBO1FBQzFCQSxHQUFHQSxDQUFDQSxTQUFTQSxHQUFHQSxTQUFTQSxDQUFDQTtRQUMxQkEsR0FBR0EsQ0FBQ0EsU0FBU0EsR0FBR0EsU0FBU0EsQ0FBQ0E7UUFDMUJBLEdBQUdBLENBQUNBLFVBQVVBLENBQUNBLElBQUlBLEdBQUdBLEdBQUdBLENBQUNBO1FBRTFCQSxJQUFJQSxVQUFVQSxHQUFpREEsR0FBR0EsQ0FBQ0EsVUFBVUEsQ0FBQ0E7UUFDOUVBLFVBQVVBLENBQUNBLFdBQVdBLEdBQUdBLEVBQUVBLENBQUNBO1FBQzVCQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxDQUFDQTtRQUNuQ0EsR0FBR0EsQ0FBQ0EsVUFBVUEsQ0FBQ0EsYUFBYUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDakNBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO0lBQzlCQSxDQUFDQTtJQUVESCxXQUFXQTtJQUNKQSxpREFBbUJBLEdBQTFCQTtRQUVDSSxNQUFNQSxJQUFJQSwwQkFBMEJBLEVBQUVBLENBQUNBO1FBQ3ZDQTs7V0FFR0E7SUFDSkEsQ0FBQ0E7SUFFREosV0FBV0E7SUFDSkEsb0RBQXNCQSxHQUE3QkEsVUFBOEJBLFVBQWlCQTtRQUU5Q0ssSUFBSUEsS0FBS0EsR0FBMEJBLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLENBQUNBO1FBQ2xEQSxJQUFJQSxXQUFXQSxHQUFVQSxLQUFLQSxDQUFDQSxTQUFTQSxDQUFDQTtRQUN6Q0EsSUFBSUEsR0FBR0EsR0FBWUEsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsYUFBYUEsQ0FBQ0E7UUFHOUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQVVBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBO1lBQ25DQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxXQUFXQSxDQUFDQTtZQUN2Q0EsSUFBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsU0FBU0EsQ0FBQ0EsUUFBUUEsR0FBR0EsR0FBR0EsQ0FBQ0E7WUFDL0NBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBO1FBQzdCQSxDQUFDQTtJQUNGQSxDQUFDQTtJQUVETCxXQUFXQTtJQUNKQSwyQ0FBYUEsR0FBcEJBLFVBQXFCQSxNQUFvQkEsRUFBRUEsS0FBV0EsRUFBRUEsUUFBa0JBO1FBRXpFTSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFVQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQTtZQUNuQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQzFCQSxJQUFJQSxDQUFDQSxpQkFBaUJBLENBQUNBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO2dCQUN0REEsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxLQUFLQSxFQUFFQSxDQUFDQTtnQkFDL0JBLEtBQUtBLENBQUNBLGtCQUFrQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxDQUFDQTtnQkFDakRBLFFBQVFBLENBQUNBLFFBQVFBLENBQUNBLElBQUlBLENBQUNBLGlCQUFpQkEsRUFBRUEsTUFBTUEsRUFBRUEsSUFBSUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQUE7WUFDM0RBLENBQUNBO1FBQ0ZBLENBQUNBO0lBQ0ZBLENBQUNBO0lBQ0ZOLDBCQUFDQTtBQUFEQSxDQWhGQSxBQWdGQ0EsRUFoRmlDLGdCQUFnQixFQWdGakQ7QUFFRCxBQUE2QixpQkFBcEIsbUJBQW1CLENBQUMiLCJmaWxlIjoibWF0ZXJpYWxzL3NoYWRvd21hcHBlcnMvQ3ViZU1hcFNoYWRvd01hcHBlci5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgVmVjdG9yM0RcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9WZWN0b3IzRFwiKTtcclxuaW1wb3J0IFBhcnRpYWxJbXBsZW1lbnRhdGlvbkVycm9yXHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZXJyb3JzL1BhcnRpYWxJbXBsZW1lbnRhdGlvbkVycm9yXCIpO1xyXG5pbXBvcnQgUGVyc3BlY3RpdmVQcm9qZWN0aW9uXHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9wcm9qZWN0aW9ucy9QZXJzcGVjdGl2ZVByb2plY3Rpb25cIik7XHJcblxyXG5pbXBvcnQgU2NlbmVcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvY29udGFpbmVycy9TY2VuZVwiKTtcclxuaW1wb3J0IENhbWVyYVx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9DYW1lcmFcIik7XHJcbmltcG9ydCBQb2ludExpZ2h0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9Qb2ludExpZ2h0XCIpO1xyXG5pbXBvcnQgU2hhZG93TWFwcGVyQmFzZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL21hdGVyaWFscy9zaGFkb3dtYXBwZXJzL1NoYWRvd01hcHBlckJhc2VcIik7XHJcbmltcG9ydCBJUmVuZGVyZXJcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL3JlbmRlci9JUmVuZGVyZXJcIik7XHJcbmltcG9ydCBSZW5kZXJUZXh0dXJlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvdGV4dHVyZXMvUmVuZGVyVGV4dHVyZVwiKTtcclxuaW1wb3J0IFRleHR1cmVQcm94eUJhc2VcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi90ZXh0dXJlcy9UZXh0dXJlUHJveHlCYXNlXCIpO1xyXG5cclxuY2xhc3MgQ3ViZU1hcFNoYWRvd01hcHBlciBleHRlbmRzIFNoYWRvd01hcHBlckJhc2Vcclxue1xyXG5cdHByaXZhdGUgX2RlcHRoQ2FtZXJhczpBcnJheTxDYW1lcmE+O1xyXG5cdHByaXZhdGUgX3Byb2plY3Rpb25zOkFycmF5PFBlcnNwZWN0aXZlUHJvamVjdGlvbj47XHJcblx0cHJpdmF0ZSBfbmVlZHNSZW5kZXI6QXJyYXk8Ym9vbGVhbj47XHJcblxyXG5cdGNvbnN0cnVjdG9yKClcclxuXHR7XHJcblx0XHRzdXBlcigpO1xyXG5cclxuXHRcdHRoaXMuX3BEZXB0aE1hcFNpemUgPSA1MTI7XHJcblx0XHR0aGlzLl9uZWVkc1JlbmRlciA9IG5ldyBBcnJheSgpO1xyXG5cdFx0dGhpcy5pbml0Q2FtZXJhcygpO1xyXG5cdH1cclxuXHJcblx0cHJpdmF0ZSBpbml0Q2FtZXJhcygpXHJcblx0e1xyXG5cdFx0dGhpcy5fZGVwdGhDYW1lcmFzID0gbmV3IEFycmF5KCk7XHJcblx0XHR0aGlzLl9wcm9qZWN0aW9ucyA9IG5ldyBBcnJheSgpO1xyXG5cclxuXHRcdC8vIHBvc1gsIG5lZ1gsIHBvc1ksIG5lZ1ksIHBvc1osIG5lZ1pcclxuXHRcdHRoaXMuYWRkQ2FtZXJhKDAsIDkwLCAwKTtcclxuXHRcdHRoaXMuYWRkQ2FtZXJhKDAsIC05MCwgMCk7XHJcblx0XHR0aGlzLmFkZENhbWVyYSgtOTAsIDAsIDApO1xyXG5cdFx0dGhpcy5hZGRDYW1lcmEoOTAsIDAsIDApO1xyXG5cdFx0dGhpcy5hZGRDYW1lcmEoMCwgMCwgMCk7XHJcblx0XHR0aGlzLmFkZENhbWVyYSgwLCAxODAsIDApO1xyXG5cdH1cclxuXHJcblx0cHJpdmF0ZSBhZGRDYW1lcmEocm90YXRpb25YOm51bWJlciwgcm90YXRpb25ZOm51bWJlciwgcm90YXRpb25aOm51bWJlcilcclxuXHR7XHJcblx0XHR2YXIgY2FtOkNhbWVyYSA9IG5ldyBDYW1lcmEoKTtcclxuXHRcdGNhbS5yb3RhdGlvblggPSByb3RhdGlvblg7XHJcblx0XHRjYW0ucm90YXRpb25ZID0gcm90YXRpb25ZO1xyXG5cdFx0Y2FtLnJvdGF0aW9uWiA9IHJvdGF0aW9uWjtcclxuXHRcdGNhbS5wcm9qZWN0aW9uLm5lYXIgPSAuMDE7XHJcblxyXG5cdFx0dmFyIHByb2plY3Rpb246UGVyc3BlY3RpdmVQcm9qZWN0aW9uID0gPFBlcnNwZWN0aXZlUHJvamVjdGlvbj4gY2FtLnByb2plY3Rpb247XHJcblx0XHRwcm9qZWN0aW9uLmZpZWxkT2ZWaWV3ID0gOTA7XHJcblx0XHR0aGlzLl9wcm9qZWN0aW9ucy5wdXNoKHByb2plY3Rpb24pO1xyXG5cdFx0Y2FtLnByb2plY3Rpb24uX2lBc3BlY3RSYXRpbyA9IDE7XHJcblx0XHR0aGlzLl9kZXB0aENhbWVyYXMucHVzaChjYW0pO1xyXG5cdH1cclxuXHJcblx0Ly9Ab3ZlcnJpZGVcclxuXHRwdWJsaWMgcENyZWF0ZURlcHRoVGV4dHVyZSgpOlRleHR1cmVQcm94eUJhc2VcclxuXHR7XHJcblx0XHR0aHJvdyBuZXcgUGFydGlhbEltcGxlbWVudGF0aW9uRXJyb3IoKTtcclxuXHRcdC8qXHJcblx0XHQgcmV0dXJuIG5ldyBSZW5kZXJDdWJlVGV4dHVyZSggdGhpcy5fZGVwdGhNYXBTaXplICk7XHJcblx0XHQgKi9cclxuXHR9XHJcblxyXG5cdC8vQG92ZXJyaWRlXHJcblx0cHVibGljIHBVcGRhdGVEZXB0aFByb2plY3Rpb24odmlld0NhbWVyYTpDYW1lcmEpXHJcblx0e1xyXG5cdFx0dmFyIGxpZ2h0OlBvaW50TGlnaHQgPSA8UG9pbnRMaWdodD4odGhpcy5fcExpZ2h0KTtcclxuXHRcdHZhciBtYXhEaXN0YW5jZTpudW1iZXIgPSBsaWdodC5fcEZhbGxPZmY7XHJcblx0XHR2YXIgcG9zOlZlY3RvcjNEID0gdGhpcy5fcExpZ2h0LnNjZW5lUG9zaXRpb247XHJcblxyXG5cdFx0Ly8gdG9kbzogZmFjZXMgb3V0c2lkZSBmcnVzdHVtIHdoaWNoIGFyZSBwb2ludGluZyBhd2F5IGZyb20gY2FtZXJhIG5lZWQgbm90IGJlIHJlbmRlcmVkIVxyXG5cdFx0Zm9yICh2YXIgaTpudW1iZXIgPSAwOyBpIDwgNjsgKytpKSB7XHJcblx0XHRcdHRoaXMuX3Byb2plY3Rpb25zW2ldLmZhciA9IG1heERpc3RhbmNlO1xyXG5cdFx0XHR0aGlzLl9kZXB0aENhbWVyYXNbaV0udHJhbnNmb3JtLnBvc2l0aW9uID0gcG9zO1xyXG5cdFx0XHR0aGlzLl9uZWVkc1JlbmRlcltpXSA9IHRydWU7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvL0BvdmVycmlkZVxyXG5cdHB1YmxpYyBwRHJhd0RlcHRoTWFwKHRhcmdldDpSZW5kZXJUZXh0dXJlLCBzY2VuZTpTY2VuZSwgcmVuZGVyZXI6SVJlbmRlcmVyKVxyXG5cdHtcclxuXHRcdGZvciAodmFyIGk6bnVtYmVyID0gMDsgaSA8IDY7ICsraSkge1xyXG5cdFx0XHRpZiAodGhpcy5fbmVlZHNSZW5kZXJbaV0pIHtcclxuXHRcdFx0XHR0aGlzLl9wQ2FzdGVyQ29sbGVjdG9yLmNhbWVyYSA9IHRoaXMuX2RlcHRoQ2FtZXJhc1tpXTtcclxuXHRcdFx0XHR0aGlzLl9wQ2FzdGVyQ29sbGVjdG9yLmNsZWFyKCk7XHJcblx0XHRcdFx0c2NlbmUudHJhdmVyc2VQYXJ0aXRpb25zKHRoaXMuX3BDYXN0ZXJDb2xsZWN0b3IpO1xyXG5cdFx0XHRcdHJlbmRlcmVyLl9pUmVuZGVyKHRoaXMuX3BDYXN0ZXJDb2xsZWN0b3IsIHRhcmdldCwgbnVsbCwgaSlcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxufVxyXG5cclxuZXhwb3J0ID0gQ3ViZU1hcFNoYWRvd01hcHBlcjsiXX0=