var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Matrix3D = require("awayjs-core/lib/geom/Matrix3D");
var FreeMatrixProjection = require("awayjs-core/lib/projections/FreeMatrixProjection");
var Camera = require("awayjs-display/lib/entities/Camera");
var ShadowMapperBase = require("awayjs-display/lib/materials/shadowmappers/ShadowMapperBase");
var DirectionalShadowMapper = (function (_super) {
    __extends(DirectionalShadowMapper, _super);
    function DirectionalShadowMapper() {
        _super.call(this);
        this._pLightOffset = 10000;
        this._pSnap = 64;
        this._pCullPlanes = [];
        this._pOverallDepthProjection = new FreeMatrixProjection();
        this._pOverallDepthCamera = new Camera(this._pOverallDepthProjection);
        this._pLocalFrustum = [];
        this._pMatrix = new Matrix3D();
    }
    Object.defineProperty(DirectionalShadowMapper.prototype, "snap", {
        get: function () {
            return this._pSnap;
        },
        set: function (value) {
            this._pSnap = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DirectionalShadowMapper.prototype, "lightOffset", {
        get: function () {
            return this._pLightOffset;
        },
        set: function (value) {
            this._pLightOffset = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DirectionalShadowMapper.prototype, "iDepthProjection", {
        //@arcane
        get: function () {
            return this._pOverallDepthCamera.viewProjection;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DirectionalShadowMapper.prototype, "depth", {
        //@arcane
        get: function () {
            return this._pMaxZ - this._pMinZ;
        },
        enumerable: true,
        configurable: true
    });
    //@override
    DirectionalShadowMapper.prototype.pDrawDepthMap = function (target, scene, renderer) {
        this._pCasterCollector.camera = this._pOverallDepthCamera;
        this._pCasterCollector.cullPlanes = this._pCullPlanes;
        this._pCasterCollector.clear();
        scene.traversePartitions(this._pCasterCollector);
        renderer._iRender(this._pCasterCollector, target);
    };
    //@protected
    DirectionalShadowMapper.prototype.pUpdateCullPlanes = function (viewCamera) {
        var lightFrustumPlanes = this._pOverallDepthCamera.frustumPlanes;
        var viewFrustumPlanes = viewCamera.frustumPlanes;
        this._pCullPlanes.length = 4;
        this._pCullPlanes[0] = lightFrustumPlanes[0];
        this._pCullPlanes[1] = lightFrustumPlanes[1];
        this._pCullPlanes[2] = lightFrustumPlanes[2];
        this._pCullPlanes[3] = lightFrustumPlanes[3];
        var light = this._pLight;
        var dir = light.sceneDirection;
        var dirX = dir.x;
        var dirY = dir.y;
        var dirZ = dir.z;
        var j = 4;
        for (var i = 0; i < 6; ++i) {
            var plane = viewFrustumPlanes[i];
            if (plane.a * dirX + plane.b * dirY + plane.c * dirZ < 0)
                this._pCullPlanes[j++] = plane;
        }
    };
    //@override
    DirectionalShadowMapper.prototype.pUpdateDepthProjection = function (viewCamera) {
        this.pUpdateProjectionFromFrustumCorners(viewCamera, viewCamera.projection.frustumCorners, this._pMatrix);
        this._pOverallDepthProjection.matrix = this._pMatrix;
        this.pUpdateCullPlanes(viewCamera);
    };
    DirectionalShadowMapper.prototype.pUpdateProjectionFromFrustumCorners = function (viewCamera, corners, matrix) {
        var raw = new Array();
        var dir;
        var x, y, z;
        var minX, minY;
        var maxX, maxY;
        var i;
        var light = this._pLight;
        dir = light.sceneDirection;
        this._pOverallDepthCamera.transform.matrix3D = this._pLight.sceneTransform;
        x = Math.floor((viewCamera.x - dir.x * this._pLightOffset) / this._pSnap) * this._pSnap;
        y = Math.floor((viewCamera.y - dir.y * this._pLightOffset) / this._pSnap) * this._pSnap;
        z = Math.floor((viewCamera.z - dir.z * this._pLightOffset) / this._pSnap) * this._pSnap;
        this._pOverallDepthCamera.x = x;
        this._pOverallDepthCamera.y = y;
        this._pOverallDepthCamera.z = z;
        this._pMatrix.copyFrom(this._pOverallDepthCamera.inverseSceneTransform);
        this._pMatrix.prepend(viewCamera.sceneTransform);
        this._pMatrix.transformVectors(corners, this._pLocalFrustum);
        minX = maxX = this._pLocalFrustum[0];
        minY = maxY = this._pLocalFrustum[1];
        this._pMaxZ = this._pLocalFrustum[2];
        i = 3;
        while (i < 24) {
            x = this._pLocalFrustum[i];
            y = this._pLocalFrustum[i + 1];
            z = this._pLocalFrustum[i + 2];
            if (x < minX)
                minX = x;
            if (x > maxX)
                maxX = x;
            if (y < minY)
                minY = y;
            if (y > maxY)
                maxY = y;
            if (z > this._pMaxZ)
                this._pMaxZ = z;
            i += 3;
        }
        this._pMinZ = 1;
        var w = maxX - minX;
        var h = maxY - minY;
        var d = 1 / (this._pMaxZ - this._pMinZ);
        if (minX < 0)
            minX -= this._pSnap; // because int() rounds up for < 0
        if (minY < 0)
            minY -= this._pSnap;
        minX = Math.floor(minX / this._pSnap) * this._pSnap;
        minY = Math.floor(minY / this._pSnap) * this._pSnap;
        var snap2 = 2 * this._pSnap;
        w = Math.floor(w / snap2 + 2) * snap2;
        h = Math.floor(h / snap2 + 2) * snap2;
        maxX = minX + w;
        maxY = minY + h;
        w = 1 / w;
        h = 1 / h;
        raw[0] = 2 * w;
        raw[5] = 2 * h;
        raw[10] = d;
        raw[12] = -(maxX + minX) * w;
        raw[13] = -(maxY + minY) * h;
        raw[14] = -this._pMinZ * d;
        raw[15] = 1;
        raw[1] = raw[2] = raw[3] = raw[4] = raw[6] = raw[7] = raw[8] = raw[9] = raw[11] = 0;
        matrix.copyRawDataFrom(raw);
    };
    return DirectionalShadowMapper;
})(ShadowMapperBase);
module.exports = DirectionalShadowMapper;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1kaXNwbGF5L2xpYi9tYXRlcmlhbHMvc2hhZG93bWFwcGVycy9EaXJlY3Rpb25hbFNoYWRvd01hcHBlci50cyJdLCJuYW1lcyI6WyJEaXJlY3Rpb25hbFNoYWRvd01hcHBlciIsIkRpcmVjdGlvbmFsU2hhZG93TWFwcGVyLmNvbnN0cnVjdG9yIiwiRGlyZWN0aW9uYWxTaGFkb3dNYXBwZXIuc25hcCIsIkRpcmVjdGlvbmFsU2hhZG93TWFwcGVyLmxpZ2h0T2Zmc2V0IiwiRGlyZWN0aW9uYWxTaGFkb3dNYXBwZXIuaURlcHRoUHJvamVjdGlvbiIsIkRpcmVjdGlvbmFsU2hhZG93TWFwcGVyLmRlcHRoIiwiRGlyZWN0aW9uYWxTaGFkb3dNYXBwZXIucERyYXdEZXB0aE1hcCIsIkRpcmVjdGlvbmFsU2hhZG93TWFwcGVyLnBVcGRhdGVDdWxsUGxhbmVzIiwiRGlyZWN0aW9uYWxTaGFkb3dNYXBwZXIucFVwZGF0ZURlcHRoUHJvamVjdGlvbiIsIkRpcmVjdGlvbmFsU2hhZG93TWFwcGVyLnBVcGRhdGVQcm9qZWN0aW9uRnJvbUZydXN0dW1Db3JuZXJzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFPLFFBQVEsV0FBZ0IsK0JBQStCLENBQUMsQ0FBQztBQUdoRSxJQUFPLG9CQUFvQixXQUFhLGtEQUFrRCxDQUFDLENBQUM7QUFJNUYsSUFBTyxNQUFNLFdBQWdCLG9DQUFvQyxDQUFDLENBQUM7QUFFbkUsSUFBTyxnQkFBZ0IsV0FBYyw2REFBNkQsQ0FBQyxDQUFDO0FBSXBHLElBQU0sdUJBQXVCO0lBQVNBLFVBQWhDQSx1QkFBdUJBLFVBQXlCQTtJQWNyREEsU0FkS0EsdUJBQXVCQTtRQWdCM0JDLGlCQUFPQSxDQUFDQTtRQVhGQSxrQkFBYUEsR0FBVUEsS0FBS0EsQ0FBQ0E7UUFHN0JBLFdBQU1BLEdBQVVBLEVBQUVBLENBQUNBO1FBVXpCQSxJQUFJQSxDQUFDQSxZQUFZQSxHQUFHQSxFQUFFQSxDQUFDQTtRQUN2QkEsSUFBSUEsQ0FBQ0Esd0JB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QUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUMzQkEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDL0JBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLGNBQWNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO1lBQy9CQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQTtnQkFDWkEsSUFBSUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7WUFDVkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0E7Z0JBQ1pBLElBQUlBLEdBQUdBLENBQUNBLENBQUNBO1lBQ1ZBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBO2dCQUNaQSxJQUFJQSxHQUFHQSxDQUFDQSxDQUFDQTtZQUNWQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQTtnQkFDWkEsSUFBSUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7WUFDVkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7Z0JBQ25CQSxJQUFJQSxDQUFDQSxNQUFNQSxHQUFHQSxDQUFDQSxDQUFDQTtZQUNqQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDUkEsQ0FBQ0E7UUFFREEsSUFBSUEsQ0FBQ0EsTUFBTUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFFaEJBLElBQUlBLENBQUNBLEdBQVVBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBO1FBQzNCQSxJQUFJQSxDQUFDQSxHQUFVQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUMzQkEsSUFBSUEsQ0FBQ0EsR0FBVUEsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsR0FBR0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7UUFFN0NBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLEdBQUdBLENBQUNBLENBQUNBO1lBQ1pBLElBQUlBLElBQUlBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLGtDQUFrQ0E7UUFFeERBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLEdBQUdBLENBQUNBLENBQUNBO1lBQ1pBLElBQUlBLElBQUlBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBO1FBRXJCQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxHQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxHQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQTtRQUNoREEsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsSUFBSUEsR0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsR0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7UUFFaERBLElBQUlBLEtBQUtBLEdBQVVBLENBQUNBLEdBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBO1FBQ2pDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQSxHQUFDQSxLQUFLQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFDQSxLQUFLQSxDQUFDQTtRQUNsQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsS0FBS0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsS0FBS0EsQ0FBQ0E7UUFFbENBLElBQUlBLEdBQUdBLElBQUlBLEdBQUdBLENBQUNBLENBQUNBO1FBQ2hCQSxJQUFJQSxHQUFHQSxJQUFJQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUVoQkEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDUkEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFFUkEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDYkEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDYkEsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDWkEsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDM0JBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBLEdBQUNBLENBQUNBLENBQUNBO1FBQzNCQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxHQUFDQSxDQUFDQSxDQUFDQTtRQUN6QkEsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDWkEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFFcEZBLE1BQU1BLENBQUNBLGVBQWVBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO0lBQzdCQSxDQUFDQTtJQUNGVCw4QkFBQ0E7QUFBREEsQ0FyTEEsQUFxTENBLEVBckxxQyxnQkFBZ0IsRUFxTHJEO0FBRUQsQUFBaUMsaUJBQXhCLHVCQUF1QixDQUFDIiwiZmlsZSI6Im1hdGVyaWFscy9zaGFkb3dtYXBwZXJzL0RpcmVjdGlvbmFsU2hhZG93TWFwcGVyLmpzIiwic291cmNlUm9vdCI6Ii4uLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBNYXRyaXgzRFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9nZW9tL01hdHJpeDNEXCIpO1xuaW1wb3J0IFBsYW5lM0RcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9QbGFuZTNEXCIpO1xuaW1wb3J0IFZlY3RvcjNEXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vVmVjdG9yM0RcIik7XG5pbXBvcnQgRnJlZU1hdHJpeFByb2plY3Rpb25cdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvcHJvamVjdGlvbnMvRnJlZU1hdHJpeFByb2plY3Rpb25cIik7XG5cbmltcG9ydCBTY2VuZVx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9jb250YWluZXJzL1NjZW5lXCIpO1xuaW1wb3J0IElSZW5kZXJlclx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvcmVuZGVyL0lSZW5kZXJlclwiKTtcbmltcG9ydCBDYW1lcmFcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvZW50aXRpZXMvQ2FtZXJhXCIpO1xuaW1wb3J0IERpcmVjdGlvbmFsTGlnaHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9EaXJlY3Rpb25hbExpZ2h0XCIpO1xuaW1wb3J0IFNoYWRvd01hcHBlckJhc2VcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9tYXRlcmlhbHMvc2hhZG93bWFwcGVycy9TaGFkb3dNYXBwZXJCYXNlXCIpO1xuaW1wb3J0IFJlbmRlclRleHR1cmVcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi90ZXh0dXJlcy9SZW5kZXJUZXh0dXJlXCIpO1xuaW1wb3J0IFRleHR1cmVCYXNlXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi90ZXh0dXJlcy9UZXh0dXJlQmFzZVwiKTtcblxuY2xhc3MgRGlyZWN0aW9uYWxTaGFkb3dNYXBwZXIgZXh0ZW5kcyBTaGFkb3dNYXBwZXJCYXNlXG57XG5cdHB1YmxpYyBfcE92ZXJhbGxEZXB0aENhbWVyYTpDYW1lcmE7XG5cdHB1YmxpYyBfcExvY2FsRnJ1c3R1bTpBcnJheTxudW1iZXI+O1xuXG5cdHB1YmxpYyBfcExpZ2h0T2Zmc2V0Om51bWJlciA9IDEwMDAwO1xuXHRwdWJsaWMgX3BNYXRyaXg6TWF0cml4M0Q7XG5cdHB1YmxpYyBfcE92ZXJhbGxEZXB0aFByb2plY3Rpb246RnJlZU1hdHJpeFByb2plY3Rpb247XG5cdHB1YmxpYyBfcFNuYXA6bnVtYmVyID0gNjQ7XG5cblx0cHVibGljIF9wQ3VsbFBsYW5lczpBcnJheTxQbGFuZTNEPjtcblx0cHVibGljIF9wTWluWjpudW1iZXI7XG5cdHB1YmxpYyBfcE1heFo6bnVtYmVyO1xuXG5cdGNvbnN0cnVjdG9yKClcblx0e1xuXHRcdHN1cGVyKCk7XG5cblx0XHR0aGlzLl9wQ3VsbFBsYW5lcyA9IFtdO1xuXHRcdHRoaXMuX3BPdmVyYWxsRGVwdGhQcm9qZWN0aW9uID0gbmV3IEZyZWVNYXRyaXhQcm9qZWN0aW9uKCk7XG5cdFx0dGhpcy5fcE92ZXJhbGxEZXB0aENhbWVyYSA9IG5ldyBDYW1lcmEodGhpcy5fcE92ZXJhbGxEZXB0aFByb2plY3Rpb24pO1xuXHRcdHRoaXMuX3BMb2NhbEZydXN0dW0gPSBbXTtcblx0XHR0aGlzLl9wTWF0cml4ID0gbmV3IE1hdHJpeDNEKCk7XG5cdH1cblxuXHRwdWJsaWMgZ2V0IHNuYXAoKTpudW1iZXJcblx0e1xuXHRcdHJldHVybiB0aGlzLl9wU25hcDtcblx0fVxuXG5cdHB1YmxpYyBzZXQgc25hcCh2YWx1ZTpudW1iZXIpXG5cdHtcblx0XHR0aGlzLl9wU25hcCA9IHZhbHVlO1xuXHR9XG5cblx0cHVibGljIGdldCBsaWdodE9mZnNldCgpOm51bWJlclxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuX3BMaWdodE9mZnNldDtcblx0fVxuXG5cdHB1YmxpYyBzZXQgbGlnaHRPZmZzZXQodmFsdWU6bnVtYmVyKVxuXHR7XG5cdFx0dGhpcy5fcExpZ2h0T2Zmc2V0ID0gdmFsdWU7XG5cdH1cblxuXHQvL0BhcmNhbmVcblx0cHVibGljIGdldCBpRGVwdGhQcm9qZWN0aW9uKCk6TWF0cml4M0Rcblx0e1xuXHRcdHJldHVybiB0aGlzLl9wT3ZlcmFsbERlcHRoQ2FtZXJhLnZpZXdQcm9qZWN0aW9uO1xuXHR9XG5cblx0Ly9AYXJjYW5lXG5cdHB1YmxpYyBnZXQgZGVwdGgoKTpudW1iZXJcblx0e1xuXHRcdHJldHVybiB0aGlzLl9wTWF4WiAtIHRoaXMuX3BNaW5aO1xuXHR9XG5cblx0Ly9Ab3ZlcnJpZGVcblx0cHVibGljIHBEcmF3RGVwdGhNYXAodGFyZ2V0OlRleHR1cmVCYXNlLCBzY2VuZTpTY2VuZSwgcmVuZGVyZXI6SVJlbmRlcmVyKVxuXHR7XG5cdFx0dGhpcy5fcENhc3RlckNvbGxlY3Rvci5jYW1lcmEgPSB0aGlzLl9wT3ZlcmFsbERlcHRoQ2FtZXJhO1xuXHRcdHRoaXMuX3BDYXN0ZXJDb2xsZWN0b3IuY3VsbFBsYW5lcyA9IHRoaXMuX3BDdWxsUGxhbmVzO1xuXHRcdHRoaXMuX3BDYXN0ZXJDb2xsZWN0b3IuY2xlYXIoKTtcblx0XHRzY2VuZS50cmF2ZXJzZVBhcnRpdGlvbnModGhpcy5fcENhc3RlckNvbGxlY3Rvcik7XG5cdFx0cmVuZGVyZXIuX2lSZW5kZXIodGhpcy5fcENhc3RlckNvbGxlY3RvciwgdGFyZ2V0KTtcblx0fVxuXG5cdC8vQHByb3RlY3RlZFxuXHRwdWJsaWMgcFVwZGF0ZUN1bGxQbGFuZXModmlld0NhbWVyYTpDYW1lcmEpXG5cdHtcblx0XHR2YXIgbGlnaHRGcnVzdHVtUGxhbmVzOkFycmF5PFBsYW5lM0Q+ID0gdGhpcy5fcE92ZXJhbGxEZXB0aENhbWVyYS5mcnVzdHVtUGxhbmVzO1xuXHRcdHZhciB2aWV3RnJ1c3R1bVBsYW5lczpBcnJheTxQbGFuZTNEPiA9IHZpZXdDYW1lcmEuZnJ1c3R1bVBsYW5lcztcblx0XHR0aGlzLl9wQ3VsbFBsYW5lcy5sZW5ndGggPSA0O1xuXG5cdFx0dGhpcy5fcEN1bGxQbGFuZXNbMF0gPSBsaWdodEZydXN0dW1QbGFuZXNbMF07XG5cdFx0dGhpcy5fcEN1bGxQbGFuZXNbMV0gPSBsaWdodEZydXN0dW1QbGFuZXNbMV07XG5cdFx0dGhpcy5fcEN1bGxQbGFuZXNbMl0gPSBsaWdodEZydXN0dW1QbGFuZXNbMl07XG5cdFx0dGhpcy5fcEN1bGxQbGFuZXNbM10gPSBsaWdodEZydXN0dW1QbGFuZXNbM107XG5cblx0XHR2YXIgbGlnaHQ6RGlyZWN0aW9uYWxMaWdodCA9IDxEaXJlY3Rpb25hbExpZ2h0PiB0aGlzLl9wTGlnaHQ7XG5cdFx0dmFyIGRpcjpWZWN0b3IzRCA9IGxpZ2h0LnNjZW5lRGlyZWN0aW9uO1xuXHRcdHZhciBkaXJYOm51bWJlciA9IGRpci54O1xuXHRcdHZhciBkaXJZOm51bWJlciA9IGRpci55O1xuXHRcdHZhciBkaXJaOm51bWJlciA9IGRpci56O1xuXHRcdHZhciBqOm51bWJlciA9IDQ7XG5cdFx0Zm9yICh2YXIgaTpudW1iZXIgPSAwOyBpIDwgNjsgKytpKSB7XG5cdFx0XHR2YXIgcGxhbmU6UGxhbmUzRCA9IHZpZXdGcnVzdHVtUGxhbmVzW2ldO1xuXHRcdFx0aWYgKHBsYW5lLmEqZGlyWCArIHBsYW5lLmIqZGlyWSArIHBsYW5lLmMqZGlyWiA8IDApXG5cdFx0XHRcdHRoaXMuX3BDdWxsUGxhbmVzW2orK10gPSBwbGFuZTtcblx0XHR9XG5cdH1cblxuXHQvL0BvdmVycmlkZVxuXHRwdWJsaWMgcFVwZGF0ZURlcHRoUHJvamVjdGlvbih2aWV3Q2FtZXJhOkNhbWVyYSlcblx0e1xuXHRcdHRoaXMucFVwZGF0ZVByb2plY3Rpb25Gcm9tRnJ1c3R1bUNvcm5lcnModmlld0NhbWVyYSwgdmlld0NhbWVyYS5wcm9qZWN0aW9uLmZydXN0dW1Db3JuZXJzLCB0aGlzLl9wTWF0cml4KTtcblx0XHR0aGlzLl9wT3ZlcmFsbERlcHRoUHJvamVjdGlvbi5tYXRyaXggPSB0aGlzLl9wTWF0cml4O1xuXHRcdHRoaXMucFVwZGF0ZUN1bGxQbGFuZXModmlld0NhbWVyYSk7XG5cdH1cblxuXHRwdWJsaWMgcFVwZGF0ZVByb2plY3Rpb25Gcm9tRnJ1c3R1bUNvcm5lcnModmlld0NhbWVyYTpDYW1lcmEsIGNvcm5lcnM6QXJyYXk8bnVtYmVyPiwgbWF0cml4Ok1hdHJpeDNEKVxuXHR7XG5cdFx0dmFyIHJhdzpBcnJheTxudW1iZXI+ID0gbmV3IEFycmF5PG51bWJlcj4oKTtcblx0XHR2YXIgZGlyOlZlY3RvcjNEO1xuXHRcdHZhciB4Om51bWJlciwgeTpudW1iZXIsIHo6bnVtYmVyO1xuXHRcdHZhciBtaW5YOm51bWJlciwgbWluWTpudW1iZXI7XG5cdFx0dmFyIG1heFg6bnVtYmVyLCBtYXhZOm51bWJlcjtcblx0XHR2YXIgaTpudW1iZXI7XG5cblx0XHR2YXIgbGlnaHQ6RGlyZWN0aW9uYWxMaWdodCA9IDxEaXJlY3Rpb25hbExpZ2h0PiB0aGlzLl9wTGlnaHQ7XG5cdFx0ZGlyID0gbGlnaHQuc2NlbmVEaXJlY3Rpb247XG5cdFx0dGhpcy5fcE92ZXJhbGxEZXB0aENhbWVyYS50cmFuc2Zvcm0ubWF0cml4M0QgPSB0aGlzLl9wTGlnaHQuc2NlbmVUcmFuc2Zvcm07XG5cdFx0eCA9IE1hdGguZmxvb3IoKHZpZXdDYW1lcmEueCAtIGRpci54KnRoaXMuX3BMaWdodE9mZnNldCkvdGhpcy5fcFNuYXApKnRoaXMuX3BTbmFwO1xuXHRcdHkgPSBNYXRoLmZsb29yKCh2aWV3Q2FtZXJhLnkgLSBkaXIueSp0aGlzLl9wTGlnaHRPZmZzZXQpL3RoaXMuX3BTbmFwKSp0aGlzLl9wU25hcDtcblx0XHR6ID0gTWF0aC5mbG9vcigodmlld0NhbWVyYS56IC0gZGlyLnoqdGhpcy5fcExpZ2h0T2Zmc2V0KS90aGlzLl9wU25hcCkqdGhpcy5fcFNuYXA7XG5cdFx0dGhpcy5fcE92ZXJhbGxEZXB0aENhbWVyYS54ID0geDtcblx0XHR0aGlzLl9wT3ZlcmFsbERlcHRoQ2FtZXJhLnkgPSB5O1xuXHRcdHRoaXMuX3BPdmVyYWxsRGVwdGhDYW1lcmEueiA9IHo7XG5cblx0XHR0aGlzLl9wTWF0cml4LmNvcHlGcm9tKHRoaXMuX3BPdmVyYWxsRGVwdGhDYW1lcmEuaW52ZXJzZVNjZW5lVHJhbnNmb3JtKTtcblx0XHR0aGlzLl9wTWF0cml4LnByZXBlbmQodmlld0NhbWVyYS5zY2VuZVRyYW5zZm9ybSk7XG5cdFx0dGhpcy5fcE1hdHJpeC50cmFuc2Zvcm1WZWN0b3JzKGNvcm5lcnMsIHRoaXMuX3BMb2NhbEZydXN0dW0pO1xuXG5cdFx0bWluWCA9IG1heFggPSB0aGlzLl9wTG9jYWxGcnVzdHVtWzBdO1xuXHRcdG1pblkgPSBtYXhZID0gdGhpcy5fcExvY2FsRnJ1c3R1bVsxXTtcblx0XHR0aGlzLl9wTWF4WiA9IHRoaXMuX3BMb2NhbEZydXN0dW1bMl07XG5cblx0XHRpID0gMztcblx0XHR3aGlsZSAoaSA8IDI0KSB7XG5cdFx0XHR4ID0gdGhpcy5fcExvY2FsRnJ1c3R1bVtpXTtcblx0XHRcdHkgPSB0aGlzLl9wTG9jYWxGcnVzdHVtW2kgKyAxXTtcblx0XHRcdHogPSB0aGlzLl9wTG9jYWxGcnVzdHVtW2kgKyAyXTtcblx0XHRcdGlmICh4IDwgbWluWClcblx0XHRcdFx0bWluWCA9IHg7XG5cdFx0XHRpZiAoeCA+IG1heFgpXG5cdFx0XHRcdG1heFggPSB4O1xuXHRcdFx0aWYgKHkgPCBtaW5ZKVxuXHRcdFx0XHRtaW5ZID0geTtcblx0XHRcdGlmICh5ID4gbWF4WSlcblx0XHRcdFx0bWF4WSA9IHk7XG5cdFx0XHRpZiAoeiA+IHRoaXMuX3BNYXhaKVxuXHRcdFx0XHR0aGlzLl9wTWF4WiA9IHo7XG5cdFx0XHRpICs9IDM7XG5cdFx0fVxuXG5cdFx0dGhpcy5fcE1pblogPSAxO1xuXG5cdFx0dmFyIHc6bnVtYmVyID0gbWF4WCAtIG1pblg7XG5cdFx0dmFyIGg6bnVtYmVyID0gbWF4WSAtIG1pblk7XG5cdFx0dmFyIGQ6bnVtYmVyID0gMS8odGhpcy5fcE1heFogLSB0aGlzLl9wTWluWik7XG5cblx0XHRpZiAobWluWCA8IDApXG5cdFx0XHRtaW5YIC09IHRoaXMuX3BTbmFwOyAvLyBiZWNhdXNlIGludCgpIHJvdW5kcyB1cCBmb3IgPCAwXG5cblx0XHRpZiAobWluWSA8IDApXG5cdFx0XHRtaW5ZIC09IHRoaXMuX3BTbmFwO1xuXG5cdFx0bWluWCA9IE1hdGguZmxvb3IobWluWC90aGlzLl9wU25hcCkqdGhpcy5fcFNuYXA7XG5cdFx0bWluWSA9IE1hdGguZmxvb3IobWluWS90aGlzLl9wU25hcCkqdGhpcy5fcFNuYXA7XG5cblx0XHR2YXIgc25hcDI6bnVtYmVyID0gMip0aGlzLl9wU25hcDtcblx0XHR3ID0gTWF0aC5mbG9vcih3L3NuYXAyICsgMikqc25hcDI7XG5cdFx0aCA9IE1hdGguZmxvb3IoaC9zbmFwMiArIDIpKnNuYXAyO1xuXG5cdFx0bWF4WCA9IG1pblggKyB3O1xuXHRcdG1heFkgPSBtaW5ZICsgaDtcblxuXHRcdHcgPSAxL3c7XG5cdFx0aCA9IDEvaDtcblxuXHRcdHJhd1swXSA9IDIqdztcblx0XHRyYXdbNV0gPSAyKmg7XG5cdFx0cmF3WzEwXSA9IGQ7XG5cdFx0cmF3WzEyXSA9IC0obWF4WCArIG1pblgpKnc7XG5cdFx0cmF3WzEzXSA9IC0obWF4WSArIG1pblkpKmg7XG5cdFx0cmF3WzE0XSA9IC10aGlzLl9wTWluWipkO1xuXHRcdHJhd1sxNV0gPSAxO1xuXHRcdHJhd1sxXSA9IHJhd1syXSA9IHJhd1szXSA9IHJhd1s0XSA9IHJhd1s2XSA9IHJhd1s3XSA9IHJhd1s4XSA9IHJhd1s5XSA9IHJhd1sxMV0gPSAwO1xuXG5cdFx0bWF0cml4LmNvcHlSYXdEYXRhRnJvbShyYXcpO1xuXHR9XG59XG5cbmV4cG9ydCA9IERpcmVjdGlvbmFsU2hhZG93TWFwcGVyOyJdfQ==