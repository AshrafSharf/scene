var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Matrix3D = require("awayjs-core/lib/geom/Matrix3D");
var FreeMatrixProjection = require("awayjs-core/lib/projections/FreeMatrixProjection");
var Camera = require("awayjs-display/lib/entities/Camera");
var ShadowMapperBase = require("awayjs-display/lib/materials/shadowmappers/ShadowMapperBase");
var DirectionalShadowMapper = (function (_super) {
    __extends(DirectionalShadowMapper, _super);
    function DirectionalShadowMapper() {
        _super.call(this);
        this._pLightOffset = 10000;
        this._pSnap = 64;
        this._pCullPlanes = [];
        this._pOverallDepthProjection = new FreeMatrixProjection();
        this._pOverallDepthCamera = new Camera(this._pOverallDepthProjection);
        this._pLocalFrustum = [];
        this._pMatrix = new Matrix3D();
    }
    Object.defineProperty(DirectionalShadowMapper.prototype, "snap", {
        get: function () {
            return this._pSnap;
        },
        set: function (value) {
            this._pSnap = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DirectionalShadowMapper.prototype, "lightOffset", {
        get: function () {
            return this._pLightOffset;
        },
        set: function (value) {
            this._pLightOffset = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DirectionalShadowMapper.prototype, "iDepthProjection", {
        //@arcane
        get: function () {
            return this._pOverallDepthCamera.viewProjection;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DirectionalShadowMapper.prototype, "depth", {
        //@arcane
        get: function () {
            return this._pMaxZ - this._pMinZ;
        },
        enumerable: true,
        configurable: true
    });
    //@override
    DirectionalShadowMapper.prototype.pDrawDepthMap = function (target, scene, renderer) {
        this._pCasterCollector.camera = this._pOverallDepthCamera;
        this._pCasterCollector.cullPlanes = this._pCullPlanes;
        this._pCasterCollector.clear();
        scene.traversePartitions(this._pCasterCollector);
        renderer._iRender(this._pCasterCollector, target);
    };
    //@protected
    DirectionalShadowMapper.prototype.pUpdateCullPlanes = function (viewCamera) {
        var lightFrustumPlanes = this._pOverallDepthCamera.frustumPlanes;
        var viewFrustumPlanes = viewCamera.frustumPlanes;
        this._pCullPlanes.length = 4;
        this._pCullPlanes[0] = lightFrustumPlanes[0];
        this._pCullPlanes[1] = lightFrustumPlanes[1];
        this._pCullPlanes[2] = lightFrustumPlanes[2];
        this._pCullPlanes[3] = lightFrustumPlanes[3];
        var light = this._pLight;
        var dir = light.sceneDirection;
        var dirX = dir.x;
        var dirY = dir.y;
        var dirZ = dir.z;
        var j = 4;
        for (var i = 0; i < 6; ++i) {
            var plane = viewFrustumPlanes[i];
            if (plane.a * dirX + plane.b * dirY + plane.c * dirZ < 0)
                this._pCullPlanes[j++] = plane;
        }
    };
    //@override
    DirectionalShadowMapper.prototype.pUpdateDepthProjection = function (viewCamera) {
        this.pUpdateProjectionFromFrustumCorners(viewCamera, viewCamera.projection.frustumCorners, this._pMatrix);
        this._pOverallDepthProjection.matrix = this._pMatrix;
        this.pUpdateCullPlanes(viewCamera);
    };
    DirectionalShadowMapper.prototype.pUpdateProjectionFromFrustumCorners = function (viewCamera, corners, matrix) {
        var raw = new Array();
        var dir;
        var x, y, z;
        var minX, minY;
        var maxX, maxY;
        var i;
        var light = this._pLight;
        dir = light.sceneDirection;
        this._pOverallDepthCamera.transform.matrix3D = this._pLight.sceneTransform;
        x = Math.floor((viewCamera.x - dir.x * this._pLightOffset) / this._pSnap) * this._pSnap;
        y = Math.floor((viewCamera.y - dir.y * this._pLightOffset) / this._pSnap) * this._pSnap;
        z = Math.floor((viewCamera.z - dir.z * this._pLightOffset) / this._pSnap) * this._pSnap;
        this._pOverallDepthCamera.x = x;
        this._pOverallDepthCamera.y = y;
        this._pOverallDepthCamera.z = z;
        this._pMatrix.copyFrom(this._pOverallDepthCamera.inverseSceneTransform);
        this._pMatrix.prepend(viewCamera.sceneTransform);
        this._pMatrix.transformVectors(corners, this._pLocalFrustum);
        minX = maxX = this._pLocalFrustum[0];
        minY = maxY = this._pLocalFrustum[1];
        this._pMaxZ = this._pLocalFrustum[2];
        i = 3;
        while (i < 24) {
            x = this._pLocalFrustum[i];
            y = this._pLocalFrustum[i + 1];
            z = this._pLocalFrustum[i + 2];
            if (x < minX)
                minX = x;
            if (x > maxX)
                maxX = x;
            if (y < minY)
                minY = y;
            if (y > maxY)
                maxY = y;
            if (z > this._pMaxZ)
                this._pMaxZ = z;
            i += 3;
        }
        this._pMinZ = 1;
        var w = maxX - minX;
        var h = maxY - minY;
        var d = 1 / (this._pMaxZ - this._pMinZ);
        if (minX < 0)
            minX -= this._pSnap; // because int() rounds up for < 0
        if (minY < 0)
            minY -= this._pSnap;
        minX = Math.floor(minX / this._pSnap) * this._pSnap;
        minY = Math.floor(minY / this._pSnap) * this._pSnap;
        var snap2 = 2 * this._pSnap;
        w = Math.floor(w / snap2 + 2) * snap2;
        h = Math.floor(h / snap2 + 2) * snap2;
        maxX = minX + w;
        maxY = minY + h;
        w = 1 / w;
        h = 1 / h;
        raw[0] = 2 * w;
        raw[5] = 2 * h;
        raw[10] = d;
        raw[12] = -(maxX + minX) * w;
        raw[13] = -(maxY + minY) * h;
        raw[14] = -this._pMinZ * d;
        raw[15] = 1;
        raw[1] = raw[2] = raw[3] = raw[4] = raw[6] = raw[7] = raw[8] = raw[9] = raw[11] = 0;
        matrix.copyRawDataFrom(raw);
    };
    return DirectionalShadowMapper;
})(ShadowMapperBase);
module.exports = DirectionalShadowMapper;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1kaXNwbGF5L2xpYi9tYXRlcmlhbHMvc2hhZG93bWFwcGVycy9EaXJlY3Rpb25hbFNoYWRvd01hcHBlci50cyJdLCJuYW1lcyI6WyJEaXJlY3Rpb25hbFNoYWRvd01hcHBlciIsIkRpcmVjdGlvbmFsU2hhZG93TWFwcGVyLmNvbnN0cnVjdG9yIiwiRGlyZWN0aW9uYWxTaGFkb3dNYXBwZXIuc25hcCIsIkRpcmVjdGlvbmFsU2hhZG93TWFwcGVyLmxpZ2h0T2Zmc2V0IiwiRGlyZWN0aW9uYWxTaGFkb3dNYXBwZXIuaURlcHRoUHJvamVjdGlvbiIsIkRpcmVjdGlvbmFsU2hhZG93TWFwcGVyLmRlcHRoIiwiRGlyZWN0aW9uYWxTaGFkb3dNYXBwZXIucERyYXdEZXB0aE1hcCIsIkRpcmVjdGlvbmFsU2hhZG93TWFwcGVyLnBVcGRhdGVDdWxsUGxhbmVzIiwiRGlyZWN0aW9uYWxTaGFkb3dNYXBwZXIucFVwZGF0ZURlcHRoUHJvamVjdGlvbiIsIkRpcmVjdGlvbmFsU2hhZG93TWFwcGVyLnBVcGRhdGVQcm9qZWN0aW9uRnJvbUZydXN0dW1Db3JuZXJzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFPLFFBQVEsV0FBZ0IsK0JBQStCLENBQUMsQ0FBQztBQUdoRSxJQUFPLG9CQUFvQixXQUFhLGtEQUFrRCxDQUFDLENBQUM7QUFJNUYsSUFBTyxNQUFNLFdBQWdCLG9DQUFvQyxDQUFDLENBQUM7QUFFbkUsSUFBTyxnQkFBZ0IsV0FBYyw2REFBNkQsQ0FBQyxDQUFDO0FBSXBHLElBQU0sdUJBQXVCO0lBQVNBLFVBQWhDQSx1QkFBdUJBLFVBQXlCQTtJQWNyREEsU0FkS0EsdUJBQXVCQTtRQWdCM0JDLGlCQUFPQSxDQUFDQTtRQVhGQSxrQkFBYUEsR0FBVUEsS0FBS0EsQ0FBQ0E7UUFHN0JBLFdBQU1BLEdBQVVBLEVBQUVBLENBQUNBO1FBVXpCQSxJQUFJQSxDQUFDQSxZQUFZQSxHQUFHQSxFQUFFQSxDQUFDQTtRQUN2QkEsSUFBSUEsQ0FBQ0Esd0JB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QUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUMzQkEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDL0JBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLGNBQWNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO1lBQy9CQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQTtnQkFDWkEsSUFBSUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7WUFDVkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0E7Z0JBQ1pBLElBQUlBLEdBQUdBLENBQUNBLENBQUNBO1lBQ1ZBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBO2dCQUNaQSxJQUFJQSxHQUFHQSxDQUFDQSxDQUFDQTtZQUNWQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQTtnQkFDWkEsSUFBSUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7WUFDVkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7Z0JBQ25CQSxJQUFJQSxDQUFDQSxNQUFNQSxHQUFHQSxDQUFDQSxDQUFDQTtZQUNqQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDUkEsQ0FBQ0E7UUFFREEsSUFBSUEsQ0FBQ0EsTUFBTUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFFaEJBLElBQUlBLENBQUNBLEdBQVVBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBO1FBQzNCQSxJQUFJQSxDQUFDQSxHQUFVQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUMzQkEsSUFBSUEsQ0FBQ0EsR0FBVUEsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsR0FBR0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7UUFFN0NBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLEdBQUdBLENBQUNBLENBQUNBO1lBQ1pBLElBQUlBLElBQUlBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLGtDQUFrQ0E7UUFFeERBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLEdBQUdBLENBQUNBLENBQUNBO1lBQ1pBLElBQUlBLElBQUlBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBO1FBRXJCQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxHQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxHQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQTtRQUNoREEsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsSUFBSUEsR0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsR0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7UUFFaERBLElBQUlBLEtBQUtBLEdBQVVBLENBQUNBLEdBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBO1FBQ2pDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQSxHQUFDQSxLQUFLQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFDQSxLQUFLQSxDQUFDQTtRQUNsQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsS0FBS0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsS0FBS0EsQ0FBQ0E7UUFFbENBLElBQUlBLEdBQUdBLElBQUlBLEdBQUdBLENBQUNBLENBQUNBO1FBQ2hCQSxJQUFJQSxHQUFHQSxJQUFJQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUVoQkEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDUkEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFFUkEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDYkEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDYkEsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDWkEsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDM0JBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBLEdBQUNBLENBQUNBLENBQUNBO1FBQzNCQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxHQUFDQSxDQUFDQSxDQUFDQTtRQUN6QkEsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDWkEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFFcEZBLE1BQU1BLENBQUNBLGVBQWVBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO0lBQzdCQSxDQUFDQTtJQUNGVCw4QkFBQ0E7QUFBREEsQ0FyTEEsQUFxTENBLEVBckxxQyxnQkFBZ0IsRUFxTHJEO0FBRUQsQUFBaUMsaUJBQXhCLHVCQUF1QixDQUFDIiwiZmlsZSI6Im1hdGVyaWFscy9zaGFkb3dtYXBwZXJzL0RpcmVjdGlvbmFsU2hhZG93TWFwcGVyLmpzIiwic291cmNlUm9vdCI6Ii4uLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBNYXRyaXgzRFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9nZW9tL01hdHJpeDNEXCIpO1xyXG5pbXBvcnQgUGxhbmUzRFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9nZW9tL1BsYW5lM0RcIik7XHJcbmltcG9ydCBWZWN0b3IzRFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9nZW9tL1ZlY3RvcjNEXCIpO1xyXG5pbXBvcnQgRnJlZU1hdHJpeFByb2plY3Rpb25cdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvcHJvamVjdGlvbnMvRnJlZU1hdHJpeFByb2plY3Rpb25cIik7XHJcblxyXG5pbXBvcnQgU2NlbmVcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvY29udGFpbmVycy9TY2VuZVwiKTtcclxuaW1wb3J0IElSZW5kZXJlclx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvcmVuZGVyL0lSZW5kZXJlclwiKTtcclxuaW1wb3J0IENhbWVyYVx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9DYW1lcmFcIik7XHJcbmltcG9ydCBEaXJlY3Rpb25hbExpZ2h0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvZW50aXRpZXMvRGlyZWN0aW9uYWxMaWdodFwiKTtcclxuaW1wb3J0IFNoYWRvd01hcHBlckJhc2VcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9tYXRlcmlhbHMvc2hhZG93bWFwcGVycy9TaGFkb3dNYXBwZXJCYXNlXCIpO1xyXG5pbXBvcnQgUmVuZGVyVGV4dHVyZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL3RleHR1cmVzL1JlbmRlclRleHR1cmVcIik7XHJcbmltcG9ydCBUZXh0dXJlUHJveHlCYXNlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvdGV4dHVyZXMvVGV4dHVyZVByb3h5QmFzZVwiKTtcclxuXHJcbmNsYXNzIERpcmVjdGlvbmFsU2hhZG93TWFwcGVyIGV4dGVuZHMgU2hhZG93TWFwcGVyQmFzZVxyXG57XHJcblx0cHVibGljIF9wT3ZlcmFsbERlcHRoQ2FtZXJhOkNhbWVyYTtcclxuXHRwdWJsaWMgX3BMb2NhbEZydXN0dW06QXJyYXk8bnVtYmVyPjtcclxuXHJcblx0cHVibGljIF9wTGlnaHRPZmZzZXQ6bnVtYmVyID0gMTAwMDA7XHJcblx0cHVibGljIF9wTWF0cml4Ok1hdHJpeDNEO1xyXG5cdHB1YmxpYyBfcE92ZXJhbGxEZXB0aFByb2plY3Rpb246RnJlZU1hdHJpeFByb2plY3Rpb247XHJcblx0cHVibGljIF9wU25hcDpudW1iZXIgPSA2NDtcclxuXHJcblx0cHVibGljIF9wQ3VsbFBsYW5lczpBcnJheTxQbGFuZTNEPjtcclxuXHRwdWJsaWMgX3BNaW5aOm51bWJlcjtcclxuXHRwdWJsaWMgX3BNYXhaOm51bWJlcjtcclxuXHJcblx0Y29uc3RydWN0b3IoKVxyXG5cdHtcclxuXHRcdHN1cGVyKCk7XHJcblxyXG5cdFx0dGhpcy5fcEN1bGxQbGFuZXMgPSBbXTtcclxuXHRcdHRoaXMuX3BPdmVyYWxsRGVwdGhQcm9qZWN0aW9uID0gbmV3IEZyZWVNYXRyaXhQcm9qZWN0aW9uKCk7XHJcblx0XHR0aGlzLl9wT3ZlcmFsbERlcHRoQ2FtZXJhID0gbmV3IENhbWVyYSh0aGlzLl9wT3ZlcmFsbERlcHRoUHJvamVjdGlvbik7XHJcblx0XHR0aGlzLl9wTG9jYWxGcnVzdHVtID0gW107XHJcblx0XHR0aGlzLl9wTWF0cml4ID0gbmV3IE1hdHJpeDNEKCk7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgZ2V0IHNuYXAoKTpudW1iZXJcclxuXHR7XHJcblx0XHRyZXR1cm4gdGhpcy5fcFNuYXA7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgc2V0IHNuYXAodmFsdWU6bnVtYmVyKVxyXG5cdHtcclxuXHRcdHRoaXMuX3BTbmFwID0gdmFsdWU7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgZ2V0IGxpZ2h0T2Zmc2V0KCk6bnVtYmVyXHJcblx0e1xyXG5cdFx0cmV0dXJuIHRoaXMuX3BMaWdodE9mZnNldDtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBzZXQgbGlnaHRPZmZzZXQodmFsdWU6bnVtYmVyKVxyXG5cdHtcclxuXHRcdHRoaXMuX3BMaWdodE9mZnNldCA9IHZhbHVlO1xyXG5cdH1cclxuXHJcblx0Ly9AYXJjYW5lXHJcblx0cHVibGljIGdldCBpRGVwdGhQcm9qZWN0aW9uKCk6TWF0cml4M0RcclxuXHR7XHJcblx0XHRyZXR1cm4gdGhpcy5fcE92ZXJhbGxEZXB0aENhbWVyYS52aWV3UHJvamVjdGlvbjtcclxuXHR9XHJcblxyXG5cdC8vQGFyY2FuZVxyXG5cdHB1YmxpYyBnZXQgZGVwdGgoKTpudW1iZXJcclxuXHR7XHJcblx0XHRyZXR1cm4gdGhpcy5fcE1heFogLSB0aGlzLl9wTWluWjtcclxuXHR9XHJcblxyXG5cdC8vQG92ZXJyaWRlXHJcblx0cHVibGljIHBEcmF3RGVwdGhNYXAodGFyZ2V0OlRleHR1cmVQcm94eUJhc2UsIHNjZW5lOlNjZW5lLCByZW5kZXJlcjpJUmVuZGVyZXIpXHJcblx0e1xyXG5cdFx0dGhpcy5fcENhc3RlckNvbGxlY3Rvci5jYW1lcmEgPSB0aGlzLl9wT3ZlcmFsbERlcHRoQ2FtZXJhO1xyXG5cdFx0dGhpcy5fcENhc3RlckNvbGxlY3Rvci5jdWxsUGxhbmVzID0gdGhpcy5fcEN1bGxQbGFuZXM7XHJcblx0XHR0aGlzLl9wQ2FzdGVyQ29sbGVjdG9yLmNsZWFyKCk7XHJcblx0XHRzY2VuZS50cmF2ZXJzZVBhcnRpdGlvbnModGhpcy5fcENhc3RlckNvbGxlY3Rvcik7XHJcblx0XHRyZW5kZXJlci5faVJlbmRlcih0aGlzLl9wQ2FzdGVyQ29sbGVjdG9yLCB0YXJnZXQpO1xyXG5cdH1cclxuXHJcblx0Ly9AcHJvdGVjdGVkXHJcblx0cHVibGljIHBVcGRhdGVDdWxsUGxhbmVzKHZpZXdDYW1lcmE6Q2FtZXJhKVxyXG5cdHtcclxuXHRcdHZhciBsaWdodEZydXN0dW1QbGFuZXM6QXJyYXk8UGxhbmUzRD4gPSB0aGlzLl9wT3ZlcmFsbERlcHRoQ2FtZXJhLmZydXN0dW1QbGFuZXM7XHJcblx0XHR2YXIgdmlld0ZydXN0dW1QbGFuZXM6QXJyYXk8UGxhbmUzRD4gPSB2aWV3Q2FtZXJhLmZydXN0dW1QbGFuZXM7XHJcblx0XHR0aGlzLl9wQ3VsbFBsYW5lcy5sZW5ndGggPSA0O1xyXG5cclxuXHRcdHRoaXMuX3BDdWxsUGxhbmVzWzBdID0gbGlnaHRGcnVzdHVtUGxhbmVzWzBdO1xyXG5cdFx0dGhpcy5fcEN1bGxQbGFuZXNbMV0gPSBsaWdodEZydXN0dW1QbGFuZXNbMV07XHJcblx0XHR0aGlzLl9wQ3VsbFBsYW5lc1syXSA9IGxpZ2h0RnJ1c3R1bVBsYW5lc1syXTtcclxuXHRcdHRoaXMuX3BDdWxsUGxhbmVzWzNdID0gbGlnaHRGcnVzdHVtUGxhbmVzWzNdO1xyXG5cclxuXHRcdHZhciBsaWdodDpEaXJlY3Rpb25hbExpZ2h0ID0gPERpcmVjdGlvbmFsTGlnaHQ+IHRoaXMuX3BMaWdodDtcclxuXHRcdHZhciBkaXI6VmVjdG9yM0QgPSBsaWdodC5zY2VuZURpcmVjdGlvbjtcclxuXHRcdHZhciBkaXJYOm51bWJlciA9IGRpci54O1xyXG5cdFx0dmFyIGRpclk6bnVtYmVyID0gZGlyLnk7XHJcblx0XHR2YXIgZGlyWjpudW1iZXIgPSBkaXIuejtcclxuXHRcdHZhciBqOm51bWJlciA9IDQ7XHJcblx0XHRmb3IgKHZhciBpOm51bWJlciA9IDA7IGkgPCA2OyArK2kpIHtcclxuXHRcdFx0dmFyIHBsYW5lOlBsYW5lM0QgPSB2aWV3RnJ1c3R1bVBsYW5lc1tpXTtcclxuXHRcdFx0aWYgKHBsYW5lLmEqZGlyWCArIHBsYW5lLmIqZGlyWSArIHBsYW5lLmMqZGlyWiA8IDApXHJcblx0XHRcdFx0dGhpcy5fcEN1bGxQbGFuZXNbaisrXSA9IHBsYW5lO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0Ly9Ab3ZlcnJpZGVcclxuXHRwdWJsaWMgcFVwZGF0ZURlcHRoUHJvamVjdGlvbih2aWV3Q2FtZXJhOkNhbWVyYSlcclxuXHR7XHJcblx0XHR0aGlzLnBVcGRhdGVQcm9qZWN0aW9uRnJvbUZydXN0dW1Db3JuZXJzKHZpZXdDYW1lcmEsIHZpZXdDYW1lcmEucHJvamVjdGlvbi5mcnVzdHVtQ29ybmVycywgdGhpcy5fcE1hdHJpeCk7XHJcblx0XHR0aGlzLl9wT3ZlcmFsbERlcHRoUHJvamVjdGlvbi5tYXRyaXggPSB0aGlzLl9wTWF0cml4O1xyXG5cdFx0dGhpcy5wVXBkYXRlQ3VsbFBsYW5lcyh2aWV3Q2FtZXJhKTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBwVXBkYXRlUHJvamVjdGlvbkZyb21GcnVzdHVtQ29ybmVycyh2aWV3Q2FtZXJhOkNhbWVyYSwgY29ybmVyczpBcnJheTxudW1iZXI+LCBtYXRyaXg6TWF0cml4M0QpXHJcblx0e1xyXG5cdFx0dmFyIHJhdzpBcnJheTxudW1iZXI+ID0gbmV3IEFycmF5PG51bWJlcj4oKTtcclxuXHRcdHZhciBkaXI6VmVjdG9yM0Q7XHJcblx0XHR2YXIgeDpudW1iZXIsIHk6bnVtYmVyLCB6Om51bWJlcjtcclxuXHRcdHZhciBtaW5YOm51bWJlciwgbWluWTpudW1iZXI7XHJcblx0XHR2YXIgbWF4WDpudW1iZXIsIG1heFk6bnVtYmVyO1xyXG5cdFx0dmFyIGk6bnVtYmVyO1xyXG5cclxuXHRcdHZhciBsaWdodDpEaXJlY3Rpb25hbExpZ2h0ID0gPERpcmVjdGlvbmFsTGlnaHQ+IHRoaXMuX3BMaWdodDtcclxuXHRcdGRpciA9IGxpZ2h0LnNjZW5lRGlyZWN0aW9uO1xyXG5cdFx0dGhpcy5fcE92ZXJhbGxEZXB0aENhbWVyYS50cmFuc2Zvcm0ubWF0cml4M0QgPSB0aGlzLl9wTGlnaHQuc2NlbmVUcmFuc2Zvcm07XHJcblx0XHR4ID0gTWF0aC5mbG9vcigodmlld0NhbWVyYS54IC0gZGlyLngqdGhpcy5fcExpZ2h0T2Zmc2V0KS90aGlzLl9wU25hcCkqdGhpcy5fcFNuYXA7XHJcblx0XHR5ID0gTWF0aC5mbG9vcigodmlld0NhbWVyYS55IC0gZGlyLnkqdGhpcy5fcExpZ2h0T2Zmc2V0KS90aGlzLl9wU25hcCkqdGhpcy5fcFNuYXA7XHJcblx0XHR6ID0gTWF0aC5mbG9vcigodmlld0NhbWVyYS56IC0gZGlyLnoqdGhpcy5fcExpZ2h0T2Zmc2V0KS90aGlzLl9wU25hcCkqdGhpcy5fcFNuYXA7XHJcblx0XHR0aGlzLl9wT3ZlcmFsbERlcHRoQ2FtZXJhLnggPSB4O1xyXG5cdFx0dGhpcy5fcE92ZXJhbGxEZXB0aENhbWVyYS55ID0geTtcclxuXHRcdHRoaXMuX3BPdmVyYWxsRGVwdGhDYW1lcmEueiA9IHo7XHJcblxyXG5cdFx0dGhpcy5fcE1hdHJpeC5jb3B5RnJvbSh0aGlzLl9wT3ZlcmFsbERlcHRoQ2FtZXJhLmludmVyc2VTY2VuZVRyYW5zZm9ybSk7XHJcblx0XHR0aGlzLl9wTWF0cml4LnByZXBlbmQodmlld0NhbWVyYS5zY2VuZVRyYW5zZm9ybSk7XHJcblx0XHR0aGlzLl9wTWF0cml4LnRyYW5zZm9ybVZlY3RvcnMoY29ybmVycywgdGhpcy5fcExvY2FsRnJ1c3R1bSk7XHJcblxyXG5cdFx0bWluWCA9IG1heFggPSB0aGlzLl9wTG9jYWxGcnVzdHVtWzBdO1xyXG5cdFx0bWluWSA9IG1heFkgPSB0aGlzLl9wTG9jYWxGcnVzdHVtWzFdO1xyXG5cdFx0dGhpcy5fcE1heFogPSB0aGlzLl9wTG9jYWxGcnVzdHVtWzJdO1xyXG5cclxuXHRcdGkgPSAzO1xyXG5cdFx0d2hpbGUgKGkgPCAyNCkge1xyXG5cdFx0XHR4ID0gdGhpcy5fcExvY2FsRnJ1c3R1bVtpXTtcclxuXHRcdFx0eSA9IHRoaXMuX3BMb2NhbEZydXN0dW1baSArIDFdO1xyXG5cdFx0XHR6ID0gdGhpcy5fcExvY2FsRnJ1c3R1bVtpICsgMl07XHJcblx0XHRcdGlmICh4IDwgbWluWClcclxuXHRcdFx0XHRtaW5YID0geDtcclxuXHRcdFx0aWYgKHggPiBtYXhYKVxyXG5cdFx0XHRcdG1heFggPSB4O1xyXG5cdFx0XHRpZiAoeSA8IG1pblkpXHJcblx0XHRcdFx0bWluWSA9IHk7XHJcblx0XHRcdGlmICh5ID4gbWF4WSlcclxuXHRcdFx0XHRtYXhZID0geTtcclxuXHRcdFx0aWYgKHogPiB0aGlzLl9wTWF4WilcclxuXHRcdFx0XHR0aGlzLl9wTWF4WiA9IHo7XHJcblx0XHRcdGkgKz0gMztcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLl9wTWluWiA9IDE7XHJcblxyXG5cdFx0dmFyIHc6bnVtYmVyID0gbWF4WCAtIG1pblg7XHJcblx0XHR2YXIgaDpudW1iZXIgPSBtYXhZIC0gbWluWTtcclxuXHRcdHZhciBkOm51bWJlciA9IDEvKHRoaXMuX3BNYXhaIC0gdGhpcy5fcE1pblopO1xyXG5cclxuXHRcdGlmIChtaW5YIDwgMClcclxuXHRcdFx0bWluWCAtPSB0aGlzLl9wU25hcDsgLy8gYmVjYXVzZSBpbnQoKSByb3VuZHMgdXAgZm9yIDwgMFxyXG5cclxuXHRcdGlmIChtaW5ZIDwgMClcclxuXHRcdFx0bWluWSAtPSB0aGlzLl9wU25hcDtcclxuXHJcblx0XHRtaW5YID0gTWF0aC5mbG9vcihtaW5YL3RoaXMuX3BTbmFwKSp0aGlzLl9wU25hcDtcclxuXHRcdG1pblkgPSBNYXRoLmZsb29yKG1pblkvdGhpcy5fcFNuYXApKnRoaXMuX3BTbmFwO1xyXG5cclxuXHRcdHZhciBzbmFwMjpudW1iZXIgPSAyKnRoaXMuX3BTbmFwO1xyXG5cdFx0dyA9IE1hdGguZmxvb3Iody9zbmFwMiArIDIpKnNuYXAyO1xyXG5cdFx0aCA9IE1hdGguZmxvb3IoaC9zbmFwMiArIDIpKnNuYXAyO1xyXG5cclxuXHRcdG1heFggPSBtaW5YICsgdztcclxuXHRcdG1heFkgPSBtaW5ZICsgaDtcclxuXHJcblx0XHR3ID0gMS93O1xyXG5cdFx0aCA9IDEvaDtcclxuXHJcblx0XHRyYXdbMF0gPSAyKnc7XHJcblx0XHRyYXdbNV0gPSAyKmg7XHJcblx0XHRyYXdbMTBdID0gZDtcclxuXHRcdHJhd1sxMl0gPSAtKG1heFggKyBtaW5YKSp3O1xyXG5cdFx0cmF3WzEzXSA9IC0obWF4WSArIG1pblkpKmg7XHJcblx0XHRyYXdbMTRdID0gLXRoaXMuX3BNaW5aKmQ7XHJcblx0XHRyYXdbMTVdID0gMTtcclxuXHRcdHJhd1sxXSA9IHJhd1syXSA9IHJhd1szXSA9IHJhd1s0XSA9IHJhd1s2XSA9IHJhd1s3XSA9IHJhd1s4XSA9IHJhd1s5XSA9IHJhd1sxMV0gPSAwO1xyXG5cclxuXHRcdG1hdHJpeC5jb3B5UmF3RGF0YUZyb20ocmF3KTtcclxuXHR9XHJcbn1cclxuXHJcbmV4cG9ydCA9IERpcmVjdGlvbmFsU2hhZG93TWFwcGVyOyJdfQ==