var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Event = require("awayjs-core/lib/events/Event");
var DirectionalLight = require("awayjs-display/lib/entities/DirectionalLight");
var LightProbe = require("awayjs-display/lib/entities/LightProbe");
var PointLight = require("awayjs-display/lib/entities/PointLight");
var LightEvent = require("awayjs-display/lib/events/LightEvent");
var LightPickerBase = require("awayjs-display/lib/materials/lightpickers/LightPickerBase");
/**
 * StaticLightPicker is a light picker that provides a static set of lights. The lights can be reassigned, but
 * if the configuration changes (number of directional lights, point lights, etc), a material recompilation may
 * occur.
 */
var StaticLightPicker = (function (_super) {
    __extends(StaticLightPicker, _super);
    /**
     * Creates a new StaticLightPicker object.
     * @param lights The lights to be used for shading.
     */
    function StaticLightPicker(lights) {
        var _this = this;
        _super.call(this);
        this._onCastShadowChangeDelegate = function (event) { return _this.onCastShadowChange(event); };
        this.lights = lights;
    }
    Object.defineProperty(StaticLightPicker.prototype, "lights", {
        /**
         * The lights used for shading.
         */
        get: function () {
            return this._lights;
        },
        set: function (value) {
            var numPointLights = 0;
            var numDirectionalLights = 0;
            var numCastingPointLights = 0;
            var numCastingDirectionalLights = 0;
            var numLightProbes = 0;
            var light;
            if (this._lights)
                this.clearListeners();
            this._lights = value;
            this._pAllPickedLights = value;
            this._pPointLights = new Array();
            this._pCastingPointLights = new Array();
            this._pDirectionalLights = new Array();
            this._pCastingDirectionalLights = new Array();
            this._pLightProbes = new Array();
            var len = value.length;
            for (var i = 0; i < len; ++i) {
                light = value[i];
                light.addEventListener(LightEvent.CASTS_SHADOW_CHANGE, this._onCastShadowChangeDelegate);
                if (light instanceof PointLight) {
                    if (light.castsShadows)
                        this._pCastingPointLights[numCastingPointLights++] = light;
                    else
                        this._pPointLights[numPointLights++] = light;
                }
                else if (light instanceof DirectionalLight) {
                    if (light.castsShadows)
                        this._pCastingDirectionalLights[numCastingDirectionalLights++] = light;
                    else
                        this._pDirectionalLights[numDirectionalLights++] = light;
                }
                else if (light instanceof LightProbe) {
                    this._pLightProbes[numLightProbes++] = light;
                }
            }
            if (this._pNumDirectionalLights == numDirectionalLights && this._pNumPointLights == numPointLights && this._pNumLightProbes == numLightProbes && this._pNumCastingPointLights == numCastingPointLights && this._pNumCastingDirectionalLights == numCastingDirectionalLights)
                return;
            this._pNumDirectionalLights = numDirectionalLights;
            this._pNumCastingDirectionalLights = numCastingDirectionalLights;
            this._pNumPointLights = numPointLights;
            this._pNumCastingPointLights = numCastingPointLights;
            this._pNumLightProbes = numLightProbes;
            // MUST HAVE MULTIPLE OF 4 ELEMENTS!
            this._pLightProbeWeights = new Array(Math.ceil(numLightProbes / 4) * 4);
            // notify material lights have changed
            this.dispatchEvent(new Event(Event.CHANGE));
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Remove configuration change listeners on the lights.
     */
    StaticLightPicker.prototype.clearListeners = function () {
        var len = this._lights.length;
        for (var i = 0; i < len; ++i)
            this._lights[i].removeEventListener(LightEvent.CASTS_SHADOW_CHANGE, this._onCastShadowChangeDelegate);
    };
    /**
     * Notifies the material of a configuration change.
     */
    StaticLightPicker.prototype.onCastShadowChange = function (event) {
        // TODO: Assign to special caster collections, just append it to the lights in SinglePass
        // But keep seperated in multipass
        var light = event.target;
        if (light instanceof PointLight)
            this.updatePointCasting(light);
        else if (light instanceof DirectionalLight)
            this.updateDirectionalCasting(light);
        this.dispatchEvent(new Event(Event.CHANGE));
    };
    /**
     * Called when a directional light's shadow casting configuration changes.
     */
    StaticLightPicker.prototype.updateDirectionalCasting = function (light) {
        var dl = light;
        if (light.castsShadows) {
            --this._pNumDirectionalLights;
            ++this._pNumCastingDirectionalLights;
            this._pDirectionalLights.splice(this._pDirectionalLights.indexOf(dl), 1);
            this._pCastingDirectionalLights.push(light);
        }
        else {
            ++this._pNumDirectionalLights;
            --this._pNumCastingDirectionalLights;
            this._pCastingDirectionalLights.splice(this._pCastingDirectionalLights.indexOf(dl), 1);
            this._pDirectionalLights.push(light);
        }
    };
    /**
     * Called when a point light's shadow casting configuration changes.
     */
    StaticLightPicker.prototype.updatePointCasting = function (light) {
        var pl = light;
        if (light.castsShadows) {
            --this._pNumPointLights;
            ++this._pNumCastingPointLights;
            this._pPointLights.splice(this._pPointLights.indexOf(pl), 1);
            this._pCastingPointLights.push(light);
        }
        else {
            ++this._pNumPointLights;
            --this._pNumCastingPointLights;
            this._pCastingPointLights.splice(this._pCastingPointLights.indexOf(pl), 1);
            this._pPointLights.push(light);
        }
    };
    return StaticLightPicker;
})(LightPickerBase);
module.exports = StaticLightPicker;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1kaXNwbGF5L2xpYi9tYXRlcmlhbHMvbGlnaHRwaWNrZXJzL3N0YXRpY2xpZ2h0cGlja2VyLnRzIl0sIm5hbWVzIjpbIlN0YXRpY0xpZ2h0UGlja2VyIiwiU3RhdGljTGlnaHRQaWNrZXIuY29uc3RydWN0b3IiLCJTdGF0aWNMaWdodFBpY2tlci5saWdodHMiLCJTdGF0aWNMaWdodFBpY2tlci5jbGVhckxpc3RlbmVycyIsIlN0YXRpY0xpZ2h0UGlja2VyLm9uQ2FzdFNoYWRvd0NoYW5nZSIsIlN0YXRpY0xpZ2h0UGlja2VyLnVwZGF0ZURpcmVjdGlvbmFsQ2FzdGluZyIsIlN0YXRpY0xpZ2h0UGlja2VyLnVwZGF0ZVBvaW50Q2FzdGluZyJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsSUFBTyxLQUFLLFdBQWdCLDhCQUE4QixDQUFDLENBQUM7QUFHNUQsSUFBTyxnQkFBZ0IsV0FBYyw4Q0FBOEMsQ0FBQyxDQUFDO0FBQ3JGLElBQU8sVUFBVSxXQUFlLHdDQUF3QyxDQUFDLENBQUM7QUFDMUUsSUFBTyxVQUFVLFdBQWUsd0NBQXdDLENBQUMsQ0FBQztBQUMxRSxJQUFPLFVBQVUsV0FBZSxzQ0FBc0MsQ0FBQyxDQUFDO0FBQ3hFLElBQU8sZUFBZSxXQUFjLDJEQUEyRCxDQUFDLENBQUM7QUFFakcsQUFLQTs7OztHQURHO0lBQ0csaUJBQWlCO0lBQVNBLFVBQTFCQSxpQkFBaUJBLFVBQXdCQTtJQUs5Q0E7OztPQUdHQTtJQUNIQSxTQVRLQSxpQkFBaUJBLENBU1ZBLE1BQU1BO1FBVG5CQyxpQkE4SkNBO1FBbkpDQSxpQkFBT0EsQ0FBQ0E7UUFFUkEsSUFBSUEsQ0FBQ0EsMkJBQTJCQSxHQUFHQSxVQUFDQSxLQUFnQkEsSUFBS0EsT0FBQUEsS0FBSUEsQ0FBQ0Esa0JBQWtCQSxDQUFDQSxLQUFLQSxDQUFDQSxFQUE5QkEsQ0FBOEJBLENBQUNBO1FBRXhGQSxJQUFJQSxDQUFDQSxNQUFNQSxHQUFHQSxNQUFNQSxDQUFDQTtJQUN0QkEsQ0FBQ0E7SUFL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Q0EsQ0FBQ0E7WUFDUEEsRUFBRUEsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxDQUFDQTtZQUN4QkEsRUFBRUEsSUFBSUEsQ0FBQ0EsdUJBQXVCQSxDQUFDQTtZQUUvQkEsSUFBSUEsQ0FBQ0Esb0JBQW9CQSxDQUFDQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxvQkFBb0JBLENBQUNBLE9BQU9BLENBQUNBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1lBQzNFQSxJQUFJQSxDQUFDQSxhQUFhQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQTtRQUNoQ0EsQ0FBQ0E7SUFDRkEsQ0FBQ0E7SUFDRk4sd0JBQUNBO0FBQURBLENBOUpBLEFBOEpDQSxFQTlKK0IsZUFBZSxFQThKOUM7QUFFRCxBQUEyQixpQkFBbEIsaUJBQWlCLENBQUMiLCJmaWxlIjoibWF0ZXJpYWxzL2xpZ2h0cGlja2Vycy9TdGF0aWNMaWdodFBpY2tlci5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgRXZlbnRcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZXZlbnRzL0V2ZW50XCIpO1xuXG5pbXBvcnQgTGlnaHRCYXNlXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9iYXNlL0xpZ2h0QmFzZVwiKTtcbmltcG9ydCBEaXJlY3Rpb25hbExpZ2h0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvZW50aXRpZXMvRGlyZWN0aW9uYWxMaWdodFwiKTtcbmltcG9ydCBMaWdodFByb2JlXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9MaWdodFByb2JlXCIpO1xuaW1wb3J0IFBvaW50TGlnaHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL1BvaW50TGlnaHRcIik7XG5pbXBvcnQgTGlnaHRFdmVudFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvZXZlbnRzL0xpZ2h0RXZlbnRcIik7XG5pbXBvcnQgTGlnaHRQaWNrZXJCYXNlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvbWF0ZXJpYWxzL2xpZ2h0cGlja2Vycy9MaWdodFBpY2tlckJhc2VcIik7XG5cbi8qKlxuICogU3RhdGljTGlnaHRQaWNrZXIgaXMgYSBsaWdodCBwaWNrZXIgdGhhdCBwcm92aWRlcyBhIHN0YXRpYyBzZXQgb2YgbGlnaHRzLiBUaGUgbGlnaHRzIGNhbiBiZSByZWFzc2lnbmVkLCBidXRcbiAqIGlmIHRoZSBjb25maWd1cmF0aW9uIGNoYW5nZXMgKG51bWJlciBvZiBkaXJlY3Rpb25hbCBsaWdodHMsIHBvaW50IGxpZ2h0cywgZXRjKSwgYSBtYXRlcmlhbCByZWNvbXBpbGF0aW9uIG1heVxuICogb2NjdXIuXG4gKi9cbmNsYXNzIFN0YXRpY0xpZ2h0UGlja2VyIGV4dGVuZHMgTGlnaHRQaWNrZXJCYXNlXG57XG5cdHByaXZhdGUgX2xpZ2h0czpBcnJheTxhbnk+O1xuXHRwcml2YXRlIF9vbkNhc3RTaGFkb3dDaGFuZ2VEZWxlZ2F0ZTpGdW5jdGlvbjtcblxuXHQvKipcblx0ICogQ3JlYXRlcyBhIG5ldyBTdGF0aWNMaWdodFBpY2tlciBvYmplY3QuXG5cdCAqIEBwYXJhbSBsaWdodHMgVGhlIGxpZ2h0cyB0byBiZSB1c2VkIGZvciBzaGFkaW5nLlxuXHQgKi9cblx0Y29uc3RydWN0b3IobGlnaHRzKVxuXHR7XG5cdFx0c3VwZXIoKTtcblxuXHRcdHRoaXMuX29uQ2FzdFNoYWRvd0NoYW5nZURlbGVnYXRlID0gKGV2ZW50OkxpZ2h0RXZlbnQpID0+IHRoaXMub25DYXN0U2hhZG93Q2hhbmdlKGV2ZW50KTtcblxuXHRcdHRoaXMubGlnaHRzID0gbGlnaHRzO1xuXHR9XG5cblx0LyoqXG5cdCAqIFRoZSBsaWdodHMgdXNlZCBmb3Igc2hhZGluZy5cblx0ICovXG5cdHB1YmxpYyBnZXQgbGlnaHRzKClcblx0e1xuXHRcdHJldHVybiB0aGlzLl9saWdodHM7XG5cdH1cblxuXHRwdWJsaWMgc2V0IGxpZ2h0cyh2YWx1ZTpBcnJheTxhbnk+KVxuXHR7XG5cdFx0dmFyIG51bVBvaW50TGlnaHRzOm51bWJlciA9IDA7XG5cdFx0dmFyIG51bURpcmVjdGlvbmFsTGlnaHRzOm51bWJlciA9IDA7XG5cdFx0dmFyIG51bUNhc3RpbmdQb2ludExpZ2h0czpudW1iZXIgPSAwO1xuXHRcdHZhciBudW1DYXN0aW5nRGlyZWN0aW9uYWxMaWdodHM6bnVtYmVyID0gMDtcblx0XHR2YXIgbnVtTGlnaHRQcm9iZXM6bnVtYmVyID0gMDtcblx0XHR2YXIgbGlnaHQ6TGlnaHRCYXNlO1xuXG5cdFx0aWYgKHRoaXMuX2xpZ2h0cylcblx0XHRcdHRoaXMuY2xlYXJMaXN0ZW5lcnMoKTtcblxuXHRcdHRoaXMuX2xpZ2h0cyA9IHZhbHVlO1xuXHRcdHRoaXMuX3BBbGxQaWNrZWRMaWdodHMgPSB2YWx1ZTtcblx0XHR0aGlzLl9wUG9pbnRMaWdodHMgPSBuZXcgQXJyYXk8UG9pbnRMaWdodD4oKTtcblx0XHR0aGlzLl9wQ2FzdGluZ1BvaW50TGlnaHRzID0gbmV3IEFycmF5PFBvaW50TGlnaHQ+KCk7XG5cdFx0dGhpcy5fcERpcmVjdGlvbmFsTGlnaHRzID0gbmV3IEFycmF5PERpcmVjdGlvbmFsTGlnaHQ+KCk7XG5cdFx0dGhpcy5fcENhc3RpbmdEaXJlY3Rpb25hbExpZ2h0cyA9IG5ldyBBcnJheTxEaXJlY3Rpb25hbExpZ2h0PigpO1xuXHRcdHRoaXMuX3BMaWdodFByb2JlcyA9IG5ldyBBcnJheTxMaWdodFByb2JlPigpO1xuXG5cdFx0dmFyIGxlbjpudW1iZXIgPSB2YWx1ZS5sZW5ndGg7XG5cblx0XHRmb3IgKHZhciBpOm51bWJlciA9IDA7IGkgPCBsZW47ICsraSkge1xuXHRcdFx0bGlnaHQgPSB2YWx1ZVtpXTtcblx0XHRcdGxpZ2h0LmFkZEV2ZW50TGlzdGVuZXIoTGlnaHRFdmVudC5DQVNUU19TSEFET1dfQ0hBTkdFLCB0aGlzLl9vbkNhc3RTaGFkb3dDaGFuZ2VEZWxlZ2F0ZSk7XG5cblx0XHRcdGlmIChsaWdodCBpbnN0YW5jZW9mIFBvaW50TGlnaHQpIHtcblx0XHRcdFx0aWYgKGxpZ2h0LmNhc3RzU2hhZG93cylcblx0XHRcdFx0XHR0aGlzLl9wQ2FzdGluZ1BvaW50TGlnaHRzW251bUNhc3RpbmdQb2ludExpZ2h0cysrXSA9IDxQb2ludExpZ2h0PiBsaWdodDtcblx0XHRcdFx0ZWxzZVxuXHRcdFx0XHRcdHRoaXMuX3BQb2ludExpZ2h0c1tudW1Qb2ludExpZ2h0cysrXSA9IDxQb2ludExpZ2h0PiBsaWdodDtcblxuXHRcdFx0fSBlbHNlIGlmIChsaWdodCBpbnN0YW5jZW9mIERpcmVjdGlvbmFsTGlnaHQpIHtcblx0XHRcdFx0aWYgKGxpZ2h0LmNhc3RzU2hhZG93cylcblx0XHRcdFx0XHR0aGlzLl9wQ2FzdGluZ0RpcmVjdGlvbmFsTGlnaHRzW251bUNhc3RpbmdEaXJlY3Rpb25hbExpZ2h0cysrXSA9IDxEaXJlY3Rpb25hbExpZ2h0PiBsaWdodDtcblx0XHRcdFx0ZWxzZVxuXHRcdFx0XHRcdHRoaXMuX3BEaXJlY3Rpb25hbExpZ2h0c1tudW1EaXJlY3Rpb25hbExpZ2h0cysrXSA9IDxEaXJlY3Rpb25hbExpZ2h0PiBsaWdodDtcblxuXHRcdFx0fSBlbHNlIGlmIChsaWdodCBpbnN0YW5jZW9mIExpZ2h0UHJvYmUpIHtcblx0XHRcdFx0dGhpcy5fcExpZ2h0UHJvYmVzW251bUxpZ2h0UHJvYmVzKytdID0gPExpZ2h0UHJvYmU+IGxpZ2h0O1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0aGlzLl9wTnVtRGlyZWN0aW9uYWxMaWdodHMgPT0gbnVtRGlyZWN0aW9uYWxMaWdodHMgJiYgdGhpcy5fcE51bVBvaW50TGlnaHRzID09IG51bVBvaW50TGlnaHRzICYmIHRoaXMuX3BOdW1MaWdodFByb2JlcyA9PSBudW1MaWdodFByb2JlcyAmJiB0aGlzLl9wTnVtQ2FzdGluZ1BvaW50TGlnaHRzID09IG51bUNhc3RpbmdQb2ludExpZ2h0cyAmJiB0aGlzLl9wTnVtQ2FzdGluZ0RpcmVjdGlvbmFsTGlnaHRzID09IG51bUNhc3RpbmdEaXJlY3Rpb25hbExpZ2h0cylcblx0XHRcdHJldHVybjtcblxuXHRcdHRoaXMuX3BOdW1EaXJlY3Rpb25hbExpZ2h0cyA9IG51bURpcmVjdGlvbmFsTGlnaHRzO1xuXHRcdHRoaXMuX3BOdW1DYXN0aW5nRGlyZWN0aW9uYWxMaWdodHMgPSBudW1DYXN0aW5nRGlyZWN0aW9uYWxMaWdodHM7XG5cdFx0dGhpcy5fcE51bVBvaW50TGlnaHRzID0gbnVtUG9pbnRMaWdodHM7XG5cdFx0dGhpcy5fcE51bUNhc3RpbmdQb2ludExpZ2h0cyA9IG51bUNhc3RpbmdQb2ludExpZ2h0cztcblx0XHR0aGlzLl9wTnVtTGlnaHRQcm9iZXMgPSBudW1MaWdodFByb2JlcztcblxuXHRcdC8vIE1VU1QgSEFWRSBNVUxUSVBMRSBPRiA0IEVMRU1FTlRTIVxuXHRcdHRoaXMuX3BMaWdodFByb2JlV2VpZ2h0cyA9IG5ldyBBcnJheTxudW1iZXI+KE1hdGguY2VpbChudW1MaWdodFByb2Jlcy80KSo0KTtcblxuXHRcdC8vIG5vdGlmeSBtYXRlcmlhbCBsaWdodHMgaGF2ZSBjaGFuZ2VkXG5cdFx0dGhpcy5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudChFdmVudC5DSEFOR0UpKTtcblxuXHR9XG5cblx0LyoqXG5cdCAqIFJlbW92ZSBjb25maWd1cmF0aW9uIGNoYW5nZSBsaXN0ZW5lcnMgb24gdGhlIGxpZ2h0cy5cblx0ICovXG5cdHByaXZhdGUgY2xlYXJMaXN0ZW5lcnMoKVxuXHR7XG5cdFx0dmFyIGxlbjpudW1iZXIgPSB0aGlzLl9saWdodHMubGVuZ3RoO1xuXHRcdGZvciAodmFyIGk6bnVtYmVyID0gMDsgaSA8IGxlbjsgKytpKVxuXHRcdFx0dGhpcy5fbGlnaHRzW2ldLnJlbW92ZUV2ZW50TGlzdGVuZXIoTGlnaHRFdmVudC5DQVNUU19TSEFET1dfQ0hBTkdFLCB0aGlzLl9vbkNhc3RTaGFkb3dDaGFuZ2VEZWxlZ2F0ZSk7XG5cdH1cblxuXHQvKipcblx0ICogTm90aWZpZXMgdGhlIG1hdGVyaWFsIG9mIGEgY29uZmlndXJhdGlvbiBjaGFuZ2UuXG5cdCAqL1xuXHRwcml2YXRlIG9uQ2FzdFNoYWRvd0NoYW5nZShldmVudDpMaWdodEV2ZW50KVxuXHR7XG5cdFx0Ly8gVE9ETzogQXNzaWduIHRvIHNwZWNpYWwgY2FzdGVyIGNvbGxlY3Rpb25zLCBqdXN0IGFwcGVuZCBpdCB0byB0aGUgbGlnaHRzIGluIFNpbmdsZVBhc3Ncblx0XHQvLyBCdXQga2VlcCBzZXBlcmF0ZWQgaW4gbXVsdGlwYXNzXG5cblx0XHR2YXIgbGlnaHQ6TGlnaHRCYXNlID0gPExpZ2h0QmFzZT4gZXZlbnQudGFyZ2V0O1xuXG5cdFx0aWYgKGxpZ2h0IGluc3RhbmNlb2YgUG9pbnRMaWdodClcblx0XHRcdHRoaXMudXBkYXRlUG9pbnRDYXN0aW5nKDxQb2ludExpZ2h0PiBsaWdodCk7XG5cdFx0ZWxzZSBpZiAobGlnaHQgaW5zdGFuY2VvZiBEaXJlY3Rpb25hbExpZ2h0KVxuXHRcdFx0dGhpcy51cGRhdGVEaXJlY3Rpb25hbENhc3RpbmcoPERpcmVjdGlvbmFsTGlnaHQ+IGxpZ2h0KTtcblxuXHRcdHRoaXMuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoRXZlbnQuQ0hBTkdFKSk7XG5cdH1cblxuXHQvKipcblx0ICogQ2FsbGVkIHdoZW4gYSBkaXJlY3Rpb25hbCBsaWdodCdzIHNoYWRvdyBjYXN0aW5nIGNvbmZpZ3VyYXRpb24gY2hhbmdlcy5cblx0ICovXG5cdHByaXZhdGUgdXBkYXRlRGlyZWN0aW9uYWxDYXN0aW5nKGxpZ2h0OkRpcmVjdGlvbmFsTGlnaHQpXG5cdHtcblx0XHR2YXIgZGw6RGlyZWN0aW9uYWxMaWdodCA9IDxEaXJlY3Rpb25hbExpZ2h0PiBsaWdodDtcblxuXHRcdGlmIChsaWdodC5jYXN0c1NoYWRvd3MpIHtcblx0XHRcdC0tdGhpcy5fcE51bURpcmVjdGlvbmFsTGlnaHRzO1xuXHRcdFx0Kyt0aGlzLl9wTnVtQ2FzdGluZ0RpcmVjdGlvbmFsTGlnaHRzO1xuXG5cblx0XHRcdHRoaXMuX3BEaXJlY3Rpb25hbExpZ2h0cy5zcGxpY2UodGhpcy5fcERpcmVjdGlvbmFsTGlnaHRzLmluZGV4T2YoZGwpLCAxKTtcblx0XHRcdHRoaXMuX3BDYXN0aW5nRGlyZWN0aW9uYWxMaWdodHMucHVzaChsaWdodCk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0Kyt0aGlzLl9wTnVtRGlyZWN0aW9uYWxMaWdodHM7XG5cdFx0XHQtLXRoaXMuX3BOdW1DYXN0aW5nRGlyZWN0aW9uYWxMaWdodHM7XG5cblx0XHRcdHRoaXMuX3BDYXN0aW5nRGlyZWN0aW9uYWxMaWdodHMuc3BsaWNlKHRoaXMuX3BDYXN0aW5nRGlyZWN0aW9uYWxMaWdodHMuaW5kZXhPZihkbCksIDEpO1xuXHRcdFx0dGhpcy5fcERpcmVjdGlvbmFsTGlnaHRzLnB1c2gobGlnaHQpO1xuXHRcdH1cblx0fVxuXG5cdC8qKlxuXHQgKiBDYWxsZWQgd2hlbiBhIHBvaW50IGxpZ2h0J3Mgc2hhZG93IGNhc3RpbmcgY29uZmlndXJhdGlvbiBjaGFuZ2VzLlxuXHQgKi9cblx0cHJpdmF0ZSB1cGRhdGVQb2ludENhc3RpbmcobGlnaHQ6UG9pbnRMaWdodClcblx0e1xuXHRcdHZhciBwbDpQb2ludExpZ2h0ID0gPFBvaW50TGlnaHQ+IGxpZ2h0O1xuXG5cdFx0aWYgKGxpZ2h0LmNhc3RzU2hhZG93cykge1xuXHRcdFx0LS10aGlzLl9wTnVtUG9pbnRMaWdodHM7XG5cdFx0XHQrK3RoaXMuX3BOdW1DYXN0aW5nUG9pbnRMaWdodHM7XG5cdFx0XHR0aGlzLl9wUG9pbnRMaWdodHMuc3BsaWNlKHRoaXMuX3BQb2ludExpZ2h0cy5pbmRleE9mKHBsKSwgMSk7XG5cdFx0XHR0aGlzLl9wQ2FzdGluZ1BvaW50TGlnaHRzLnB1c2gobGlnaHQpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHQrK3RoaXMuX3BOdW1Qb2ludExpZ2h0cztcblx0XHRcdC0tdGhpcy5fcE51bUNhc3RpbmdQb2ludExpZ2h0cztcblxuXHRcdFx0dGhpcy5fcENhc3RpbmdQb2ludExpZ2h0cy5zcGxpY2UodGhpcy5fcENhc3RpbmdQb2ludExpZ2h0cy5pbmRleE9mKHBsKSwgMSk7XG5cdFx0XHR0aGlzLl9wUG9pbnRMaWdodHMucHVzaChsaWdodCk7XG5cdFx0fVxuXHR9XG59XG5cbmV4cG9ydCA9IFN0YXRpY0xpZ2h0UGlja2VyOyJdfQ==