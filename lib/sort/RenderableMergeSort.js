/**
 * @class away.sort.RenderableMergeSort
 */
var RenderableMergeSort = (function () {
    function RenderableMergeSort() {
    }
    RenderableMergeSort.prototype.sortBlendedRenderables = function (head) {
        var headB;
        var fast;
        var slow;
        if (!head || !head.next) {
            return head;
        }
        // split in two sublists
        slow = head;
        fast = head.next;
        while (fast) {
            fast = fast.next;
            if (fast) {
                slow = slow.next;
                fast = fast.next;
            }
        }
        headB = slow.next;
        slow.next = null;
        // recurse
        head = this.sortBlendedRenderables(head);
        headB = this.sortBlendedRenderables(headB);
        // merge sublists while respecting order
        var result;
        var curr;
        var l;
        if (!head)
            return headB;
        if (!headB)
            return head;
        while (head && headB) {
            if (head.zIndex < headB.zIndex) {
                l = head;
                head = head.next;
            }
            else {
                l = headB;
                headB = headB.next;
            }
            if (!result)
                result = l;
            else
                curr.next = l;
            curr = l;
        }
        if (head)
            curr.next = head;
        else if (headB)
            curr.next = headB;
        return result;
    };
    RenderableMergeSort.prototype.sortOpaqueRenderables = function (head) {
        var headB;
        var fast, slow;
        if (!head || !head.next) {
            return head;
        }
        // split in two sublists
        slow = head;
        fast = head.next;
        while (fast) {
            fast = fast.next;
            if (fast) {
                slow = slow.next;
                fast = fast.next;
            }
        }
        headB = slow.next;
        slow.next = null;
        // recurse
        head = this.sortOpaqueRenderables(head);
        headB = this.sortOpaqueRenderables(headB);
        // merge sublists while respecting order
        var result;
        var curr;
        var l;
        var cmp = 0;
        if (!head)
            return headB;
        if (!headB)
            return head;
        while (head && headB && head != null && headB != null) {
            // first sort per render order id (reduces program3D switches),
            // then on render object id (reduces setting props),
            // then on zIndex (reduces overdraw)
            var aid = head.renderOrderId;
            var bid = headB.renderOrderId;
            if (aid == bid) {
                var ma = head.renderObjectId;
                var mb = headB.renderObjectId;
                if (ma == mb) {
                    if (head.zIndex < headB.zIndex)
                        cmp = 1;
                    else
                        cmp = -1;
                }
                else if (ma > mb) {
                    cmp = 1;
                }
                else {
                    cmp = -1;
                }
            }
            else if (aid > bid) {
                cmp = 1;
            }
            else {
                cmp = -1;
            }
            if (cmp < 0) {
                l = head;
                head = head.next;
            }
            else {
                l = headB;
                headB = headB.next;
            }
            if (!result) {
                result = l;
                curr = l;
            }
            else {
                curr.next = l;
                curr = l;
            }
        }
        if (head)
            curr.next = head;
        else if (headB)
            curr.next = headB;
        return result;
    };
    return RenderableMergeSort;
})();
module.exports = RenderableMergeSort;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1kaXNwbGF5L2xpYi9zb3J0L3JlbmRlcmFibGVtZXJnZXNvcnQudHMiXSwibmFtZXMiOlsiUmVuZGVyYWJsZU1lcmdlU29ydCIsIlJlbmRlcmFibGVNZXJnZVNvcnQuY29uc3RydWN0b3IiLCJSZW5kZXJhYmxlTWVyZ2VTb3J0LnNvcnRCbGVuZGVkUmVuZGVyYWJsZXMiLCJSZW5kZXJhYmxlTWVyZ2VTb3J0LnNvcnRPcGFxdWVSZW5kZXJhYmxlcyJdLCJtYXBwaW5ncyI6IkFBR0EsQUFHQTs7R0FERztJQUNHLG1CQUFtQjtJQUF6QkEsU0FBTUEsbUJBQW1CQTtJQXlKekJDLENBQUNBO0lBdkpPRCxvREFBc0JBLEdBQTdCQSxVQUE4QkEsSUFBZ0JBO1FBRTdDRSxJQUFJQSxLQUFpQkEsQ0FBQ0E7UUFDdEJBLElBQUlBLElBQWdCQSxDQUFDQTtRQUNyQkEsSUFBSUEsSUFBZ0JBLENBQUNBO1FBRXJCQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUN6QkEsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0E7UUFDYkEsQ0FBQ0E7UUFFREEsQUFDQUEsd0JBRHdCQTtRQUN4QkEsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFDWkEsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0E7UUFFakJBLE9BQU9BLElBQUlBLEVBQUVBLENBQUNBO1lBQ2JBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBLElBQUlBLENBQUNBO1lBQ2pCQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDVkEsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0E7Z0JBQ2pCQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQTtZQUNsQkEsQ0FBQ0E7UUFDRkEsQ0FBQ0E7UUFFREEsS0FBS0EsR0FBR0EsSUFBSUEsQ0FB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TUFBTUEsR0FBR0EsS0FBS0EsQ0FBQ0EsTUFBTUEsQ0FBQ0E7d0JBQzlCQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQTtvQkFBQ0EsSUFBSUE7d0JBQ2JBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO2dCQUNYQSxDQUFDQTtnQkFBQ0EsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsR0FBR0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQ3BCQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQTtnQkFDVEEsQ0FBQ0E7Z0JBQUNBLElBQUlBLENBQUNBLENBQUNBO29CQUNQQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDVkEsQ0FBQ0E7WUFDRkEsQ0FBQ0E7WUFBQ0EsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ3RCQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQTtZQUNUQSxDQUFDQTtZQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtnQkFDUEEsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDVkEsQ0FBQ0E7WUFFREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ2JBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBO2dCQUNUQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQTtZQUNsQkEsQ0FBQ0E7WUFBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7Z0JBQ1BBLENBQUNBLEdBQUdBLEtBQUtBLENBQUNBO2dCQUNWQSxLQUFLQSxHQUFHQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQTtZQUNwQkEsQ0FBQ0E7WUFFREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ2JBLE1BQU1BLEdBQUdBLENBQUNBLENBQUNBO2dCQUNYQSxJQUFJQSxHQUFHQSxDQUFDQSxDQUFDQTtZQUNWQSxDQUFDQTtZQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtnQkFDUEEsSUFBSUEsQ0FBQ0EsSUFBSUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ2RBLElBQUlBLEdBQUdBLENBQUNBLENBQUNBO1lBQ1ZBLENBQUNBO1FBQ0ZBLENBQUNBO1FBRURBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBO1lBQ1JBLElBQUlBLENBQUNBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBO1FBQUNBLElBQUlBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLEtBQUtBLENBQUNBO1lBQ2pDQSxJQUFJQSxDQUFDQSxJQUFJQSxHQUFHQSxLQUFLQSxDQUFDQTtRQUVuQkEsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7SUFDZkEsQ0FBQ0E7SUFDRkgsMEJBQUNBO0FBQURBLENBekpBLEFBeUpDQSxJQUFBO0FBRUQsQUFBNkIsaUJBQXBCLG1CQUFtQixDQUFDIiwiZmlsZSI6InNvcnQvUmVuZGVyYWJsZU1lcmdlU29ydC5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgSVJlbmRlcmFibGVcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL3Bvb2wvSVJlbmRlcmFibGVcIik7XG5pbXBvcnQgSUVudGl0eVNvcnRlclx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL3NvcnQvSUVudGl0eVNvcnRlclwiKTtcblxuLyoqXG4gKiBAY2xhc3MgYXdheS5zb3J0LlJlbmRlcmFibGVNZXJnZVNvcnRcbiAqL1xuY2xhc3MgUmVuZGVyYWJsZU1lcmdlU29ydCBpbXBsZW1lbnRzIElFbnRpdHlTb3J0ZXJcbntcblx0cHVibGljIHNvcnRCbGVuZGVkUmVuZGVyYWJsZXMoaGVhZDpJUmVuZGVyYWJsZSk6SVJlbmRlcmFibGVcblx0e1xuXHRcdHZhciBoZWFkQjpJUmVuZGVyYWJsZTtcblx0XHR2YXIgZmFzdDpJUmVuZGVyYWJsZTtcblx0XHR2YXIgc2xvdzpJUmVuZGVyYWJsZTtcblxuXHRcdGlmICghaGVhZCB8fCAhaGVhZC5uZXh0KSB7XG5cdFx0XHRyZXR1cm4gaGVhZDtcblx0XHR9XG5cblx0XHQvLyBzcGxpdCBpbiB0d28gc3VibGlzdHNcblx0XHRzbG93ID0gaGVhZDtcblx0XHRmYXN0ID0gaGVhZC5uZXh0O1xuXG5cdFx0d2hpbGUgKGZhc3QpIHtcblx0XHRcdGZhc3QgPSBmYXN0Lm5leHQ7XG5cdFx0XHRpZiAoZmFzdCkge1xuXHRcdFx0XHRzbG93ID0gc2xvdy5uZXh0O1xuXHRcdFx0XHRmYXN0ID0gZmFzdC5uZXh0O1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGhlYWRCID0gc2xvdy5uZXh0O1xuXHRcdHNsb3cubmV4dCA9IG51bGw7XG5cblx0XHQvLyByZWN1cnNlXG5cdFx0aGVhZCA9IHRoaXMuc29ydEJsZW5kZWRSZW5kZXJhYmxlcyhoZWFkKTtcblx0XHRoZWFkQiA9IHRoaXMuc29ydEJsZW5kZWRSZW5kZXJhYmxlcyhoZWFkQik7XG5cblx0XHQvLyBtZXJnZSBzdWJsaXN0cyB3aGlsZSByZXNwZWN0aW5nIG9yZGVyXG5cdFx0dmFyIHJlc3VsdDpJUmVuZGVyYWJsZTtcblx0XHR2YXIgY3VycjpJUmVuZGVyYWJsZTtcblx0XHR2YXIgbDpJUmVuZGVyYWJsZTtcblxuXHRcdGlmICghaGVhZClcblx0XHRcdHJldHVybiBoZWFkQjtcblx0XHRpZiAoIWhlYWRCKVxuXHRcdFx0cmV0dXJuIGhlYWQ7XG5cblx0XHR3aGlsZSAoaGVhZCAmJiBoZWFkQikge1xuXHRcdFx0aWYgKGhlYWQuekluZGV4IDwgaGVhZEIuekluZGV4KSB7XG5cdFx0XHRcdGwgPSBoZWFkO1xuXHRcdFx0XHRoZWFkID0gaGVhZC5uZXh0O1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0bCA9IGhlYWRCO1xuXHRcdFx0XHRoZWFkQiA9IGhlYWRCLm5leHQ7XG5cdFx0XHR9XG5cblx0XHRcdGlmICghcmVzdWx0KVxuXHRcdFx0XHRyZXN1bHQgPSBsOyBlbHNlXG5cdFx0XHRcdGN1cnIubmV4dCA9IGw7XG5cblx0XHRcdGN1cnIgPSBsO1xuXHRcdH1cblxuXHRcdGlmIChoZWFkKVxuXHRcdFx0Y3Vyci5uZXh0ID0gaGVhZDsgZWxzZSBpZiAoaGVhZEIpXG5cdFx0XHRjdXJyLm5leHQgPSBoZWFkQjtcblxuXHRcdHJldHVybiByZXN1bHQ7XG5cdH1cblxuXHRwdWJsaWMgc29ydE9wYXF1ZVJlbmRlcmFibGVzKGhlYWQ6SVJlbmRlcmFibGUpOklSZW5kZXJhYmxlXG5cdHtcblx0XHR2YXIgaGVhZEI6SVJlbmRlcmFibGU7XG5cdFx0dmFyIGZhc3Q6SVJlbmRlcmFibGUsIHNsb3c6SVJlbmRlcmFibGU7XG5cblx0XHRpZiAoIWhlYWQgfHwgIWhlYWQubmV4dCkge1xuXHRcdFx0cmV0dXJuIGhlYWQ7XG5cdFx0fVxuXG5cdFx0Ly8gc3BsaXQgaW4gdHdvIHN1Ymxpc3RzXG5cdFx0c2xvdyA9IGhlYWQ7XG5cdFx0ZmFzdCA9IGhlYWQubmV4dDtcblxuXHRcdHdoaWxlIChmYXN0KSB7XG5cdFx0XHRmYXN0ID0gZmFzdC5uZXh0O1xuXHRcdFx0aWYgKGZhc3QpIHtcblx0XHRcdFx0c2xvdyA9IHNsb3cubmV4dDtcblx0XHRcdFx0ZmFzdCA9IGZhc3QubmV4dDtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRoZWFkQiA9IHNsb3cubmV4dDtcblx0XHRzbG93Lm5leHQgPSBudWxsO1xuXG5cdFx0Ly8gcmVjdXJzZVxuXHRcdGhlYWQgPSB0aGlzLnNvcnRPcGFxdWVSZW5kZXJhYmxlcyhoZWFkKTtcblx0XHRoZWFkQiA9IHRoaXMuc29ydE9wYXF1ZVJlbmRlcmFibGVzKGhlYWRCKTtcblxuXHRcdC8vIG1lcmdlIHN1Ymxpc3RzIHdoaWxlIHJlc3BlY3Rpbmcgb3JkZXJcblx0XHR2YXIgcmVzdWx0OklSZW5kZXJhYmxlO1xuXHRcdHZhciBjdXJyOklSZW5kZXJhYmxlO1xuXHRcdHZhciBsOklSZW5kZXJhYmxlO1xuXHRcdHZhciBjbXA6bnVtYmVyID0gMDtcblxuXHRcdGlmICghaGVhZClcblx0XHRcdHJldHVybiBoZWFkQjtcblx0XHRpZiAoIWhlYWRCKVxuXHRcdFx0cmV0dXJuIGhlYWQ7XG5cblx0XHR3aGlsZSAoaGVhZCAmJiBoZWFkQiAmJiBoZWFkICE9IG51bGwgJiYgaGVhZEIgIT0gbnVsbCkge1xuXG5cdFx0XHQvLyBmaXJzdCBzb3J0IHBlciByZW5kZXIgb3JkZXIgaWQgKHJlZHVjZXMgcHJvZ3JhbTNEIHN3aXRjaGVzKSxcblx0XHRcdC8vIHRoZW4gb24gcmVuZGVyIG9iamVjdCBpZCAocmVkdWNlcyBzZXR0aW5nIHByb3BzKSxcblx0XHRcdC8vIHRoZW4gb24gekluZGV4IChyZWR1Y2VzIG92ZXJkcmF3KVxuXHRcdFx0dmFyIGFpZDpudW1iZXIgPSBoZWFkLnJlbmRlck9yZGVySWQ7XG5cdFx0XHR2YXIgYmlkOm51bWJlciA9IGhlYWRCLnJlbmRlck9yZGVySWQ7XG5cblx0XHRcdGlmIChhaWQgPT0gYmlkKSB7XG5cdFx0XHRcdHZhciBtYTpudW1iZXIgPSBoZWFkLnJlbmRlck9iamVjdElkO1xuXHRcdFx0XHR2YXIgbWI6bnVtYmVyID0gaGVhZEIucmVuZGVyT2JqZWN0SWQ7XG5cblx0XHRcdFx0aWYgKG1hID09IG1iKSB7XG5cdFx0XHRcdFx0aWYgKGhlYWQuekluZGV4IDwgaGVhZEIuekluZGV4KVxuXHRcdFx0XHRcdFx0Y21wID0gMTsgZWxzZVxuXHRcdFx0XHRcdFx0Y21wID0gLTE7XG5cdFx0XHRcdH0gZWxzZSBpZiAobWEgPiBtYikge1xuXHRcdFx0XHRcdGNtcCA9IDE7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y21wID0gLTE7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAoYWlkID4gYmlkKSB7XG5cdFx0XHRcdGNtcCA9IDE7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjbXAgPSAtMTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGNtcCA8IDApIHtcblx0XHRcdFx0bCA9IGhlYWQ7XG5cdFx0XHRcdGhlYWQgPSBoZWFkLm5leHQ7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRsID0gaGVhZEI7XG5cdFx0XHRcdGhlYWRCID0gaGVhZEIubmV4dDtcblx0XHRcdH1cblxuXHRcdFx0aWYgKCFyZXN1bHQpIHtcblx0XHRcdFx0cmVzdWx0ID0gbDtcblx0XHRcdFx0Y3VyciA9IGw7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjdXJyLm5leHQgPSBsO1xuXHRcdFx0XHRjdXJyID0gbDtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoaGVhZClcblx0XHRcdGN1cnIubmV4dCA9IGhlYWQ7IGVsc2UgaWYgKGhlYWRCKVxuXHRcdFx0Y3Vyci5uZXh0ID0gaGVhZEI7XG5cblx0XHRyZXR1cm4gcmVzdWx0O1xuXHR9XG59XG5cbmV4cG9ydCA9IFJlbmRlcmFibGVNZXJnZVNvcnQ7Il19