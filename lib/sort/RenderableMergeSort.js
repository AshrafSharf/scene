/**
 * @class away.sort.RenderableMergeSort
 */
var RenderableMergeSort = (function () {
    function RenderableMergeSort() {
    }
    RenderableMergeSort.prototype.sortBlendedRenderables = function (head) {
        var headB;
        var fast;
        var slow;
        if (!head || !head.next) {
            return head;
        }
        // split in two sublists
        slow = head;
        fast = head.next;
        while (fast) {
            fast = fast.next;
            if (fast) {
                slow = slow.next;
                fast = fast.next;
            }
        }
        headB = slow.next;
        slow.next = null;
        // recurse
        head = this.sortBlendedRenderables(head);
        headB = this.sortBlendedRenderables(headB);
        // merge sublists while respecting order
        var result;
        var curr;
        var l;
        if (!head)
            return headB;
        if (!headB)
            return head;
        while (head && headB) {
            if (head.zIndex < headB.zIndex) {
                l = head;
                head = head.next;
            }
            else {
                l = headB;
                headB = headB.next;
            }
            if (!result)
                result = l;
            else
                curr.next = l;
            curr = l;
        }
        if (head)
            curr.next = head;
        else if (headB)
            curr.next = headB;
        return result;
    };
    RenderableMergeSort.prototype.sortOpaqueRenderables = function (head) {
        var headB;
        var fast, slow;
        if (!head || !head.next) {
            return head;
        }
        // split in two sublists
        slow = head;
        fast = head.next;
        while (fast) {
            fast = fast.next;
            if (fast) {
                slow = slow.next;
                fast = fast.next;
            }
        }
        headB = slow.next;
        slow.next = null;
        // recurse
        head = this.sortOpaqueRenderables(head);
        headB = this.sortOpaqueRenderables(headB);
        // merge sublists while respecting order
        var result;
        var curr;
        var l;
        var cmp = 0;
        if (!head)
            return headB;
        if (!headB)
            return head;
        while (head && headB && head != null && headB != null) {
            // first sort per render order id (reduces program3D switches),
            // then on render object id (reduces setting props),
            // then on zIndex (reduces overdraw)
            var aid = head.renderOrderId;
            var bid = headB.renderOrderId;
            if (aid == bid) {
                var ma = head.renderObjectId;
                var mb = headB.renderObjectId;
                if (ma == mb) {
                    if (head.zIndex < headB.zIndex)
                        cmp = 1;
                    else
                        cmp = -1;
                }
                else if (ma > mb) {
                    cmp = 1;
                }
                else {
                    cmp = -1;
                }
            }
            else if (aid > bid) {
                cmp = 1;
            }
            else {
                cmp = -1;
            }
            if (cmp < 0) {
                l = head;
                head = head.next;
            }
            else {
                l = headB;
                headB = headB.next;
            }
            if (!result) {
                result = l;
                curr = l;
            }
            else {
                curr.next = l;
                curr = l;
            }
        }
        if (head)
            curr.next = head;
        else if (headB)
            curr.next = headB;
        return result;
    };
    return RenderableMergeSort;
})();
module.exports = RenderableMergeSort;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1kaXNwbGF5L2xpYi9zb3J0L1JlbmRlcmFibGVNZXJnZVNvcnQudHMiXSwibmFtZXMiOlsiUmVuZGVyYWJsZU1lcmdlU29ydCIsIlJlbmRlcmFibGVNZXJnZVNvcnQuY29uc3RydWN0b3IiLCJSZW5kZXJhYmxlTWVyZ2VTb3J0LnNvcnRCbGVuZGVkUmVuZGVyYWJsZXMiLCJSZW5kZXJhYmxlTWVyZ2VTb3J0LnNvcnRPcGFxdWVSZW5kZXJhYmxlcyJdLCJtYXBwaW5ncyI6IkFBR0EsQUFHQTs7R0FERztJQUNHLG1CQUFtQjtJQUF6QkEsU0FBTUEsbUJBQW1CQTtJQXlKekJDLENBQUNBO0lBdkpPRCxvREFBc0JBLEdBQTdCQSxVQUE4QkEsSUFBZ0JBO1FBRTdDRSxJQUFJQSxLQUFpQkEsQ0FBQ0E7UUFDdEJBLElBQUlBLElBQWdCQSxDQUFDQTtRQUNyQkEsSUFBSUEsSUFBZ0JBLENBQUNBO1FBRXJCQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUN6QkEsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0E7UUFDYkEsQ0FBQ0E7UUFFREEsQUFDQUEsd0JBRHdCQTtRQUN4QkEsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFDWkEsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0E7UUFFakJBLE9BQU9BLElBQUlBLEVBQUVBLENBQUNBO1lBQ2JBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBLElBQUlBLENBQUNBO1lBQ2pCQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDVkEsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0E7Z0JBQ2pCQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQTtZQUNsQkEsQ0FBQ0E7UUFDRkEsQ0FBQ0E7UUFFREEsS0FBS0EsR0FBR0EsSUFBSUEsQ0FB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TUFBTUEsR0FBR0EsS0FBS0EsQ0FBQ0EsTUFBTUEsQ0FBQ0E7d0JBQzlCQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQTtvQkFBQ0EsSUFBSUE7d0JBQ2JBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO2dCQUNYQSxDQUFDQTtnQkFBQ0EsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsR0FBR0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQ3BCQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQTtnQkFDVEEsQ0FBQ0E7Z0JBQUNBLElBQUlBLENBQUNBLENBQUNBO29CQUNQQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDVkEsQ0FBQ0E7WUFDRkEsQ0FBQ0E7WUFBQ0EsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ3RCQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQTtZQUNUQSxDQUFDQTtZQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtnQkFDUEEsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDVkEsQ0FBQ0E7WUFFREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ2JBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBO2dCQUNUQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQTtZQUNsQkEsQ0FBQ0E7WUFBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7Z0JBQ1BBLENBQUNBLEdBQUdBLEtBQUtBLENBQUNBO2dCQUNWQSxLQUFLQSxHQUFHQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQTtZQUNwQkEsQ0FBQ0E7WUFFREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ2JBLE1BQU1BLEdBQUdBLENBQUNBLENBQUNBO2dCQUNYQSxJQUFJQSxHQUFHQSxDQUFDQSxDQUFDQTtZQUNWQSxDQUFDQTtZQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtnQkFDUEEsSUFBSUEsQ0FBQ0EsSUFBSUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ2RBLElBQUlBLEdBQUdBLENBQUNBLENBQUNBO1lBQ1ZBLENBQUNBO1FBQ0ZBLENBQUNBO1FBRURBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBO1lBQ1JBLElBQUlBLENBQUNBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBO1FBQUNBLElBQUlBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLEtBQUtBLENBQUNBO1lBQ2pDQSxJQUFJQSxDQUFDQSxJQUFJQSxHQUFHQSxLQUFLQSxDQUFDQTtRQUVuQkEsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7SUFDZkEsQ0FBQ0E7SUFDRkgsMEJBQUNBO0FBQURBLENBekpBLEFBeUpDQSxJQUFBO0FBRUQsQUFBNkIsaUJBQXBCLG1CQUFtQixDQUFDIiwiZmlsZSI6InNvcnQvUmVuZGVyYWJsZU1lcmdlU29ydC5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgSVJlbmRlcmFibGVcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL3Bvb2wvSVJlbmRlcmFibGVcIik7XHJcbmltcG9ydCBJRW50aXR5U29ydGVyXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvc29ydC9JRW50aXR5U29ydGVyXCIpO1xyXG5cclxuLyoqXHJcbiAqIEBjbGFzcyBhd2F5LnNvcnQuUmVuZGVyYWJsZU1lcmdlU29ydFxyXG4gKi9cclxuY2xhc3MgUmVuZGVyYWJsZU1lcmdlU29ydCBpbXBsZW1lbnRzIElFbnRpdHlTb3J0ZXJcclxue1xyXG5cdHB1YmxpYyBzb3J0QmxlbmRlZFJlbmRlcmFibGVzKGhlYWQ6SVJlbmRlcmFibGUpOklSZW5kZXJhYmxlXHJcblx0e1xyXG5cdFx0dmFyIGhlYWRCOklSZW5kZXJhYmxlO1xyXG5cdFx0dmFyIGZhc3Q6SVJlbmRlcmFibGU7XHJcblx0XHR2YXIgc2xvdzpJUmVuZGVyYWJsZTtcclxuXHJcblx0XHRpZiAoIWhlYWQgfHwgIWhlYWQubmV4dCkge1xyXG5cdFx0XHRyZXR1cm4gaGVhZDtcclxuXHRcdH1cclxuXHJcblx0XHQvLyBzcGxpdCBpbiB0d28gc3VibGlzdHNcclxuXHRcdHNsb3cgPSBoZWFkO1xyXG5cdFx0ZmFzdCA9IGhlYWQubmV4dDtcclxuXHJcblx0XHR3aGlsZSAoZmFzdCkge1xyXG5cdFx0XHRmYXN0ID0gZmFzdC5uZXh0O1xyXG5cdFx0XHRpZiAoZmFzdCkge1xyXG5cdFx0XHRcdHNsb3cgPSBzbG93Lm5leHQ7XHJcblx0XHRcdFx0ZmFzdCA9IGZhc3QubmV4dDtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdGhlYWRCID0gc2xvdy5uZXh0O1xyXG5cdFx0c2xvdy5uZXh0ID0gbnVsbDtcclxuXHJcblx0XHQvLyByZWN1cnNlXHJcblx0XHRoZWFkID0gdGhpcy5zb3J0QmxlbmRlZFJlbmRlcmFibGVzKGhlYWQpO1xyXG5cdFx0aGVhZEIgPSB0aGlzLnNvcnRCbGVuZGVkUmVuZGVyYWJsZXMoaGVhZEIpO1xyXG5cclxuXHRcdC8vIG1lcmdlIHN1Ymxpc3RzIHdoaWxlIHJlc3BlY3Rpbmcgb3JkZXJcclxuXHRcdHZhciByZXN1bHQ6SVJlbmRlcmFibGU7XHJcblx0XHR2YXIgY3VycjpJUmVuZGVyYWJsZTtcclxuXHRcdHZhciBsOklSZW5kZXJhYmxlO1xyXG5cclxuXHRcdGlmICghaGVhZClcclxuXHRcdFx0cmV0dXJuIGhlYWRCO1xyXG5cdFx0aWYgKCFoZWFkQilcclxuXHRcdFx0cmV0dXJuIGhlYWQ7XHJcblxyXG5cdFx0d2hpbGUgKGhlYWQgJiYgaGVhZEIpIHtcclxuXHRcdFx0aWYgKGhlYWQuekluZGV4IDwgaGVhZEIuekluZGV4KSB7XHJcblx0XHRcdFx0bCA9IGhlYWQ7XHJcblx0XHRcdFx0aGVhZCA9IGhlYWQubmV4dDtcclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRsID0gaGVhZEI7XHJcblx0XHRcdFx0aGVhZEIgPSBoZWFkQi5uZXh0O1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAoIXJlc3VsdClcclxuXHRcdFx0XHRyZXN1bHQgPSBsOyBlbHNlXHJcblx0XHRcdFx0Y3Vyci5uZXh0ID0gbDtcclxuXHJcblx0XHRcdGN1cnIgPSBsO1xyXG5cdFx0fVxyXG5cclxuXHRcdGlmIChoZWFkKVxyXG5cdFx0XHRjdXJyLm5leHQgPSBoZWFkOyBlbHNlIGlmIChoZWFkQilcclxuXHRcdFx0Y3Vyci5uZXh0ID0gaGVhZEI7XHJcblxyXG5cdFx0cmV0dXJuIHJlc3VsdDtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBzb3J0T3BhcXVlUmVuZGVyYWJsZXMoaGVhZDpJUmVuZGVyYWJsZSk6SVJlbmRlcmFibGVcclxuXHR7XHJcblx0XHR2YXIgaGVhZEI6SVJlbmRlcmFibGU7XHJcblx0XHR2YXIgZmFzdDpJUmVuZGVyYWJsZSwgc2xvdzpJUmVuZGVyYWJsZTtcclxuXHJcblx0XHRpZiAoIWhlYWQgfHwgIWhlYWQubmV4dCkge1xyXG5cdFx0XHRyZXR1cm4gaGVhZDtcclxuXHRcdH1cclxuXHJcblx0XHQvLyBzcGxpdCBpbiB0d28gc3VibGlzdHNcclxuXHRcdHNsb3cgPSBoZWFkO1xyXG5cdFx0ZmFzdCA9IGhlYWQubmV4dDtcclxuXHJcblx0XHR3aGlsZSAoZmFzdCkge1xyXG5cdFx0XHRmYXN0ID0gZmFzdC5uZXh0O1xyXG5cdFx0XHRpZiAoZmFzdCkge1xyXG5cdFx0XHRcdHNsb3cgPSBzbG93Lm5leHQ7XHJcblx0XHRcdFx0ZmFzdCA9IGZhc3QubmV4dDtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdGhlYWRCID0gc2xvdy5uZXh0O1xyXG5cdFx0c2xvdy5uZXh0ID0gbnVsbDtcclxuXHJcblx0XHQvLyByZWN1cnNlXHJcblx0XHRoZWFkID0gdGhpcy5zb3J0T3BhcXVlUmVuZGVyYWJsZXMoaGVhZCk7XHJcblx0XHRoZWFkQiA9IHRoaXMuc29ydE9wYXF1ZVJlbmRlcmFibGVzKGhlYWRCKTtcclxuXHJcblx0XHQvLyBtZXJnZSBzdWJsaXN0cyB3aGlsZSByZXNwZWN0aW5nIG9yZGVyXHJcblx0XHR2YXIgcmVzdWx0OklSZW5kZXJhYmxlO1xyXG5cdFx0dmFyIGN1cnI6SVJlbmRlcmFibGU7XHJcblx0XHR2YXIgbDpJUmVuZGVyYWJsZTtcclxuXHRcdHZhciBjbXA6bnVtYmVyID0gMDtcclxuXHJcblx0XHRpZiAoIWhlYWQpXHJcblx0XHRcdHJldHVybiBoZWFkQjtcclxuXHRcdGlmICghaGVhZEIpXHJcblx0XHRcdHJldHVybiBoZWFkO1xyXG5cclxuXHRcdHdoaWxlIChoZWFkICYmIGhlYWRCICYmIGhlYWQgIT0gbnVsbCAmJiBoZWFkQiAhPSBudWxsKSB7XHJcblxyXG5cdFx0XHQvLyBmaXJzdCBzb3J0IHBlciByZW5kZXIgb3JkZXIgaWQgKHJlZHVjZXMgcHJvZ3JhbTNEIHN3aXRjaGVzKSxcclxuXHRcdFx0Ly8gdGhlbiBvbiByZW5kZXIgb2JqZWN0IGlkIChyZWR1Y2VzIHNldHRpbmcgcHJvcHMpLFxyXG5cdFx0XHQvLyB0aGVuIG9uIHpJbmRleCAocmVkdWNlcyBvdmVyZHJhdylcclxuXHRcdFx0dmFyIGFpZDpudW1iZXIgPSBoZWFkLnJlbmRlck9yZGVySWQ7XHJcblx0XHRcdHZhciBiaWQ6bnVtYmVyID0gaGVhZEIucmVuZGVyT3JkZXJJZDtcclxuXHJcblx0XHRcdGlmIChhaWQgPT0gYmlkKSB7XHJcblx0XHRcdFx0dmFyIG1hOm51bWJlciA9IGhlYWQucmVuZGVyT2JqZWN0SWQ7XHJcblx0XHRcdFx0dmFyIG1iOm51bWJlciA9IGhlYWRCLnJlbmRlck9iamVjdElkO1xyXG5cclxuXHRcdFx0XHRpZiAobWEgPT0gbWIpIHtcclxuXHRcdFx0XHRcdGlmIChoZWFkLnpJbmRleCA8IGhlYWRCLnpJbmRleClcclxuXHRcdFx0XHRcdFx0Y21wID0gMTsgZWxzZVxyXG5cdFx0XHRcdFx0XHRjbXAgPSAtMTtcclxuXHRcdFx0XHR9IGVsc2UgaWYgKG1hID4gbWIpIHtcclxuXHRcdFx0XHRcdGNtcCA9IDE7XHJcblx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdGNtcCA9IC0xO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSBlbHNlIGlmIChhaWQgPiBiaWQpIHtcclxuXHRcdFx0XHRjbXAgPSAxO1xyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdGNtcCA9IC0xO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAoY21wIDwgMCkge1xyXG5cdFx0XHRcdGwgPSBoZWFkO1xyXG5cdFx0XHRcdGhlYWQgPSBoZWFkLm5leHQ7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0bCA9IGhlYWRCO1xyXG5cdFx0XHRcdGhlYWRCID0gaGVhZEIubmV4dDtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0aWYgKCFyZXN1bHQpIHtcclxuXHRcdFx0XHRyZXN1bHQgPSBsO1xyXG5cdFx0XHRcdGN1cnIgPSBsO1xyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdGN1cnIubmV4dCA9IGw7XHJcblx0XHRcdFx0Y3VyciA9IGw7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRpZiAoaGVhZClcclxuXHRcdFx0Y3Vyci5uZXh0ID0gaGVhZDsgZWxzZSBpZiAoaGVhZEIpXHJcblx0XHRcdGN1cnIubmV4dCA9IGhlYWRCO1xyXG5cclxuXHRcdHJldHVybiByZXN1bHQ7XHJcblx0fVxyXG59XHJcblxyXG5leHBvcnQgPSBSZW5kZXJhYmxlTWVyZ2VTb3J0OyJdfQ==