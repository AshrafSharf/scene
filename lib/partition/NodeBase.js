var AbstractMethodError = require("awayjs-core/lib/errors/AbstractMethodError");
/**
 * @class away.partition.NodeBase
 */
var NodeBase = (function () {
    /**
     *
     */
    function NodeBase() {
        this._pNumChildNodes = 0;
        this._iNumEntities = 0;
        this._pChildNodes = new Array();
    }
    Object.defineProperty(NodeBase.prototype, "debugVisible", {
        /**
         *
         */
        get: function () {
            return this._explicitDebugVisible;
        },
        set: function (value) {
            if (this._explicitDebugVisible == value)
                return;
            this._explicitDebugVisible = value;
            this._iUpdateImplicitDebugVisible(this._iParent ? this._iParent.debugChildrenVisible : false);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NodeBase.prototype, "debugChildrenVisible", {
        get: function () {
            return this._debugChildrenVisible;
        },
        set: function (value) {
            if (this._debugChildrenVisible == value)
                return;
            this._debugChildrenVisible = value;
            for (var i = 0; i < this._pNumChildNodes; ++i)
                this._pChildNodes[i]._iUpdateImplicitDebugVisible(this._debugChildrenVisible);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NodeBase.prototype, "parent", {
        /**
         *
         */
        get: function () {
            return this._iParent;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NodeBase.prototype, "_pNumEntities", {
        /**
         *
         * @protected
         */
        get: function () {
            return this._iNumEntities;
        },
        enumerable: true,
        configurable: true
    });
    /**
     *
     * @param planes
     * @param numPlanes
     * @returns {boolean}
     * @internal
     */
    NodeBase.prototype.isInFrustum = function (planes, numPlanes) {
        return true;
    };
    /**
     *
     * @param rayPosition
     * @param rayDirection
     * @returns {boolean}
     */
    NodeBase.prototype.isIntersectingRay = function (rayPosition, rayDirection) {
        return true;
    };
    /**
     *
     * @returns {boolean}
     */
    NodeBase.prototype.isCastingShadow = function () {
        return true;
    };
    /**
     *
     * @param entity
     * @returns {away.partition.NodeBase}
     */
    NodeBase.prototype.findPartitionForEntity = function (entity) {
        return this;
    };
    /**
     *
     * @param traverser
     */
    NodeBase.prototype.acceptTraverser = function (traverser) {
        if (this._pNumEntities == 0 && !this._pImplicitDebugVisible)
            return;
        if (traverser.enterNode(this)) {
            var i = 0;
            while (i < this._pNumChildNodes)
                this._pChildNodes[i++].acceptTraverser(traverser);
            if (this._pImplicitDebugVisible && traverser.isEntityCollector)
                traverser.applyEntity(this._pDebugEntity);
        }
    };
    /**
     *
     * @protected
     */
    NodeBase.prototype.applyDebugEntity = function (traverser) {
        if (this._pDebugEntity == null)
            this._pDebugEntity = this._pCreateDebugEntity();
        traverser.applyEntity(this._pDebugEntity);
    };
    /**
     *
     * @param node
     * @internal
     */
    NodeBase.prototype.iAddNode = function (node) {
        node._iParent = this;
        this._iNumEntities += node._pNumEntities;
        this._pChildNodes[this._pNumChildNodes++] = node;
        node._iUpdateImplicitDebugVisible(this.debugChildrenVisible);
        var numEntities = node._pNumEntities;
        node = this;
        do {
            node._iNumEntities += numEntities;
        } while ((node = node._iParent) != null);
    };
    /**
     *
     * @param node
     * @internal
     */
    NodeBase.prototype.iRemoveNode = function (node) {
        var index = this._pChildNodes.indexOf(node);
        this._pChildNodes[index] = this._pChildNodes[--this._pNumChildNodes];
        this._pChildNodes.pop();
        node._iUpdateImplicitDebugVisible(false);
        var numEntities = node._pNumEntities;
        node = this;
        do {
            node._pNumEntities -= numEntities;
        } while ((node = node._iParent) != null);
    };
    NodeBase.prototype._iUpdateImplicitDebugVisible = function (value) {
        if (this._pImplicitDebugVisible == this._explicitDebugVisible || value)
            return;
        this._pImplicitDebugVisible = this._explicitDebugVisible || value;
        for (var i = 0; i < this._pNumChildNodes; ++i)
            this._pChildNodes[i]._iUpdateImplicitDebugVisible(this._debugChildrenVisible);
        if (this._pImplicitDebugVisible) {
            this._pDebugEntity = this._pCreateDebugEntity();
        }
        else {
            //this._pDebugEntity.dispose();
            this._pDebugEntity = null;
        }
    };
    NodeBase.prototype.updateDebugEntity = function () {
        if (this._pImplicitDebugVisible) {
            //this._pDebugEntity.dispose();
            this._pDebugEntity = this._pCreateDebugEntity();
        }
    };
    NodeBase.prototype._pCreateDebugEntity = function () {
        throw new AbstractMethodError();
    };
    return NodeBase;
})();
module.exports = NodeBase;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1kaXNwbGF5L2xpYi9wYXJ0aXRpb24vTm9kZUJhc2UudHMiXSwibmFtZXMiOlsiTm9kZUJhc2UiLCJOb2RlQmFzZS5jb25zdHJ1Y3RvciIsIk5vZGVCYXNlLmRlYnVnVmlzaWJsZSIsIk5vZGVCYXNlLmRlYnVnQ2hpbGRyZW5WaXNpYmxlIiwiTm9kZUJhc2UucGFyZW50IiwiTm9kZUJhc2UuX3BOdW1FbnRpdGllcyIsIk5vZGVCYXNlLmlzSW5GcnVzdHVtIiwiTm9kZUJhc2UuaXNJbnRlcnNlY3RpbmdSYXkiLCJOb2RlQmFzZS5pc0Nhc3RpbmdTaGFkb3ciLCJOb2RlQmFzZS5maW5kUGFydGl0aW9uRm9yRW50aXR5IiwiTm9kZUJhc2UuYWNjZXB0VHJhdmVyc2VyIiwiTm9kZUJhc2UuYXBwbHlEZWJ1Z0VudGl0eSIsIk5vZGVCYXNlLmlBZGROb2RlIiwiTm9kZUJhc2UuaVJlbW92ZU5vZGUiLCJOb2RlQmFzZS5faVVwZGF0ZUltcGxpY2l0RGVidWdWaXNpYmxlIiwiTm9kZUJhc2UudXBkYXRlRGVidWdFbnRpdHkiLCJOb2RlQmFzZS5fcENyZWF0ZURlYnVnRW50aXR5Il0sIm1hcHBpbmdzIjoiQUFFQSxJQUFPLG1CQUFtQixXQUFhLDRDQUE0QyxDQUFDLENBQUM7QUFLckYsQUFHQTs7R0FERztJQUNHLFFBQVE7SUFrRWJBOztPQUVHQTtJQUNIQSxTQXJFS0EsUUFBUUE7UUFPTkMsb0JBQWVBLEdBQVVBLENBQUNBLENBQUNBO1FBSTNCQSxrQkFBYUEsR0FBVUEsQ0FBQ0EsQ0FBQ0E7UUE0RC9CQSxJQUFJQSxDQUFDQSxZQUFZQSxHQUFHQSxJQUFJQSxLQUFLQSxFQUFZQSxDQUFDQTtJQUMzQ0EsQ0FBQ0E7SUF2RERELHNCQUFXQSxrQ0FBWUE7UUFIdkJBOztXQUVHQTthQUNIQTtZQUVDRSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxxQkFBcUJBLENBQUNBO1FBQ25DQSxDQUFDQTthQUVERixVQUF3QkEsS0FBYUE7WUFFcENFLEVBQUVBLENBQUNB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QUNBLENBQUNBO1FBRS9FQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxzQkFBc0JBLENBQUNBLENBQUNBLENBQUNBO1lBQ2pDQSxJQUFJQSxDQUFDQSxhQUFhQSxHQUFHQSxJQUFJQSxDQUFDQSxtQkFBbUJBLEVBQUVBLENBQUNBO1FBQ2pEQSxDQUFDQTtRQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUNQQSxBQUNBQSwrQkFEK0JBO1lBQy9CQSxJQUFJQSxDQUFDQSxhQUFhQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUMzQkEsQ0FBQ0E7SUFFRkEsQ0FBQ0E7SUFFTWQsb0NBQWlCQSxHQUF4QkE7UUFFQ2UsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0Esc0JBQXNCQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNqQ0EsQUFDQUEsK0JBRCtCQTtZQUMvQkEsSUFBSUEsQ0FBQ0EsYUFBYUEsR0FBR0EsSUFBSUEsQ0FBQ0EsbUJBQW1CQSxFQUFFQSxDQUFDQTtRQUNqREEsQ0FBQ0E7SUFDRkEsQ0FBQ0E7SUFFTWYsc0NBQW1CQSxHQUExQkE7UUFFQ2dCLE1BQU1BLElBQUlBLG1CQUFtQkEsRUFBRUEsQ0FBQ0E7SUFDakNBLENBQUNBO0lBQ0ZoQixlQUFDQTtBQUFEQSxDQTdOQSxBQTZOQ0EsSUFBQTtBQUVELEFBQWtCLGlCQUFULFFBQVEsQ0FBQyIsImZpbGUiOiJwYXJ0aXRpb24vTm9kZUJhc2UuanMiLCJzb3VyY2VSb290IjoiLi4vIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFBsYW5lM0RcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9QbGFuZTNEXCIpO1xuaW1wb3J0IFZlY3RvcjNEXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vVmVjdG9yM0RcIik7XG5pbXBvcnQgQWJzdHJhY3RNZXRob2RFcnJvclx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9lcnJvcnMvQWJzdHJhY3RNZXRob2RFcnJvclwiKTtcblxuaW1wb3J0IENvbGxlY3RvckJhc2VcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi90cmF2ZXJzZS9Db2xsZWN0b3JCYXNlXCIpO1xuaW1wb3J0IElFbnRpdHlcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvZW50aXRpZXMvSUVudGl0eVwiKTtcblxuLyoqXG4gKiBAY2xhc3MgYXdheS5wYXJ0aXRpb24uTm9kZUJhc2VcbiAqL1xuY2xhc3MgTm9kZUJhc2Vcbntcblx0cHJpdmF0ZSBfZGVidWdDaGlsZHJlblZpc2libGU6Ym9vbGVhbjtcblx0cHJpdmF0ZSBfZXhwbGljaXREZWJ1Z1Zpc2libGU6Ym9vbGVhbjtcblx0cHVibGljIF9wSW1wbGljaXREZWJ1Z1Zpc2libGU6Ym9vbGVhbjtcblx0cHVibGljIF9pUGFyZW50Ok5vZGVCYXNlO1xuXHRwdWJsaWMgX3BDaGlsZE5vZGVzOkFycmF5PE5vZGVCYXNlPjtcblx0cHVibGljIF9wTnVtQ2hpbGROb2RlczpudW1iZXIgPSAwO1xuXG5cdHB1YmxpYyBfcERlYnVnRW50aXR5OklFbnRpdHk7XG5cblx0cHVibGljIF9pTnVtRW50aXRpZXM6bnVtYmVyID0gMDtcblx0cHVibGljIF9pQ29sbGVjdGlvbk1hcms6bnVtYmVyOy8vID0gMDtcblxuXHQvKipcblx0ICpcblx0ICovXG5cdHB1YmxpYyBnZXQgZGVidWdWaXNpYmxlKCk6Ym9vbGVhblxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuX2V4cGxpY2l0RGVidWdWaXNpYmxlO1xuXHR9XG5cblx0cHVibGljIHNldCBkZWJ1Z1Zpc2libGUodmFsdWU6Ym9vbGVhbilcblx0e1xuXHRcdGlmICh0aGlzLl9leHBsaWNpdERlYnVnVmlzaWJsZSA9PSB2YWx1ZSlcblx0XHRcdHJldHVybjtcblxuXHRcdHRoaXMuX2V4cGxpY2l0RGVidWdWaXNpYmxlID0gdmFsdWU7XG5cblx0XHR0aGlzLl9pVXBkYXRlSW1wbGljaXREZWJ1Z1Zpc2libGUodGhpcy5faVBhcmVudD8gdGhpcy5faVBhcmVudC5kZWJ1Z0NoaWxkcmVuVmlzaWJsZSA6IGZhbHNlKTtcblxuXHR9XG5cblx0cHVibGljIGdldCBkZWJ1Z0NoaWxkcmVuVmlzaWJsZSgpOmJvb2xlYW5cblx0e1xuXHRcdHJldHVybiB0aGlzLl9kZWJ1Z0NoaWxkcmVuVmlzaWJsZTtcblx0fVxuXG5cdHB1YmxpYyBzZXQgZGVidWdDaGlsZHJlblZpc2libGUodmFsdWU6Ym9vbGVhbilcblx0e1xuXHRcdGlmICh0aGlzLl9kZWJ1Z0NoaWxkcmVuVmlzaWJsZSA9PSB2YWx1ZSlcblx0XHRcdHJldHVybjtcblxuXHRcdHRoaXMuX2RlYnVnQ2hpbGRyZW5WaXNpYmxlID0gdmFsdWU7XG5cblx0XHRmb3IgKHZhciBpOm51bWJlciA9IDA7IGkgPCB0aGlzLl9wTnVtQ2hpbGROb2RlczsgKytpKVxuXHRcdFx0dGhpcy5fcENoaWxkTm9kZXNbaV0uX2lVcGRhdGVJbXBsaWNpdERlYnVnVmlzaWJsZSh0aGlzLl9kZWJ1Z0NoaWxkcmVuVmlzaWJsZSk7XG5cdH1cblxuXHQvKipcblx0ICpcblx0ICovXG5cdHB1YmxpYyBnZXQgcGFyZW50KCk6Tm9kZUJhc2Vcblx0e1xuXHRcdHJldHVybiB0aGlzLl9pUGFyZW50O1xuXHR9XG5cblx0LyoqXG5cdCAqXG5cdCAqIEBwcm90ZWN0ZWRcblx0ICovXG5cdHB1YmxpYyBnZXQgX3BOdW1FbnRpdGllcygpOm51bWJlclxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuX2lOdW1FbnRpdGllcztcblx0fVxuXG5cdC8qKlxuXHQgKlxuXHQgKi9cblx0Y29uc3RydWN0b3IoKVxuXHR7XG5cdFx0dGhpcy5fcENoaWxkTm9kZXMgPSBuZXcgQXJyYXk8Tm9kZUJhc2U+KCk7XG5cdH1cblxuXHQvKipcblx0ICpcblx0ICogQHBhcmFtIHBsYW5lc1xuXHQgKiBAcGFyYW0gbnVtUGxhbmVzXG5cdCAqIEByZXR1cm5zIHtib29sZWFufVxuXHQgKiBAaW50ZXJuYWxcblx0ICovXG5cdHB1YmxpYyBpc0luRnJ1c3R1bShwbGFuZXM6QXJyYXk8UGxhbmUzRD4sIG51bVBsYW5lczpudW1iZXIpOmJvb2xlYW5cblx0e1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0LyoqXG5cdCAqXG5cdCAqIEBwYXJhbSByYXlQb3NpdGlvblxuXHQgKiBAcGFyYW0gcmF5RGlyZWN0aW9uXG5cdCAqIEByZXR1cm5zIHtib29sZWFufVxuXHQgKi9cblx0cHVibGljIGlzSW50ZXJzZWN0aW5nUmF5KHJheVBvc2l0aW9uOlZlY3RvcjNELCByYXlEaXJlY3Rpb246VmVjdG9yM0QpOmJvb2xlYW5cblx0e1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0LyoqXG5cdCAqXG5cdCAqIEByZXR1cm5zIHtib29sZWFufVxuXHQgKi9cblx0cHVibGljIGlzQ2FzdGluZ1NoYWRvdygpOmJvb2xlYW5cblx0e1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0LyoqXG5cdCAqXG5cdCAqIEBwYXJhbSBlbnRpdHlcblx0ICogQHJldHVybnMge2F3YXkucGFydGl0aW9uLk5vZGVCYXNlfVxuXHQgKi9cblx0cHVibGljIGZpbmRQYXJ0aXRpb25Gb3JFbnRpdHkoZW50aXR5OklFbnRpdHkpOk5vZGVCYXNlXG5cdHtcblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKlxuXHQgKlxuXHQgKiBAcGFyYW0gdHJhdmVyc2VyXG5cdCAqL1xuXHRwdWJsaWMgYWNjZXB0VHJhdmVyc2VyKHRyYXZlcnNlcjpDb2xsZWN0b3JCYXNlKVxuXHR7XG5cdFx0aWYgKHRoaXMuX3BOdW1FbnRpdGllcyA9PSAwICYmICF0aGlzLl9wSW1wbGljaXREZWJ1Z1Zpc2libGUpXG5cdFx0XHRyZXR1cm47XG5cblx0XHRpZiAodHJhdmVyc2VyLmVudGVyTm9kZSh0aGlzKSkge1xuXHRcdFx0dmFyIGk6bnVtYmVyID0gMDtcblxuXHRcdFx0d2hpbGUgKGkgPCB0aGlzLl9wTnVtQ2hpbGROb2Rlcylcblx0XHRcdFx0dGhpcy5fcENoaWxkTm9kZXNbaSsrXS5hY2NlcHRUcmF2ZXJzZXIodHJhdmVyc2VyKTtcblxuXHRcdFx0aWYgKHRoaXMuX3BJbXBsaWNpdERlYnVnVmlzaWJsZSAmJiB0cmF2ZXJzZXIuaXNFbnRpdHlDb2xsZWN0b3IpXG5cdFx0XHRcdHRyYXZlcnNlci5hcHBseUVudGl0eSh0aGlzLl9wRGVidWdFbnRpdHkpO1xuXHRcdH1cblx0fVxuXG5cdC8qKlxuXHQgKlxuXHQgKiBAcHJvdGVjdGVkXG5cdCAqL1xuXHRwdWJsaWMgYXBwbHlEZWJ1Z0VudGl0eSh0cmF2ZXJzZXI6Q29sbGVjdG9yQmFzZSlcblx0e1xuXHRcdGlmICh0aGlzLl9wRGVidWdFbnRpdHkgPT0gbnVsbClcblx0XHRcdHRoaXMuX3BEZWJ1Z0VudGl0eSA9IHRoaXMuX3BDcmVhdGVEZWJ1Z0VudGl0eSgpO1xuXG5cdFx0dHJhdmVyc2VyLmFwcGx5RW50aXR5KHRoaXMuX3BEZWJ1Z0VudGl0eSk7XG5cdH1cblxuXHQvKipcblx0ICpcblx0ICogQHBhcmFtIG5vZGVcblx0ICogQGludGVybmFsXG5cdCAqL1xuXHRwdWJsaWMgaUFkZE5vZGUobm9kZTpOb2RlQmFzZSlcblx0e1xuXHRcdG5vZGUuX2lQYXJlbnQgPSB0aGlzO1xuXHRcdHRoaXMuX2lOdW1FbnRpdGllcyArPSBub2RlLl9wTnVtRW50aXRpZXM7XG5cdFx0dGhpcy5fcENoaWxkTm9kZXNbIHRoaXMuX3BOdW1DaGlsZE5vZGVzKysgXSA9IG5vZGU7XG5cblx0XHRub2RlLl9pVXBkYXRlSW1wbGljaXREZWJ1Z1Zpc2libGUodGhpcy5kZWJ1Z0NoaWxkcmVuVmlzaWJsZSk7XG5cblx0XHR2YXIgbnVtRW50aXRpZXM6bnVtYmVyID0gbm9kZS5fcE51bUVudGl0aWVzO1xuXHRcdG5vZGUgPSB0aGlzO1xuXG5cdFx0ZG8ge1xuXHRcdFx0bm9kZS5faU51bUVudGl0aWVzICs9IG51bUVudGl0aWVzO1xuXHRcdH0gd2hpbGUgKChub2RlID0gbm9kZS5faVBhcmVudCkgIT0gbnVsbCk7XG5cdH1cblxuXHQvKipcblx0ICpcblx0ICogQHBhcmFtIG5vZGVcblx0ICogQGludGVybmFsXG5cdCAqL1xuXHRwdWJsaWMgaVJlbW92ZU5vZGUobm9kZTpOb2RlQmFzZSlcblx0e1xuXHRcdHZhciBpbmRleDpudW1iZXIgPSB0aGlzLl9wQ2hpbGROb2Rlcy5pbmRleE9mKG5vZGUpO1xuXHRcdHRoaXMuX3BDaGlsZE5vZGVzW2luZGV4XSA9IHRoaXMuX3BDaGlsZE5vZGVzWy0tdGhpcy5fcE51bUNoaWxkTm9kZXNdO1xuXHRcdHRoaXMuX3BDaGlsZE5vZGVzLnBvcCgpO1xuXG5cdFx0bm9kZS5faVVwZGF0ZUltcGxpY2l0RGVidWdWaXNpYmxlKGZhbHNlKTtcblxuXHRcdHZhciBudW1FbnRpdGllczpudW1iZXIgPSBub2RlLl9wTnVtRW50aXRpZXM7XG5cdFx0bm9kZSA9IHRoaXM7XG5cblx0XHRkbyB7XG5cdFx0XHRub2RlLl9wTnVtRW50aXRpZXMgLT0gbnVtRW50aXRpZXM7XG5cdFx0fSB3aGlsZSAoKG5vZGUgPSBub2RlLl9pUGFyZW50KSAhPSBudWxsKTtcblx0fVxuXG5cdHByaXZhdGUgX2lVcGRhdGVJbXBsaWNpdERlYnVnVmlzaWJsZSh2YWx1ZTpib29sZWFuKVxuXHR7XG5cdFx0aWYgKHRoaXMuX3BJbXBsaWNpdERlYnVnVmlzaWJsZSA9PSB0aGlzLl9leHBsaWNpdERlYnVnVmlzaWJsZSB8fCB2YWx1ZSlcblx0XHRcdHJldHVybjtcblxuXHRcdHRoaXMuX3BJbXBsaWNpdERlYnVnVmlzaWJsZSA9IHRoaXMuX2V4cGxpY2l0RGVidWdWaXNpYmxlIHx8IHZhbHVlO1xuXG5cdFx0Zm9yICh2YXIgaTpudW1iZXIgPSAwOyBpIDwgdGhpcy5fcE51bUNoaWxkTm9kZXM7ICsraSlcblx0XHRcdHRoaXMuX3BDaGlsZE5vZGVzW2ldLl9pVXBkYXRlSW1wbGljaXREZWJ1Z1Zpc2libGUodGhpcy5fZGVidWdDaGlsZHJlblZpc2libGUpO1xuXG5cdFx0aWYgKHRoaXMuX3BJbXBsaWNpdERlYnVnVmlzaWJsZSkge1xuXHRcdFx0dGhpcy5fcERlYnVnRW50aXR5ID0gdGhpcy5fcENyZWF0ZURlYnVnRW50aXR5KCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdC8vdGhpcy5fcERlYnVnRW50aXR5LmRpc3Bvc2UoKTtcblx0XHRcdHRoaXMuX3BEZWJ1Z0VudGl0eSA9IG51bGw7XG5cdFx0fVxuXHRcdFxuXHR9XG5cblx0cHVibGljIHVwZGF0ZURlYnVnRW50aXR5KClcblx0e1xuXHRcdGlmICh0aGlzLl9wSW1wbGljaXREZWJ1Z1Zpc2libGUpIHtcblx0XHRcdC8vdGhpcy5fcERlYnVnRW50aXR5LmRpc3Bvc2UoKTtcblx0XHRcdHRoaXMuX3BEZWJ1Z0VudGl0eSA9IHRoaXMuX3BDcmVhdGVEZWJ1Z0VudGl0eSgpO1xuXHRcdH1cblx0fVxuXG5cdHB1YmxpYyBfcENyZWF0ZURlYnVnRW50aXR5KCk6SUVudGl0eVxuXHR7XG5cdFx0dGhyb3cgbmV3IEFic3RyYWN0TWV0aG9kRXJyb3IoKTtcblx0fVxufVxuXG5leHBvcnQgPSBOb2RlQmFzZTsiXX0=