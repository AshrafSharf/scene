var AbstractMethodError = require("awayjs-core/lib/errors/AbstractMethodError");
/**
 * @class away.partition.NodeBase
 */
var NodeBase = (function () {
    /**
     *
     */
    function NodeBase() {
        this._pNumChildNodes = 0;
        this._iNumEntities = 0;
        this._pChildNodes = new Array();
    }
    Object.defineProperty(NodeBase.prototype, "debugVisible", {
        /**
         *
         */
        get: function () {
            return this._explicitDebugVisible;
        },
        set: function (value) {
            if (this._explicitDebugVisible == value)
                return;
            this._explicitDebugVisible = value;
            this._iUpdateImplicitDebugVisible(this._iParent ? this._iParent.debugChildrenVisible : false);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NodeBase.prototype, "debugChildrenVisible", {
        get: function () {
            return this._debugChildrenVisible;
        },
        set: function (value) {
            if (this._debugChildrenVisible == value)
                return;
            this._debugChildrenVisible = value;
            for (var i = 0; i < this._pNumChildNodes; ++i)
                this._pChildNodes[i]._iUpdateImplicitDebugVisible(this._debugChildrenVisible);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NodeBase.prototype, "parent", {
        /**
         *
         */
        get: function () {
            return this._iParent;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NodeBase.prototype, "_pNumEntities", {
        /**
         *
         * @protected
         */
        get: function () {
            return this._iNumEntities;
        },
        enumerable: true,
        configurable: true
    });
    /**
     *
     * @param planes
     * @param numPlanes
     * @returns {boolean}
     * @internal
     */
    NodeBase.prototype.isInFrustum = function (planes, numPlanes) {
        return true;
    };
    /**
     *
     * @param rayPosition
     * @param rayDirection
     * @returns {boolean}
     */
    NodeBase.prototype.isIntersectingRay = function (rayPosition, rayDirection) {
        return true;
    };
    /**
     *
     * @returns {boolean}
     */
    NodeBase.prototype.isCastingShadow = function () {
        return true;
    };
    /**
     *
     * @param entity
     * @returns {away.partition.NodeBase}
     */
    NodeBase.prototype.findPartitionForEntity = function (entity) {
        return this;
    };
    /**
     *
     * @param traverser
     */
    NodeBase.prototype.acceptTraverser = function (traverser) {
        if (this._pNumEntities == 0 && !this._pImplicitDebugVisible)
            return;
        if (traverser.enterNode(this)) {
            var i = 0;
            while (i < this._pNumChildNodes)
                this._pChildNodes[i++].acceptTraverser(traverser);
            if (this._pImplicitDebugVisible && traverser.isEntityCollector)
                traverser.applyEntity(this._pDebugEntity);
        }
    };
    /**
     *
     * @protected
     */
    NodeBase.prototype.applyDebugEntity = function (traverser) {
        if (this._pDebugEntity == null)
            this._pDebugEntity = this._pCreateDebugEntity();
        traverser.applyEntity(this._pDebugEntity);
    };
    /**
     *
     * @param node
     * @internal
     */
    NodeBase.prototype.iAddNode = function (node) {
        node._iParent = this;
        this._iNumEntities += node._pNumEntities;
        this._pChildNodes[this._pNumChildNodes++] = node;
        node._iUpdateImplicitDebugVisible(this.debugChildrenVisible);
        var numEntities = node._pNumEntities;
        node = this;
        do {
            node._iNumEntities += numEntities;
        } while ((node = node._iParent) != null);
    };
    /**
     *
     * @param node
     * @internal
     */
    NodeBase.prototype.iRemoveNode = function (node) {
        var index = this._pChildNodes.indexOf(node);
        this._pChildNodes[index] = this._pChildNodes[--this._pNumChildNodes];
        this._pChildNodes.pop();
        node._iUpdateImplicitDebugVisible(false);
        var numEntities = node._pNumEntities;
        node = this;
        do {
            node._pNumEntities -= numEntities;
        } while ((node = node._iParent) != null);
    };
    NodeBase.prototype._iUpdateImplicitDebugVisible = function (value) {
        if (this._pImplicitDebugVisible == this._explicitDebugVisible || value)
            return;
        this._pImplicitDebugVisible = this._explicitDebugVisible || value;
        for (var i = 0; i < this._pNumChildNodes; ++i)
            this._pChildNodes[i]._iUpdateImplicitDebugVisible(this._debugChildrenVisible);
        if (this._pImplicitDebugVisible) {
            this._pDebugEntity = this._pCreateDebugEntity();
        }
        else {
            //this._pDebugEntity.dispose();
            this._pDebugEntity = null;
        }
    };
    NodeBase.prototype.updateDebugEntity = function () {
        if (this._pImplicitDebugVisible) {
            //this._pDebugEntity.dispose();
            this._pDebugEntity = this._pCreateDebugEntity();
        }
    };
    NodeBase.prototype._pCreateDebugEntity = function () {
        throw new AbstractMethodError();
    };
    return NodeBase;
})();
module.exports = NodeBase;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1kaXNwbGF5L2xpYi9wYXJ0aXRpb24vTm9kZUJhc2UudHMiXSwibmFtZXMiOlsiTm9kZUJhc2UiLCJOb2RlQmFzZS5jb25zdHJ1Y3RvciIsIk5vZGVCYXNlLmRlYnVnVmlzaWJsZSIsIk5vZGVCYXNlLmRlYnVnQ2hpbGRyZW5WaXNpYmxlIiwiTm9kZUJhc2UucGFyZW50IiwiTm9kZUJhc2UuX3BOdW1FbnRpdGllcyIsIk5vZGVCYXNlLmlzSW5GcnVzdHVtIiwiTm9kZUJhc2UuaXNJbnRlcnNlY3RpbmdSYXkiLCJOb2RlQmFzZS5pc0Nhc3RpbmdTaGFkb3ciLCJOb2RlQmFzZS5maW5kUGFydGl0aW9uRm9yRW50aXR5IiwiTm9kZUJhc2UuYWNjZXB0VHJhdmVyc2VyIiwiTm9kZUJhc2UuYXBwbHlEZWJ1Z0VudGl0eSIsIk5vZGVCYXNlLmlBZGROb2RlIiwiTm9kZUJhc2UuaVJlbW92ZU5vZGUiLCJOb2RlQmFzZS5faVVwZGF0ZUltcGxpY2l0RGVidWdWaXNpYmxlIiwiTm9kZUJhc2UudXBkYXRlRGVidWdFbnRpdHkiLCJOb2RlQmFzZS5fcENyZWF0ZURlYnVnRW50aXR5Il0sIm1hcHBpbmdzIjoiQUFFQSxJQUFPLG1CQUFtQixXQUFhLDRDQUE0QyxDQUFDLENBQUM7QUFLckYsQUFHQTs7R0FERztJQUNHLFFBQVE7SUFrRWJBOztPQUVHQTtJQUNIQSxTQXJFS0EsUUFBUUE7UUFPTkMsb0JBQWVBLEdBQVVBLENBQUNBLENBQUNBO1FBSTNCQSxrQkFBYUEsR0FBVUEsQ0FBQ0EsQ0FBQ0E7UUE0RC9CQSxJQUFJQSxDQUFDQSxZQUFZQSxHQUFHQSxJQUFJQSxLQUFLQSxFQUFZQSxDQUFDQTtJQUMzQ0EsQ0FBQ0E7SUF2RERELHNCQUFXQSxrQ0FBWUE7UUFIdkJBOztXQUVHQTthQUNIQTtZQUVDRSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxxQkFBcUJBLENBQUNBO1FBQ25DQSxDQUFDQTthQUVERixVQUF3QkEsS0FBYUE7WUFFcENFLEVBQUVBLENBQUNB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QUNBLENBQUNBO1FBRS9FQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxzQkFBc0JBLENBQUNBLENBQUNBLENBQUNBO1lBQ2pDQSxJQUFJQSxDQUFDQSxhQUFhQSxHQUFHQSxJQUFJQSxDQUFDQSxtQkFBbUJBLEVBQUVBLENBQUNBO1FBQ2pEQSxDQUFDQTtRQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUNQQSxBQUNBQSwrQkFEK0JBO1lBQy9CQSxJQUFJQSxDQUFDQSxhQUFhQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUMzQkEsQ0FBQ0E7SUFFRkEsQ0FBQ0E7SUFFTWQsb0NBQWlCQSxHQUF4QkE7UUFFQ2UsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0Esc0JBQXNCQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNqQ0EsQUFDQUEsK0JBRCtCQTtZQUMvQkEsSUFBSUEsQ0FBQ0EsYUFBYUEsR0FBR0EsSUFBSUEsQ0FBQ0EsbUJBQW1CQSxFQUFFQSxDQUFDQTtRQUNqREEsQ0FBQ0E7SUFDRkEsQ0FBQ0E7SUFFTWYsc0NBQW1CQSxHQUExQkE7UUFFQ2dCLE1BQU1BLElBQUlBLG1CQUFtQkEsRUFBRUEsQ0FBQ0E7SUFDakNBLENBQUNBO0lBQ0ZoQixlQUFDQTtBQUFEQSxDQTdOQSxBQTZOQ0EsSUFBQTtBQUVELEFBQWtCLGlCQUFULFFBQVEsQ0FBQyIsImZpbGUiOiJwYXJ0aXRpb24vTm9kZUJhc2UuanMiLCJzb3VyY2VSb290IjoiLi4vIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFBsYW5lM0RcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9QbGFuZTNEXCIpO1xyXG5pbXBvcnQgVmVjdG9yM0RcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9WZWN0b3IzRFwiKTtcclxuaW1wb3J0IEFic3RyYWN0TWV0aG9kRXJyb3JcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZXJyb3JzL0Fic3RyYWN0TWV0aG9kRXJyb3JcIik7XHJcblxyXG5pbXBvcnQgQ29sbGVjdG9yQmFzZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL3RyYXZlcnNlL0NvbGxlY3RvckJhc2VcIik7XHJcbmltcG9ydCBJRW50aXR5XHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL0lFbnRpdHlcIik7XHJcblxyXG4vKipcclxuICogQGNsYXNzIGF3YXkucGFydGl0aW9uLk5vZGVCYXNlXHJcbiAqL1xyXG5jbGFzcyBOb2RlQmFzZVxyXG57XHJcblx0cHJpdmF0ZSBfZGVidWdDaGlsZHJlblZpc2libGU6Ym9vbGVhbjtcclxuXHRwcml2YXRlIF9leHBsaWNpdERlYnVnVmlzaWJsZTpib29sZWFuO1xyXG5cdHB1YmxpYyBfcEltcGxpY2l0RGVidWdWaXNpYmxlOmJvb2xlYW47XHJcblx0cHVibGljIF9pUGFyZW50Ok5vZGVCYXNlO1xyXG5cdHB1YmxpYyBfcENoaWxkTm9kZXM6QXJyYXk8Tm9kZUJhc2U+O1xyXG5cdHB1YmxpYyBfcE51bUNoaWxkTm9kZXM6bnVtYmVyID0gMDtcclxuXHJcblx0cHVibGljIF9wRGVidWdFbnRpdHk6SUVudGl0eTtcclxuXHJcblx0cHVibGljIF9pTnVtRW50aXRpZXM6bnVtYmVyID0gMDtcclxuXHRwdWJsaWMgX2lDb2xsZWN0aW9uTWFyazpudW1iZXI7Ly8gPSAwO1xyXG5cclxuXHQvKipcclxuXHQgKlxyXG5cdCAqL1xyXG5cdHB1YmxpYyBnZXQgZGVidWdWaXNpYmxlKCk6Ym9vbGVhblxyXG5cdHtcclxuXHRcdHJldHVybiB0aGlzLl9leHBsaWNpdERlYnVnVmlzaWJsZTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBzZXQgZGVidWdWaXNpYmxlKHZhbHVlOmJvb2xlYW4pXHJcblx0e1xyXG5cdFx0aWYgKHRoaXMuX2V4cGxpY2l0RGVidWdWaXNpYmxlID09IHZhbHVlKVxyXG5cdFx0XHRyZXR1cm47XHJcblxyXG5cdFx0dGhpcy5fZXhwbGljaXREZWJ1Z1Zpc2libGUgPSB2YWx1ZTtcclxuXHJcblx0XHR0aGlzLl9pVXBkYXRlSW1wbGljaXREZWJ1Z1Zpc2libGUodGhpcy5faVBhcmVudD8gdGhpcy5faVBhcmVudC5kZWJ1Z0NoaWxkcmVuVmlzaWJsZSA6IGZhbHNlKTtcclxuXHJcblx0fVxyXG5cclxuXHRwdWJsaWMgZ2V0IGRlYnVnQ2hpbGRyZW5WaXNpYmxlKCk6Ym9vbGVhblxyXG5cdHtcclxuXHRcdHJldHVybiB0aGlzLl9kZWJ1Z0NoaWxkcmVuVmlzaWJsZTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBzZXQgZGVidWdDaGlsZHJlblZpc2libGUodmFsdWU6Ym9vbGVhbilcclxuXHR7XHJcblx0XHRpZiAodGhpcy5fZGVidWdDaGlsZHJlblZpc2libGUgPT0gdmFsdWUpXHJcblx0XHRcdHJldHVybjtcclxuXHJcblx0XHR0aGlzLl9kZWJ1Z0NoaWxkcmVuVmlzaWJsZSA9IHZhbHVlO1xyXG5cclxuXHRcdGZvciAodmFyIGk6bnVtYmVyID0gMDsgaSA8IHRoaXMuX3BOdW1DaGlsZE5vZGVzOyArK2kpXHJcblx0XHRcdHRoaXMuX3BDaGlsZE5vZGVzW2ldLl9pVXBkYXRlSW1wbGljaXREZWJ1Z1Zpc2libGUodGhpcy5fZGVidWdDaGlsZHJlblZpc2libGUpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICpcclxuXHQgKi9cclxuXHRwdWJsaWMgZ2V0IHBhcmVudCgpOk5vZGVCYXNlXHJcblx0e1xyXG5cdFx0cmV0dXJuIHRoaXMuX2lQYXJlbnQ7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKlxyXG5cdCAqIEBwcm90ZWN0ZWRcclxuXHQgKi9cclxuXHRwdWJsaWMgZ2V0IF9wTnVtRW50aXRpZXMoKTpudW1iZXJcclxuXHR7XHJcblx0XHRyZXR1cm4gdGhpcy5faU51bUVudGl0aWVzO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICpcclxuXHQgKi9cclxuXHRjb25zdHJ1Y3RvcigpXHJcblx0e1xyXG5cdFx0dGhpcy5fcENoaWxkTm9kZXMgPSBuZXcgQXJyYXk8Tm9kZUJhc2U+KCk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKlxyXG5cdCAqIEBwYXJhbSBwbGFuZXNcclxuXHQgKiBAcGFyYW0gbnVtUGxhbmVzXHJcblx0ICogQHJldHVybnMge2Jvb2xlYW59XHJcblx0ICogQGludGVybmFsXHJcblx0ICovXHJcblx0cHVibGljIGlzSW5GcnVzdHVtKHBsYW5lczpBcnJheTxQbGFuZTNEPiwgbnVtUGxhbmVzOm51bWJlcik6Ym9vbGVhblxyXG5cdHtcclxuXHRcdHJldHVybiB0cnVlO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICpcclxuXHQgKiBAcGFyYW0gcmF5UG9zaXRpb25cclxuXHQgKiBAcGFyYW0gcmF5RGlyZWN0aW9uXHJcblx0ICogQHJldHVybnMge2Jvb2xlYW59XHJcblx0ICovXHJcblx0cHVibGljIGlzSW50ZXJzZWN0aW5nUmF5KHJheVBvc2l0aW9uOlZlY3RvcjNELCByYXlEaXJlY3Rpb246VmVjdG9yM0QpOmJvb2xlYW5cclxuXHR7XHJcblx0XHRyZXR1cm4gdHJ1ZTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqXHJcblx0ICogQHJldHVybnMge2Jvb2xlYW59XHJcblx0ICovXHJcblx0cHVibGljIGlzQ2FzdGluZ1NoYWRvdygpOmJvb2xlYW5cclxuXHR7XHJcblx0XHRyZXR1cm4gdHJ1ZTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqXHJcblx0ICogQHBhcmFtIGVudGl0eVxyXG5cdCAqIEByZXR1cm5zIHthd2F5LnBhcnRpdGlvbi5Ob2RlQmFzZX1cclxuXHQgKi9cclxuXHRwdWJsaWMgZmluZFBhcnRpdGlvbkZvckVudGl0eShlbnRpdHk6SUVudGl0eSk6Tm9kZUJhc2VcclxuXHR7XHJcblx0XHRyZXR1cm4gdGhpcztcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqXHJcblx0ICogQHBhcmFtIHRyYXZlcnNlclxyXG5cdCAqL1xyXG5cdHB1YmxpYyBhY2NlcHRUcmF2ZXJzZXIodHJhdmVyc2VyOkNvbGxlY3RvckJhc2UpXHJcblx0e1xyXG5cdFx0aWYgKHRoaXMuX3BOdW1FbnRpdGllcyA9PSAwICYmICF0aGlzLl9wSW1wbGljaXREZWJ1Z1Zpc2libGUpXHJcblx0XHRcdHJldHVybjtcclxuXHJcblx0XHRpZiAodHJhdmVyc2VyLmVudGVyTm9kZSh0aGlzKSkge1xyXG5cdFx0XHR2YXIgaTpudW1iZXIgPSAwO1xyXG5cclxuXHRcdFx0d2hpbGUgKGkgPCB0aGlzLl9wTnVtQ2hpbGROb2RlcylcclxuXHRcdFx0XHR0aGlzLl9wQ2hpbGROb2Rlc1tpKytdLmFjY2VwdFRyYXZlcnNlcih0cmF2ZXJzZXIpO1xyXG5cclxuXHRcdFx0aWYgKHRoaXMuX3BJbXBsaWNpdERlYnVnVmlzaWJsZSAmJiB0cmF2ZXJzZXIuaXNFbnRpdHlDb2xsZWN0b3IpXHJcblx0XHRcdFx0dHJhdmVyc2VyLmFwcGx5RW50aXR5KHRoaXMuX3BEZWJ1Z0VudGl0eSk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKlxyXG5cdCAqIEBwcm90ZWN0ZWRcclxuXHQgKi9cclxuXHRwdWJsaWMgYXBwbHlEZWJ1Z0VudGl0eSh0cmF2ZXJzZXI6Q29sbGVjdG9yQmFzZSlcclxuXHR7XHJcblx0XHRpZiAodGhpcy5fcERlYnVnRW50aXR5ID09IG51bGwpXHJcblx0XHRcdHRoaXMuX3BEZWJ1Z0VudGl0eSA9IHRoaXMuX3BDcmVhdGVEZWJ1Z0VudGl0eSgpO1xyXG5cclxuXHRcdHRyYXZlcnNlci5hcHBseUVudGl0eSh0aGlzLl9wRGVidWdFbnRpdHkpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICpcclxuXHQgKiBAcGFyYW0gbm9kZVxyXG5cdCAqIEBpbnRlcm5hbFxyXG5cdCAqL1xyXG5cdHB1YmxpYyBpQWRkTm9kZShub2RlOk5vZGVCYXNlKVxyXG5cdHtcclxuXHRcdG5vZGUuX2lQYXJlbnQgPSB0aGlzO1xyXG5cdFx0dGhpcy5faU51bUVudGl0aWVzICs9IG5vZGUuX3BOdW1FbnRpdGllcztcclxuXHRcdHRoaXMuX3BDaGlsZE5vZGVzWyB0aGlzLl9wTnVtQ2hpbGROb2RlcysrIF0gPSBub2RlO1xyXG5cclxuXHRcdG5vZGUuX2lVcGRhdGVJbXBsaWNpdERlYnVnVmlzaWJsZSh0aGlzLmRlYnVnQ2hpbGRyZW5WaXNpYmxlKTtcclxuXHJcblx0XHR2YXIgbnVtRW50aXRpZXM6bnVtYmVyID0gbm9kZS5fcE51bUVudGl0aWVzO1xyXG5cdFx0bm9kZSA9IHRoaXM7XHJcblxyXG5cdFx0ZG8ge1xyXG5cdFx0XHRub2RlLl9pTnVtRW50aXRpZXMgKz0gbnVtRW50aXRpZXM7XHJcblx0XHR9IHdoaWxlICgobm9kZSA9IG5vZGUuX2lQYXJlbnQpICE9IG51bGwpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICpcclxuXHQgKiBAcGFyYW0gbm9kZVxyXG5cdCAqIEBpbnRlcm5hbFxyXG5cdCAqL1xyXG5cdHB1YmxpYyBpUmVtb3ZlTm9kZShub2RlOk5vZGVCYXNlKVxyXG5cdHtcclxuXHRcdHZhciBpbmRleDpudW1iZXIgPSB0aGlzLl9wQ2hpbGROb2Rlcy5pbmRleE9mKG5vZGUpO1xyXG5cdFx0dGhpcy5fcENoaWxkTm9kZXNbaW5kZXhdID0gdGhpcy5fcENoaWxkTm9kZXNbLS10aGlzLl9wTnVtQ2hpbGROb2Rlc107XHJcblx0XHR0aGlzLl9wQ2hpbGROb2Rlcy5wb3AoKTtcclxuXHJcblx0XHRub2RlLl9pVXBkYXRlSW1wbGljaXREZWJ1Z1Zpc2libGUoZmFsc2UpO1xyXG5cclxuXHRcdHZhciBudW1FbnRpdGllczpudW1iZXIgPSBub2RlLl9wTnVtRW50aXRpZXM7XHJcblx0XHRub2RlID0gdGhpcztcclxuXHJcblx0XHRkbyB7XHJcblx0XHRcdG5vZGUuX3BOdW1FbnRpdGllcyAtPSBudW1FbnRpdGllcztcclxuXHRcdH0gd2hpbGUgKChub2RlID0gbm9kZS5faVBhcmVudCkgIT0gbnVsbCk7XHJcblx0fVxyXG5cclxuXHRwcml2YXRlIF9pVXBkYXRlSW1wbGljaXREZWJ1Z1Zpc2libGUodmFsdWU6Ym9vbGVhbilcclxuXHR7XHJcblx0XHRpZiAodGhpcy5fcEltcGxpY2l0RGVidWdWaXNpYmxlID09IHRoaXMuX2V4cGxpY2l0RGVidWdWaXNpYmxlIHx8IHZhbHVlKVxyXG5cdFx0XHRyZXR1cm47XHJcblxyXG5cdFx0dGhpcy5fcEltcGxpY2l0RGVidWdWaXNpYmxlID0gdGhpcy5fZXhwbGljaXREZWJ1Z1Zpc2libGUgfHwgdmFsdWU7XHJcblxyXG5cdFx0Zm9yICh2YXIgaTpudW1iZXIgPSAwOyBpIDwgdGhpcy5fcE51bUNoaWxkTm9kZXM7ICsraSlcclxuXHRcdFx0dGhpcy5fcENoaWxkTm9kZXNbaV0uX2lVcGRhdGVJbXBsaWNpdERlYnVnVmlzaWJsZSh0aGlzLl9kZWJ1Z0NoaWxkcmVuVmlzaWJsZSk7XHJcblxyXG5cdFx0aWYgKHRoaXMuX3BJbXBsaWNpdERlYnVnVmlzaWJsZSkge1xyXG5cdFx0XHR0aGlzLl9wRGVidWdFbnRpdHkgPSB0aGlzLl9wQ3JlYXRlRGVidWdFbnRpdHkoKTtcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdC8vdGhpcy5fcERlYnVnRW50aXR5LmRpc3Bvc2UoKTtcclxuXHRcdFx0dGhpcy5fcERlYnVnRW50aXR5ID0gbnVsbDtcclxuXHRcdH1cclxuXHRcdFxyXG5cdH1cclxuXHJcblx0cHVibGljIHVwZGF0ZURlYnVnRW50aXR5KClcclxuXHR7XHJcblx0XHRpZiAodGhpcy5fcEltcGxpY2l0RGVidWdWaXNpYmxlKSB7XHJcblx0XHRcdC8vdGhpcy5fcERlYnVnRW50aXR5LmRpc3Bvc2UoKTtcclxuXHRcdFx0dGhpcy5fcERlYnVnRW50aXR5ID0gdGhpcy5fcENyZWF0ZURlYnVnRW50aXR5KCk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgX3BDcmVhdGVEZWJ1Z0VudGl0eSgpOklFbnRpdHlcclxuXHR7XHJcblx0XHR0aHJvdyBuZXcgQWJzdHJhY3RNZXRob2RFcnJvcigpO1xyXG5cdH1cclxufVxyXG5cclxuZXhwb3J0ID0gTm9kZUJhc2U7Il19