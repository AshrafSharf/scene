var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Vector3D = require("awayjs-core/lib/geom/Vector3D");
var AxisAlignedBoundingBox = require("awayjs-display/lib/bounds/AxisAlignedBoundingBox");
var BoundingSphere = require("awayjs-display/lib/bounds/BoundingSphere");
var BoundsType = require("awayjs-display/lib/bounds/BoundsType");
var NullBounds = require("awayjs-display/lib/bounds/NullBounds");
var NodeBase = require("awayjs-display/lib/partition/NodeBase");
/**
 * @class away.partition.EntityNode
 */
var EntityNode = (function (_super) {
    __extends(EntityNode, _super);
    function EntityNode(pool, entity, partition) {
        _super.call(this);
        this._pool = pool;
        this._entity = entity;
        this._partition = partition;
        this._iNumEntities = 1;
        this.updateBounds();
        this.debugVisible = this._entity.debugVisible;
    }
    Object.defineProperty(EntityNode.prototype, "entity", {
        get: function () {
            return this._entity;
        },
        enumerable: true,
        configurable: true
    });
    EntityNode.prototype.removeFromParent = function () {
        if (this._iParent)
            this._iParent.iRemoveNode(this);
        this._iParent = null;
    };
    /**
     *
     * @returns {boolean}
     */
    EntityNode.prototype.isCastingShadow = function () {
        return this.entity.castsShadows;
    };
    /**
     *
     * @param planes
     * @param numPlanes
     * @returns {boolean}
     */
    EntityNode.prototype.isInFrustum = function (planes, numPlanes) {
        if (!this._entity._iIsVisible())
            return false;
        return this._bounds.isInFrustum(planes, numPlanes);
    };
    /**
     * @inheritDoc
     */
    EntityNode.prototype.acceptTraverser = function (traverser) {
        if (traverser.enterNode(this)) {
            traverser.applyEntity(this._entity);
            if (this._pImplicitDebugVisible && traverser.isEntityCollector)
                traverser.applyEntity(this._pDebugEntity);
        }
    };
    /**
     * @inheritDoc
     */
    EntityNode.prototype.isIntersectingRay = function (rayPosition, rayDirection) {
        if (!this._entity._iIsVisible())
            return false;
        var pickingCollisionVO = this._entity._iPickingCollisionVO;
        pickingCollisionVO.localRayPosition = this._entity.inverseSceneTransform.transformVector(rayPosition);
        pickingCollisionVO.localRayDirection = this._entity.inverseSceneTransform.deltaTransformVector(rayDirection);
        if (!pickingCollisionVO.localNormal)
            pickingCollisionVO.localNormal = new Vector3D();
        var rayEntryDistance = this._bounds.rayIntersection(pickingCollisionVO.localRayPosition, pickingCollisionVO.localRayDirection, pickingCollisionVO.localNormal);
        if (rayEntryDistance < 0)
            return false;
        pickingCollisionVO.rayEntryDistance = rayEntryDistance;
        pickingCollisionVO.rayPosition = rayPosition;
        pickingCollisionVO.rayDirection = rayDirection;
        pickingCollisionVO.rayOriginIsInsideBounds = rayEntryDistance == 0;
        return true;
    };
    /**
     *
     * @protected
     */
    EntityNode.prototype._pCreateDebugEntity = function () {
        return this._bounds.boundsPrimitive;
    };
    EntityNode.prototype.invalidatePartition = function () {
        this._bounds.invalidate();
        this._partition.iMarkForUpdate(this);
    };
    EntityNode.prototype.updateBounds = function () {
        if (this._entity.boundsType == BoundsType.AXIS_ALIGNED_BOX)
            this._bounds = new AxisAlignedBoundingBox(this._entity);
        else if (this._entity.boundsType == BoundsType.SPHERE)
            this._bounds = new BoundingSphere(this._entity);
        else if (this._entity.boundsType == BoundsType.NULL)
            this._bounds = new NullBounds();
        this.updateDebugEntity();
    };
    EntityNode.id = "entityNode";
    return EntityNode;
})(NodeBase);
module.exports = EntityNode;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1kaXNwbGF5L2xpYi9wYXJ0aXRpb24vRW50aXR5Tm9kZS50cyJdLCJuYW1lcyI6WyJFbnRpdHlOb2RlIiwiRW50aXR5Tm9kZS5jb25zdHJ1Y3RvciIsIkVudGl0eU5vZGUuZW50aXR5IiwiRW50aXR5Tm9kZS5yZW1vdmVGcm9tUGFyZW50IiwiRW50aXR5Tm9kZS5pc0Nhc3RpbmdTaGFkb3ciLCJFbnRpdHlOb2RlLmlzSW5GcnVzdHVtIiwiRW50aXR5Tm9kZS5hY2NlcHRUcmF2ZXJzZXIiLCJFbnRpdHlOb2RlLmlzSW50ZXJzZWN0aW5nUmF5IiwiRW50aXR5Tm9kZS5fcENyZWF0ZURlYnVnRW50aXR5IiwiRW50aXR5Tm9kZS5pbnZhbGlkYXRlUGFydGl0aW9uIiwiRW50aXR5Tm9kZS51cGRhdGVCb3VuZHMiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUNBLElBQU8sUUFBUSxXQUFnQiwrQkFBK0IsQ0FBQyxDQUFDO0FBRWhFLElBQU8sc0JBQXNCLFdBQVksa0RBQWtELENBQUMsQ0FBQztBQUM3RixJQUFPLGNBQWMsV0FBYywwQ0FBMEMsQ0FBQyxDQUFDO0FBRS9FLElBQU8sVUFBVSxXQUFlLHNDQUFzQyxDQUFDLENBQUM7QUFDeEUsSUFBTyxVQUFVLFdBQWUsc0NBQXNDLENBQUMsQ0FBQztBQUV4RSxJQUFPLFFBQVEsV0FBZ0IsdUNBQXVDLENBQUMsQ0FBQztBQU94RSxBQUdBOztHQURHO0lBQ0csVUFBVTtJQUFTQSxVQUFuQkEsVUFBVUEsVUFBaUJBO0lBVWhDQSxTQVZLQSxVQUFVQSxDQVVIQSxJQUFtQkEsRUFBRUEsTUFBY0EsRUFBRUEsU0FBbUJBO1FBRW5FQyxpQkFBT0EsQ0FBQ0E7UUFDUkEsSUFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFDbEJBLElBQUlBLENBQUNBLE9BQU9BLEdBQUdBLE1BQU1BLENBQUNBO1FBQ3RCQSxJQUFJQSxDQUFDQSxVQUFVQSxHQUFHQSxTQUFTQSxDQUFDQTtRQUM1QkEsSUFBSUEsQ0FBQ0Es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QSxDQUFDQSxPQUFPQSxHQUFHQSxJQUFJQSxjQUFjQSxDQUFDQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQTtRQUNqREEsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsVUFBVUEsSUFBSUEsVUFBVUEsQ0FBQ0EsSUFBSUEsQ0FBQ0E7WUFDbkRBLElBQUlBLENBQUNBLE9BQU9BLEdBQUdBLElBQUlBLFVBQVVBLEVBQUVBLENBQUNBO1FBRWpDQSxJQUFJQSxDQUFDQSxpQkFBaUJBLEVBQUVBLENBQUNBO0lBQzFCQSxDQUFDQTtJQTVIYVYsYUFBRUEsR0FBVUEsWUFBWUEsQ0FBQ0E7SUE2SHhDQSxpQkFBQ0E7QUFBREEsQ0EvSEEsQUErSENBLEVBL0h3QixRQUFRLEVBK0hoQztBQUVELEFBQW9CLGlCQUFYLFVBQVUsQ0FBQyIsImZpbGUiOiJwYXJ0aXRpb24vRW50aXR5Tm9kZS5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUGxhbmUzRFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9nZW9tL1BsYW5lM0RcIik7XG5pbXBvcnQgVmVjdG9yM0RcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9WZWN0b3IzRFwiKTtcblxuaW1wb3J0IEF4aXNBbGlnbmVkQm91bmRpbmdCb3hcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2JvdW5kcy9BeGlzQWxpZ25lZEJvdW5kaW5nQm94XCIpO1xuaW1wb3J0IEJvdW5kaW5nU3BoZXJlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvYm91bmRzL0JvdW5kaW5nU3BoZXJlXCIpO1xuaW1wb3J0IEJvdW5kaW5nVm9sdW1lQmFzZVx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9ib3VuZHMvQm91bmRpbmdWb2x1bWVCYXNlXCIpO1xuaW1wb3J0IEJvdW5kc1R5cGVcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2JvdW5kcy9Cb3VuZHNUeXBlXCIpO1xuaW1wb3J0IE51bGxCb3VuZHNcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2JvdW5kcy9OdWxsQm91bmRzXCIpO1xuaW1wb3J0IFBhcnRpdGlvblx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvcGFydGl0aW9uL1BhcnRpdGlvblwiKTtcbmltcG9ydCBOb2RlQmFzZVx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9wYXJ0aXRpb24vTm9kZUJhc2VcIik7XG5pbXBvcnQgQ29sbGVjdG9yQmFzZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL3RyYXZlcnNlL0NvbGxlY3RvckJhc2VcIik7XG5pbXBvcnQgSUVudGl0eVx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9JRW50aXR5XCIpO1xuaW1wb3J0IE1lc2hcdFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9NZXNoXCIpO1xuaW1wb3J0IFBpY2tpbmdDb2xsaXNpb25WT1x0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9waWNrL1BpY2tpbmdDb2xsaXNpb25WT1wiKTtcbmltcG9ydCBFbnRpdHlOb2RlUG9vbFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL3Bvb2wvRW50aXR5Tm9kZVBvb2xcIik7XG5cbi8qKlxuICogQGNsYXNzIGF3YXkucGFydGl0aW9uLkVudGl0eU5vZGVcbiAqL1xuY2xhc3MgRW50aXR5Tm9kZSBleHRlbmRzIE5vZGVCYXNlXG57XG5cdHB1YmxpYyBzdGF0aWMgaWQ6c3RyaW5nID0gXCJlbnRpdHlOb2RlXCI7XG5cblx0cHJpdmF0ZSBfcG9vbDpFbnRpdHlOb2RlUG9vbDtcblx0cHJpdmF0ZSBfZW50aXR5OklFbnRpdHk7XG5cdHByaXZhdGUgX3BhcnRpdGlvbjpQYXJ0aXRpb247XG5cdHByaXZhdGUgX2JvdW5kczpCb3VuZGluZ1ZvbHVtZUJhc2U7XG5cdHB1YmxpYyBfaVVwZGF0ZVF1ZXVlTmV4dDpFbnRpdHlOb2RlO1xuXG5cdGNvbnN0cnVjdG9yKHBvb2w6RW50aXR5Tm9kZVBvb2wsIGVudGl0eTpJRW50aXR5LCBwYXJ0aXRpb246UGFydGl0aW9uKVxuXHR7XG5cdFx0c3VwZXIoKTtcblx0XHR0aGlzLl9wb29sID0gcG9vbDtcblx0XHR0aGlzLl9lbnRpdHkgPSBlbnRpdHk7XG5cdFx0dGhpcy5fcGFydGl0aW9uID0gcGFydGl0aW9uO1xuXHRcdHRoaXMuX2lOdW1FbnRpdGllcyA9IDE7XG5cblx0XHR0aGlzLnVwZGF0ZUJvdW5kcygpO1xuXG5cdFx0dGhpcy5kZWJ1Z1Zpc2libGUgPSB0aGlzLl9lbnRpdHkuZGVidWdWaXNpYmxlO1xuXHR9XG5cblx0cHVibGljIGdldCBlbnRpdHkoKTpJRW50aXR5XG5cdHtcblx0XHRyZXR1cm4gdGhpcy5fZW50aXR5O1xuXHR9XG5cblx0cHVibGljIHJlbW92ZUZyb21QYXJlbnQoKTp2b2lkXG5cdHtcblx0XHRpZiAodGhpcy5faVBhcmVudClcblx0XHRcdHRoaXMuX2lQYXJlbnQuaVJlbW92ZU5vZGUodGhpcyk7XG5cblx0XHR0aGlzLl9pUGFyZW50ID0gbnVsbDtcblx0fVxuXG5cdC8qKlxuXHQgKlxuXHQgKiBAcmV0dXJucyB7Ym9vbGVhbn1cblx0ICovXG5cdHB1YmxpYyBpc0Nhc3RpbmdTaGFkb3coKTpib29sZWFuXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5lbnRpdHkuY2FzdHNTaGFkb3dzO1xuXHR9XG5cblx0LyoqXG5cdCAqXG5cdCAqIEBwYXJhbSBwbGFuZXNcblx0ICogQHBhcmFtIG51bVBsYW5lc1xuXHQgKiBAcmV0dXJucyB7Ym9vbGVhbn1cblx0ICovXG5cdHB1YmxpYyBpc0luRnJ1c3R1bShwbGFuZXM6QXJyYXk8UGxhbmUzRD4sIG51bVBsYW5lczpudW1iZXIpOmJvb2xlYW5cblx0e1xuXHRcdGlmICghdGhpcy5fZW50aXR5Ll9pSXNWaXNpYmxlKCkpXG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cblx0XHRyZXR1cm4gdGhpcy5fYm91bmRzLmlzSW5GcnVzdHVtKHBsYW5lcywgbnVtUGxhbmVzKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi9cblx0cHVibGljIGFjY2VwdFRyYXZlcnNlcih0cmF2ZXJzZXI6Q29sbGVjdG9yQmFzZSlcblx0e1xuXHRcdGlmICh0cmF2ZXJzZXIuZW50ZXJOb2RlKHRoaXMpKSB7XG5cdFx0XHR0cmF2ZXJzZXIuYXBwbHlFbnRpdHkodGhpcy5fZW50aXR5KTtcblxuXHRcdFx0aWYgKHRoaXMuX3BJbXBsaWNpdERlYnVnVmlzaWJsZSAmJiB0cmF2ZXJzZXIuaXNFbnRpdHlDb2xsZWN0b3IpXG5cdFx0XHRcdHRyYXZlcnNlci5hcHBseUVudGl0eSh0aGlzLl9wRGVidWdFbnRpdHkpO1xuXHRcdH1cblx0fVxuXG5cdC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi9cblx0cHVibGljIGlzSW50ZXJzZWN0aW5nUmF5KHJheVBvc2l0aW9uOlZlY3RvcjNELCByYXlEaXJlY3Rpb246VmVjdG9yM0QpOmJvb2xlYW5cblx0e1xuXHRcdGlmICghdGhpcy5fZW50aXR5Ll9pSXNWaXNpYmxlKCkpXG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cblx0XHR2YXIgcGlja2luZ0NvbGxpc2lvblZPOlBpY2tpbmdDb2xsaXNpb25WTyA9IHRoaXMuX2VudGl0eS5faVBpY2tpbmdDb2xsaXNpb25WTztcblx0XHRwaWNraW5nQ29sbGlzaW9uVk8ubG9jYWxSYXlQb3NpdGlvbiA9IHRoaXMuX2VudGl0eS5pbnZlcnNlU2NlbmVUcmFuc2Zvcm0udHJhbnNmb3JtVmVjdG9yKHJheVBvc2l0aW9uKTtcblx0XHRwaWNraW5nQ29sbGlzaW9uVk8ubG9jYWxSYXlEaXJlY3Rpb24gPSB0aGlzLl9lbnRpdHkuaW52ZXJzZVNjZW5lVHJhbnNmb3JtLmRlbHRhVHJhbnNmb3JtVmVjdG9yKHJheURpcmVjdGlvbik7XG5cblx0XHRpZiAoIXBpY2tpbmdDb2xsaXNpb25WTy5sb2NhbE5vcm1hbClcblx0XHRcdHBpY2tpbmdDb2xsaXNpb25WTy5sb2NhbE5vcm1hbCA9IG5ldyBWZWN0b3IzRCgpO1xuXG5cdFx0dmFyIHJheUVudHJ5RGlzdGFuY2U6bnVtYmVyID0gdGhpcy5fYm91bmRzLnJheUludGVyc2VjdGlvbihwaWNraW5nQ29sbGlzaW9uVk8ubG9jYWxSYXlQb3NpdGlvbiwgcGlja2luZ0NvbGxpc2lvblZPLmxvY2FsUmF5RGlyZWN0aW9uLCBwaWNraW5nQ29sbGlzaW9uVk8ubG9jYWxOb3JtYWwpO1xuXG5cdFx0aWYgKHJheUVudHJ5RGlzdGFuY2UgPCAwKVxuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXG5cdFx0cGlja2luZ0NvbGxpc2lvblZPLnJheUVudHJ5RGlzdGFuY2UgPSByYXlFbnRyeURpc3RhbmNlO1xuXHRcdHBpY2tpbmdDb2xsaXNpb25WTy5yYXlQb3NpdGlvbiA9IHJheVBvc2l0aW9uO1xuXHRcdHBpY2tpbmdDb2xsaXNpb25WTy5yYXlEaXJlY3Rpb24gPSByYXlEaXJlY3Rpb247XG5cdFx0cGlja2luZ0NvbGxpc2lvblZPLnJheU9yaWdpbklzSW5zaWRlQm91bmRzID0gcmF5RW50cnlEaXN0YW5jZSA9PSAwO1xuXG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHQvKipcblx0ICpcblx0ICogQHByb3RlY3RlZFxuXHQgKi9cblx0cHVibGljIF9wQ3JlYXRlRGVidWdFbnRpdHkoKTpJRW50aXR5XG5cdHtcblx0XHRyZXR1cm4gdGhpcy5fYm91bmRzLmJvdW5kc1ByaW1pdGl2ZTtcblx0fVxuXG5cdHB1YmxpYyBpbnZhbGlkYXRlUGFydGl0aW9uKClcblx0e1xuXHRcdHRoaXMuX2JvdW5kcy5pbnZhbGlkYXRlKCk7XG5cblx0XHR0aGlzLl9wYXJ0aXRpb24uaU1hcmtGb3JVcGRhdGUodGhpcyk7XG5cdH1cblxuXHRwdWJsaWMgdXBkYXRlQm91bmRzKClcblx0e1xuXHRcdGlmICh0aGlzLl9lbnRpdHkuYm91bmRzVHlwZSA9PSBCb3VuZHNUeXBlLkFYSVNfQUxJR05FRF9CT1gpXG5cdFx0XHR0aGlzLl9ib3VuZHMgPSBuZXcgQXhpc0FsaWduZWRCb3VuZGluZ0JveCh0aGlzLl9lbnRpdHkpO1xuXHRcdGVsc2UgaWYgKHRoaXMuX2VudGl0eS5ib3VuZHNUeXBlID09IEJvdW5kc1R5cGUuU1BIRVJFKVxuXHRcdFx0dGhpcy5fYm91bmRzID0gbmV3IEJvdW5kaW5nU3BoZXJlKHRoaXMuX2VudGl0eSk7XG5cdFx0ZWxzZSBpZiAodGhpcy5fZW50aXR5LmJvdW5kc1R5cGUgPT0gQm91bmRzVHlwZS5OVUxMKVxuXHRcdFx0dGhpcy5fYm91bmRzID0gbmV3IE51bGxCb3VuZHMoKTtcblxuXHRcdHRoaXMudXBkYXRlRGVidWdFbnRpdHkoKTtcblx0fVxufVxuXG5leHBvcnQgPSBFbnRpdHlOb2RlOyJdfQ==