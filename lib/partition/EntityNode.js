var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Vector3D = require("awayjs-core/lib/geom/Vector3D");
var AxisAlignedBoundingBox = require("awayjs-display/lib/bounds/AxisAlignedBoundingBox");
var BoundingSphere = require("awayjs-display/lib/bounds/BoundingSphere");
var BoundsType = require("awayjs-display/lib/bounds/BoundsType");
var NullBounds = require("awayjs-display/lib/bounds/NullBounds");
var NodeBase = require("awayjs-display/lib/partition/NodeBase");
/**
 * @class away.partition.EntityNode
 */
var EntityNode = (function (_super) {
    __extends(EntityNode, _super);
    function EntityNode(pool, entity, partition) {
        _super.call(this);
        this._pool = pool;
        this._entity = entity;
        this._partition = partition;
        this._iNumEntities = 1;
        this.updateBounds();
        this.debugVisible = this._entity.debugVisible;
    }
    Object.defineProperty(EntityNode.prototype, "entity", {
        get: function () {
            return this._entity;
        },
        enumerable: true,
        configurable: true
    });
    EntityNode.prototype.removeFromParent = function () {
        if (this._iParent)
            this._iParent.iRemoveNode(this);
        this._iParent = null;
    };
    /**
     *
     * @returns {boolean}
     */
    EntityNode.prototype.isCastingShadow = function () {
        return this.entity.castsShadows;
    };
    /**
     *
     * @param planes
     * @param numPlanes
     * @returns {boolean}
     */
    EntityNode.prototype.isInFrustum = function (planes, numPlanes) {
        if (!this._entity._iIsVisible())
            return false;
        return this._bounds.isInFrustum(planes, numPlanes);
    };
    /**
     * @inheritDoc
     */
    EntityNode.prototype.acceptTraverser = function (traverser) {
        if (traverser.enterNode(this)) {
            traverser.applyEntity(this._entity);
            if (this._pImplicitDebugVisible && traverser.isEntityCollector)
                traverser.applyEntity(this._pDebugEntity);
        }
    };
    /**
     * @inheritDoc
     */
    EntityNode.prototype.isIntersectingRay = function (rayPosition, rayDirection) {
        if (!this._entity._iIsVisible())
            return false;
        var pickingCollisionVO = this._entity._iPickingCollisionVO;
        pickingCollisionVO.localRayPosition = this._entity.inverseSceneTransform.transformVector(rayPosition);
        pickingCollisionVO.localRayDirection = this._entity.inverseSceneTransform.deltaTransformVector(rayDirection);
        if (!pickingCollisionVO.localNormal)
            pickingCollisionVO.localNormal = new Vector3D();
        var rayEntryDistance = this._bounds.rayIntersection(pickingCollisionVO.localRayPosition, pickingCollisionVO.localRayDirection, pickingCollisionVO.localNormal);
        if (rayEntryDistance < 0)
            return false;
        pickingCollisionVO.rayEntryDistance = rayEntryDistance;
        pickingCollisionVO.rayPosition = rayPosition;
        pickingCollisionVO.rayDirection = rayDirection;
        pickingCollisionVO.rayOriginIsInsideBounds = rayEntryDistance == 0;
        return true;
    };
    /**
     *
     * @protected
     */
    EntityNode.prototype._pCreateDebugEntity = function () {
        return this._bounds.boundsPrimitive;
    };
    EntityNode.prototype.invalidatePartition = function () {
        this._bounds.invalidate();
        this._partition.iMarkForUpdate(this);
    };
    EntityNode.prototype.updateBounds = function () {
        if (this._entity.boundsType == BoundsType.AXIS_ALIGNED_BOX)
            this._bounds = new AxisAlignedBoundingBox(this._entity);
        else if (this._entity.boundsType == BoundsType.SPHERE)
            this._bounds = new BoundingSphere(this._entity);
        else if (this._entity.boundsType == BoundsType.NULL)
            this._bounds = new NullBounds();
        this.updateDebugEntity();
    };
    EntityNode.id = "entityNode";
    return EntityNode;
})(NodeBase);
module.exports = EntityNode;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1kaXNwbGF5L2xpYi9wYXJ0aXRpb24vRW50aXR5Tm9kZS50cyJdLCJuYW1lcyI6WyJFbnRpdHlOb2RlIiwiRW50aXR5Tm9kZS5jb25zdHJ1Y3RvciIsIkVudGl0eU5vZGUuZW50aXR5IiwiRW50aXR5Tm9kZS5yZW1vdmVGcm9tUGFyZW50IiwiRW50aXR5Tm9kZS5pc0Nhc3RpbmdTaGFkb3ciLCJFbnRpdHlOb2RlLmlzSW5GcnVzdHVtIiwiRW50aXR5Tm9kZS5hY2NlcHRUcmF2ZXJzZXIiLCJFbnRpdHlOb2RlLmlzSW50ZXJzZWN0aW5nUmF5IiwiRW50aXR5Tm9kZS5fcENyZWF0ZURlYnVnRW50aXR5IiwiRW50aXR5Tm9kZS5pbnZhbGlkYXRlUGFydGl0aW9uIiwiRW50aXR5Tm9kZS51cGRhdGVCb3VuZHMiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUNBLElBQU8sUUFBUSxXQUFnQiwrQkFBK0IsQ0FBQyxDQUFDO0FBRWhFLElBQU8sc0JBQXNCLFdBQVksa0RBQWtELENBQUMsQ0FBQztBQUM3RixJQUFPLGNBQWMsV0FBYywwQ0FBMEMsQ0FBQyxDQUFDO0FBRS9FLElBQU8sVUFBVSxXQUFlLHNDQUFzQyxDQUFDLENBQUM7QUFDeEUsSUFBTyxVQUFVLFdBQWUsc0NBQXNDLENBQUMsQ0FBQztBQUV4RSxJQUFPLFFBQVEsV0FBZ0IsdUNBQXVDLENBQUMsQ0FBQztBQU94RSxBQUdBOztHQURHO0lBQ0csVUFBVTtJQUFTQSxVQUFuQkEsVUFBVUEsVUFBaUJBO0lBVWhDQSxTQVZLQSxVQUFVQSxDQVVIQSxJQUFtQkEsRUFBRUEsTUFBY0EsRUFBRUEsU0FBbUJBO1FBRW5FQyxpQkFBT0EsQ0FBQ0E7UUFDUkEsSUFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFDbEJBLElBQUlBLENBQUNBLE9BQU9BLEdBQUdBLE1BQU1BLENBQUNBO1FBQ3RCQSxJQUFJQSxDQUFDQSxVQUFVQSxHQUFHQSxTQUFTQSxDQUFDQTtRQUM1QkEsSUFBSUEsQ0FBQ0Es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QSxDQUFDQSxPQUFPQSxHQUFHQSxJQUFJQSxjQUFjQSxDQUFDQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQTtRQUNqREEsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsVUFBVUEsSUFBSUEsVUFBVUEsQ0FBQ0EsSUFBSUEsQ0FBQ0E7WUFDbkRBLElBQUlBLENBQUNBLE9BQU9BLEdBQUdBLElBQUlBLFVBQVVBLEVBQUVBLENBQUNBO1FBRWpDQSxJQUFJQSxDQUFDQSxpQkFBaUJBLEVBQUVBLENBQUNBO0lBQzFCQSxDQUFDQTtJQTVIYVYsYUFBRUEsR0FBVUEsWUFBWUEsQ0FBQ0E7SUE2SHhDQSxpQkFBQ0E7QUFBREEsQ0EvSEEsQUErSENBLEVBL0h3QixRQUFRLEVBK0hoQztBQUVELEFBQW9CLGlCQUFYLFVBQVUsQ0FBQyIsImZpbGUiOiJwYXJ0aXRpb24vRW50aXR5Tm9kZS5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUGxhbmUzRFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9nZW9tL1BsYW5lM0RcIik7XHJcbmltcG9ydCBWZWN0b3IzRFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9nZW9tL1ZlY3RvcjNEXCIpO1xyXG5cclxuaW1wb3J0IEF4aXNBbGlnbmVkQm91bmRpbmdCb3hcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2JvdW5kcy9BeGlzQWxpZ25lZEJvdW5kaW5nQm94XCIpO1xyXG5pbXBvcnQgQm91bmRpbmdTcGhlcmVcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9ib3VuZHMvQm91bmRpbmdTcGhlcmVcIik7XHJcbmltcG9ydCBCb3VuZGluZ1ZvbHVtZUJhc2VcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvYm91bmRzL0JvdW5kaW5nVm9sdW1lQmFzZVwiKTtcclxuaW1wb3J0IEJvdW5kc1R5cGVcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2JvdW5kcy9Cb3VuZHNUeXBlXCIpO1xyXG5pbXBvcnQgTnVsbEJvdW5kc1x0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvYm91bmRzL051bGxCb3VuZHNcIik7XHJcbmltcG9ydCBQYXJ0aXRpb25cdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL3BhcnRpdGlvbi9QYXJ0aXRpb25cIik7XHJcbmltcG9ydCBOb2RlQmFzZVx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9wYXJ0aXRpb24vTm9kZUJhc2VcIik7XHJcbmltcG9ydCBDb2xsZWN0b3JCYXNlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvdHJhdmVyc2UvQ29sbGVjdG9yQmFzZVwiKTtcclxuaW1wb3J0IElFbnRpdHlcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvZW50aXRpZXMvSUVudGl0eVwiKTtcclxuaW1wb3J0IE1lc2hcdFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9NZXNoXCIpO1xyXG5pbXBvcnQgUGlja2luZ0NvbGxpc2lvblZPXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL3BpY2svUGlja2luZ0NvbGxpc2lvblZPXCIpO1xyXG5pbXBvcnQgRW50aXR5Tm9kZVBvb2xcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9wb29sL0VudGl0eU5vZGVQb29sXCIpO1xyXG5cclxuLyoqXHJcbiAqIEBjbGFzcyBhd2F5LnBhcnRpdGlvbi5FbnRpdHlOb2RlXHJcbiAqL1xyXG5jbGFzcyBFbnRpdHlOb2RlIGV4dGVuZHMgTm9kZUJhc2Vcclxue1xyXG5cdHB1YmxpYyBzdGF0aWMgaWQ6c3RyaW5nID0gXCJlbnRpdHlOb2RlXCI7XHJcblxyXG5cdHByaXZhdGUgX3Bvb2w6RW50aXR5Tm9kZVBvb2w7XHJcblx0cHJpdmF0ZSBfZW50aXR5OklFbnRpdHk7XHJcblx0cHJpdmF0ZSBfcGFydGl0aW9uOlBhcnRpdGlvbjtcclxuXHRwcml2YXRlIF9ib3VuZHM6Qm91bmRpbmdWb2x1bWVCYXNlO1xyXG5cdHB1YmxpYyBfaVVwZGF0ZVF1ZXVlTmV4dDpFbnRpdHlOb2RlO1xyXG5cclxuXHRjb25zdHJ1Y3Rvcihwb29sOkVudGl0eU5vZGVQb29sLCBlbnRpdHk6SUVudGl0eSwgcGFydGl0aW9uOlBhcnRpdGlvbilcclxuXHR7XHJcblx0XHRzdXBlcigpO1xyXG5cdFx0dGhpcy5fcG9vbCA9IHBvb2w7XHJcblx0XHR0aGlzLl9lbnRpdHkgPSBlbnRpdHk7XHJcblx0XHR0aGlzLl9wYXJ0aXRpb24gPSBwYXJ0aXRpb247XHJcblx0XHR0aGlzLl9pTnVtRW50aXRpZXMgPSAxO1xyXG5cclxuXHRcdHRoaXMudXBkYXRlQm91bmRzKCk7XHJcblxyXG5cdFx0dGhpcy5kZWJ1Z1Zpc2libGUgPSB0aGlzLl9lbnRpdHkuZGVidWdWaXNpYmxlO1xyXG5cdH1cclxuXHJcblx0cHVibGljIGdldCBlbnRpdHkoKTpJRW50aXR5XHJcblx0e1xyXG5cdFx0cmV0dXJuIHRoaXMuX2VudGl0eTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyByZW1vdmVGcm9tUGFyZW50KCk6dm9pZFxyXG5cdHtcclxuXHRcdGlmICh0aGlzLl9pUGFyZW50KVxyXG5cdFx0XHR0aGlzLl9pUGFyZW50LmlSZW1vdmVOb2RlKHRoaXMpO1xyXG5cclxuXHRcdHRoaXMuX2lQYXJlbnQgPSBudWxsO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICpcclxuXHQgKiBAcmV0dXJucyB7Ym9vbGVhbn1cclxuXHQgKi9cclxuXHRwdWJsaWMgaXNDYXN0aW5nU2hhZG93KCk6Ym9vbGVhblxyXG5cdHtcclxuXHRcdHJldHVybiB0aGlzLmVudGl0eS5jYXN0c1NoYWRvd3M7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKlxyXG5cdCAqIEBwYXJhbSBwbGFuZXNcclxuXHQgKiBAcGFyYW0gbnVtUGxhbmVzXHJcblx0ICogQHJldHVybnMge2Jvb2xlYW59XHJcblx0ICovXHJcblx0cHVibGljIGlzSW5GcnVzdHVtKHBsYW5lczpBcnJheTxQbGFuZTNEPiwgbnVtUGxhbmVzOm51bWJlcik6Ym9vbGVhblxyXG5cdHtcclxuXHRcdGlmICghdGhpcy5fZW50aXR5Ll9pSXNWaXNpYmxlKCkpXHJcblx0XHRcdHJldHVybiBmYWxzZTtcclxuXHJcblx0XHRyZXR1cm4gdGhpcy5fYm91bmRzLmlzSW5GcnVzdHVtKHBsYW5lcywgbnVtUGxhbmVzKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBpbmhlcml0RG9jXHJcblx0ICovXHJcblx0cHVibGljIGFjY2VwdFRyYXZlcnNlcih0cmF2ZXJzZXI6Q29sbGVjdG9yQmFzZSlcclxuXHR7XHJcblx0XHRpZiAodHJhdmVyc2VyLmVudGVyTm9kZSh0aGlzKSkge1xyXG5cdFx0XHR0cmF2ZXJzZXIuYXBwbHlFbnRpdHkodGhpcy5fZW50aXR5KTtcclxuXHJcblx0XHRcdGlmICh0aGlzLl9wSW1wbGljaXREZWJ1Z1Zpc2libGUgJiYgdHJhdmVyc2VyLmlzRW50aXR5Q29sbGVjdG9yKVxyXG5cdFx0XHRcdHRyYXZlcnNlci5hcHBseUVudGl0eSh0aGlzLl9wRGVidWdFbnRpdHkpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQGluaGVyaXREb2NcclxuXHQgKi9cclxuXHRwdWJsaWMgaXNJbnRlcnNlY3RpbmdSYXkocmF5UG9zaXRpb246VmVjdG9yM0QsIHJheURpcmVjdGlvbjpWZWN0b3IzRCk6Ym9vbGVhblxyXG5cdHtcclxuXHRcdGlmICghdGhpcy5fZW50aXR5Ll9pSXNWaXNpYmxlKCkpXHJcblx0XHRcdHJldHVybiBmYWxzZTtcclxuXHJcblx0XHR2YXIgcGlja2luZ0NvbGxpc2lvblZPOlBpY2tpbmdDb2xsaXNpb25WTyA9IHRoaXMuX2VudGl0eS5faVBpY2tpbmdDb2xsaXNpb25WTztcclxuXHRcdHBpY2tpbmdDb2xsaXNpb25WTy5sb2NhbFJheVBvc2l0aW9uID0gdGhpcy5fZW50aXR5LmludmVyc2VTY2VuZVRyYW5zZm9ybS50cmFuc2Zvcm1WZWN0b3IocmF5UG9zaXRpb24pO1xyXG5cdFx0cGlja2luZ0NvbGxpc2lvblZPLmxvY2FsUmF5RGlyZWN0aW9uID0gdGhpcy5fZW50aXR5LmludmVyc2VTY2VuZVRyYW5zZm9ybS5kZWx0YVRyYW5zZm9ybVZlY3RvcihyYXlEaXJlY3Rpb24pO1xyXG5cclxuXHRcdGlmICghcGlja2luZ0NvbGxpc2lvblZPLmxvY2FsTm9ybWFsKVxyXG5cdFx0XHRwaWNraW5nQ29sbGlzaW9uVk8ubG9jYWxOb3JtYWwgPSBuZXcgVmVjdG9yM0QoKTtcclxuXHJcblx0XHR2YXIgcmF5RW50cnlEaXN0YW5jZTpudW1iZXIgPSB0aGlzLl9ib3VuZHMucmF5SW50ZXJzZWN0aW9uKHBpY2tpbmdDb2xsaXNpb25WTy5sb2NhbFJheVBvc2l0aW9uLCBwaWNraW5nQ29sbGlzaW9uVk8ubG9jYWxSYXlEaXJlY3Rpb24sIHBpY2tpbmdDb2xsaXNpb25WTy5sb2NhbE5vcm1hbCk7XHJcblxyXG5cdFx0aWYgKHJheUVudHJ5RGlzdGFuY2UgPCAwKVxyXG5cdFx0XHRyZXR1cm4gZmFsc2U7XHJcblxyXG5cdFx0cGlja2luZ0NvbGxpc2lvblZPLnJheUVudHJ5RGlzdGFuY2UgPSByYXlFbnRyeURpc3RhbmNlO1xyXG5cdFx0cGlja2luZ0NvbGxpc2lvblZPLnJheVBvc2l0aW9uID0gcmF5UG9zaXRpb247XHJcblx0XHRwaWNraW5nQ29sbGlzaW9uVk8ucmF5RGlyZWN0aW9uID0gcmF5RGlyZWN0aW9uO1xyXG5cdFx0cGlja2luZ0NvbGxpc2lvblZPLnJheU9yaWdpbklzSW5zaWRlQm91bmRzID0gcmF5RW50cnlEaXN0YW5jZSA9PSAwO1xyXG5cclxuXHRcdHJldHVybiB0cnVlO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICpcclxuXHQgKiBAcHJvdGVjdGVkXHJcblx0ICovXHJcblx0cHVibGljIF9wQ3JlYXRlRGVidWdFbnRpdHkoKTpJRW50aXR5XHJcblx0e1xyXG5cdFx0cmV0dXJuIHRoaXMuX2JvdW5kcy5ib3VuZHNQcmltaXRpdmU7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgaW52YWxpZGF0ZVBhcnRpdGlvbigpXHJcblx0e1xyXG5cdFx0dGhpcy5fYm91bmRzLmludmFsaWRhdGUoKTtcclxuXHJcblx0XHR0aGlzLl9wYXJ0aXRpb24uaU1hcmtGb3JVcGRhdGUodGhpcyk7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgdXBkYXRlQm91bmRzKClcclxuXHR7XHJcblx0XHRpZiAodGhpcy5fZW50aXR5LmJvdW5kc1R5cGUgPT0gQm91bmRzVHlwZS5BWElTX0FMSUdORURfQk9YKVxyXG5cdFx0XHR0aGlzLl9ib3VuZHMgPSBuZXcgQXhpc0FsaWduZWRCb3VuZGluZ0JveCh0aGlzLl9lbnRpdHkpO1xyXG5cdFx0ZWxzZSBpZiAodGhpcy5fZW50aXR5LmJvdW5kc1R5cGUgPT0gQm91bmRzVHlwZS5TUEhFUkUpXHJcblx0XHRcdHRoaXMuX2JvdW5kcyA9IG5ldyBCb3VuZGluZ1NwaGVyZSh0aGlzLl9lbnRpdHkpO1xyXG5cdFx0ZWxzZSBpZiAodGhpcy5fZW50aXR5LmJvdW5kc1R5cGUgPT0gQm91bmRzVHlwZS5OVUxMKVxyXG5cdFx0XHR0aGlzLl9ib3VuZHMgPSBuZXcgTnVsbEJvdW5kcygpO1xyXG5cclxuXHRcdHRoaXMudXBkYXRlRGVidWdFbnRpdHkoKTtcclxuXHR9XHJcbn1cclxuXHJcbmV4cG9ydCA9IEVudGl0eU5vZGU7Il19