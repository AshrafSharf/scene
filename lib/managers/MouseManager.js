var Vector3D = require("awayjs-core/lib/geom/Vector3D");
var AwayMouseEvent = require("awayjs-display/lib/events/MouseEvent");
/**
 * MouseManager enforces a singleton pattern and is not intended to be instanced.
 * it provides a manager class for detecting mouse hits on scene objects and sending out mouse events.
 */
var MouseManager = (function () {
    /**
     * Creates a new <code>MouseManager</code> object.
     */
    function MouseManager() {
        var _this = this;
        this._viewLookup = new Array();
        this._nullVector = new Vector3D();
        this._queuedEvents = new Array();
        this._mouseUp = new AwayMouseEvent(AwayMouseEvent.MOUSE_UP);
        this._mouseClick = new AwayMouseEvent(AwayMouseEvent.CLICK);
        this._mouseOut = new AwayMouseEvent(AwayMouseEvent.MOUSE_OUT);
        this._mouseDown = new AwayMouseEvent(AwayMouseEvent.MOUSE_DOWN);
        this._mouseMove = new AwayMouseEvent(AwayMouseEvent.MOUSE_MOVE);
        this._mouseOver = new AwayMouseEvent(AwayMouseEvent.MOUSE_OVER);
        this._mouseWheel = new AwayMouseEvent(AwayMouseEvent.MOUSE_WHEEL);
        this._mouseDoubleClick = new AwayMouseEvent(AwayMouseEvent.DOUBLE_CLICK);
        this.onClickDelegate = function (event) { return _this.onClick(event); };
        this.onDoubleClickDelegate = function (event) { return _this.onDoubleClick(event); };
        this.onMouseDownDelegate = function (event) { return _this.onMouseDown(event); };
        this.onMouseMoveDelegate = function (event) { return _this.onMouseMove(event); };
        this.onMouseUpDelegate = function (event) { return _this.onMouseUp(event); };
        this.onMouseWheelDelegate = function (event) { return _this.onMouseWheel(event); };
        this.onMouseOverDelegate = function (event) { return _this.onMouseOver(event); };
        this.onMouseOutDelegate = function (event) { return _this.onMouseOut(event); };
    }
    MouseManager.getInstance = function () {
        if (this._instance)
            return this._instance;
        return (this._instance = new MouseManager());
    };
    MouseManager.prototype.fireMouseEvents = function (forceMouseMove) {
        // If colliding object has changed, queue over/out events.
        if (this._iCollidingObject != this._previousCollidingObject) {
            if (this._previousCollidingObject)
                this.queueDispatch(this._mouseOut, this._mouseMoveEvent, this._previousCollidingObject);
            if (this._iCollidingObject)
                this.queueDispatch(this._mouseOver, this._mouseMoveEvent);
        }
        // Fire mouse move events here if forceMouseMove is on.
        if (forceMouseMove && this._iCollidingObject)
            this.queueDispatch(this._mouseMove, this._mouseMoveEvent);
        var event;
        var dispatcher;
        // Dispatch all queued events.
        var len = this._queuedEvents.length;
        for (var i = 0; i < len; ++i) {
            // Only dispatch from first implicitly enabled object ( one that is not a child of a mouseChildren = false hierarchy ).
            event = this._queuedEvents[i];
            dispatcher = event.object;
            while (dispatcher && !dispatcher._iIsMouseEnabled())
                dispatcher = dispatcher.parent;
            if (dispatcher)
                dispatcher.dispatchEvent(event);
        }
        this._queuedEvents.length = 0;
        this._previousCollidingObject = this._iCollidingObject;
        this._iUpdateDirty = false;
    };
    //		public addViewLayer(view:View)
    //		{
    //			var stg:Stage = view.stage;
    //
    //			// Add instance to mouse3dmanager to fire mouse events for multiple views
    //			if (!view.stageGL.mouse3DManager)
    //				view.stageGL.mouse3DManager = this;
    //
    //			if (!hasKey(view))
    //				_view3Ds[view] = 0;
    //
    //			_childDepth = 0;
    //			traverseDisplayObjects(stg);
    //			_viewCount = _childDepth;
    //		}
    MouseManager.prototype.registerView = function (view) {
        view.htmlElement.addEventListener("click", this.onClickDelegate);
        view.htmlElement.addEventListener("dblclick", this.onDoubleClickDelegate);
        view.htmlElement.addEventListener("mousedown", this.onMouseDownDelegate);
        view.htmlElement.addEventListener("mousemove", this.onMouseMoveDelegate);
        view.htmlElement.addEventListener("mouseup", this.onMouseUpDelegate);
        view.htmlElement.addEventListener("mousewheel", this.onMouseWheelDelegate);
        view.htmlElement.addEventListener("mouseover", this.onMouseOverDelegate);
        view.htmlElement.addEventListener("mouseout", this.onMouseOutDelegate);
        this._viewLookup.push(view);
    };
    MouseManager.prototype.unregisterView = function (view) {
        view.htmlElement.removeEventListener("click", this.onClickDelegate);
        view.htmlElement.removeEventListener("dblclick", this.onDoubleClickDelegate);
        view.htmlElement.removeEventListener("mousedown", this.onMouseDownDelegate);
        view.htmlElement.removeEventListener("mousemove", this.onMouseMoveDelegate);
        view.htmlElement.removeEventListener("mouseup", this.onMouseUpDelegate);
        view.htmlElement.removeEventListener("mousewheel", this.onMouseWheelDelegate);
        view.htmlElement.removeEventListener("mouseover", this.onMouseOverDelegate);
        view.htmlElement.removeEventListener("mouseout", this.onMouseOutDelegate);
        this._viewLookup.slice(this._viewLookup.indexOf(view), 1);
    };
    // ---------------------------------------------------------------------
    // Private.
    // ---------------------------------------------------------------------
    MouseManager.prototype.queueDispatch = function (event, sourceEvent, collider) {
        if (collider === void 0) { collider = null; }
        // 2D properties.
        if (sourceEvent) {
            event.ctrlKey = sourceEvent.ctrlKey;
            event.altKey = sourceEvent.altKey;
            event.shiftKey = sourceEvent.shiftKey;
            event.screenX = sourceEvent.clientX;
            event.screenY = sourceEvent.clientY;
        }
        if (collider == null)
            collider = this._iCollidingObject;
        // 3D properties.
        if (collider) {
            // Object.
            event.object = collider.displayObject;
            event.renderableOwner = collider.renderableOwner;
            // UV.
            event.uv = collider.uv;
            // Position.
            event.localPosition = collider.localPosition ? collider.localPosition.clone() : null;
            // Normal.
            event.localNormal = collider.localNormal ? collider.localNormal.clone() : null;
            // Face index.
            event.index = collider.index;
        }
        else {
            // Set all to null.
            event.uv = null;
            event.object = null;
            event.localPosition = this._nullVector;
            event.localNormal = this._nullVector;
            event.index = 0;
            event.subGeometryIndex = 0;
        }
        // Store event to be dispatched later.
        this._queuedEvents.push(event);
    };
    // ---------------------------------------------------------------------
    // Listeners.
    // ---------------------------------------------------------------------
    MouseManager.prototype.onMouseMove = function (event) {
        this.updateColliders(event);
        if (this._iCollidingObject)
            this.queueDispatch(this._mouseMove, this._mouseMoveEvent = event);
    };
    MouseManager.prototype.onMouseOut = function (event) {
        this._iActiveDiv = null;
        this.updateColliders(event);
        if (this._iCollidingObject)
            this.queueDispatch(this._mouseOut, event);
    };
    MouseManager.prototype.onMouseOver = function (event) {
        this._iActiveDiv = event.target;
        this.updateColliders(event);
        if (this._iCollidingObject)
            this.queueDispatch(this._mouseOver, event);
    };
    MouseManager.prototype.onClick = function (event) {
        this.updateColliders(event);
        if (this._iCollidingObject)
            this.queueDispatch(this._mouseClick, event);
    };
    MouseManager.prototype.onDoubleClick = function (event) {
        this.updateColliders(event);
        if (this._iCollidingObject)
            this.queueDispatch(this._mouseDoubleClick, event);
    };
    MouseManager.prototype.onMouseDown = function (event) {
        this._iActiveDiv = event.target;
        this.updateColliders(event);
        if (this._iCollidingObject)
            this.queueDispatch(this._mouseDown, event);
    };
    MouseManager.prototype.onMouseUp = function (event) {
        this.updateColliders(event);
        if (this._iCollidingObject)
            this.queueDispatch(this._mouseUp, event);
    };
    MouseManager.prototype.onMouseWheel = function (event) {
        this.updateColliders(event);
        if (this._iCollidingObject)
            this.queueDispatch(this._mouseWheel, event);
    };
    MouseManager.prototype.updateColliders = function (event) {
        if (this._iUpdateDirty)
            return;
        var view;
        var bounds;
        var mouseX = event.clientX;
        var mouseY = event.clientY;
        var len = this._viewLookup.length;
        for (var i = 0; i < len; i++) {
            view = this._viewLookup[i];
            bounds = view.htmlElement.getBoundingClientRect();
            if (mouseX < bounds.left || mouseX > bounds.right || mouseY < bounds.top || mouseY > bounds.bottom) {
                view._pMouseX = null;
                view._pMouseY = null;
            }
            else {
                view._pMouseX = mouseX + bounds.left;
                view._pMouseY = mouseY + bounds.top;
                view.updateCollider();
                if (view.layeredView && this._iCollidingObject)
                    break;
            }
        }
        this._iUpdateDirty = true;
    };
    return MouseManager;
})();
module.exports = MouseManager;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1kaXNwbGF5L2xpYi9tYW5hZ2Vycy9Nb3VzZU1hbmFnZXIudHMiXSwibmFtZXMiOlsiTW91c2VNYW5hZ2VyIiwiTW91c2VNYW5hZ2VyLmNvbnN0cnVjdG9yIiwiTW91c2VNYW5hZ2VyLmdldEluc3RhbmNlIiwiTW91c2VNYW5hZ2VyLmZpcmVNb3VzZUV2ZW50cyIsIk1vdXNlTWFuYWdlci5yZWdpc3RlclZpZXciLCJNb3VzZU1hbmFnZXIudW5yZWdpc3RlclZpZXciLCJNb3VzZU1hbmFnZXIucXVldWVEaXNwYXRjaCIsIk1vdXNlTWFuYWdlci5vbk1vdXNlTW92ZSIsIk1vdXNlTWFuYWdlci5vbk1vdXNlT3V0IiwiTW91c2VNYW5hZ2VyLm9uTW91c2VPdmVyIiwiTW91c2VNYW5hZ2VyLm9uQ2xpY2siLCJNb3VzZU1hbmFnZXIub25Eb3VibGVDbGljayIsIk1vdXNlTWFuYWdlci5vbk1vdXNlRG93biIsIk1vdXNlTWFuYWdlci5vbk1vdXNlVXAiLCJNb3VzZU1hbmFnZXIub25Nb3VzZVdoZWVsIiwiTW91c2VNYW5hZ2VyLnVwZGF0ZUNvbGxpZGVycyJdLCJtYXBwaW5ncyI6IkFBQUEsSUFBTyxRQUFRLFdBQWdCLCtCQUErQixDQUFDLENBQUM7QUFLaEUsSUFBTyxjQUFjLFdBQWMsc0NBQXNDLENBQUMsQ0FBQztBQUUzRSxBQUlBOzs7R0FERztJQUNHLFlBQVk7SUFrQ2pCQTs7T0FFR0E7SUFDSEEsU0FyQ0tBLFlBQVlBO1FBQWxCQyxpQkFnU0NBO1FBNVJRQSxnQkFBV0EsR0FBZUEsSUFBSUEsS0FBS0EsRUFBUUEsQ0FBQ0E7UUFNNUNBLGdCQUFXQSxHQUFZQSxJQUFJQSxRQUFRQSxFQUFFQSxDQUFDQTtRQUV0Q0Esa0JBQWFBLEdBQXlCQSxJQUFJQSxLQUFLQSxFQUFrQkEsQ0FBQ0E7UUFJbEVBLGFBQVFBLEdBQWtCQSxJQUFJQSxjQUFjQSxDQUFDQSxjQUFjQSxDQUFDQSxRQUFRQSxDQUFDQSxDQUFDQTtRQUN0RUEsZ0JBQVdBLEdBQWtCQSxJ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QUVBLENBQUNBLENBQUNBLE1BQU1BLEdBQUdBLE1BQU1BLENBQUNBLElBQUlBLElBQUlBLE1BQU1BLEdBQUdBLE1BQU1BLENBQUNBLEtBQUtBLElBQUlBLE1BQU1BLEdBQUdBLE1BQU1BLENBQUNBLEdBQUdBLElBQUlBLE1BQU1BLEdBQUdBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBO2dCQUNwR0EsSUFBSUEsQ0FBQ0EsUUFBUUEsR0FBR0EsSUFBSUEsQ0FBQ0E7Z0JBQ3JCQSxJQUFJQSxDQUFDQSxRQUFRQSxHQUFHQSxJQUFJQSxDQUFDQTtZQUN0QkEsQ0FBQ0E7WUFBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7Z0JBQ1BBLElBQUlBLENBQUNBLFFBQVFBLEdBQUdBLE1BQU1BLEdBQUdBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBO2dCQUNyQ0EsSUFBSUEsQ0FBQ0EsUUFBUUEsR0FBR0EsTUFBTUEsR0FBR0EsTUFBTUEsQ0FBQ0EsR0FBR0EsQ0FBQ0E7Z0JBQ3BDQSxJQUFJQSxDQUFDQSxjQUFjQSxFQUFFQSxDQUFDQTtnQkFFdEJBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLFdBQVdBLElBQUlBLElBQUlBLENBQUNBLGlCQUFpQkEsQ0FBQ0E7b0JBQzlDQSxLQUFLQSxDQUFDQTtZQUNSQSxDQUFDQTtRQUNGQSxDQUFDQTtRQUVEQSxJQUFJQSxDQUFDQSxhQUFhQSxHQUFHQSxJQUFJQSxDQUFDQTtJQUMzQkEsQ0FBQ0E7SUFDRmYsbUJBQUNBO0FBQURBLENBaFNBLEFBZ1NDQSxJQUFBO0FBRUQsQUFBc0IsaUJBQWIsWUFBWSxDQUFDIiwiZmlsZSI6Im1hbmFnZXJzL01vdXNlTWFuYWdlci5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgVmVjdG9yM0RcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9WZWN0b3IzRFwiKTtcclxuXHJcbmltcG9ydCBEaXNwbGF5T2JqZWN0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvYmFzZS9EaXNwbGF5T2JqZWN0XCIpO1xyXG5pbXBvcnQgVmlld1x0XHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2NvbnRhaW5lcnMvVmlld1wiKTtcclxuaW1wb3J0IFBpY2tpbmdDb2xsaXNpb25WT1x0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9waWNrL1BpY2tpbmdDb2xsaXNpb25WT1wiKTtcclxuaW1wb3J0IEF3YXlNb3VzZUV2ZW50XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvZXZlbnRzL01vdXNlRXZlbnRcIik7XHJcblxyXG4vKipcclxuICogTW91c2VNYW5hZ2VyIGVuZm9yY2VzIGEgc2luZ2xldG9uIHBhdHRlcm4gYW5kIGlzIG5vdCBpbnRlbmRlZCB0byBiZSBpbnN0YW5jZWQuXHJcbiAqIGl0IHByb3ZpZGVzIGEgbWFuYWdlciBjbGFzcyBmb3IgZGV0ZWN0aW5nIG1vdXNlIGhpdHMgb24gc2NlbmUgb2JqZWN0cyBhbmQgc2VuZGluZyBvdXQgbW91c2UgZXZlbnRzLlxyXG4gKi9cclxuY2xhc3MgTW91c2VNYW5hZ2VyXHJcbntcclxuXHRwcml2YXRlIHN0YXRpYyBfaW5zdGFuY2U6TW91c2VNYW5hZ2VyO1xyXG5cclxuXHRwcml2YXRlIF92aWV3TG9va3VwOkFycmF5PFZpZXc+ID0gbmV3IEFycmF5PFZpZXc+KCk7XHJcblxyXG5cdHB1YmxpYyBfaUFjdGl2ZURpdjpIVE1MRGl2RWxlbWVudDtcclxuXHRwdWJsaWMgX2lVcGRhdGVEaXJ0eTpib29sZWFuO1xyXG5cdHB1YmxpYyBfaUNvbGxpZGluZ09iamVjdDpQaWNraW5nQ29sbGlzaW9uVk87XHJcblx0XHJcblx0cHJpdmF0ZSBfbnVsbFZlY3RvcjpWZWN0b3IzRCA9IG5ldyBWZWN0b3IzRCgpO1xyXG5cdHByaXZhdGUgX3ByZXZpb3VzQ29sbGlkaW5nT2JqZWN0OlBpY2tpbmdDb2xsaXNpb25WTztcclxuXHRwcml2YXRlIF9xdWV1ZWRFdmVudHM6QXJyYXk8QXdheU1vdXNlRXZlbnQ+ID0gbmV3IEFycmF5PEF3YXlNb3VzZUV2ZW50PigpO1xyXG5cclxuXHRwcml2YXRlIF9tb3VzZU1vdmVFdmVudDpNb3VzZUV2ZW50O1xyXG5cclxuXHRwcml2YXRlIF9tb3VzZVVwOkF3YXlNb3VzZUV2ZW50ID0gbmV3IEF3YXlNb3VzZUV2ZW50KEF3YXlNb3VzZUV2ZW50Lk1PVVNFX1VQKTtcclxuXHRwcml2YXRlIF9tb3VzZUNsaWNrOkF3YXlNb3VzZUV2ZW50ID0gbmV3IEF3YXlNb3VzZUV2ZW50KEF3YXlNb3VzZUV2ZW50LkNMSUNLKTtcclxuXHRwcml2YXRlIF9tb3VzZU91dDpBd2F5TW91c2VFdmVudCA9IG5ldyBBd2F5TW91c2VFdmVudChBd2F5TW91c2VFdmVudC5NT1VTRV9PVVQpO1xyXG5cdHByaXZhdGUgX21vdXNlRG93bjpBd2F5TW91c2VFdmVudCA9IG5ldyBBd2F5TW91c2VFdmVudChBd2F5TW91c2VFdmVudC5NT1VTRV9ET1dOKTtcclxuXHRwcml2YXRlIF9tb3VzZU1vdmU6QXdheU1vdXNlRXZlbnQgPSBuZXcgQXdheU1vdXNlRXZlbnQoQXdheU1vdXNlRXZlbnQuTU9VU0VfTU9WRSk7XHJcblx0cHJpdmF0ZSBfbW91c2VPdmVyOkF3YXlNb3VzZUV2ZW50ID0gbmV3IEF3YXlNb3VzZUV2ZW50KEF3YXlNb3VzZUV2ZW50Lk1PVVNFX09WRVIpO1xyXG5cdHByaXZhdGUgX21vdXNlV2hlZWw6QXdheU1vdXNlRXZlbnQgPSBuZXcgQXdheU1vdXNlRXZlbnQoQXdheU1vdXNlRXZlbnQuTU9VU0VfV0hFRUwpO1xyXG5cdHByaXZhdGUgX21vdXNlRG91YmxlQ2xpY2s6QXdheU1vdXNlRXZlbnQgPSBuZXcgQXdheU1vdXNlRXZlbnQoQXdheU1vdXNlRXZlbnQuRE9VQkxFX0NMSUNLKTtcclxuXHJcblx0cHJpdmF0ZSBvbkNsaWNrRGVsZWdhdGU6KGV2ZW50Ok1vdXNlRXZlbnQpID0+IHZvaWQ7XHJcblx0cHJpdmF0ZSBvbkRvdWJsZUNsaWNrRGVsZWdhdGU6KGV2ZW50Ok1vdXNlRXZlbnQpID0+IHZvaWQ7XHJcblx0cHJpdmF0ZSBvbk1vdXNlRG93bkRlbGVnYXRlOihldmVudDpNb3VzZUV2ZW50KSA9PiB2b2lkO1xyXG5cdHByaXZhdGUgb25Nb3VzZU1vdmVEZWxlZ2F0ZTooZXZlbnQ6TW91c2VFdmVudCkgPT4gdm9pZDtcclxuXHRwcml2YXRlIG9uTW91c2VVcERlbGVnYXRlOihldmVudDpNb3VzZUV2ZW50KSA9PiB2b2lkO1xyXG5cdHByaXZhdGUgb25Nb3VzZVdoZWVsRGVsZWdhdGU6KGV2ZW50Ok1vdXNlRXZlbnQpID0+IHZvaWQ7XHJcblx0cHJpdmF0ZSBvbk1vdXNlT3ZlckRlbGVnYXRlOihldmVudDpNb3VzZUV2ZW50KSA9PiB2b2lkO1xyXG5cdHByaXZhdGUgb25Nb3VzZU91dERlbGVnYXRlOihldmVudDpNb3VzZUV2ZW50KSA9PiB2b2lkO1xyXG5cclxuXHQvKipcclxuXHQgKiBDcmVhdGVzIGEgbmV3IDxjb2RlPk1vdXNlTWFuYWdlcjwvY29kZT4gb2JqZWN0LlxyXG5cdCAqL1xyXG5cdGNvbnN0cnVjdG9yKClcclxuXHR7XHJcblx0XHR0aGlzLm9uQ2xpY2tEZWxlZ2F0ZSA9IChldmVudDpNb3VzZUV2ZW50KSA9PiB0aGlzLm9uQ2xpY2soZXZlbnQpO1xyXG5cdFx0dGhpcy5vbkRvdWJsZUNsaWNrRGVsZWdhdGUgPSAoZXZlbnQ6TW91c2VFdmVudCkgPT4gdGhpcy5vbkRvdWJsZUNsaWNrKGV2ZW50KTtcclxuXHRcdHRoaXMub25Nb3VzZURvd25EZWxlZ2F0ZSA9IChldmVudDpNb3VzZUV2ZW50KSA9PiB0aGlzLm9uTW91c2VEb3duKGV2ZW50KTtcclxuXHRcdHRoaXMub25Nb3VzZU1vdmVEZWxlZ2F0ZSA9IChldmVudDpNb3VzZUV2ZW50KSA9PiB0aGlzLm9uTW91c2VNb3ZlKGV2ZW50KTtcclxuXHRcdHRoaXMub25Nb3VzZVVwRGVsZWdhdGUgPSAoZXZlbnQ6TW91c2VFdmVudCkgPT4gdGhpcy5vbk1vdXNlVXAoZXZlbnQpO1xyXG5cdFx0dGhpcy5vbk1vdXNlV2hlZWxEZWxlZ2F0ZSA9IChldmVudDpNb3VzZUV2ZW50KSA9PiB0aGlzLm9uTW91c2VXaGVlbChldmVudCk7XHJcblx0XHR0aGlzLm9uTW91c2VPdmVyRGVsZWdhdGUgPSAoZXZlbnQ6TW91c2VFdmVudCkgPT4gdGhpcy5vbk1vdXNlT3ZlcihldmVudCk7XHJcblx0XHR0aGlzLm9uTW91c2VPdXREZWxlZ2F0ZSA9IChldmVudDpNb3VzZUV2ZW50KSA9PiB0aGlzLm9uTW91c2VPdXQoZXZlbnQpO1xyXG5cdH1cclxuXHJcblx0cHVibGljIHN0YXRpYyBnZXRJbnN0YW5jZSgpOk1vdXNlTWFuYWdlclxyXG5cdHtcclxuXHRcdGlmICh0aGlzLl9pbnN0YW5jZSlcclxuXHRcdFx0cmV0dXJuIHRoaXMuX2luc3RhbmNlO1xyXG5cclxuXHRcdHJldHVybiAodGhpcy5faW5zdGFuY2UgPSBuZXcgTW91c2VNYW5hZ2VyKCkpO1xyXG5cdH1cclxuXHJcblx0cHVibGljIGZpcmVNb3VzZUV2ZW50cyhmb3JjZU1vdXNlTW92ZTpib29sZWFuKVxyXG5cdHtcclxuXHRcdCAvLyBJZiBjb2xsaWRpbmcgb2JqZWN0IGhhcyBjaGFuZ2VkLCBxdWV1ZSBvdmVyL291dCBldmVudHMuXHJcblx0XHRpZiAodGhpcy5faUNvbGxpZGluZ09iamVjdCAhPSB0aGlzLl9wcmV2aW91c0NvbGxpZGluZ09iamVjdCkge1xyXG5cdFx0XHRpZiAodGhpcy5fcHJldmlvdXNDb2xsaWRpbmdPYmplY3QpXHJcblx0XHRcdFx0dGhpcy5xdWV1ZURpc3BhdGNoKHRoaXMuX21vdXNlT3V0LCB0aGlzLl9tb3VzZU1vdmVFdmVudCwgdGhpcy5fcHJldmlvdXNDb2xsaWRpbmdPYmplY3QpO1xyXG5cclxuXHRcdFx0aWYgKHRoaXMuX2lDb2xsaWRpbmdPYmplY3QpXHJcblx0XHRcdFx0dGhpcy5xdWV1ZURpc3BhdGNoKHRoaXMuX21vdXNlT3ZlciwgdGhpcy5fbW91c2VNb3ZlRXZlbnQpO1xyXG5cdFx0fVxyXG5cclxuXHRcdCAvLyBGaXJlIG1vdXNlIG1vdmUgZXZlbnRzIGhlcmUgaWYgZm9yY2VNb3VzZU1vdmUgaXMgb24uXHJcblx0XHRpZiAoZm9yY2VNb3VzZU1vdmUgJiYgdGhpcy5faUNvbGxpZGluZ09iamVjdClcclxuXHRcdFx0dGhpcy5xdWV1ZURpc3BhdGNoKCB0aGlzLl9tb3VzZU1vdmUsIHRoaXMuX21vdXNlTW92ZUV2ZW50KTtcclxuXHJcblx0XHR2YXIgZXZlbnQ6QXdheU1vdXNlRXZlbnQ7XHJcblx0XHR2YXIgZGlzcGF0Y2hlcjpEaXNwbGF5T2JqZWN0O1xyXG5cclxuXHRcdCAvLyBEaXNwYXRjaCBhbGwgcXVldWVkIGV2ZW50cy5cclxuXHRcdHZhciBsZW46bnVtYmVyID0gdGhpcy5fcXVldWVkRXZlbnRzLmxlbmd0aDtcclxuXHRcdGZvciAodmFyIGk6bnVtYmVyID0gMDsgaSA8IGxlbjsgKytpKSB7XHJcblx0XHRcdC8vIE9ubHkgZGlzcGF0Y2ggZnJvbSBmaXJzdCBpbXBsaWNpdGx5IGVuYWJsZWQgb2JqZWN0ICggb25lIHRoYXQgaXMgbm90IGEgY2hpbGQgb2YgYSBtb3VzZUNoaWxkcmVuID0gZmFsc2UgaGllcmFyY2h5ICkuXHJcblx0XHRcdGV2ZW50ID0gdGhpcy5fcXVldWVkRXZlbnRzW2ldO1xyXG5cdFx0XHRkaXNwYXRjaGVyID0gZXZlbnQub2JqZWN0O1xyXG5cclxuXHRcdFx0d2hpbGUgKGRpc3BhdGNoZXIgJiYgIWRpc3BhdGNoZXIuX2lJc01vdXNlRW5hYmxlZCgpKVxyXG5cdFx0XHRcdGRpc3BhdGNoZXIgPSBkaXNwYXRjaGVyLnBhcmVudDtcclxuXHJcblx0XHRcdGlmIChkaXNwYXRjaGVyKVxyXG5cdFx0XHRcdGRpc3BhdGNoZXIuZGlzcGF0Y2hFdmVudChldmVudCk7XHJcblx0XHR9XHJcblxyXG5cdFx0dGhpcy5fcXVldWVkRXZlbnRzLmxlbmd0aCA9IDA7XHJcblxyXG5cdFx0dGhpcy5fcHJldmlvdXNDb2xsaWRpbmdPYmplY3QgPSB0aGlzLl9pQ29sbGlkaW5nT2JqZWN0O1xyXG5cclxuXHRcdHRoaXMuX2lVcGRhdGVEaXJ0eSA9IGZhbHNlO1xyXG5cdH1cclxuXHJcbi8vXHRcdHB1YmxpYyBhZGRWaWV3TGF5ZXIodmlldzpWaWV3KVxyXG4vL1x0XHR7XHJcbi8vXHRcdFx0dmFyIHN0ZzpTdGFnZSA9IHZpZXcuc3RhZ2U7XHJcbi8vXHJcbi8vXHRcdFx0Ly8gQWRkIGluc3RhbmNlIHRvIG1vdXNlM2RtYW5hZ2VyIHRvIGZpcmUgbW91c2UgZXZlbnRzIGZvciBtdWx0aXBsZSB2aWV3c1xyXG4vL1x0XHRcdGlmICghdmlldy5zdGFnZUdMLm1vdXNlM0RNYW5hZ2VyKVxyXG4vL1x0XHRcdFx0dmlldy5zdGFnZUdMLm1vdXNlM0RNYW5hZ2VyID0gdGhpcztcclxuLy9cclxuLy9cdFx0XHRpZiAoIWhhc0tleSh2aWV3KSlcclxuLy9cdFx0XHRcdF92aWV3M0RzW3ZpZXddID0gMDtcclxuLy9cclxuLy9cdFx0XHRfY2hpbGREZXB0aCA9IDA7XHJcbi8vXHRcdFx0dHJhdmVyc2VEaXNwbGF5T2JqZWN0cyhzdGcpO1xyXG4vL1x0XHRcdF92aWV3Q291bnQgPSBfY2hpbGREZXB0aDtcclxuLy9cdFx0fVxyXG5cclxuXHRwdWJsaWMgcmVnaXN0ZXJWaWV3KHZpZXc6VmlldylcclxuXHR7XHJcblx0XHR2aWV3Lmh0bWxFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLm9uQ2xpY2tEZWxlZ2F0ZSk7XHJcblx0XHR2aWV3Lmh0bWxFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJkYmxjbGlja1wiLCB0aGlzLm9uRG91YmxlQ2xpY2tEZWxlZ2F0ZSk7XHJcblx0XHR2aWV3Lmh0bWxFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgdGhpcy5vbk1vdXNlRG93bkRlbGVnYXRlKTtcclxuXHRcdHZpZXcuaHRtbEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLCB0aGlzLm9uTW91c2VNb3ZlRGVsZWdhdGUpO1xyXG5cdFx0dmlldy5odG1sRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2V1cFwiLCB0aGlzLm9uTW91c2VVcERlbGVnYXRlKTtcclxuXHRcdHZpZXcuaHRtbEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNld2hlZWxcIiwgdGhpcy5vbk1vdXNlV2hlZWxEZWxlZ2F0ZSk7XHJcblx0XHR2aWV3Lmh0bWxFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW92ZXJcIiwgdGhpcy5vbk1vdXNlT3ZlckRlbGVnYXRlKTtcclxuXHRcdHZpZXcuaHRtbEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlb3V0XCIsIHRoaXMub25Nb3VzZU91dERlbGVnYXRlKTtcclxuXHJcblx0XHR0aGlzLl92aWV3TG9va3VwLnB1c2godmlldyk7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgdW5yZWdpc3RlclZpZXcodmlldzpWaWV3KVxyXG5cdHtcclxuXHRcdHZpZXcuaHRtbEVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMub25DbGlja0RlbGVnYXRlKTtcclxuXHRcdHZpZXcuaHRtbEVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImRibGNsaWNrXCIsIHRoaXMub25Eb3VibGVDbGlja0RlbGVnYXRlKTtcclxuXHRcdHZpZXcuaHRtbEVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCB0aGlzLm9uTW91c2VEb3duRGVsZWdhdGUpO1xyXG5cdFx0dmlldy5odG1sRWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2Vtb3ZlXCIsIHRoaXMub25Nb3VzZU1vdmVEZWxlZ2F0ZSk7XHJcblx0XHR2aWV3Lmh0bWxFbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsIHRoaXMub25Nb3VzZVVwRGVsZWdhdGUpO1xyXG5cdFx0dmlldy5odG1sRWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2V3aGVlbFwiLCB0aGlzLm9uTW91c2VXaGVlbERlbGVnYXRlKTtcclxuXHRcdHZpZXcuaHRtbEVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNlb3ZlclwiLCB0aGlzLm9uTW91c2VPdmVyRGVsZWdhdGUpO1xyXG5cdFx0dmlldy5odG1sRWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2VvdXRcIiwgdGhpcy5vbk1vdXNlT3V0RGVsZWdhdGUpO1xyXG5cclxuXHRcdHRoaXMuX3ZpZXdMb29rdXAuc2xpY2UodGhpcy5fdmlld0xvb2t1cC5pbmRleE9mKHZpZXcpLCAxKTtcclxuXHR9XHJcblxyXG5cdC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cdC8vIFByaXZhdGUuXHJcblx0Ly8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG5cdHByaXZhdGUgcXVldWVEaXNwYXRjaChldmVudDpBd2F5TW91c2VFdmVudCwgc291cmNlRXZlbnQ6TW91c2VFdmVudCwgY29sbGlkZXI6UGlja2luZ0NvbGxpc2lvblZPID0gbnVsbClcclxuXHR7XHJcblx0XHQvLyAyRCBwcm9wZXJ0aWVzLlxyXG5cdFx0aWYgKHNvdXJjZUV2ZW50KSB7XHJcblx0XHRcdGV2ZW50LmN0cmxLZXkgPSBzb3VyY2VFdmVudC5jdHJsS2V5O1xyXG5cdFx0XHRldmVudC5hbHRLZXkgPSBzb3VyY2VFdmVudC5hbHRLZXk7XHJcblx0XHRcdGV2ZW50LnNoaWZ0S2V5ID0gc291cmNlRXZlbnQuc2hpZnRLZXk7XHJcblx0XHRcdGV2ZW50LnNjcmVlblggPSBzb3VyY2VFdmVudC5jbGllbnRYO1xyXG5cdFx0XHRldmVudC5zY3JlZW5ZID0gc291cmNlRXZlbnQuY2xpZW50WTtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAoY29sbGlkZXIgPT0gbnVsbClcclxuXHRcdFx0Y29sbGlkZXIgPSB0aGlzLl9pQ29sbGlkaW5nT2JqZWN0O1xyXG5cclxuXHRcdC8vIDNEIHByb3BlcnRpZXMuXHJcblx0XHRpZiAoY29sbGlkZXIpIHtcclxuXHRcdFx0Ly8gT2JqZWN0LlxyXG5cdFx0XHRldmVudC5vYmplY3QgPSBjb2xsaWRlci5kaXNwbGF5T2JqZWN0O1xyXG5cdFx0XHRldmVudC5yZW5kZXJhYmxlT3duZXIgPSBjb2xsaWRlci5yZW5kZXJhYmxlT3duZXI7XHJcblx0XHRcdC8vIFVWLlxyXG5cdFx0XHRldmVudC51diA9IGNvbGxpZGVyLnV2O1xyXG5cdFx0XHQvLyBQb3NpdGlvbi5cclxuXHRcdFx0ZXZlbnQubG9jYWxQb3NpdGlvbiA9IGNvbGxpZGVyLmxvY2FsUG9zaXRpb24/IGNvbGxpZGVyLmxvY2FsUG9zaXRpb24uY2xvbmUoKSA6IG51bGw7XHJcblx0XHRcdC8vIE5vcm1hbC5cclxuXHRcdFx0ZXZlbnQubG9jYWxOb3JtYWwgPSBjb2xsaWRlci5sb2NhbE5vcm1hbD8gY29sbGlkZXIubG9jYWxOb3JtYWwuY2xvbmUoKSA6IG51bGw7XHJcblx0XHRcdC8vIEZhY2UgaW5kZXguXHJcblx0XHRcdGV2ZW50LmluZGV4ID0gY29sbGlkZXIuaW5kZXg7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHQvLyBTZXQgYWxsIHRvIG51bGwuXHJcblx0XHRcdGV2ZW50LnV2ID0gbnVsbDtcclxuXHRcdFx0ZXZlbnQub2JqZWN0ID0gbnVsbDtcclxuXHRcdFx0ZXZlbnQubG9jYWxQb3NpdGlvbiA9IHRoaXMuX251bGxWZWN0b3I7XHJcblx0XHRcdGV2ZW50LmxvY2FsTm9ybWFsID0gdGhpcy5fbnVsbFZlY3RvcjtcclxuXHRcdFx0ZXZlbnQuaW5kZXggPSAwO1xyXG5cdFx0XHRldmVudC5zdWJHZW9tZXRyeUluZGV4ID0gMDtcclxuXHRcdH1cclxuXHJcblx0XHQvLyBTdG9yZSBldmVudCB0byBiZSBkaXNwYXRjaGVkIGxhdGVyLlxyXG5cdFx0dGhpcy5fcXVldWVkRXZlbnRzLnB1c2goZXZlbnQpO1xyXG5cdH1cclxuXHJcblx0Ly8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblx0Ly8gTGlzdGVuZXJzLlxyXG5cdC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuXHRwcml2YXRlIG9uTW91c2VNb3ZlKGV2ZW50Ok1vdXNlRXZlbnQpXHJcblx0e1xyXG5cdFx0dGhpcy51cGRhdGVDb2xsaWRlcnMoZXZlbnQpO1xyXG5cclxuXHRcdGlmICh0aGlzLl9pQ29sbGlkaW5nT2JqZWN0KVxyXG5cdFx0XHR0aGlzLnF1ZXVlRGlzcGF0Y2godGhpcy5fbW91c2VNb3ZlLCB0aGlzLl9tb3VzZU1vdmVFdmVudCA9IGV2ZW50KTtcclxuXHR9XHJcblxyXG5cdHByaXZhdGUgb25Nb3VzZU91dChldmVudDpNb3VzZUV2ZW50KVxyXG5cdHtcclxuXHRcdHRoaXMuX2lBY3RpdmVEaXYgPSBudWxsO1xyXG5cclxuXHRcdHRoaXMudXBkYXRlQ29sbGlkZXJzKGV2ZW50KTtcclxuXHJcblx0XHRpZiAodGhpcy5faUNvbGxpZGluZ09iamVjdClcclxuXHRcdFx0dGhpcy5xdWV1ZURpc3BhdGNoKHRoaXMuX21vdXNlT3V0LCBldmVudCk7XHJcblx0fVxyXG5cclxuXHRwcml2YXRlIG9uTW91c2VPdmVyKGV2ZW50Ok1vdXNlRXZlbnQpXHJcblx0e1xyXG5cdFx0dGhpcy5faUFjdGl2ZURpdiA9IDxIVE1MRGl2RWxlbWVudD4gZXZlbnQudGFyZ2V0O1xyXG5cclxuXHRcdHRoaXMudXBkYXRlQ29sbGlkZXJzKGV2ZW50KTtcclxuXHJcblx0XHRpZiAodGhpcy5faUNvbGxpZGluZ09iamVjdClcclxuXHRcdFx0dGhpcy5xdWV1ZURpc3BhdGNoKCB0aGlzLl9tb3VzZU92ZXIsIGV2ZW50KTtcclxuXHR9XHJcblxyXG5cdHByaXZhdGUgb25DbGljayhldmVudDpNb3VzZUV2ZW50KVxyXG5cdHtcclxuXHRcdHRoaXMudXBkYXRlQ29sbGlkZXJzKGV2ZW50KTtcclxuXHJcblx0XHRpZiAodGhpcy5faUNvbGxpZGluZ09iamVjdClcclxuXHRcdFx0dGhpcy5xdWV1ZURpc3BhdGNoKHRoaXMuX21vdXNlQ2xpY2ssIGV2ZW50KTtcclxuXHR9XHJcblxyXG5cdHByaXZhdGUgb25Eb3VibGVDbGljayhldmVudDpNb3VzZUV2ZW50KVxyXG5cdHtcclxuXHRcdHRoaXMudXBkYXRlQ29sbGlkZXJzKGV2ZW50KTtcclxuXHJcblx0XHRpZiAodGhpcy5faUNvbGxpZGluZ09iamVjdClcclxuXHRcdFx0dGhpcy5xdWV1ZURpc3BhdGNoKHRoaXMuX21vdXNlRG91YmxlQ2xpY2ssIGV2ZW50KTtcclxuXHR9XHJcblxyXG5cdHByaXZhdGUgb25Nb3VzZURvd24oZXZlbnQ6TW91c2VFdmVudClcclxuXHR7XHJcblx0XHR0aGlzLl9pQWN0aXZlRGl2ID0gPEhUTUxEaXZFbGVtZW50PiBldmVudC50YXJnZXQ7XHJcblxyXG5cdFx0dGhpcy51cGRhdGVDb2xsaWRlcnMoZXZlbnQpO1xyXG5cclxuXHRcdGlmICh0aGlzLl9pQ29sbGlkaW5nT2JqZWN0KVxyXG5cdFx0XHR0aGlzLnF1ZXVlRGlzcGF0Y2godGhpcy5fbW91c2VEb3duLCBldmVudCk7XHJcblx0fVxyXG5cclxuXHRwcml2YXRlIG9uTW91c2VVcChldmVudDpNb3VzZUV2ZW50KVxyXG5cdHtcclxuXHRcdHRoaXMudXBkYXRlQ29sbGlkZXJzKGV2ZW50KTtcclxuXHJcblx0XHRpZiAodGhpcy5faUNvbGxpZGluZ09iamVjdClcclxuXHRcdFx0dGhpcy5xdWV1ZURpc3BhdGNoKHRoaXMuX21vdXNlVXAgLCBldmVudCk7XHJcblx0fVxyXG5cclxuXHRwcml2YXRlIG9uTW91c2VXaGVlbChldmVudDpNb3VzZUV2ZW50KVxyXG5cdHtcclxuXHRcdHRoaXMudXBkYXRlQ29sbGlkZXJzKGV2ZW50KTtcclxuXHJcblx0XHRpZiAodGhpcy5faUNvbGxpZGluZ09iamVjdClcclxuXHRcdFx0dGhpcy5xdWV1ZURpc3BhdGNoKHRoaXMuX21vdXNlV2hlZWwsIGV2ZW50KTtcclxuXHR9XHJcblxyXG5cclxuXHRwcml2YXRlIHVwZGF0ZUNvbGxpZGVycyhldmVudDpNb3VzZUV2ZW50KVxyXG5cdHtcclxuXHRcdGlmICh0aGlzLl9pVXBkYXRlRGlydHkpXHJcblx0XHRcdHJldHVybjtcclxuXHJcblx0XHR2YXIgdmlldzpWaWV3O1xyXG5cdFx0dmFyIGJvdW5kczpDbGllbnRSZWN0O1xyXG5cdFx0dmFyIG1vdXNlWDpudW1iZXIgPSBldmVudC5jbGllbnRYO1xyXG5cdFx0dmFyIG1vdXNlWTpudW1iZXIgPSBldmVudC5jbGllbnRZO1xyXG5cdFx0dmFyIGxlbjpudW1iZXIgPSB0aGlzLl92aWV3TG9va3VwLmxlbmd0aDtcclxuXHRcdGZvciAodmFyIGk6bnVtYmVyID0gMDsgaSA8IGxlbjsgaSsrKSB7XHJcblx0XHRcdHZpZXcgPSB0aGlzLl92aWV3TG9va3VwW2ldO1xyXG5cdFx0XHRib3VuZHMgPSB2aWV3Lmh0bWxFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG5cdFx0XHRpZiAobW91c2VYIDwgYm91bmRzLmxlZnQgfHwgbW91c2VYID4gYm91bmRzLnJpZ2h0IHx8IG1vdXNlWSA8IGJvdW5kcy50b3AgfHwgbW91c2VZID4gYm91bmRzLmJvdHRvbSkge1xyXG5cdFx0XHRcdHZpZXcuX3BNb3VzZVggPSBudWxsO1xyXG5cdFx0XHRcdHZpZXcuX3BNb3VzZVkgPSBudWxsO1xyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdHZpZXcuX3BNb3VzZVggPSBtb3VzZVggKyBib3VuZHMubGVmdDtcclxuXHRcdFx0XHR2aWV3Ll9wTW91c2VZID0gbW91c2VZICsgYm91bmRzLnRvcDtcclxuXHRcdFx0XHR2aWV3LnVwZGF0ZUNvbGxpZGVyKCk7XHJcblxyXG5cdFx0XHRcdGlmICh2aWV3LmxheWVyZWRWaWV3ICYmIHRoaXMuX2lDb2xsaWRpbmdPYmplY3QpXHJcblx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMuX2lVcGRhdGVEaXJ0eSA9IHRydWU7XHJcblx0fVxyXG59XHJcblxyXG5leHBvcnQgPSBNb3VzZU1hbmFnZXI7Il19