var Vector3D = require("awayjs-core/lib/geom/Vector3D");
var AwayMouseEvent = require("awayjs-display/lib/events/MouseEvent");
/**
 * MouseManager enforces a singleton pattern and is not intended to be instanced.
 * it provides a manager class for detecting mouse hits on scene objects and sending out mouse events.
 */
var MouseManager = (function () {
    /**
     * Creates a new <code>MouseManager</code> object.
     */
    function MouseManager() {
        var _this = this;
        this._viewLookup = new Array();
        this._nullVector = new Vector3D();
        this._queuedEvents = new Array();
        this._mouseUp = new AwayMouseEvent(AwayMouseEvent.MOUSE_UP);
        this._mouseClick = new AwayMouseEvent(AwayMouseEvent.CLICK);
        this._mouseOut = new AwayMouseEvent(AwayMouseEvent.MOUSE_OUT);
        this._mouseDown = new AwayMouseEvent(AwayMouseEvent.MOUSE_DOWN);
        this._mouseMove = new AwayMouseEvent(AwayMouseEvent.MOUSE_MOVE);
        this._mouseOver = new AwayMouseEvent(AwayMouseEvent.MOUSE_OVER);
        this._mouseWheel = new AwayMouseEvent(AwayMouseEvent.MOUSE_WHEEL);
        this._mouseDoubleClick = new AwayMouseEvent(AwayMouseEvent.DOUBLE_CLICK);
        this.onClickDelegate = function (event) { return _this.onClick(event); };
        this.onDoubleClickDelegate = function (event) { return _this.onDoubleClick(event); };
        this.onMouseDownDelegate = function (event) { return _this.onMouseDown(event); };
        this.onMouseMoveDelegate = function (event) { return _this.onMouseMove(event); };
        this.onMouseUpDelegate = function (event) { return _this.onMouseUp(event); };
        this.onMouseWheelDelegate = function (event) { return _this.onMouseWheel(event); };
        this.onMouseOverDelegate = function (event) { return _this.onMouseOver(event); };
        this.onMouseOutDelegate = function (event) { return _this.onMouseOut(event); };
    }
    MouseManager.getInstance = function () {
        if (this._instance)
            return this._instance;
        return (this._instance = new MouseManager());
    };
    MouseManager.prototype.fireMouseEvents = function (forceMouseMove) {
        // If colliding object has changed, queue over/out events.
        if (this._iCollidingObject != this._previousCollidingObject) {
            if (this._previousCollidingObject)
                this.queueDispatch(this._mouseOut, this._mouseMoveEvent, this._previousCollidingObject);
            if (this._iCollidingObject)
                this.queueDispatch(this._mouseOver, this._mouseMoveEvent);
        }
        // Fire mouse move events here if forceMouseMove is on.
        if (forceMouseMove && this._iCollidingObject)
            this.queueDispatch(this._mouseMove, this._mouseMoveEvent);
        var event;
        var dispatcher;
        // Dispatch all queued events.
        var len = this._queuedEvents.length;
        for (var i = 0; i < len; ++i) {
            // Only dispatch from first implicitly enabled object ( one that is not a child of a mouseChildren = false hierarchy ).
            event = this._queuedEvents[i];
            dispatcher = event.object;
            while (dispatcher && !dispatcher._iIsMouseEnabled())
                dispatcher = dispatcher.parent;
            if (dispatcher)
                dispatcher.dispatchEvent(event);
        }
        this._queuedEvents.length = 0;
        this._previousCollidingObject = this._iCollidingObject;
        this._iUpdateDirty = false;
    };
    //		public addViewLayer(view:View)
    //		{
    //			var stg:Stage = view.stage;
    //
    //			// Add instance to mouse3dmanager to fire mouse events for multiple views
    //			if (!view.stageGL.mouse3DManager)
    //				view.stageGL.mouse3DManager = this;
    //
    //			if (!hasKey(view))
    //				_view3Ds[view] = 0;
    //
    //			_childDepth = 0;
    //			traverseDisplayObjects(stg);
    //			_viewCount = _childDepth;
    //		}
    MouseManager.prototype.registerView = function (view) {
        view.htmlElement.addEventListener("click", this.onClickDelegate);
        view.htmlElement.addEventListener("dblclick", this.onDoubleClickDelegate);
        view.htmlElement.addEventListener("mousedown", this.onMouseDownDelegate);
        view.htmlElement.addEventListener("mousemove", this.onMouseMoveDelegate);
        view.htmlElement.addEventListener("mouseup", this.onMouseUpDelegate);
        view.htmlElement.addEventListener("mousewheel", this.onMouseWheelDelegate);
        view.htmlElement.addEventListener("mouseover", this.onMouseOverDelegate);
        view.htmlElement.addEventListener("mouseout", this.onMouseOutDelegate);
        this._viewLookup.push(view);
    };
    MouseManager.prototype.unregisterView = function (view) {
        view.htmlElement.removeEventListener("click", this.onClickDelegate);
        view.htmlElement.removeEventListener("dblclick", this.onDoubleClickDelegate);
        view.htmlElement.removeEventListener("mousedown", this.onMouseDownDelegate);
        view.htmlElement.removeEventListener("mousemove", this.onMouseMoveDelegate);
        view.htmlElement.removeEventListener("mouseup", this.onMouseUpDelegate);
        view.htmlElement.removeEventListener("mousewheel", this.onMouseWheelDelegate);
        view.htmlElement.removeEventListener("mouseover", this.onMouseOverDelegate);
        view.htmlElement.removeEventListener("mouseout", this.onMouseOutDelegate);
        this._viewLookup.slice(this._viewLookup.indexOf(view), 1);
    };
    // ---------------------------------------------------------------------
    // Private.
    // ---------------------------------------------------------------------
    MouseManager.prototype.queueDispatch = function (event, sourceEvent, collider) {
        if (collider === void 0) { collider = null; }
        // 2D properties.
        if (sourceEvent) {
            event.ctrlKey = sourceEvent.ctrlKey;
            event.altKey = sourceEvent.altKey;
            event.shiftKey = sourceEvent.shiftKey;
            event.screenX = sourceEvent.clientX;
            event.screenY = sourceEvent.clientY;
        }
        if (collider == null)
            collider = this._iCollidingObject;
        // 3D properties.
        if (collider) {
            // Object.
            event.object = collider.displayObject;
            event.renderableOwner = collider.renderableOwner;
            // UV.
            event.uv = collider.uv;
            // Position.
            event.localPosition = collider.localPosition ? collider.localPosition.clone() : null;
            // Normal.
            event.localNormal = collider.localNormal ? collider.localNormal.clone() : null;
            // Face index.
            event.index = collider.index;
        }
        else {
            // Set all to null.
            event.uv = null;
            event.object = null;
            event.localPosition = this._nullVector;
            event.localNormal = this._nullVector;
            event.index = 0;
            event.subGeometryIndex = 0;
        }
        // Store event to be dispatched later.
        this._queuedEvents.push(event);
    };
    // ---------------------------------------------------------------------
    // Listeners.
    // ---------------------------------------------------------------------
    MouseManager.prototype.onMouseMove = function (event) {
        this.updateColliders(event);
        if (this._iCollidingObject)
            this.queueDispatch(this._mouseMove, this._mouseMoveEvent = event);
    };
    MouseManager.prototype.onMouseOut = function (event) {
        this._iActiveDiv = null;
        this.updateColliders(event);
        if (this._iCollidingObject)
            this.queueDispatch(this._mouseOut, event);
    };
    MouseManager.prototype.onMouseOver = function (event) {
        this._iActiveDiv = event.target;
        this.updateColliders(event);
        if (this._iCollidingObject)
            this.queueDispatch(this._mouseOver, event);
    };
    MouseManager.prototype.onClick = function (event) {
        this.updateColliders(event);
        if (this._iCollidingObject)
            this.queueDispatch(this._mouseClick, event);
    };
    MouseManager.prototype.onDoubleClick = function (event) {
        this.updateColliders(event);
        if (this._iCollidingObject)
            this.queueDispatch(this._mouseDoubleClick, event);
    };
    MouseManager.prototype.onMouseDown = function (event) {
        this._iActiveDiv = event.target;
        this.updateColliders(event);
        if (this._iCollidingObject)
            this.queueDispatch(this._mouseDown, event);
    };
    MouseManager.prototype.onMouseUp = function (event) {
        this.updateColliders(event);
        if (this._iCollidingObject)
            this.queueDispatch(this._mouseUp, event);
    };
    MouseManager.prototype.onMouseWheel = function (event) {
        this.updateColliders(event);
        if (this._iCollidingObject)
            this.queueDispatch(this._mouseWheel, event);
    };
    MouseManager.prototype.updateColliders = function (event) {
        if (this._iUpdateDirty)
            return;
        var view;
        var bounds;
        var mouseX = event.clientX;
        var mouseY = event.clientY;
        var len = this._viewLookup.length;
        for (var i = 0; i < len; i++) {
            view = this._viewLookup[i];
            bounds = view.htmlElement.getBoundingClientRect();
            if (mouseX < bounds.left || mouseX > bounds.right || mouseY < bounds.top || mouseY > bounds.bottom) {
                view._pMouseX = null;
                view._pMouseY = null;
            }
            else {
                view._pMouseX = mouseX + bounds.left;
                view._pMouseY = mouseY + bounds.top;
                view.updateCollider();
                if (view.layeredView && this._iCollidingObject)
                    break;
            }
        }
        this._iUpdateDirty = true;
    };
    return MouseManager;
})();
module.exports = MouseManager;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1kaXNwbGF5L2xpYi9tYW5hZ2Vycy9Nb3VzZU1hbmFnZXIudHMiXSwibmFtZXMiOlsiTW91c2VNYW5hZ2VyIiwiTW91c2VNYW5hZ2VyLmNvbnN0cnVjdG9yIiwiTW91c2VNYW5hZ2VyLmdldEluc3RhbmNlIiwiTW91c2VNYW5hZ2VyLmZpcmVNb3VzZUV2ZW50cyIsIk1vdXNlTWFuYWdlci5yZWdpc3RlclZpZXciLCJNb3VzZU1hbmFnZXIudW5yZWdpc3RlclZpZXciLCJNb3VzZU1hbmFnZXIucXVldWVEaXNwYXRjaCIsIk1vdXNlTWFuYWdlci5vbk1vdXNlTW92ZSIsIk1vdXNlTWFuYWdlci5vbk1vdXNlT3V0IiwiTW91c2VNYW5hZ2VyLm9uTW91c2VPdmVyIiwiTW91c2VNYW5hZ2VyLm9uQ2xpY2siLCJNb3VzZU1hbmFnZXIub25Eb3VibGVDbGljayIsIk1vdXNlTWFuYWdlci5vbk1vdXNlRG93biIsIk1vdXNlTWFuYWdlci5vbk1vdXNlVXAiLCJNb3VzZU1hbmFnZXIub25Nb3VzZVdoZWVsIiwiTW91c2VNYW5hZ2VyLnVwZGF0ZUNvbGxpZGVycyJdLCJtYXBwaW5ncyI6IkFBQUEsSUFBTyxRQUFRLFdBQWdCLCtCQUErQixDQUFDLENBQUM7QUFLaEUsSUFBTyxjQUFjLFdBQWMsc0NBQXNDLENBQUMsQ0FBQztBQUUzRSxBQUlBOzs7R0FERztJQUNHLFlBQVk7SUFrQ2pCQTs7T0FFR0E7SUFDSEEsU0FyQ0tBLFlBQVlBO1FBQWxCQyxpQkFnU0NBO1FBNVJRQSxnQkFBV0EsR0FBZUEsSUFBSUEsS0FBS0EsRUFBUUEsQ0FBQ0E7UUFNNUNBLGdCQUFXQSxHQUFZQSxJQUFJQSxRQUFRQSxFQUFFQSxDQUFDQTtRQUV0Q0Esa0JBQWFBLEdBQXlCQSxJQUFJQSxLQUFLQSxFQUFrQkEsQ0FBQ0E7UUFJbEVBLGFBQVFBLEdBQWtCQSxJQUFJQSxjQUFjQSxDQUFDQSxjQUFjQSxDQUFDQSxRQUFRQSxDQUFDQSxDQUFDQTtRQUN0RUEsZ0JBQVdBLEdBQWtCQSxJ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QUVBLENBQUNBLENBQUNBLE1BQU1BLEdBQUdBLE1BQU1BLENBQUNBLElBQUlBLElBQUlBLE1BQU1BLEdBQUdBLE1BQU1BLENBQUNBLEtBQUtBLElBQUlBLE1BQU1BLEdBQUdBLE1BQU1BLENBQUNBLEdBQUdBLElBQUlBLE1BQU1BLEdBQUdBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBO2dCQUNwR0EsSUFBSUEsQ0FBQ0EsUUFBUUEsR0FBR0EsSUFBSUEsQ0FBQ0E7Z0JBQ3JCQSxJQUFJQSxDQUFDQSxRQUFRQSxHQUFHQSxJQUFJQSxDQUFDQTtZQUN0QkEsQ0FBQ0E7WUFBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7Z0JBQ1BBLElBQUlBLENBQUNBLFFBQVFBLEdBQUdBLE1BQU1BLEdBQUdBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBO2dCQUNyQ0EsSUFBSUEsQ0FBQ0EsUUFBUUEsR0FBR0EsTUFBTUEsR0FBR0EsTUFBTUEsQ0FBQ0EsR0FBR0EsQ0FBQ0E7Z0JBQ3BDQSxJQUFJQSxDQUFDQSxjQUFjQSxFQUFFQSxDQUFDQTtnQkFFdEJBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLFdBQVdBLElBQUlBLElBQUlBLENBQUNBLGlCQUFpQkEsQ0FBQ0E7b0JBQzlDQSxLQUFLQSxDQUFDQTtZQUNSQSxDQUFDQTtRQUNGQSxDQUFDQTtRQUVEQSxJQUFJQSxDQUFDQSxhQUFhQSxHQUFHQSxJQUFJQSxDQUFDQTtJQUMzQkEsQ0FBQ0E7SUFDRmYsbUJBQUNBO0FBQURBLENBaFNBLEFBZ1NDQSxJQUFBO0FBRUQsQUFBc0IsaUJBQWIsWUFBWSxDQUFDIiwiZmlsZSI6Im1hbmFnZXJzL01vdXNlTWFuYWdlci5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgVmVjdG9yM0RcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9WZWN0b3IzRFwiKTtcblxuaW1wb3J0IERpc3BsYXlPYmplY3RcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9iYXNlL0Rpc3BsYXlPYmplY3RcIik7XG5pbXBvcnQgVmlld1x0XHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2NvbnRhaW5lcnMvVmlld1wiKTtcbmltcG9ydCBQaWNraW5nQ29sbGlzaW9uVk9cdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvcGljay9QaWNraW5nQ29sbGlzaW9uVk9cIik7XG5pbXBvcnQgQXdheU1vdXNlRXZlbnRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9ldmVudHMvTW91c2VFdmVudFwiKTtcblxuLyoqXG4gKiBNb3VzZU1hbmFnZXIgZW5mb3JjZXMgYSBzaW5nbGV0b24gcGF0dGVybiBhbmQgaXMgbm90IGludGVuZGVkIHRvIGJlIGluc3RhbmNlZC5cbiAqIGl0IHByb3ZpZGVzIGEgbWFuYWdlciBjbGFzcyBmb3IgZGV0ZWN0aW5nIG1vdXNlIGhpdHMgb24gc2NlbmUgb2JqZWN0cyBhbmQgc2VuZGluZyBvdXQgbW91c2UgZXZlbnRzLlxuICovXG5jbGFzcyBNb3VzZU1hbmFnZXJcbntcblx0cHJpdmF0ZSBzdGF0aWMgX2luc3RhbmNlOk1vdXNlTWFuYWdlcjtcblxuXHRwcml2YXRlIF92aWV3TG9va3VwOkFycmF5PFZpZXc+ID0gbmV3IEFycmF5PFZpZXc+KCk7XG5cblx0cHVibGljIF9pQWN0aXZlRGl2OkhUTUxEaXZFbGVtZW50O1xuXHRwdWJsaWMgX2lVcGRhdGVEaXJ0eTpib29sZWFuO1xuXHRwdWJsaWMgX2lDb2xsaWRpbmdPYmplY3Q6UGlja2luZ0NvbGxpc2lvblZPO1xuXHRcblx0cHJpdmF0ZSBfbnVsbFZlY3RvcjpWZWN0b3IzRCA9IG5ldyBWZWN0b3IzRCgpO1xuXHRwcml2YXRlIF9wcmV2aW91c0NvbGxpZGluZ09iamVjdDpQaWNraW5nQ29sbGlzaW9uVk87XG5cdHByaXZhdGUgX3F1ZXVlZEV2ZW50czpBcnJheTxBd2F5TW91c2VFdmVudD4gPSBuZXcgQXJyYXk8QXdheU1vdXNlRXZlbnQ+KCk7XG5cblx0cHJpdmF0ZSBfbW91c2VNb3ZlRXZlbnQ6TW91c2VFdmVudDtcblxuXHRwcml2YXRlIF9tb3VzZVVwOkF3YXlNb3VzZUV2ZW50ID0gbmV3IEF3YXlNb3VzZUV2ZW50KEF3YXlNb3VzZUV2ZW50Lk1PVVNFX1VQKTtcblx0cHJpdmF0ZSBfbW91c2VDbGljazpBd2F5TW91c2VFdmVudCA9IG5ldyBBd2F5TW91c2VFdmVudChBd2F5TW91c2VFdmVudC5DTElDSyk7XG5cdHByaXZhdGUgX21vdXNlT3V0OkF3YXlNb3VzZUV2ZW50ID0gbmV3IEF3YXlNb3VzZUV2ZW50KEF3YXlNb3VzZUV2ZW50Lk1PVVNFX09VVCk7XG5cdHByaXZhdGUgX21vdXNlRG93bjpBd2F5TW91c2VFdmVudCA9IG5ldyBBd2F5TW91c2VFdmVudChBd2F5TW91c2VFdmVudC5NT1VTRV9ET1dOKTtcblx0cHJpdmF0ZSBfbW91c2VNb3ZlOkF3YXlNb3VzZUV2ZW50ID0gbmV3IEF3YXlNb3VzZUV2ZW50KEF3YXlNb3VzZUV2ZW50Lk1PVVNFX01PVkUpO1xuXHRwcml2YXRlIF9tb3VzZU92ZXI6QXdheU1vdXNlRXZlbnQgPSBuZXcgQXdheU1vdXNlRXZlbnQoQXdheU1vdXNlRXZlbnQuTU9VU0VfT1ZFUik7XG5cdHByaXZhdGUgX21vdXNlV2hlZWw6QXdheU1vdXNlRXZlbnQgPSBuZXcgQXdheU1vdXNlRXZlbnQoQXdheU1vdXNlRXZlbnQuTU9VU0VfV0hFRUwpO1xuXHRwcml2YXRlIF9tb3VzZURvdWJsZUNsaWNrOkF3YXlNb3VzZUV2ZW50ID0gbmV3IEF3YXlNb3VzZUV2ZW50KEF3YXlNb3VzZUV2ZW50LkRPVUJMRV9DTElDSyk7XG5cblx0cHJpdmF0ZSBvbkNsaWNrRGVsZWdhdGU6KGV2ZW50Ok1vdXNlRXZlbnQpID0+IHZvaWQ7XG5cdHByaXZhdGUgb25Eb3VibGVDbGlja0RlbGVnYXRlOihldmVudDpNb3VzZUV2ZW50KSA9PiB2b2lkO1xuXHRwcml2YXRlIG9uTW91c2VEb3duRGVsZWdhdGU6KGV2ZW50Ok1vdXNlRXZlbnQpID0+IHZvaWQ7XG5cdHByaXZhdGUgb25Nb3VzZU1vdmVEZWxlZ2F0ZTooZXZlbnQ6TW91c2VFdmVudCkgPT4gdm9pZDtcblx0cHJpdmF0ZSBvbk1vdXNlVXBEZWxlZ2F0ZTooZXZlbnQ6TW91c2VFdmVudCkgPT4gdm9pZDtcblx0cHJpdmF0ZSBvbk1vdXNlV2hlZWxEZWxlZ2F0ZTooZXZlbnQ6TW91c2VFdmVudCkgPT4gdm9pZDtcblx0cHJpdmF0ZSBvbk1vdXNlT3ZlckRlbGVnYXRlOihldmVudDpNb3VzZUV2ZW50KSA9PiB2b2lkO1xuXHRwcml2YXRlIG9uTW91c2VPdXREZWxlZ2F0ZTooZXZlbnQ6TW91c2VFdmVudCkgPT4gdm9pZDtcblxuXHQvKipcblx0ICogQ3JlYXRlcyBhIG5ldyA8Y29kZT5Nb3VzZU1hbmFnZXI8L2NvZGU+IG9iamVjdC5cblx0ICovXG5cdGNvbnN0cnVjdG9yKClcblx0e1xuXHRcdHRoaXMub25DbGlja0RlbGVnYXRlID0gKGV2ZW50Ok1vdXNlRXZlbnQpID0+IHRoaXMub25DbGljayhldmVudCk7XG5cdFx0dGhpcy5vbkRvdWJsZUNsaWNrRGVsZWdhdGUgPSAoZXZlbnQ6TW91c2VFdmVudCkgPT4gdGhpcy5vbkRvdWJsZUNsaWNrKGV2ZW50KTtcblx0XHR0aGlzLm9uTW91c2VEb3duRGVsZWdhdGUgPSAoZXZlbnQ6TW91c2VFdmVudCkgPT4gdGhpcy5vbk1vdXNlRG93bihldmVudCk7XG5cdFx0dGhpcy5vbk1vdXNlTW92ZURlbGVnYXRlID0gKGV2ZW50Ok1vdXNlRXZlbnQpID0+IHRoaXMub25Nb3VzZU1vdmUoZXZlbnQpO1xuXHRcdHRoaXMub25Nb3VzZVVwRGVsZWdhdGUgPSAoZXZlbnQ6TW91c2VFdmVudCkgPT4gdGhpcy5vbk1vdXNlVXAoZXZlbnQpO1xuXHRcdHRoaXMub25Nb3VzZVdoZWVsRGVsZWdhdGUgPSAoZXZlbnQ6TW91c2VFdmVudCkgPT4gdGhpcy5vbk1vdXNlV2hlZWwoZXZlbnQpO1xuXHRcdHRoaXMub25Nb3VzZU92ZXJEZWxlZ2F0ZSA9IChldmVudDpNb3VzZUV2ZW50KSA9PiB0aGlzLm9uTW91c2VPdmVyKGV2ZW50KTtcblx0XHR0aGlzLm9uTW91c2VPdXREZWxlZ2F0ZSA9IChldmVudDpNb3VzZUV2ZW50KSA9PiB0aGlzLm9uTW91c2VPdXQoZXZlbnQpO1xuXHR9XG5cblx0cHVibGljIHN0YXRpYyBnZXRJbnN0YW5jZSgpOk1vdXNlTWFuYWdlclxuXHR7XG5cdFx0aWYgKHRoaXMuX2luc3RhbmNlKVxuXHRcdFx0cmV0dXJuIHRoaXMuX2luc3RhbmNlO1xuXG5cdFx0cmV0dXJuICh0aGlzLl9pbnN0YW5jZSA9IG5ldyBNb3VzZU1hbmFnZXIoKSk7XG5cdH1cblxuXHRwdWJsaWMgZmlyZU1vdXNlRXZlbnRzKGZvcmNlTW91c2VNb3ZlOmJvb2xlYW4pXG5cdHtcblx0XHQgLy8gSWYgY29sbGlkaW5nIG9iamVjdCBoYXMgY2hhbmdlZCwgcXVldWUgb3Zlci9vdXQgZXZlbnRzLlxuXHRcdGlmICh0aGlzLl9pQ29sbGlkaW5nT2JqZWN0ICE9IHRoaXMuX3ByZXZpb3VzQ29sbGlkaW5nT2JqZWN0KSB7XG5cdFx0XHRpZiAodGhpcy5fcHJldmlvdXNDb2xsaWRpbmdPYmplY3QpXG5cdFx0XHRcdHRoaXMucXVldWVEaXNwYXRjaCh0aGlzLl9tb3VzZU91dCwgdGhpcy5fbW91c2VNb3ZlRXZlbnQsIHRoaXMuX3ByZXZpb3VzQ29sbGlkaW5nT2JqZWN0KTtcblxuXHRcdFx0aWYgKHRoaXMuX2lDb2xsaWRpbmdPYmplY3QpXG5cdFx0XHRcdHRoaXMucXVldWVEaXNwYXRjaCh0aGlzLl9tb3VzZU92ZXIsIHRoaXMuX21vdXNlTW92ZUV2ZW50KTtcblx0XHR9XG5cblx0XHQgLy8gRmlyZSBtb3VzZSBtb3ZlIGV2ZW50cyBoZXJlIGlmIGZvcmNlTW91c2VNb3ZlIGlzIG9uLlxuXHRcdGlmIChmb3JjZU1vdXNlTW92ZSAmJiB0aGlzLl9pQ29sbGlkaW5nT2JqZWN0KVxuXHRcdFx0dGhpcy5xdWV1ZURpc3BhdGNoKCB0aGlzLl9tb3VzZU1vdmUsIHRoaXMuX21vdXNlTW92ZUV2ZW50KTtcblxuXHRcdHZhciBldmVudDpBd2F5TW91c2VFdmVudDtcblx0XHR2YXIgZGlzcGF0Y2hlcjpEaXNwbGF5T2JqZWN0O1xuXG5cdFx0IC8vIERpc3BhdGNoIGFsbCBxdWV1ZWQgZXZlbnRzLlxuXHRcdHZhciBsZW46bnVtYmVyID0gdGhpcy5fcXVldWVkRXZlbnRzLmxlbmd0aDtcblx0XHRmb3IgKHZhciBpOm51bWJlciA9IDA7IGkgPCBsZW47ICsraSkge1xuXHRcdFx0Ly8gT25seSBkaXNwYXRjaCBmcm9tIGZpcnN0IGltcGxpY2l0bHkgZW5hYmxlZCBvYmplY3QgKCBvbmUgdGhhdCBpcyBub3QgYSBjaGlsZCBvZiBhIG1vdXNlQ2hpbGRyZW4gPSBmYWxzZSBoaWVyYXJjaHkgKS5cblx0XHRcdGV2ZW50ID0gdGhpcy5fcXVldWVkRXZlbnRzW2ldO1xuXHRcdFx0ZGlzcGF0Y2hlciA9IGV2ZW50Lm9iamVjdDtcblxuXHRcdFx0d2hpbGUgKGRpc3BhdGNoZXIgJiYgIWRpc3BhdGNoZXIuX2lJc01vdXNlRW5hYmxlZCgpKVxuXHRcdFx0XHRkaXNwYXRjaGVyID0gZGlzcGF0Y2hlci5wYXJlbnQ7XG5cblx0XHRcdGlmIChkaXNwYXRjaGVyKVxuXHRcdFx0XHRkaXNwYXRjaGVyLmRpc3BhdGNoRXZlbnQoZXZlbnQpO1xuXHRcdH1cblxuXHRcdHRoaXMuX3F1ZXVlZEV2ZW50cy5sZW5ndGggPSAwO1xuXG5cdFx0dGhpcy5fcHJldmlvdXNDb2xsaWRpbmdPYmplY3QgPSB0aGlzLl9pQ29sbGlkaW5nT2JqZWN0O1xuXG5cdFx0dGhpcy5faVVwZGF0ZURpcnR5ID0gZmFsc2U7XG5cdH1cblxuLy9cdFx0cHVibGljIGFkZFZpZXdMYXllcih2aWV3OlZpZXcpXG4vL1x0XHR7XG4vL1x0XHRcdHZhciBzdGc6U3RhZ2UgPSB2aWV3LnN0YWdlO1xuLy9cbi8vXHRcdFx0Ly8gQWRkIGluc3RhbmNlIHRvIG1vdXNlM2RtYW5hZ2VyIHRvIGZpcmUgbW91c2UgZXZlbnRzIGZvciBtdWx0aXBsZSB2aWV3c1xuLy9cdFx0XHRpZiAoIXZpZXcuc3RhZ2VHTC5tb3VzZTNETWFuYWdlcilcbi8vXHRcdFx0XHR2aWV3LnN0YWdlR0wubW91c2UzRE1hbmFnZXIgPSB0aGlzO1xuLy9cbi8vXHRcdFx0aWYgKCFoYXNLZXkodmlldykpXG4vL1x0XHRcdFx0X3ZpZXczRHNbdmlld10gPSAwO1xuLy9cbi8vXHRcdFx0X2NoaWxkRGVwdGggPSAwO1xuLy9cdFx0XHR0cmF2ZXJzZURpc3BsYXlPYmplY3RzKHN0Zyk7XG4vL1x0XHRcdF92aWV3Q291bnQgPSBfY2hpbGREZXB0aDtcbi8vXHRcdH1cblxuXHRwdWJsaWMgcmVnaXN0ZXJWaWV3KHZpZXc6Vmlldylcblx0e1xuXHRcdHZpZXcuaHRtbEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMub25DbGlja0RlbGVnYXRlKTtcblx0XHR2aWV3Lmh0bWxFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJkYmxjbGlja1wiLCB0aGlzLm9uRG91YmxlQ2xpY2tEZWxlZ2F0ZSk7XG5cdFx0dmlldy5odG1sRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIHRoaXMub25Nb3VzZURvd25EZWxlZ2F0ZSk7XG5cdFx0dmlldy5odG1sRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vtb3ZlXCIsIHRoaXMub25Nb3VzZU1vdmVEZWxlZ2F0ZSk7XG5cdFx0dmlldy5odG1sRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2V1cFwiLCB0aGlzLm9uTW91c2VVcERlbGVnYXRlKTtcblx0XHR2aWV3Lmh0bWxFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZXdoZWVsXCIsIHRoaXMub25Nb3VzZVdoZWVsRGVsZWdhdGUpO1xuXHRcdHZpZXcuaHRtbEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlb3ZlclwiLCB0aGlzLm9uTW91c2VPdmVyRGVsZWdhdGUpO1xuXHRcdHZpZXcuaHRtbEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlb3V0XCIsIHRoaXMub25Nb3VzZU91dERlbGVnYXRlKTtcblxuXHRcdHRoaXMuX3ZpZXdMb29rdXAucHVzaCh2aWV3KTtcblx0fVxuXG5cdHB1YmxpYyB1bnJlZ2lzdGVyVmlldyh2aWV3OlZpZXcpXG5cdHtcblx0XHR2aWV3Lmh0bWxFbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLm9uQ2xpY2tEZWxlZ2F0ZSk7XG5cdFx0dmlldy5odG1sRWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwiZGJsY2xpY2tcIiwgdGhpcy5vbkRvdWJsZUNsaWNrRGVsZWdhdGUpO1xuXHRcdHZpZXcuaHRtbEVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCB0aGlzLm9uTW91c2VEb3duRGVsZWdhdGUpO1xuXHRcdHZpZXcuaHRtbEVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLCB0aGlzLm9uTW91c2VNb3ZlRGVsZWdhdGUpO1xuXHRcdHZpZXcuaHRtbEVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgdGhpcy5vbk1vdXNlVXBEZWxlZ2F0ZSk7XG5cdFx0dmlldy5odG1sRWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2V3aGVlbFwiLCB0aGlzLm9uTW91c2VXaGVlbERlbGVnYXRlKTtcblx0XHR2aWV3Lmh0bWxFbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZW92ZXJcIiwgdGhpcy5vbk1vdXNlT3ZlckRlbGVnYXRlKTtcblx0XHR2aWV3Lmh0bWxFbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZW91dFwiLCB0aGlzLm9uTW91c2VPdXREZWxlZ2F0ZSk7XG5cblx0XHR0aGlzLl92aWV3TG9va3VwLnNsaWNlKHRoaXMuX3ZpZXdMb29rdXAuaW5kZXhPZih2aWV3KSwgMSk7XG5cdH1cblxuXHQvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblx0Ly8gUHJpdmF0ZS5cblx0Ly8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cblx0cHJpdmF0ZSBxdWV1ZURpc3BhdGNoKGV2ZW50OkF3YXlNb3VzZUV2ZW50LCBzb3VyY2VFdmVudDpNb3VzZUV2ZW50LCBjb2xsaWRlcjpQaWNraW5nQ29sbGlzaW9uVk8gPSBudWxsKVxuXHR7XG5cdFx0Ly8gMkQgcHJvcGVydGllcy5cblx0XHRpZiAoc291cmNlRXZlbnQpIHtcblx0XHRcdGV2ZW50LmN0cmxLZXkgPSBzb3VyY2VFdmVudC5jdHJsS2V5O1xuXHRcdFx0ZXZlbnQuYWx0S2V5ID0gc291cmNlRXZlbnQuYWx0S2V5O1xuXHRcdFx0ZXZlbnQuc2hpZnRLZXkgPSBzb3VyY2VFdmVudC5zaGlmdEtleTtcblx0XHRcdGV2ZW50LnNjcmVlblggPSBzb3VyY2VFdmVudC5jbGllbnRYO1xuXHRcdFx0ZXZlbnQuc2NyZWVuWSA9IHNvdXJjZUV2ZW50LmNsaWVudFk7XG5cdFx0fVxuXG5cdFx0aWYgKGNvbGxpZGVyID09IG51bGwpXG5cdFx0XHRjb2xsaWRlciA9IHRoaXMuX2lDb2xsaWRpbmdPYmplY3Q7XG5cblx0XHQvLyAzRCBwcm9wZXJ0aWVzLlxuXHRcdGlmIChjb2xsaWRlcikge1xuXHRcdFx0Ly8gT2JqZWN0LlxuXHRcdFx0ZXZlbnQub2JqZWN0ID0gY29sbGlkZXIuZGlzcGxheU9iamVjdDtcblx0XHRcdGV2ZW50LnJlbmRlcmFibGVPd25lciA9IGNvbGxpZGVyLnJlbmRlcmFibGVPd25lcjtcblx0XHRcdC8vIFVWLlxuXHRcdFx0ZXZlbnQudXYgPSBjb2xsaWRlci51djtcblx0XHRcdC8vIFBvc2l0aW9uLlxuXHRcdFx0ZXZlbnQubG9jYWxQb3NpdGlvbiA9IGNvbGxpZGVyLmxvY2FsUG9zaXRpb24/IGNvbGxpZGVyLmxvY2FsUG9zaXRpb24uY2xvbmUoKSA6IG51bGw7XG5cdFx0XHQvLyBOb3JtYWwuXG5cdFx0XHRldmVudC5sb2NhbE5vcm1hbCA9IGNvbGxpZGVyLmxvY2FsTm9ybWFsPyBjb2xsaWRlci5sb2NhbE5vcm1hbC5jbG9uZSgpIDogbnVsbDtcblx0XHRcdC8vIEZhY2UgaW5kZXguXG5cdFx0XHRldmVudC5pbmRleCA9IGNvbGxpZGVyLmluZGV4O1xuXHRcdH0gZWxzZSB7XG5cdFx0XHQvLyBTZXQgYWxsIHRvIG51bGwuXG5cdFx0XHRldmVudC51diA9IG51bGw7XG5cdFx0XHRldmVudC5vYmplY3QgPSBudWxsO1xuXHRcdFx0ZXZlbnQubG9jYWxQb3NpdGlvbiA9IHRoaXMuX251bGxWZWN0b3I7XG5cdFx0XHRldmVudC5sb2NhbE5vcm1hbCA9IHRoaXMuX251bGxWZWN0b3I7XG5cdFx0XHRldmVudC5pbmRleCA9IDA7XG5cdFx0XHRldmVudC5zdWJHZW9tZXRyeUluZGV4ID0gMDtcblx0XHR9XG5cblx0XHQvLyBTdG9yZSBldmVudCB0byBiZSBkaXNwYXRjaGVkIGxhdGVyLlxuXHRcdHRoaXMuX3F1ZXVlZEV2ZW50cy5wdXNoKGV2ZW50KTtcblx0fVxuXG5cdC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXHQvLyBMaXN0ZW5lcnMuXG5cdC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5cdHByaXZhdGUgb25Nb3VzZU1vdmUoZXZlbnQ6TW91c2VFdmVudClcblx0e1xuXHRcdHRoaXMudXBkYXRlQ29sbGlkZXJzKGV2ZW50KTtcblxuXHRcdGlmICh0aGlzLl9pQ29sbGlkaW5nT2JqZWN0KVxuXHRcdFx0dGhpcy5xdWV1ZURpc3BhdGNoKHRoaXMuX21vdXNlTW92ZSwgdGhpcy5fbW91c2VNb3ZlRXZlbnQgPSBldmVudCk7XG5cdH1cblxuXHRwcml2YXRlIG9uTW91c2VPdXQoZXZlbnQ6TW91c2VFdmVudClcblx0e1xuXHRcdHRoaXMuX2lBY3RpdmVEaXYgPSBudWxsO1xuXG5cdFx0dGhpcy51cGRhdGVDb2xsaWRlcnMoZXZlbnQpO1xuXG5cdFx0aWYgKHRoaXMuX2lDb2xsaWRpbmdPYmplY3QpXG5cdFx0XHR0aGlzLnF1ZXVlRGlzcGF0Y2godGhpcy5fbW91c2VPdXQsIGV2ZW50KTtcblx0fVxuXG5cdHByaXZhdGUgb25Nb3VzZU92ZXIoZXZlbnQ6TW91c2VFdmVudClcblx0e1xuXHRcdHRoaXMuX2lBY3RpdmVEaXYgPSA8SFRNTERpdkVsZW1lbnQ+IGV2ZW50LnRhcmdldDtcblxuXHRcdHRoaXMudXBkYXRlQ29sbGlkZXJzKGV2ZW50KTtcblxuXHRcdGlmICh0aGlzLl9pQ29sbGlkaW5nT2JqZWN0KVxuXHRcdFx0dGhpcy5xdWV1ZURpc3BhdGNoKCB0aGlzLl9tb3VzZU92ZXIsIGV2ZW50KTtcblx0fVxuXG5cdHByaXZhdGUgb25DbGljayhldmVudDpNb3VzZUV2ZW50KVxuXHR7XG5cdFx0dGhpcy51cGRhdGVDb2xsaWRlcnMoZXZlbnQpO1xuXG5cdFx0aWYgKHRoaXMuX2lDb2xsaWRpbmdPYmplY3QpXG5cdFx0XHR0aGlzLnF1ZXVlRGlzcGF0Y2godGhpcy5fbW91c2VDbGljaywgZXZlbnQpO1xuXHR9XG5cblx0cHJpdmF0ZSBvbkRvdWJsZUNsaWNrKGV2ZW50Ok1vdXNlRXZlbnQpXG5cdHtcblx0XHR0aGlzLnVwZGF0ZUNvbGxpZGVycyhldmVudCk7XG5cblx0XHRpZiAodGhpcy5faUNvbGxpZGluZ09iamVjdClcblx0XHRcdHRoaXMucXVldWVEaXNwYXRjaCh0aGlzLl9tb3VzZURvdWJsZUNsaWNrLCBldmVudCk7XG5cdH1cblxuXHRwcml2YXRlIG9uTW91c2VEb3duKGV2ZW50Ok1vdXNlRXZlbnQpXG5cdHtcblx0XHR0aGlzLl9pQWN0aXZlRGl2ID0gPEhUTUxEaXZFbGVtZW50PiBldmVudC50YXJnZXQ7XG5cblx0XHR0aGlzLnVwZGF0ZUNvbGxpZGVycyhldmVudCk7XG5cblx0XHRpZiAodGhpcy5faUNvbGxpZGluZ09iamVjdClcblx0XHRcdHRoaXMucXVldWVEaXNwYXRjaCh0aGlzLl9tb3VzZURvd24sIGV2ZW50KTtcblx0fVxuXG5cdHByaXZhdGUgb25Nb3VzZVVwKGV2ZW50Ok1vdXNlRXZlbnQpXG5cdHtcblx0XHR0aGlzLnVwZGF0ZUNvbGxpZGVycyhldmVudCk7XG5cblx0XHRpZiAodGhpcy5faUNvbGxpZGluZ09iamVjdClcblx0XHRcdHRoaXMucXVldWVEaXNwYXRjaCh0aGlzLl9tb3VzZVVwICwgZXZlbnQpO1xuXHR9XG5cblx0cHJpdmF0ZSBvbk1vdXNlV2hlZWwoZXZlbnQ6TW91c2VFdmVudClcblx0e1xuXHRcdHRoaXMudXBkYXRlQ29sbGlkZXJzKGV2ZW50KTtcblxuXHRcdGlmICh0aGlzLl9pQ29sbGlkaW5nT2JqZWN0KVxuXHRcdFx0dGhpcy5xdWV1ZURpc3BhdGNoKHRoaXMuX21vdXNlV2hlZWwsIGV2ZW50KTtcblx0fVxuXG5cblx0cHJpdmF0ZSB1cGRhdGVDb2xsaWRlcnMoZXZlbnQ6TW91c2VFdmVudClcblx0e1xuXHRcdGlmICh0aGlzLl9pVXBkYXRlRGlydHkpXG5cdFx0XHRyZXR1cm47XG5cblx0XHR2YXIgdmlldzpWaWV3O1xuXHRcdHZhciBib3VuZHM6Q2xpZW50UmVjdDtcblx0XHR2YXIgbW91c2VYOm51bWJlciA9IGV2ZW50LmNsaWVudFg7XG5cdFx0dmFyIG1vdXNlWTpudW1iZXIgPSBldmVudC5jbGllbnRZO1xuXHRcdHZhciBsZW46bnVtYmVyID0gdGhpcy5fdmlld0xvb2t1cC5sZW5ndGg7XG5cdFx0Zm9yICh2YXIgaTpudW1iZXIgPSAwOyBpIDwgbGVuOyBpKyspIHtcblx0XHRcdHZpZXcgPSB0aGlzLl92aWV3TG9va3VwW2ldO1xuXHRcdFx0Ym91bmRzID0gdmlldy5odG1sRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblx0XHRcdGlmIChtb3VzZVggPCBib3VuZHMubGVmdCB8fCBtb3VzZVggPiBib3VuZHMucmlnaHQgfHwgbW91c2VZIDwgYm91bmRzLnRvcCB8fCBtb3VzZVkgPiBib3VuZHMuYm90dG9tKSB7XG5cdFx0XHRcdHZpZXcuX3BNb3VzZVggPSBudWxsO1xuXHRcdFx0XHR2aWV3Ll9wTW91c2VZID0gbnVsbDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHZpZXcuX3BNb3VzZVggPSBtb3VzZVggKyBib3VuZHMubGVmdDtcblx0XHRcdFx0dmlldy5fcE1vdXNlWSA9IG1vdXNlWSArIGJvdW5kcy50b3A7XG5cdFx0XHRcdHZpZXcudXBkYXRlQ29sbGlkZXIoKTtcblxuXHRcdFx0XHRpZiAodmlldy5sYXllcmVkVmlldyAmJiB0aGlzLl9pQ29sbGlkaW5nT2JqZWN0KVxuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHRoaXMuX2lVcGRhdGVEaXJ0eSA9IHRydWU7XG5cdH1cbn1cblxuZXhwb3J0ID0gTW91c2VNYW5hZ2VyOyJdfQ==