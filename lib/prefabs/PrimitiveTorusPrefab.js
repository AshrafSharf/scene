var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var PrimitivePrefabBase = require("awayjs-display/lib/prefabs/PrimitivePrefabBase");
/**
 * A UV Cylinder primitive mesh.
 */
var PrimitiveTorusPrefab = (function (_super) {
    __extends(PrimitiveTorusPrefab, _super);
    /**
     * Creates a new <code>Torus</code> object.
     * @param radius The radius of the torus.
     * @param tuebRadius The radius of the inner tube of the torus.
     * @param segmentsR Defines the number of horizontal segments that make up the torus.
     * @param segmentsT Defines the number of vertical segments that make up the torus.
     * @param yUp Defines whether the torus poles should lay on the Y-axis (true) or on the Z-axis (false).
     */
    function PrimitiveTorusPrefab(radius, tubeRadius, segmentsR, segmentsT, yUp) {
        if (radius === void 0) { radius = 50; }
        if (tubeRadius === void 0) { tubeRadius = 50; }
        if (segmentsR === void 0) { segmentsR = 16; }
        if (segmentsT === void 0) { segmentsT = 8; }
        if (yUp === void 0) { yUp = true; }
        _super.call(this);
        this._numVertices = 0;
        this._radius = radius;
        this._tubeRadius = tubeRadius;
        this._segmentsR = segmentsR;
        this._segmentsT = segmentsT;
        this._yUp = yUp;
    }
    Object.defineProperty(PrimitiveTorusPrefab.prototype, "radius", {
        /**
         * The radius of the torus.
         */
        get: function () {
            return this._radius;
        },
        set: function (value) {
            this._radius = value;
            this._pInvalidateGeometry();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PrimitiveTorusPrefab.prototype, "tubeRadius", {
        /**
         * The radius of the inner tube of the torus.
         */
        get: function () {
            return this._tubeRadius;
        },
        set: function (value) {
            this._tubeRadius = value;
            this._pInvalidateGeometry();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PrimitiveTorusPrefab.prototype, "segmentsR", {
        /**
         * Defines the number of horizontal segments that make up the torus. Defaults to 16.
         */
        get: function () {
            return this._segmentsR;
        },
        set: function (value) {
            this._segmentsR = value;
            this._pInvalidateGeometry();
            this._pInvalidateUVs();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PrimitiveTorusPrefab.prototype, "segmentsT", {
        /**
         * Defines the number of vertical segments that make up the torus. Defaults to 8.
         */
        get: function () {
            return this._segmentsT;
        },
        set: function (value) {
            this._segmentsT = value;
            this._pInvalidateGeometry();
            this._pInvalidateUVs();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PrimitiveTorusPrefab.prototype, "yUp", {
        /**
         * Defines whether the torus poles should lay on the Y-axis (true) or on the Z-axis (false).
         */
        get: function () {
            return this._yUp;
        },
        set: function (value) {
            this._yUp = value;
            this._pInvalidateGeometry();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @inheritDoc
     */
    PrimitiveTorusPrefab.prototype._pBuildGeometry = function (target, geometryType) {
        var indices /*uint*/;
        var positions;
        var normals;
        var tangents;
        var i, j;
        var x, y, z, nx, ny, nz, revolutionAngleR, revolutionAngleT;
        var vidx;
        var fidx;
        var numIndices = 0;
        if (geometryType == "triangleSubGeometry") {
            var triangleGeometry = target;
            // evaluate target number of vertices, triangles and indices
            this._numVertices = (this._segmentsT + 1) * (this._segmentsR + 1); // segmentsT + 1 because of closure, segmentsR + 1 because of closure
            numIndices = this._segmentsT * this._segmentsR * 6; // each level has segmentR quads, each of 2 triangles
            // need to initialize raw arrays or can be reused?
            if (this._numVertices == triangleGeometry.numVertices) {
                indices = triangleGeometry.indices;
                positions = triangleGeometry.positions;
                normals = triangleGeometry.vertexNormals;
                tangents = triangleGeometry.vertexTangents;
            }
            else {
                indices = new Array(numIndices);
                positions = new Array(this._numVertices * 3);
                normals = new Array(this._numVertices * 3);
                tangents = new Array(this._numVertices * 3);
                this._pInvalidateUVs();
            }
            vidx = 0;
            fidx = 0;
            // evaluate revolution steps
            var revolutionAngleDeltaR = 2 * Math.PI / this._segmentsR;
            var revolutionAngleDeltaT = 2 * Math.PI / this._segmentsT;
            var comp1, comp2;
            var t1, t2, n1, n2;
            var startIndex = 0;
            var nextVertexIndex = 0;
            // surface
            var a, b, c, d, length;
            for (j = 0; j <= this._segmentsT; ++j) {
                startIndex = nextVertexIndex * 3;
                for (i = 0; i <= this._segmentsR; ++i) {
                    // revolution vertex
                    revolutionAngleR = i * revolutionAngleDeltaR;
                    revolutionAngleT = j * revolutionAngleDeltaT;
                    length = Math.cos(revolutionAngleT);
                    nx = length * Math.cos(revolutionAngleR);
                    ny = length * Math.sin(revolutionAngleR);
                    nz = Math.sin(revolutionAngleT);
                    x = this._radius * Math.cos(revolutionAngleR) + this._tubeRadius * nx;
                    y = this._radius * Math.sin(revolutionAngleR) + this._tubeRadius * ny;
                    z = (j == this._segmentsT) ? 0 : this._tubeRadius * nz;
                    if (this._yUp) {
                        n1 = -nz;
                        n2 = ny;
                        t1 = 0;
                        t2 = (length ? nx / length : x / this._radius);
                        comp1 = -z;
                        comp2 = y;
                    }
                    else {
                        n1 = ny;
                        n2 = nz;
                        t1 = (length ? nx / length : x / this._radius);
                        t2 = 0;
                        comp1 = y;
                        comp2 = z;
                    }
                    if (i == this._segmentsR) {
                        positions[vidx] = x;
                        positions[vidx + 1] = positions[startIndex + 1];
                        positions[vidx + 2] = positions[startIndex + 2];
                    }
                    else {
                        positions[vidx] = x;
                        positions[vidx + 1] = comp1;
                        positions[vidx + 2] = comp2;
                    }
                    normals[vidx] = nx;
                    normals[vidx + 1] = n1;
                    normals[vidx + 2] = n2;
                    tangents[vidx] = -(length ? ny / length : y / this._radius);
                    tangents[vidx + 1] = t1;
                    tangents[vidx + 2] = t2;
                    vidx += 3;
                    // close triangle
                    if (i > 0 && j > 0) {
                        a = nextVertexIndex; // current
                        b = nextVertexIndex - 1; // previous
                        c = b - this._segmentsR - 1; // previous of last level
                        d = a - this._segmentsR - 1; // current of last level
                        indices[fidx++] = a;
                        indices[fidx++] = b;
                        indices[fidx++] = c;
                        indices[fidx++] = a;
                        indices[fidx++] = c;
                        indices[fidx++] = d;
                    }
                    nextVertexIndex++;
                }
            }
            // build real data from raw data
            triangleGeometry.updateIndices(indices);
            triangleGeometry.updatePositions(positions);
            triangleGeometry.updateVertexNormals(normals);
            triangleGeometry.updateVertexTangents(tangents);
        }
        else if (geometryType == "lineSubGeometry") {
        }
    };
    /**
     * @inheritDoc
     */
    PrimitiveTorusPrefab.prototype._pBuildUVs = function (target, geometryType) {
        var i, j;
        var uvs;
        if (geometryType == "triangleSubGeometry") {
            var triangleGeometry = target;
            // need to initialize raw array or can be reused?
            if (triangleGeometry.uvs && this._numVertices == triangleGeometry.numVertices) {
                uvs = triangleGeometry.uvs;
            }
            else {
                uvs = new Array(this._numVertices * 2);
            }
            // current uv component index
            var index = 0;
            for (j = 0; j <= this._segmentsT; ++j) {
                for (i = 0; i <= this._segmentsR; ++i) {
                    // revolution vertex
                    uvs[index++] = (i / this._segmentsR) * triangleGeometry.scaleU;
                    uvs[index++] = (j / this._segmentsT) * triangleGeometry.scaleV;
                }
            }
            // build real data from raw data
            triangleGeometry.updateUVs(uvs);
        }
        else if (geometryType == "lineSubGeometry") {
        }
    };
    return PrimitiveTorusPrefab;
})(PrimitivePrefabBase);
module.exports = PrimitiveTorusPrefab;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1kaXNwbGF5L2xpYi9wcmVmYWJzL1ByaW1pdGl2ZVRvcnVzUHJlZmFiLnRzIl0sIm5hbWVzIjpbIlByaW1pdGl2ZVRvcnVzUHJlZmFiIiwiUHJpbWl0aXZlVG9ydXNQcmVmYWIuY29uc3RydWN0b3IiLCJQcmltaXRpdmVUb3J1c1ByZWZhYi5yYWRpdXMiLCJQcmltaXRpdmVUb3J1c1ByZWZhYi50dWJlUmFkaXVzIiwiUHJpbWl0aXZlVG9ydXNQcmVmYWIuc2VnbWVudHNSIiwiUHJpbWl0aXZlVG9ydXNQcmVmYWIuc2VnbWVudHNUIiwiUHJpbWl0aXZlVG9ydXNQcmVmYWIueVVwIiwiUHJpbWl0aXZlVG9ydXNQcmVmYWIuX3BCdWlsZEdlb21ldHJ5IiwiUHJpbWl0aXZlVG9ydXNQcmVmYWIuX3BCdWlsZFVWcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBSUEsSUFBTyxtQkFBbUIsV0FBWSxnREFBZ0QsQ0FBQyxDQUFDO0FBRXhGLEFBR0E7O0dBREc7SUFDRyxvQkFBb0I7SUFBU0EsVUFBN0JBLG9CQUFvQkEsVUFBNEJBO0lBaUZyREE7Ozs7Ozs7T0FPR0E7SUFDSEEsU0F6RktBLG9CQUFvQkEsQ0F5RmJBLE1BQWtCQSxFQUFFQSxVQUFzQkEsRUFBRUEsU0FBcUJBLEVBQUVBLFNBQW9CQSxFQUFFQSxHQUFrQkE7UUFBM0dDLHNCQUFrQkEsR0FBbEJBLFdBQWtCQTtRQUFFQSwwQkFBc0JBLEdBQXRCQSxlQUFzQkE7UUFBRUEseUJBQXFCQSxHQUFyQkEsY0FBcUJBO1FBQUVBLHlCQUFvQkEsR0FBcEJBLGFBQW9CQTtRQUFFQSxtQkFBa0JBLEdBQWxCQSxVQUFrQkE7UUFFdEhBLGlCQUFPQSxDQUFDQTtRQXBGREEsaUJBQVlBLEdBQVVBLENBQUNBLENBQUNBO1FBc0YvQkEsSUFBSUEsQ0FBQ0EsT0FBT0EsR0FBR0EsTUFBTUEsQ0FBQ0E7UUFDdEJBLElBQUlBLENBQUNBLFdBQVdBLEdBQUdBLFVBQVVBLENBQUNBO1FBQzlCQSxJQUFJQSxDQUFDQSxVQUFV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QUFDQTtvQkFFM0NBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsQ0FBQ0E7b0JBQ3BDQSxFQUFFQSxHQUFHQSxNQUFNQSxHQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxnQkFBZ0JBLENBQUNBLENBQUNBO29CQUN2Q0EsRUFBRUEsR0FBR0EsTUFBTUEsR0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxDQUFDQTtvQkFDdkNBLEVBQUVBLEdBQUdBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsQ0FBQ0E7b0JBRWhDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxPQUFPQSxHQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxnQkFBZ0JBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLFdBQVdBLEdBQUNBLEVBQUVBLENBQUNBO29CQUNsRUEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsT0FBT0EsR0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxXQUFXQSxHQUFDQSxFQUFFQSxDQUFDQTtvQkFDbEVBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLElBQUlBLElBQUlBLENBQUNBLFVBQVVBLENBQUNBLEdBQUVBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLFdBQVdBLEdBQUNBLEVBQUVBLENBQUNBO29CQUVwREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7d0JBRWZBLEVBQUVBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBO3dCQUNUQSxFQUFFQSxHQUFHQSxFQUFFQSxDQUFDQTt3QkFDUkEsRUFBRUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7d0JBQ1BBLEVBQUVBLEdBQUdBLENBQUNBLE1BQU1BLEdBQUVBLEVBQUVBLEdBQUNBLE1BQU1BLEdBQUdBLENBQUNBLEdBQUNBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLENBQUNBO3dCQUMxQ0EsS0FBS0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7d0JBQ1hBLEtBQUtBLEdBQUdBLENBQUNBLENBQUNBO29CQUVYQSxDQUFDQTtvQkFBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7d0JBQ1BBLEVBQUVBLEdBQUdBLEVBQUVBLENBQUNBO3dCQUNSQSxFQUFFQSxHQUFHQSxFQUFFQSxDQUFDQTt3QkFDUkEsRUFBRUEsR0FBR0EsQ0FBQ0EsTUFBTUEsR0FBRUEsRUFBRUEsR0FBQ0EsTUFBTUEsR0FBR0EsQ0FBQ0EsR0FBQ0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0E7d0JBQzFDQSxFQUFFQSxHQUFHQSxDQUFDQSxDQUFDQTt3QkFDUEEsS0FBS0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7d0JBQ1ZBLEtBQUtBLEdBQUdBLENBQUNBLENBQUNBO29CQUNYQSxDQUFDQTtvQkFFREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsSUFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7d0JBQzFCQSxTQUFTQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTt3QkFDcEJBLFNBQVNBLENBQUNBLElBQUlBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLFNBQVNBLENBQUNBLFVBQVVBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO3dCQUNoREEsU0FBU0EsQ0FBQ0EsSUFBSUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsU0FBU0EsQ0FBQ0EsVUFBVUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQ2pEQSxDQUFDQTtvQkFBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7d0JBQ1BBLFNBQVNBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO3dCQUNwQkEsU0FBU0EsQ0FBQ0EsSUFBSUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsS0FBS0EsQ0FBQ0E7d0JBQzVCQSxTQUFTQSxDQUFDQSxJQUFJQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxL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LFNBQVNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1FBRWpDQSxDQUFDQTtRQUFDQSxJQUFJQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxZQUFZQSxJQUFJQSxpQkFBaUJBLENBQUNBLENBQUNBLENBQUNBO1FBRS9DQSxDQUFDQTtJQUNGQSxDQUFDQTtJQUNGUiwyQkFBQ0E7QUFBREEsQ0E1UkEsQUE0UkNBLEVBNVJrQyxtQkFBbUIsRUE0UnJEO0FBRUQsQUFBOEIsaUJBQXJCLG9CQUFvQixDQUFDIiwiZmlsZSI6InByZWZhYnMvUHJpbWl0aXZlVG9ydXNQcmVmYWIuanMiLCJzb3VyY2VSb290IjoiLi4vIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IElBc3NldFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvbGlicmFyeS9JQXNzZXRcIik7XG5cbmltcG9ydCBTdWJHZW9tZXRyeUJhc2VcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZGF0YS9TdWJHZW9tZXRyeUJhc2VcIik7XG5pbXBvcnQgVHJpYW5nbGVTdWJHZW9tZXRyeVx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZGF0YS9UcmlhbmdsZVN1Ykdlb21ldHJ5XCIpO1xuaW1wb3J0IFByaW1pdGl2ZVByZWZhYkJhc2VcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL3ByZWZhYnMvUHJpbWl0aXZlUHJlZmFiQmFzZVwiKTtcblxuLyoqXG4gKiBBIFVWIEN5bGluZGVyIHByaW1pdGl2ZSBtZXNoLlxuICovXG5jbGFzcyBQcmltaXRpdmVUb3J1c1ByZWZhYiBleHRlbmRzIFByaW1pdGl2ZVByZWZhYkJhc2UgaW1wbGVtZW50cyBJQXNzZXRcbntcblx0cHJpdmF0ZSBfcmFkaXVzOm51bWJlcjtcblx0cHJpdmF0ZSBfdHViZVJhZGl1czpudW1iZXI7XG5cdHByaXZhdGUgX3NlZ21lbnRzUjpudW1iZXI7XG5cdHByaXZhdGUgX3NlZ21lbnRzVDpudW1iZXI7XG5cdHByaXZhdGUgX3lVcDpib29sZWFuO1xuXHRwcml2YXRlIF9udW1WZXJ0aWNlczpudW1iZXIgPSAwO1xuXG5cdC8qKlxuXHQgKiBUaGUgcmFkaXVzIG9mIHRoZSB0b3J1cy5cblx0ICovXG5cdHB1YmxpYyBnZXQgcmFkaXVzKCk6bnVtYmVyXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5fcmFkaXVzO1xuXHR9XG5cblx0cHVibGljIHNldCByYWRpdXModmFsdWU6bnVtYmVyKVxuXHR7XG5cdFx0dGhpcy5fcmFkaXVzID0gdmFsdWU7XG5cdFx0dGhpcy5fcEludmFsaWRhdGVHZW9tZXRyeSgpO1xuXHR9XG5cblx0LyoqXG5cdCAqIFRoZSByYWRpdXMgb2YgdGhlIGlubmVyIHR1YmUgb2YgdGhlIHRvcnVzLlxuXHQgKi9cblx0cHVibGljIGdldCB0dWJlUmFkaXVzKCk6bnVtYmVyXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5fdHViZVJhZGl1cztcblx0fVxuXG5cdHB1YmxpYyBzZXQgdHViZVJhZGl1cyh2YWx1ZTpudW1iZXIpXG5cdHtcblx0XHR0aGlzLl90dWJlUmFkaXVzID0gdmFsdWU7XG5cdFx0dGhpcy5fcEludmFsaWRhdGVHZW9tZXRyeSgpO1xuXHR9XG5cblx0LyoqXG5cdCAqIERlZmluZXMgdGhlIG51bWJlciBvZiBob3Jpem9udGFsIHNlZ21lbnRzIHRoYXQgbWFrZSB1cCB0aGUgdG9ydXMuIERlZmF1bHRzIHRvIDE2LlxuXHQgKi9cblx0cHVibGljIGdldCBzZWdtZW50c1IoKTpudW1iZXJcblx0e1xuXHRcdHJldHVybiB0aGlzLl9zZWdtZW50c1I7XG5cdH1cblxuXHRwdWJsaWMgc2V0IHNlZ21lbnRzUih2YWx1ZTpudW1iZXIpXG5cdHtcblx0XHR0aGlzLl9zZWdtZW50c1IgPSB2YWx1ZTtcblx0XHR0aGlzLl9wSW52YWxpZGF0ZUdlb21ldHJ5KCk7XG5cdFx0dGhpcy5fcEludmFsaWRhdGVVVnMoKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBEZWZpbmVzIHRoZSBudW1iZXIgb2YgdmVydGljYWwgc2VnbWVudHMgdGhhdCBtYWtlIHVwIHRoZSB0b3J1cy4gRGVmYXVsdHMgdG8gOC5cblx0ICovXG5cdHB1YmxpYyBnZXQgc2VnbWVudHNUKCk6bnVtYmVyXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5fc2VnbWVudHNUO1xuXHR9XG5cblx0cHVibGljIHNldCBzZWdtZW50c1QodmFsdWU6bnVtYmVyKVxuXHR7XG5cdFx0dGhpcy5fc2VnbWVudHNUID0gdmFsdWU7XG5cdFx0dGhpcy5fcEludmFsaWRhdGVHZW9tZXRyeSgpO1xuXHRcdHRoaXMuX3BJbnZhbGlkYXRlVVZzKCk7XG5cdH1cblxuXHQvKipcblx0ICogRGVmaW5lcyB3aGV0aGVyIHRoZSB0b3J1cyBwb2xlcyBzaG91bGQgbGF5IG9uIHRoZSBZLWF4aXMgKHRydWUpIG9yIG9uIHRoZSBaLWF4aXMgKGZhbHNlKS5cblx0ICovXG5cdHB1YmxpYyBnZXQgeVVwKCk6Ym9vbGVhblxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuX3lVcDtcblx0fVxuXG5cdHB1YmxpYyBzZXQgeVVwKHZhbHVlOmJvb2xlYW4pXG5cdHtcblx0XHR0aGlzLl95VXAgPSB2YWx1ZTtcblx0XHR0aGlzLl9wSW52YWxpZGF0ZUdlb21ldHJ5KCk7XG5cdH1cblxuXHQvKipcblx0ICogQ3JlYXRlcyBhIG5ldyA8Y29kZT5Ub3J1czwvY29kZT4gb2JqZWN0LlxuXHQgKiBAcGFyYW0gcmFkaXVzIFRoZSByYWRpdXMgb2YgdGhlIHRvcnVzLlxuXHQgKiBAcGFyYW0gdHVlYlJhZGl1cyBUaGUgcmFkaXVzIG9mIHRoZSBpbm5lciB0dWJlIG9mIHRoZSB0b3J1cy5cblx0ICogQHBhcmFtIHNlZ21lbnRzUiBEZWZpbmVzIHRoZSBudW1iZXIgb2YgaG9yaXpvbnRhbCBzZWdtZW50cyB0aGF0IG1ha2UgdXAgdGhlIHRvcnVzLlxuXHQgKiBAcGFyYW0gc2VnbWVudHNUIERlZmluZXMgdGhlIG51bWJlciBvZiB2ZXJ0aWNhbCBzZWdtZW50cyB0aGF0IG1ha2UgdXAgdGhlIHRvcnVzLlxuXHQgKiBAcGFyYW0geVVwIERlZmluZXMgd2hldGhlciB0aGUgdG9ydXMgcG9sZXMgc2hvdWxkIGxheSBvbiB0aGUgWS1heGlzICh0cnVlKSBvciBvbiB0aGUgWi1heGlzIChmYWxzZSkuXG5cdCAqL1xuXHRjb25zdHJ1Y3RvcihyYWRpdXM6bnVtYmVyID0gNTAsIHR1YmVSYWRpdXM6bnVtYmVyID0gNTAsIHNlZ21lbnRzUjpudW1iZXIgPSAxNiwgc2VnbWVudHNUOm51bWJlciA9IDgsIHlVcDpib29sZWFuID0gdHJ1ZSlcblx0e1xuXHRcdHN1cGVyKCk7XG5cblx0XHR0aGlzLl9yYWRpdXMgPSByYWRpdXM7XG5cdFx0dGhpcy5fdHViZVJhZGl1cyA9IHR1YmVSYWRpdXM7XG5cdFx0dGhpcy5fc2VnbWVudHNSID0gc2VnbWVudHNSO1xuXHRcdHRoaXMuX3NlZ21lbnRzVCA9IHNlZ21lbnRzVDtcblx0XHR0aGlzLl95VXAgPSB5VXA7XG5cdH1cblxuXG5cdC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi9cblx0cHVibGljIF9wQnVpbGRHZW9tZXRyeSh0YXJnZXQ6U3ViR2VvbWV0cnlCYXNlLCBnZW9tZXRyeVR5cGU6c3RyaW5nKVxuXHR7XG5cdFx0dmFyIGluZGljZXM6QXJyYXk8bnVtYmVyPiAvKnVpbnQqLztcblx0XHR2YXIgcG9zaXRpb25zOkFycmF5PG51bWJlcj47XG5cdFx0dmFyIG5vcm1hbHM6QXJyYXk8bnVtYmVyPjtcblx0XHR2YXIgdGFuZ2VudHM6QXJyYXk8bnVtYmVyPjtcblxuXHRcdHZhciBpOm51bWJlciwgajpudW1iZXI7XG5cdFx0dmFyIHg6bnVtYmVyLCB5Om51bWJlciwgejpudW1iZXIsIG54Om51bWJlciwgbnk6bnVtYmVyLCBuejpudW1iZXIsIHJldm9sdXRpb25BbmdsZVI6bnVtYmVyLCByZXZvbHV0aW9uQW5nbGVUOm51bWJlcjtcblx0XHR2YXIgdmlkeDpudW1iZXI7XG5cdFx0dmFyIGZpZHg6bnVtYmVyO1xuXHRcdHZhciBudW1JbmRpY2VzOm51bWJlciA9IDA7XG5cblx0XHRpZiAoZ2VvbWV0cnlUeXBlID09IFwidHJpYW5nbGVTdWJHZW9tZXRyeVwiKSB7XG5cblx0XHRcdHZhciB0cmlhbmdsZUdlb21ldHJ5OlRyaWFuZ2xlU3ViR2VvbWV0cnkgPSA8VHJpYW5nbGVTdWJHZW9tZXRyeT4gdGFyZ2V0O1xuXG5cdFx0XHQvLyBldmFsdWF0ZSB0YXJnZXQgbnVtYmVyIG9mIHZlcnRpY2VzLCB0cmlhbmdsZXMgYW5kIGluZGljZXNcblx0XHRcdHRoaXMuX251bVZlcnRpY2VzID0gKHRoaXMuX3NlZ21lbnRzVCArIDEpKih0aGlzLl9zZWdtZW50c1IgKyAxKTsgLy8gc2VnbWVudHNUICsgMSBiZWNhdXNlIG9mIGNsb3N1cmUsIHNlZ21lbnRzUiArIDEgYmVjYXVzZSBvZiBjbG9zdXJlXG5cdFx0XHRudW1JbmRpY2VzID0gdGhpcy5fc2VnbWVudHNUKnRoaXMuX3NlZ21lbnRzUio2OyAvLyBlYWNoIGxldmVsIGhhcyBzZWdtZW50UiBxdWFkcywgZWFjaCBvZiAyIHRyaWFuZ2xlc1xuXG5cdFx0XHQvLyBuZWVkIHRvIGluaXRpYWxpemUgcmF3IGFycmF5cyBvciBjYW4gYmUgcmV1c2VkP1xuXHRcdFx0aWYgKHRoaXMuX251bVZlcnRpY2VzID09IHRyaWFuZ2xlR2VvbWV0cnkubnVtVmVydGljZXMpIHtcblx0XHRcdFx0aW5kaWNlcyA9IHRyaWFuZ2xlR2VvbWV0cnkuaW5kaWNlcztcblx0XHRcdFx0cG9zaXRpb25zID0gdHJpYW5nbGVHZW9tZXRyeS5wb3NpdGlvbnM7XG5cdFx0XHRcdG5vcm1hbHMgPSB0cmlhbmdsZUdlb21ldHJ5LnZlcnRleE5vcm1hbHM7XG5cdFx0XHRcdHRhbmdlbnRzID0gdHJpYW5nbGVHZW9tZXRyeS52ZXJ0ZXhUYW5nZW50cztcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGluZGljZXMgPSBuZXcgQXJyYXk8bnVtYmVyPihudW1JbmRpY2VzKVxuXHRcdFx0XHRwb3NpdGlvbnMgPSBuZXcgQXJyYXk8bnVtYmVyPih0aGlzLl9udW1WZXJ0aWNlcyozKTtcblx0XHRcdFx0bm9ybWFscyA9IG5ldyBBcnJheTxudW1iZXI+KHRoaXMuX251bVZlcnRpY2VzKjMpO1xuXHRcdFx0XHR0YW5nZW50cyA9IG5ldyBBcnJheTxudW1iZXI+KHRoaXMuX251bVZlcnRpY2VzKjMpO1xuXG5cdFx0XHRcdHRoaXMuX3BJbnZhbGlkYXRlVVZzKCk7XG5cdFx0XHR9XG5cblxuXHRcdFx0dmlkeCA9IDA7XG5cdFx0XHRmaWR4ID0gMDtcblxuXHRcdFx0Ly8gZXZhbHVhdGUgcmV2b2x1dGlvbiBzdGVwc1xuXHRcdFx0dmFyIHJldm9sdXRpb25BbmdsZURlbHRhUjpudW1iZXIgPSAyKk1hdGguUEkvdGhpcy5fc2VnbWVudHNSO1xuXHRcdFx0dmFyIHJldm9sdXRpb25BbmdsZURlbHRhVDpudW1iZXIgPSAyKk1hdGguUEkvdGhpcy5fc2VnbWVudHNUO1xuXG5cdFx0XHR2YXIgY29tcDE6bnVtYmVyLCBjb21wMjpudW1iZXI7XG5cdFx0XHR2YXIgdDE6bnVtYmVyLCB0MjpudW1iZXIsIG4xOm51bWJlciwgbjI6bnVtYmVyO1xuXHRcdFx0dmFyIHN0YXJ0SW5kZXg6bnVtYmVyID0gMDtcblx0XHRcdHZhciBuZXh0VmVydGV4SW5kZXg6bnVtYmVyID0gMDtcblxuXHRcdFx0Ly8gc3VyZmFjZVxuXHRcdFx0dmFyIGE6bnVtYmVyLCBiOm51bWJlciwgYzpudW1iZXIsIGQ6bnVtYmVyLCBsZW5ndGg6bnVtYmVyO1xuXG5cdFx0XHRmb3IgKGogPSAwOyBqIDw9IHRoaXMuX3NlZ21lbnRzVDsgKytqKSB7XG5cblx0XHRcdFx0c3RhcnRJbmRleCA9IG5leHRWZXJ0ZXhJbmRleCozO1xuXG5cdFx0XHRcdGZvciAoaSA9IDA7IGkgPD0gdGhpcy5fc2VnbWVudHNSOyArK2kpIHtcblxuXHRcdFx0XHRcdC8vIHJldm9sdXRpb24gdmVydGV4XG5cdFx0XHRcdFx0cmV2b2x1dGlvbkFuZ2xlUiA9IGkqcmV2b2x1dGlvbkFuZ2xlRGVsdGFSO1xuXHRcdFx0XHRcdHJldm9sdXRpb25BbmdsZVQgPSBqKnJldm9sdXRpb25BbmdsZURlbHRhVDtcblxuXHRcdFx0XHRcdGxlbmd0aCA9IE1hdGguY29zKHJldm9sdXRpb25BbmdsZVQpO1xuXHRcdFx0XHRcdG54ID0gbGVuZ3RoKk1hdGguY29zKHJldm9sdXRpb25BbmdsZVIpO1xuXHRcdFx0XHRcdG55ID0gbGVuZ3RoKk1hdGguc2luKHJldm9sdXRpb25BbmdsZVIpO1xuXHRcdFx0XHRcdG56ID0gTWF0aC5zaW4ocmV2b2x1dGlvbkFuZ2xlVCk7XG5cblx0XHRcdFx0XHR4ID0gdGhpcy5fcmFkaXVzKk1hdGguY29zKHJldm9sdXRpb25BbmdsZVIpICsgdGhpcy5fdHViZVJhZGl1cypueDtcblx0XHRcdFx0XHR5ID0gdGhpcy5fcmFkaXVzKk1hdGguc2luKHJldm9sdXRpb25BbmdsZVIpICsgdGhpcy5fdHViZVJhZGl1cypueTtcblx0XHRcdFx0XHR6ID0gKGogPT0gdGhpcy5fc2VnbWVudHNUKT8gMCA6IHRoaXMuX3R1YmVSYWRpdXMqbno7XG5cblx0XHRcdFx0XHRpZiAodGhpcy5feVVwKSB7XG5cblx0XHRcdFx0XHRcdG4xID0gLW56O1xuXHRcdFx0XHRcdFx0bjIgPSBueTtcblx0XHRcdFx0XHRcdHQxID0gMDtcblx0XHRcdFx0XHRcdHQyID0gKGxlbmd0aD8gbngvbGVuZ3RoIDogeC90aGlzLl9yYWRpdXMpO1xuXHRcdFx0XHRcdFx0Y29tcDEgPSAtejtcblx0XHRcdFx0XHRcdGNvbXAyID0geTtcblxuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRuMSA9IG55O1xuXHRcdFx0XHRcdFx0bjIgPSBuejtcblx0XHRcdFx0XHRcdHQxID0gKGxlbmd0aD8gbngvbGVuZ3RoIDogeC90aGlzLl9yYWRpdXMpO1xuXHRcdFx0XHRcdFx0dDIgPSAwO1xuXHRcdFx0XHRcdFx0Y29tcDEgPSB5O1xuXHRcdFx0XHRcdFx0Y29tcDIgPSB6O1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmIChpID09IHRoaXMuX3NlZ21lbnRzUikge1xuXHRcdFx0XHRcdFx0cG9zaXRpb25zW3ZpZHhdID0geDtcblx0XHRcdFx0XHRcdHBvc2l0aW9uc1t2aWR4ICsgMV0gPSBwb3NpdGlvbnNbc3RhcnRJbmRleCArIDFdO1xuXHRcdFx0XHRcdFx0cG9zaXRpb25zW3ZpZHggKyAyXSA9IHBvc2l0aW9uc1tzdGFydEluZGV4ICsgMl07XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdHBvc2l0aW9uc1t2aWR4XSA9IHg7XG5cdFx0XHRcdFx0XHRwb3NpdGlvbnNbdmlkeCArIDFdID0gY29tcDE7XG5cdFx0XHRcdFx0XHRwb3NpdGlvbnNbdmlkeCArIDJdID0gY29tcDI7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0bm9ybWFsc1t2aWR4XSA9IG54O1xuXHRcdFx0XHRcdG5vcm1hbHNbdmlkeCArIDFdID0gbjE7XG5cdFx0XHRcdFx0bm9ybWFsc1t2aWR4ICsgMl0gPSBuMjtcblx0XHRcdFx0XHR0YW5nZW50c1t2aWR4XSA9IC0obGVuZ3RoPyBueS9sZW5ndGggOiB5L3RoaXMuX3JhZGl1cyk7XG5cdFx0XHRcdFx0dGFuZ2VudHNbdmlkeCArIDFdID0gdDE7XG5cdFx0XHRcdFx0dGFuZ2VudHNbdmlkeCArIDJdID0gdDI7XG5cblx0XHRcdFx0XHR2aWR4ICs9IDM7XG5cblx0XHRcdFx0XHQvLyBjbG9zZSB0cmlhbmdsZVxuXHRcdFx0XHRcdGlmIChpID4gMCAmJiBqID4gMCkge1xuXHRcdFx0XHRcdFx0YSA9IG5leHRWZXJ0ZXhJbmRleDsgLy8gY3VycmVudFxuXHRcdFx0XHRcdFx0YiA9IG5leHRWZXJ0ZXhJbmRleCAtIDE7IC8vIHByZXZpb3VzXG5cdFx0XHRcdFx0XHRjID0gYiAtIHRoaXMuX3NlZ21lbnRzUiAtIDE7IC8vIHByZXZpb3VzIG9mIGxhc3QgbGV2ZWxcblx0XHRcdFx0XHRcdGQgPSBhIC0gdGhpcy5fc2VnbWVudHNSIC0gMTsgLy8gY3VycmVudCBvZiBsYXN0IGxldmVsXG5cblx0XHRcdFx0XHRcdGluZGljZXNbZmlkeCsrXSA9IGE7XG5cdFx0XHRcdFx0XHRpbmRpY2VzW2ZpZHgrK10gPSBiO1xuXHRcdFx0XHRcdFx0aW5kaWNlc1tmaWR4KytdID0gYztcblxuXHRcdFx0XHRcdFx0aW5kaWNlc1tmaWR4KytdID0gYTtcblx0XHRcdFx0XHRcdGluZGljZXNbZmlkeCsrXSA9IGM7XG5cdFx0XHRcdFx0XHRpbmRpY2VzW2ZpZHgrK10gPSBkO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdG5leHRWZXJ0ZXhJbmRleCsrO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8vIGJ1aWxkIHJlYWwgZGF0YSBmcm9tIHJhdyBkYXRhXG5cdFx0XHR0cmlhbmdsZUdlb21ldHJ5LnVwZGF0ZUluZGljZXMoaW5kaWNlcyk7XG5cblx0XHRcdHRyaWFuZ2xlR2VvbWV0cnkudXBkYXRlUG9zaXRpb25zKHBvc2l0aW9ucyk7XG5cdFx0XHR0cmlhbmdsZUdlb21ldHJ5LnVwZGF0ZVZlcnRleE5vcm1hbHMobm9ybWFscyk7XG5cdFx0XHR0cmlhbmdsZUdlb21ldHJ5LnVwZGF0ZVZlcnRleFRhbmdlbnRzKHRhbmdlbnRzKTtcblxuXHRcdH0gZWxzZSBpZiAoZ2VvbWV0cnlUeXBlID09IFwibGluZVN1Ykdlb21ldHJ5XCIpIHtcblx0XHRcdC8vVE9ET1xuXHRcdH1cblx0fVxuXG5cdC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi9cblx0cHVibGljIF9wQnVpbGRVVnModGFyZ2V0OlN1Ykdlb21ldHJ5QmFzZSwgZ2VvbWV0cnlUeXBlOnN0cmluZylcblx0e1xuXG5cdFx0dmFyIGk6bnVtYmVyLCBqOm51bWJlcjtcblx0XHR2YXIgdXZzOkFycmF5PG51bWJlcj47XG5cblxuXHRcdGlmIChnZW9tZXRyeVR5cGUgPT0gXCJ0cmlhbmdsZVN1Ykdlb21ldHJ5XCIpIHtcblxuXHRcdFx0dmFyIHRyaWFuZ2xlR2VvbWV0cnk6VHJpYW5nbGVTdWJHZW9tZXRyeSA9IDxUcmlhbmdsZVN1Ykdlb21ldHJ5PiB0YXJnZXQ7XG5cblx0XHRcdC8vIG5lZWQgdG8gaW5pdGlhbGl6ZSByYXcgYXJyYXkgb3IgY2FuIGJlIHJldXNlZD9cblx0XHRcdGlmICh0cmlhbmdsZUdlb21ldHJ5LnV2cyAmJiB0aGlzLl9udW1WZXJ0aWNlcyA9PSB0cmlhbmdsZUdlb21ldHJ5Lm51bVZlcnRpY2VzKSB7XG5cdFx0XHRcdHV2cyA9IHRyaWFuZ2xlR2VvbWV0cnkudXZzO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dXZzID0gbmV3IEFycmF5PG51bWJlcj4odGhpcy5fbnVtVmVydGljZXMqMik7XG5cdFx0XHR9XG5cblx0XHRcdC8vIGN1cnJlbnQgdXYgY29tcG9uZW50IGluZGV4XG5cdFx0XHR2YXIgaW5kZXg6bnVtYmVyID0gMDtcblxuXHRcdFx0Ly8gc3VyZmFjZVxuXHRcdFx0Zm9yIChqID0gMDsgaiA8PSB0aGlzLl9zZWdtZW50c1Q7ICsraikge1xuXHRcdFx0XHRmb3IgKGkgPSAwOyBpIDw9IHRoaXMuX3NlZ21lbnRzUjsgKytpKSB7XG5cdFx0XHRcdFx0Ly8gcmV2b2x1dGlvbiB2ZXJ0ZXhcblx0XHRcdFx0XHR1dnNbaW5kZXgrK10gPSAoIGkvdGhpcy5fc2VnbWVudHNSICkqdHJpYW5nbGVHZW9tZXRyeS5zY2FsZVU7XG5cdFx0XHRcdFx0dXZzW2luZGV4KytdID0gKCBqL3RoaXMuX3NlZ21lbnRzVCApKnRyaWFuZ2xlR2VvbWV0cnkuc2NhbGVWO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8vIGJ1aWxkIHJlYWwgZGF0YSBmcm9tIHJhdyBkYXRhXG5cdFx0XHR0cmlhbmdsZUdlb21ldHJ5LnVwZGF0ZVVWcyh1dnMpO1xuXG5cdFx0fSBlbHNlIGlmIChnZW9tZXRyeVR5cGUgPT0gXCJsaW5lU3ViR2VvbWV0cnlcIikge1xuXHRcdFx0Ly9ub3RoaW5nIHRvIGRvIGhlcmVcblx0XHR9XG5cdH1cbn1cblxuZXhwb3J0ID0gUHJpbWl0aXZlVG9ydXNQcmVmYWI7Il19