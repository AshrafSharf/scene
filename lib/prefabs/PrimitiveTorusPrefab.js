var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var PrimitivePrefabBase = require("awayjs-display/lib/prefabs/PrimitivePrefabBase");
/**
 * A UV Cylinder primitive mesh.
 */
var PrimitiveTorusPrefab = (function (_super) {
    __extends(PrimitiveTorusPrefab, _super);
    /**
     * Creates a new <code>Torus</code> object.
     * @param radius The radius of the torus.
     * @param tuebRadius The radius of the inner tube of the torus.
     * @param segmentsR Defines the number of horizontal segments that make up the torus.
     * @param segmentsT Defines the number of vertical segments that make up the torus.
     * @param yUp Defines whether the torus poles should lay on the Y-axis (true) or on the Z-axis (false).
     */
    function PrimitiveTorusPrefab(radius, tubeRadius, segmentsR, segmentsT, yUp) {
        if (radius === void 0) { radius = 50; }
        if (tubeRadius === void 0) { tubeRadius = 50; }
        if (segmentsR === void 0) { segmentsR = 16; }
        if (segmentsT === void 0) { segmentsT = 8; }
        if (yUp === void 0) { yUp = true; }
        _super.call(this);
        this._numVertices = 0;
        this._radius = radius;
        this._tubeRadius = tubeRadius;
        this._segmentsR = segmentsR;
        this._segmentsT = segmentsT;
        this._yUp = yUp;
    }
    Object.defineProperty(PrimitiveTorusPrefab.prototype, "radius", {
        /**
         * The radius of the torus.
         */
        get: function () {
            return this._radius;
        },
        set: function (value) {
            this._radius = value;
            this._pInvalidateGeometry();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PrimitiveTorusPrefab.prototype, "tubeRadius", {
        /**
         * The radius of the inner tube of the torus.
         */
        get: function () {
            return this._tubeRadius;
        },
        set: function (value) {
            this._tubeRadius = value;
            this._pInvalidateGeometry();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PrimitiveTorusPrefab.prototype, "segmentsR", {
        /**
         * Defines the number of horizontal segments that make up the torus. Defaults to 16.
         */
        get: function () {
            return this._segmentsR;
        },
        set: function (value) {
            this._segmentsR = value;
            this._pInvalidateGeometry();
            this._pInvalidateUVs();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PrimitiveTorusPrefab.prototype, "segmentsT", {
        /**
         * Defines the number of vertical segments that make up the torus. Defaults to 8.
         */
        get: function () {
            return this._segmentsT;
        },
        set: function (value) {
            this._segmentsT = value;
            this._pInvalidateGeometry();
            this._pInvalidateUVs();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PrimitiveTorusPrefab.prototype, "yUp", {
        /**
         * Defines whether the torus poles should lay on the Y-axis (true) or on the Z-axis (false).
         */
        get: function () {
            return this._yUp;
        },
        set: function (value) {
            this._yUp = value;
            this._pInvalidateGeometry();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @inheritDoc
     */
    PrimitiveTorusPrefab.prototype._pBuildGeometry = function (target, geometryType) {
        var indices /*uint*/;
        var positions;
        var normals;
        var tangents;
        var i, j;
        var x, y, z, nx, ny, nz, revolutionAngleR, revolutionAngleT;
        var vidx;
        var fidx;
        var numIndices = 0;
        if (geometryType == "triangleSubGeometry") {
            var triangleGeometry = target;
            // evaluate target number of vertices, triangles and indices
            this._numVertices = (this._segmentsT + 1) * (this._segmentsR + 1); // segmentsT + 1 because of closure, segmentsR + 1 because of closure
            numIndices = this._segmentsT * this._segmentsR * 6; // each level has segmentR quads, each of 2 triangles
            // need to initialize raw arrays or can be reused?
            if (this._numVertices == triangleGeometry.numVertices) {
                indices = triangleGeometry.indices;
                positions = triangleGeometry.positions;
                normals = triangleGeometry.vertexNormals;
                tangents = triangleGeometry.vertexTangents;
            }
            else {
                indices = new Array(numIndices);
                positions = new Array(this._numVertices * 3);
                normals = new Array(this._numVertices * 3);
                tangents = new Array(this._numVertices * 3);
                this._pInvalidateUVs();
            }
            vidx = 0;
            fidx = 0;
            // evaluate revolution steps
            var revolutionAngleDeltaR = 2 * Math.PI / this._segmentsR;
            var revolutionAngleDeltaT = 2 * Math.PI / this._segmentsT;
            var comp1, comp2;
            var t1, t2, n1, n2;
            var startIndex = 0;
            var nextVertexIndex = 0;
            // surface
            var a, b, c, d, length;
            for (j = 0; j <= this._segmentsT; ++j) {
                startIndex = nextVertexIndex * 3;
                for (i = 0; i <= this._segmentsR; ++i) {
                    // revolution vertex
                    revolutionAngleR = i * revolutionAngleDeltaR;
                    revolutionAngleT = j * revolutionAngleDeltaT;
                    length = Math.cos(revolutionAngleT);
                    nx = length * Math.cos(revolutionAngleR);
                    ny = length * Math.sin(revolutionAngleR);
                    nz = Math.sin(revolutionAngleT);
                    x = this._radius * Math.cos(revolutionAngleR) + this._tubeRadius * nx;
                    y = this._radius * Math.sin(revolutionAngleR) + this._tubeRadius * ny;
                    z = (j == this._segmentsT) ? 0 : this._tubeRadius * nz;
                    if (this._yUp) {
                        n1 = -nz;
                        n2 = ny;
                        t1 = 0;
                        t2 = (length ? nx / length : x / this._radius);
                        comp1 = -z;
                        comp2 = y;
                    }
                    else {
                        n1 = ny;
                        n2 = nz;
                        t1 = (length ? nx / length : x / this._radius);
                        t2 = 0;
                        comp1 = y;
                        comp2 = z;
                    }
                    if (i == this._segmentsR) {
                        positions[vidx] = x;
                        positions[vidx + 1] = positions[startIndex + 1];
                        positions[vidx + 2] = positions[startIndex + 2];
                    }
                    else {
                        positions[vidx] = x;
                        positions[vidx + 1] = comp1;
                        positions[vidx + 2] = comp2;
                    }
                    normals[vidx] = nx;
                    normals[vidx + 1] = n1;
                    normals[vidx + 2] = n2;
                    tangents[vidx] = -(length ? ny / length : y / this._radius);
                    tangents[vidx + 1] = t1;
                    tangents[vidx + 2] = t2;
                    vidx += 3;
                    // close triangle
                    if (i > 0 && j > 0) {
                        a = nextVertexIndex; // current
                        b = nextVertexIndex - 1; // previous
                        c = b - this._segmentsR - 1; // previous of last level
                        d = a - this._segmentsR - 1; // current of last level
                        indices[fidx++] = a;
                        indices[fidx++] = b;
                        indices[fidx++] = c;
                        indices[fidx++] = a;
                        indices[fidx++] = c;
                        indices[fidx++] = d;
                    }
                    nextVertexIndex++;
                }
            }
            // build real data from raw data
            triangleGeometry.updateIndices(indices);
            triangleGeometry.updatePositions(positions);
            triangleGeometry.updateVertexNormals(normals);
            triangleGeometry.updateVertexTangents(tangents);
        }
        else if (geometryType == "lineSubGeometry") {
        }
    };
    /**
     * @inheritDoc
     */
    PrimitiveTorusPrefab.prototype._pBuildUVs = function (target, geometryType) {
        var i, j;
        var uvs;
        if (geometryType == "triangleSubGeometry") {
            var triangleGeometry = target;
            // need to initialize raw array or can be reused?
            if (triangleGeometry.uvs && this._numVertices == triangleGeometry.numVertices) {
                uvs = triangleGeometry.uvs;
            }
            else {
                uvs = new Array(this._numVertices * 2);
            }
            // current uv component index
            var index = 0;
            for (j = 0; j <= this._segmentsT; ++j) {
                for (i = 0; i <= this._segmentsR; ++i) {
                    // revolution vertex
                    uvs[index++] = (i / this._segmentsR) * triangleGeometry.scaleU;
                    uvs[index++] = (j / this._segmentsT) * triangleGeometry.scaleV;
                }
            }
            // build real data from raw data
            triangleGeometry.updateUVs(uvs);
        }
        else if (geometryType == "lineSubGeometry") {
        }
    };
    return PrimitiveTorusPrefab;
})(PrimitivePrefabBase);
module.exports = PrimitiveTorusPrefab;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1kaXNwbGF5L2xpYi9wcmVmYWJzL1ByaW1pdGl2ZVRvcnVzUHJlZmFiLnRzIl0sIm5hbWVzIjpbIlByaW1pdGl2ZVRvcnVzUHJlZmFiIiwiUHJpbWl0aXZlVG9ydXNQcmVmYWIuY29uc3RydWN0b3IiLCJQcmltaXRpdmVUb3J1c1ByZWZhYi5yYWRpdXMiLCJQcmltaXRpdmVUb3J1c1ByZWZhYi50dWJlUmFkaXVzIiwiUHJpbWl0aXZlVG9ydXNQcmVmYWIuc2VnbWVudHNSIiwiUHJpbWl0aXZlVG9ydXNQcmVmYWIuc2VnbWVudHNUIiwiUHJpbWl0aXZlVG9ydXNQcmVmYWIueVVwIiwiUHJpbWl0aXZlVG9ydXNQcmVmYWIuX3BCdWlsZEdlb21ldHJ5IiwiUHJpbWl0aXZlVG9ydXNQcmVmYWIuX3BCdWlsZFVWcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBSUEsSUFBTyxtQkFBbUIsV0FBWSxnREFBZ0QsQ0FBQyxDQUFDO0FBRXhGLEFBR0E7O0dBREc7SUFDRyxvQkFBb0I7SUFBU0EsVUFBN0JBLG9CQUFvQkEsVUFBNEJBO0lBaUZyREE7Ozs7Ozs7T0FPR0E7SUFDSEEsU0F6RktBLG9CQUFvQkEsQ0F5RmJBLE1BQWtCQSxFQUFFQSxVQUFzQkEsRUFBRUEsU0FBcUJBLEVBQUVBLFNBQW9CQSxFQUFFQSxHQUFrQkE7UUFBM0dDLHNCQUFrQkEsR0FBbEJBLFdBQWtCQTtRQUFFQSwwQkFBc0JBLEdBQXRCQSxlQUFzQkE7UUFBRUEseUJBQXFCQSxHQUFyQkEsY0FBcUJBO1FBQUVBLHlCQUFvQkEsR0FBcEJBLGFBQW9CQTtRQUFFQSxtQkFBa0JBLEdBQWxCQSxVQUFrQkE7UUFFdEhBLGlCQUFPQSxDQUFDQTtRQXBGREEsaUJBQVlBLEdBQVVBLENBQUNBLENBQUNBO1FBc0YvQkEsSUFBSUEsQ0FBQ0EsT0FBT0EsR0FBR0EsTUFBTUEsQ0FBQ0E7UUFDdEJBLElBQUlBLENBQUNBLFdBQVdBLEdBQUdBLFVBQVVBLENBQUNBO1FBQzlCQSxJQUFJQSxDQUFDQSxVQUFV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QUFDQTtvQkFFM0NBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsQ0FBQ0E7b0JBQ3BDQSxFQUFFQSxHQUFHQSxNQUFNQSxHQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxnQkFBZ0JBLENBQUNBLENBQUNBO29CQUN2Q0EsRUFBRUEsR0FBR0EsTUFBTUEsR0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxDQUFDQTtvQkFDdkNBLEVBQUVBLEdBQUdBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsQ0FBQ0E7b0JBRWhDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxPQUFPQSxHQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxnQkFBZ0JBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLFdBQVdBLEdBQUNBLEVBQUVBLENBQUNBO29CQUNsRUEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsT0FBT0EsR0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxXQUFXQSxHQUFDQSxFQUFFQSxDQUFDQTtvQkFDbEVBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLElBQUlBLElBQUlBLENBQUNBLFVBQVVBLENBQUNBLEdBQUVBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLFdBQVdBLEdBQUNBLEVBQUVBLENBQUNBO29CQUVwREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7d0JBRWZBLEVBQUVBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBO3dCQUNUQSxFQUFFQSxHQUFHQSxFQUFFQSxDQUFDQTt3QkFDUkEsRUFBRUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7d0JBQ1BBLEVBQUVBLEdBQUdBLENBQUNBLE1BQU1BLEdBQUVBLEVBQUVBLEdBQUNBLE1BQU1BLEdBQUdBLENBQUNBLEdBQUNBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLENBQUNBO3dCQUMxQ0EsS0FBS0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7d0JBQ1hBLEtBQUtBLEdBQUdBLENBQUNBLENBQUNBO29CQUVYQSxDQUFDQTtvQkFBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7d0JBQ1BBLEVBQUVBLEdBQUdBLEVBQUVBLENBQUNBO3dCQUNSQSxFQUFFQSxHQUFHQSxFQUFFQSxDQUFDQTt3QkFDUkEsRUFBRUEsR0FBR0EsQ0FBQ0EsTUFBTUEsR0FBRUEsRUFBRUEsR0FBQ0EsTUFBTUEsR0FBR0EsQ0FBQ0EsR0FBQ0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0E7d0JBQzFDQSxFQUFFQSxHQUFHQSxDQUFDQSxDQUFDQTt3QkFDUEEsS0FBS0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7d0JBQ1ZBLEtBQUtBLEdBQUdBLENBQUNBLENBQUNBO29CQUNYQSxDQUFDQTtvQkFFREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsSUFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7d0JBQzFCQSxTQUFTQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTt3QkFDcEJBLFNBQVNBLENBQUNBLElBQUlBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLFNBQVNBLENBQUNBLFVBQVVBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO3dCQUNoREEsU0FBU0EsQ0FBQ0EsSUFBSUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsU0FBU0EsQ0FBQ0EsVUFBVUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQ2pEQSxDQUFDQTtvQkFBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7d0JBQ1BBLFNBQVNBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO3dCQUNwQkEsU0FBU0EsQ0FBQ0EsSUFBSUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsS0FBS0EsQ0FBQ0E7d0JBQzVCQSxTQUFTQSxDQUFDQSxJQUFJQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxL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LFNBQVNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1FBRWpDQSxDQUFDQTtRQUFDQSxJQUFJQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxZQUFZQSxJQUFJQSxpQkFBaUJBLENBQUNBLENBQUNBLENBQUNBO1FBRS9DQSxDQUFDQTtJQUNGQSxDQUFDQTtJQUNGUiwyQkFBQ0E7QUFBREEsQ0E1UkEsQUE0UkNBLEVBNVJrQyxtQkFBbUIsRUE0UnJEO0FBRUQsQUFBOEIsaUJBQXJCLG9CQUFvQixDQUFDIiwiZmlsZSI6InByZWZhYnMvUHJpbWl0aXZlVG9ydXNQcmVmYWIuanMiLCJzb3VyY2VSb290IjoiLi4vIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IElBc3NldFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvbGlicmFyeS9JQXNzZXRcIik7XHJcblxyXG5pbXBvcnQgU3ViR2VvbWV0cnlCYXNlXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2RhdGEvU3ViR2VvbWV0cnlCYXNlXCIpO1xyXG5pbXBvcnQgVHJpYW5nbGVTdWJHZW9tZXRyeVx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZGF0YS9UcmlhbmdsZVN1Ykdlb21ldHJ5XCIpO1xyXG5pbXBvcnQgUHJpbWl0aXZlUHJlZmFiQmFzZVx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvcHJlZmFicy9QcmltaXRpdmVQcmVmYWJCYXNlXCIpO1xyXG5cclxuLyoqXHJcbiAqIEEgVVYgQ3lsaW5kZXIgcHJpbWl0aXZlIG1lc2guXHJcbiAqL1xyXG5jbGFzcyBQcmltaXRpdmVUb3J1c1ByZWZhYiBleHRlbmRzIFByaW1pdGl2ZVByZWZhYkJhc2UgaW1wbGVtZW50cyBJQXNzZXRcclxue1xyXG5cdHByaXZhdGUgX3JhZGl1czpudW1iZXI7XHJcblx0cHJpdmF0ZSBfdHViZVJhZGl1czpudW1iZXI7XHJcblx0cHJpdmF0ZSBfc2VnbWVudHNSOm51bWJlcjtcclxuXHRwcml2YXRlIF9zZWdtZW50c1Q6bnVtYmVyO1xyXG5cdHByaXZhdGUgX3lVcDpib29sZWFuO1xyXG5cdHByaXZhdGUgX251bVZlcnRpY2VzOm51bWJlciA9IDA7XHJcblxyXG5cdC8qKlxyXG5cdCAqIFRoZSByYWRpdXMgb2YgdGhlIHRvcnVzLlxyXG5cdCAqL1xyXG5cdHB1YmxpYyBnZXQgcmFkaXVzKCk6bnVtYmVyXHJcblx0e1xyXG5cdFx0cmV0dXJuIHRoaXMuX3JhZGl1cztcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBzZXQgcmFkaXVzKHZhbHVlOm51bWJlcilcclxuXHR7XHJcblx0XHR0aGlzLl9yYWRpdXMgPSB2YWx1ZTtcclxuXHRcdHRoaXMuX3BJbnZhbGlkYXRlR2VvbWV0cnkoKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIFRoZSByYWRpdXMgb2YgdGhlIGlubmVyIHR1YmUgb2YgdGhlIHRvcnVzLlxyXG5cdCAqL1xyXG5cdHB1YmxpYyBnZXQgdHViZVJhZGl1cygpOm51bWJlclxyXG5cdHtcclxuXHRcdHJldHVybiB0aGlzLl90dWJlUmFkaXVzO1xyXG5cdH1cclxuXHJcblx0cHVibGljIHNldCB0dWJlUmFkaXVzKHZhbHVlOm51bWJlcilcclxuXHR7XHJcblx0XHR0aGlzLl90dWJlUmFkaXVzID0gdmFsdWU7XHJcblx0XHR0aGlzLl9wSW52YWxpZGF0ZUdlb21ldHJ5KCk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBEZWZpbmVzIHRoZSBudW1iZXIgb2YgaG9yaXpvbnRhbCBzZWdtZW50cyB0aGF0IG1ha2UgdXAgdGhlIHRvcnVzLiBEZWZhdWx0cyB0byAxNi5cclxuXHQgKi9cclxuXHRwdWJsaWMgZ2V0IHNlZ21lbnRzUigpOm51bWJlclxyXG5cdHtcclxuXHRcdHJldHVybiB0aGlzLl9zZWdtZW50c1I7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgc2V0IHNlZ21lbnRzUih2YWx1ZTpudW1iZXIpXHJcblx0e1xyXG5cdFx0dGhpcy5fc2VnbWVudHNSID0gdmFsdWU7XHJcblx0XHR0aGlzLl9wSW52YWxpZGF0ZUdlb21ldHJ5KCk7XHJcblx0XHR0aGlzLl9wSW52YWxpZGF0ZVVWcygpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogRGVmaW5lcyB0aGUgbnVtYmVyIG9mIHZlcnRpY2FsIHNlZ21lbnRzIHRoYXQgbWFrZSB1cCB0aGUgdG9ydXMuIERlZmF1bHRzIHRvIDguXHJcblx0ICovXHJcblx0cHVibGljIGdldCBzZWdtZW50c1QoKTpudW1iZXJcclxuXHR7XHJcblx0XHRyZXR1cm4gdGhpcy5fc2VnbWVudHNUO1xyXG5cdH1cclxuXHJcblx0cHVibGljIHNldCBzZWdtZW50c1QodmFsdWU6bnVtYmVyKVxyXG5cdHtcclxuXHRcdHRoaXMuX3NlZ21lbnRzVCA9IHZhbHVlO1xyXG5cdFx0dGhpcy5fcEludmFsaWRhdGVHZW9tZXRyeSgpO1xyXG5cdFx0dGhpcy5fcEludmFsaWRhdGVVVnMoKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIERlZmluZXMgd2hldGhlciB0aGUgdG9ydXMgcG9sZXMgc2hvdWxkIGxheSBvbiB0aGUgWS1heGlzICh0cnVlKSBvciBvbiB0aGUgWi1heGlzIChmYWxzZSkuXHJcblx0ICovXHJcblx0cHVibGljIGdldCB5VXAoKTpib29sZWFuXHJcblx0e1xyXG5cdFx0cmV0dXJuIHRoaXMuX3lVcDtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBzZXQgeVVwKHZhbHVlOmJvb2xlYW4pXHJcblx0e1xyXG5cdFx0dGhpcy5feVVwID0gdmFsdWU7XHJcblx0XHR0aGlzLl9wSW52YWxpZGF0ZUdlb21ldHJ5KCk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBDcmVhdGVzIGEgbmV3IDxjb2RlPlRvcnVzPC9jb2RlPiBvYmplY3QuXHJcblx0ICogQHBhcmFtIHJhZGl1cyBUaGUgcmFkaXVzIG9mIHRoZSB0b3J1cy5cclxuXHQgKiBAcGFyYW0gdHVlYlJhZGl1cyBUaGUgcmFkaXVzIG9mIHRoZSBpbm5lciB0dWJlIG9mIHRoZSB0b3J1cy5cclxuXHQgKiBAcGFyYW0gc2VnbWVudHNSIERlZmluZXMgdGhlIG51bWJlciBvZiBob3Jpem9udGFsIHNlZ21lbnRzIHRoYXQgbWFrZSB1cCB0aGUgdG9ydXMuXHJcblx0ICogQHBhcmFtIHNlZ21lbnRzVCBEZWZpbmVzIHRoZSBudW1iZXIgb2YgdmVydGljYWwgc2VnbWVudHMgdGhhdCBtYWtlIHVwIHRoZSB0b3J1cy5cclxuXHQgKiBAcGFyYW0geVVwIERlZmluZXMgd2hldGhlciB0aGUgdG9ydXMgcG9sZXMgc2hvdWxkIGxheSBvbiB0aGUgWS1heGlzICh0cnVlKSBvciBvbiB0aGUgWi1heGlzIChmYWxzZSkuXHJcblx0ICovXHJcblx0Y29uc3RydWN0b3IocmFkaXVzOm51bWJlciA9IDUwLCB0dWJlUmFkaXVzOm51bWJlciA9IDUwLCBzZWdtZW50c1I6bnVtYmVyID0gMTYsIHNlZ21lbnRzVDpudW1iZXIgPSA4LCB5VXA6Ym9vbGVhbiA9IHRydWUpXHJcblx0e1xyXG5cdFx0c3VwZXIoKTtcclxuXHJcblx0XHR0aGlzLl9yYWRpdXMgPSByYWRpdXM7XHJcblx0XHR0aGlzLl90dWJlUmFkaXVzID0gdHViZVJhZGl1cztcclxuXHRcdHRoaXMuX3NlZ21lbnRzUiA9IHNlZ21lbnRzUjtcclxuXHRcdHRoaXMuX3NlZ21lbnRzVCA9IHNlZ21lbnRzVDtcclxuXHRcdHRoaXMuX3lVcCA9IHlVcDtcclxuXHR9XHJcblxyXG5cclxuXHQvKipcclxuXHQgKiBAaW5oZXJpdERvY1xyXG5cdCAqL1xyXG5cdHB1YmxpYyBfcEJ1aWxkR2VvbWV0cnkodGFyZ2V0OlN1Ykdlb21ldHJ5QmFzZSwgZ2VvbWV0cnlUeXBlOnN0cmluZylcclxuXHR7XHJcblx0XHR2YXIgaW5kaWNlczpBcnJheTxudW1iZXI+IC8qdWludCovO1xyXG5cdFx0dmFyIHBvc2l0aW9uczpBcnJheTxudW1iZXI+O1xyXG5cdFx0dmFyIG5vcm1hbHM6QXJyYXk8bnVtYmVyPjtcclxuXHRcdHZhciB0YW5nZW50czpBcnJheTxudW1iZXI+O1xyXG5cclxuXHRcdHZhciBpOm51bWJlciwgajpudW1iZXI7XHJcblx0XHR2YXIgeDpudW1iZXIsIHk6bnVtYmVyLCB6Om51bWJlciwgbng6bnVtYmVyLCBueTpudW1iZXIsIG56Om51bWJlciwgcmV2b2x1dGlvbkFuZ2xlUjpudW1iZXIsIHJldm9sdXRpb25BbmdsZVQ6bnVtYmVyO1xyXG5cdFx0dmFyIHZpZHg6bnVtYmVyO1xyXG5cdFx0dmFyIGZpZHg6bnVtYmVyO1xyXG5cdFx0dmFyIG51bUluZGljZXM6bnVtYmVyID0gMDtcclxuXHJcblx0XHRpZiAoZ2VvbWV0cnlUeXBlID09IFwidHJpYW5nbGVTdWJHZW9tZXRyeVwiKSB7XHJcblxyXG5cdFx0XHR2YXIgdHJpYW5nbGVHZW9tZXRyeTpUcmlhbmdsZVN1Ykdlb21ldHJ5ID0gPFRyaWFuZ2xlU3ViR2VvbWV0cnk+IHRhcmdldDtcclxuXHJcblx0XHRcdC8vIGV2YWx1YXRlIHRhcmdldCBudW1iZXIgb2YgdmVydGljZXMsIHRyaWFuZ2xlcyBhbmQgaW5kaWNlc1xyXG5cdFx0XHR0aGlzLl9udW1WZXJ0aWNlcyA9ICh0aGlzLl9zZWdtZW50c1QgKyAxKSoodGhpcy5fc2VnbWVudHNSICsgMSk7IC8vIHNlZ21lbnRzVCArIDEgYmVjYXVzZSBvZiBjbG9zdXJlLCBzZWdtZW50c1IgKyAxIGJlY2F1c2Ugb2YgY2xvc3VyZVxyXG5cdFx0XHRudW1JbmRpY2VzID0gdGhpcy5fc2VnbWVudHNUKnRoaXMuX3NlZ21lbnRzUio2OyAvLyBlYWNoIGxldmVsIGhhcyBzZWdtZW50UiBxdWFkcywgZWFjaCBvZiAyIHRyaWFuZ2xlc1xyXG5cclxuXHRcdFx0Ly8gbmVlZCB0byBpbml0aWFsaXplIHJhdyBhcnJheXMgb3IgY2FuIGJlIHJldXNlZD9cclxuXHRcdFx0aWYgKHRoaXMuX251bVZlcnRpY2VzID09IHRyaWFuZ2xlR2VvbWV0cnkubnVtVmVydGljZXMpIHtcclxuXHRcdFx0XHRpbmRpY2VzID0gdHJpYW5nbGVHZW9tZXRyeS5pbmRpY2VzO1xyXG5cdFx0XHRcdHBvc2l0aW9ucyA9IHRyaWFuZ2xlR2VvbWV0cnkucG9zaXRpb25zO1xyXG5cdFx0XHRcdG5vcm1hbHMgPSB0cmlhbmdsZUdlb21ldHJ5LnZlcnRleE5vcm1hbHM7XHJcblx0XHRcdFx0dGFuZ2VudHMgPSB0cmlhbmdsZUdlb21ldHJ5LnZlcnRleFRhbmdlbnRzO1xyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdGluZGljZXMgPSBuZXcgQXJyYXk8bnVtYmVyPihudW1JbmRpY2VzKVxyXG5cdFx0XHRcdHBvc2l0aW9ucyA9IG5ldyBBcnJheTxudW1iZXI+KHRoaXMuX251bVZlcnRpY2VzKjMpO1xyXG5cdFx0XHRcdG5vcm1hbHMgPSBuZXcgQXJyYXk8bnVtYmVyPih0aGlzLl9udW1WZXJ0aWNlcyozKTtcclxuXHRcdFx0XHR0YW5nZW50cyA9IG5ldyBBcnJheTxudW1iZXI+KHRoaXMuX251bVZlcnRpY2VzKjMpO1xyXG5cclxuXHRcdFx0XHR0aGlzLl9wSW52YWxpZGF0ZVVWcygpO1xyXG5cdFx0XHR9XHJcblxyXG5cclxuXHRcdFx0dmlkeCA9IDA7XHJcblx0XHRcdGZpZHggPSAwO1xyXG5cclxuXHRcdFx0Ly8gZXZhbHVhdGUgcmV2b2x1dGlvbiBzdGVwc1xyXG5cdFx0XHR2YXIgcmV2b2x1dGlvbkFuZ2xlRGVsdGFSOm51bWJlciA9IDIqTWF0aC5QSS90aGlzLl9zZWdtZW50c1I7XHJcblx0XHRcdHZhciByZXZvbHV0aW9uQW5nbGVEZWx0YVQ6bnVtYmVyID0gMipNYXRoLlBJL3RoaXMuX3NlZ21lbnRzVDtcclxuXHJcblx0XHRcdHZhciBjb21wMTpudW1iZXIsIGNvbXAyOm51bWJlcjtcclxuXHRcdFx0dmFyIHQxOm51bWJlciwgdDI6bnVtYmVyLCBuMTpudW1iZXIsIG4yOm51bWJlcjtcclxuXHRcdFx0dmFyIHN0YXJ0SW5kZXg6bnVtYmVyID0gMDtcclxuXHRcdFx0dmFyIG5leHRWZXJ0ZXhJbmRleDpudW1iZXIgPSAwO1xyXG5cclxuXHRcdFx0Ly8gc3VyZmFjZVxyXG5cdFx0XHR2YXIgYTpudW1iZXIsIGI6bnVtYmVyLCBjOm51bWJlciwgZDpudW1iZXIsIGxlbmd0aDpudW1iZXI7XHJcblxyXG5cdFx0XHRmb3IgKGogPSAwOyBqIDw9IHRoaXMuX3NlZ21lbnRzVDsgKytqKSB7XHJcblxyXG5cdFx0XHRcdHN0YXJ0SW5kZXggPSBuZXh0VmVydGV4SW5kZXgqMztcclxuXHJcblx0XHRcdFx0Zm9yIChpID0gMDsgaSA8PSB0aGlzLl9zZWdtZW50c1I7ICsraSkge1xyXG5cclxuXHRcdFx0XHRcdC8vIHJldm9sdXRpb24gdmVydGV4XHJcblx0XHRcdFx0XHRyZXZvbHV0aW9uQW5nbGVSID0gaSpyZXZvbHV0aW9uQW5nbGVEZWx0YVI7XHJcblx0XHRcdFx0XHRyZXZvbHV0aW9uQW5nbGVUID0gaipyZXZvbHV0aW9uQW5nbGVEZWx0YVQ7XHJcblxyXG5cdFx0XHRcdFx0bGVuZ3RoID0gTWF0aC5jb3MocmV2b2x1dGlvbkFuZ2xlVCk7XHJcblx0XHRcdFx0XHRueCA9IGxlbmd0aCpNYXRoLmNvcyhyZXZvbHV0aW9uQW5nbGVSKTtcclxuXHRcdFx0XHRcdG55ID0gbGVuZ3RoKk1hdGguc2luKHJldm9sdXRpb25BbmdsZVIpO1xyXG5cdFx0XHRcdFx0bnogPSBNYXRoLnNpbihyZXZvbHV0aW9uQW5nbGVUKTtcclxuXHJcblx0XHRcdFx0XHR4ID0gdGhpcy5fcmFkaXVzKk1hdGguY29zKHJldm9sdXRpb25BbmdsZVIpICsgdGhpcy5fdHViZVJhZGl1cypueDtcclxuXHRcdFx0XHRcdHkgPSB0aGlzLl9yYWRpdXMqTWF0aC5zaW4ocmV2b2x1dGlvbkFuZ2xlUikgKyB0aGlzLl90dWJlUmFkaXVzKm55O1xyXG5cdFx0XHRcdFx0eiA9IChqID09IHRoaXMuX3NlZ21lbnRzVCk/IDAgOiB0aGlzLl90dWJlUmFkaXVzKm56O1xyXG5cclxuXHRcdFx0XHRcdGlmICh0aGlzLl95VXApIHtcclxuXHJcblx0XHRcdFx0XHRcdG4xID0gLW56O1xyXG5cdFx0XHRcdFx0XHRuMiA9IG55O1xyXG5cdFx0XHRcdFx0XHR0MSA9IDA7XHJcblx0XHRcdFx0XHRcdHQyID0gKGxlbmd0aD8gbngvbGVuZ3RoIDogeC90aGlzLl9yYWRpdXMpO1xyXG5cdFx0XHRcdFx0XHRjb21wMSA9IC16O1xyXG5cdFx0XHRcdFx0XHRjb21wMiA9IHk7XHJcblxyXG5cdFx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdFx0bjEgPSBueTtcclxuXHRcdFx0XHRcdFx0bjIgPSBuejtcclxuXHRcdFx0XHRcdFx0dDEgPSAobGVuZ3RoPyBueC9sZW5ndGggOiB4L3RoaXMuX3JhZGl1cyk7XHJcblx0XHRcdFx0XHRcdHQyID0gMDtcclxuXHRcdFx0XHRcdFx0Y29tcDEgPSB5O1xyXG5cdFx0XHRcdFx0XHRjb21wMiA9IHo7XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0aWYgKGkgPT0gdGhpcy5fc2VnbWVudHNSKSB7XHJcblx0XHRcdFx0XHRcdHBvc2l0aW9uc1t2aWR4XSA9IHg7XHJcblx0XHRcdFx0XHRcdHBvc2l0aW9uc1t2aWR4ICsgMV0gPSBwb3NpdGlvbnNbc3RhcnRJbmRleCArIDFdO1xyXG5cdFx0XHRcdFx0XHRwb3NpdGlvbnNbdmlkeCArIDJdID0gcG9zaXRpb25zW3N0YXJ0SW5kZXggKyAyXTtcclxuXHRcdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRcdHBvc2l0aW9uc1t2aWR4XSA9IHg7XHJcblx0XHRcdFx0XHRcdHBvc2l0aW9uc1t2aWR4ICsgMV0gPSBjb21wMTtcclxuXHRcdFx0XHRcdFx0cG9zaXRpb25zW3ZpZHggKyAyXSA9IGNvbXAyO1xyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdG5vcm1hbHNbdmlkeF0gPSBueDtcclxuXHRcdFx0XHRcdG5vcm1hbHNbdmlkeCArIDFdID0gbjE7XHJcblx0XHRcdFx0XHRub3JtYWxzW3ZpZHggKyAyXSA9IG4yO1xyXG5cdFx0XHRcdFx0dGFuZ2VudHNbdmlkeF0gPSAtKGxlbmd0aD8gbnkvbGVuZ3RoIDogeS90aGlzLl9yYWRpdXMpO1xyXG5cdFx0XHRcdFx0dGFuZ2VudHNbdmlkeCArIDFdID0gdDE7XHJcblx0XHRcdFx0XHR0YW5nZW50c1t2aWR4ICsgMl0gPSB0MjtcclxuXHJcblx0XHRcdFx0XHR2aWR4ICs9IDM7XHJcblxyXG5cdFx0XHRcdFx0Ly8gY2xvc2UgdHJpYW5nbGVcclxuXHRcdFx0XHRcdGlmIChpID4gMCAmJiBqID4gMCkge1xyXG5cdFx0XHRcdFx0XHRhID0gbmV4dFZlcnRleEluZGV4OyAvLyBjdXJyZW50XHJcblx0XHRcdFx0XHRcdGIgPSBuZXh0VmVydGV4SW5kZXggLSAxOyAvLyBwcmV2aW91c1xyXG5cdFx0XHRcdFx0XHRjID0gYiAtIHRoaXMuX3NlZ21lbnRzUiAtIDE7IC8vIHByZXZpb3VzIG9mIGxhc3QgbGV2ZWxcclxuXHRcdFx0XHRcdFx0ZCA9IGEgLSB0aGlzLl9zZWdtZW50c1IgLSAxOyAvLyBjdXJyZW50IG9mIGxhc3QgbGV2ZWxcclxuXHJcblx0XHRcdFx0XHRcdGluZGljZXNbZmlkeCsrXSA9IGE7XHJcblx0XHRcdFx0XHRcdGluZGljZXNbZmlkeCsrXSA9IGI7XHJcblx0XHRcdFx0XHRcdGluZGljZXNbZmlkeCsrXSA9IGM7XHJcblxyXG5cdFx0XHRcdFx0XHRpbmRpY2VzW2ZpZHgrK10gPSBhO1xyXG5cdFx0XHRcdFx0XHRpbmRpY2VzW2ZpZHgrK10gPSBjO1xyXG5cdFx0XHRcdFx0XHRpbmRpY2VzW2ZpZHgrK10gPSBkO1xyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdG5leHRWZXJ0ZXhJbmRleCsrO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gYnVpbGQgcmVhbCBkYXRhIGZyb20gcmF3IGRhdGFcclxuXHRcdFx0dHJpYW5nbGVHZW9tZXRyeS51cGRhdGVJbmRpY2VzKGluZGljZXMpO1xyXG5cclxuXHRcdFx0dHJpYW5nbGVHZW9tZXRyeS51cGRhdGVQb3NpdGlvbnMocG9zaXRpb25zKTtcclxuXHRcdFx0dHJpYW5nbGVHZW9tZXRyeS51cGRhdGVWZXJ0ZXhOb3JtYWxzKG5vcm1hbHMpO1xyXG5cdFx0XHR0cmlhbmdsZUdlb21ldHJ5LnVwZGF0ZVZlcnRleFRhbmdlbnRzKHRhbmdlbnRzKTtcclxuXHJcblx0XHR9IGVsc2UgaWYgKGdlb21ldHJ5VHlwZSA9PSBcImxpbmVTdWJHZW9tZXRyeVwiKSB7XHJcblx0XHRcdC8vVE9ET1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQGluaGVyaXREb2NcclxuXHQgKi9cclxuXHRwdWJsaWMgX3BCdWlsZFVWcyh0YXJnZXQ6U3ViR2VvbWV0cnlCYXNlLCBnZW9tZXRyeVR5cGU6c3RyaW5nKVxyXG5cdHtcclxuXHJcblx0XHR2YXIgaTpudW1iZXIsIGo6bnVtYmVyO1xyXG5cdFx0dmFyIHV2czpBcnJheTxudW1iZXI+O1xyXG5cclxuXHJcblx0XHRpZiAoZ2VvbWV0cnlUeXBlID09IFwidHJpYW5nbGVTdWJHZW9tZXRyeVwiKSB7XHJcblxyXG5cdFx0XHR2YXIgdHJpYW5nbGVHZW9tZXRyeTpUcmlhbmdsZVN1Ykdlb21ldHJ5ID0gPFRyaWFuZ2xlU3ViR2VvbWV0cnk+IHRhcmdldDtcclxuXHJcblx0XHRcdC8vIG5lZWQgdG8gaW5pdGlhbGl6ZSByYXcgYXJyYXkgb3IgY2FuIGJlIHJldXNlZD9cclxuXHRcdFx0aWYgKHRyaWFuZ2xlR2VvbWV0cnkudXZzICYmIHRoaXMuX251bVZlcnRpY2VzID09IHRyaWFuZ2xlR2VvbWV0cnkubnVtVmVydGljZXMpIHtcclxuXHRcdFx0XHR1dnMgPSB0cmlhbmdsZUdlb21ldHJ5LnV2cztcclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHR1dnMgPSBuZXcgQXJyYXk8bnVtYmVyPih0aGlzLl9udW1WZXJ0aWNlcyoyKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gY3VycmVudCB1diBjb21wb25lbnQgaW5kZXhcclxuXHRcdFx0dmFyIGluZGV4Om51bWJlciA9IDA7XHJcblxyXG5cdFx0XHQvLyBzdXJmYWNlXHJcblx0XHRcdGZvciAoaiA9IDA7IGogPD0gdGhpcy5fc2VnbWVudHNUOyArK2opIHtcclxuXHRcdFx0XHRmb3IgKGkgPSAwOyBpIDw9IHRoaXMuX3NlZ21lbnRzUjsgKytpKSB7XHJcblx0XHRcdFx0XHQvLyByZXZvbHV0aW9uIHZlcnRleFxyXG5cdFx0XHRcdFx0dXZzW2luZGV4KytdID0gKCBpL3RoaXMuX3NlZ21lbnRzUiApKnRyaWFuZ2xlR2VvbWV0cnkuc2NhbGVVO1xyXG5cdFx0XHRcdFx0dXZzW2luZGV4KytdID0gKCBqL3RoaXMuX3NlZ21lbnRzVCApKnRyaWFuZ2xlR2VvbWV0cnkuc2NhbGVWO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gYnVpbGQgcmVhbCBkYXRhIGZyb20gcmF3IGRhdGFcclxuXHRcdFx0dHJpYW5nbGVHZW9tZXRyeS51cGRhdGVVVnModXZzKTtcclxuXHJcblx0XHR9IGVsc2UgaWYgKGdlb21ldHJ5VHlwZSA9PSBcImxpbmVTdWJHZW9tZXRyeVwiKSB7XHJcblx0XHRcdC8vbm90aGluZyB0byBkbyBoZXJlXHJcblx0XHR9XHJcblx0fVxyXG59XHJcblxyXG5leHBvcnQgPSBQcmltaXRpdmVUb3J1c1ByZWZhYjsiXX0=