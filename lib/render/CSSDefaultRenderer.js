var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Matrix3D = require("awayjs-core/lib/geom/Matrix3D");
var CoordinateSystem = require("awayjs-core/lib/projections/CoordinateSystem");
var CSSRendererBase = require("awayjs-display/lib/render/CSSRendererBase");
var CSSEntityCollector = require("awayjs-display/lib/traverse/CSSEntityCollector");
/**
 * The DefaultRenderer class provides the default rendering method. It renders the scene graph objects using the
 * materials assigned to them.
 *
 * @class away.render.DefaultRenderer
 */
var CSSDefaultRenderer = (function (_super) {
    __extends(CSSDefaultRenderer, _super);
    /**
     * Creates a new CSSDefaultRenderer object.
     */
    function CSSDefaultRenderer() {
        _super.call(this);
        this._contextMatrix = new Matrix3D();
        this._skyboxProjection = new Matrix3D();
        this._transform = new Matrix3D();
        //create container for the renderer
        this._container = document.createElement("div");
        this._container.style.overflow = "hidden";
        this._container.style.position = "absolute";
        //add container to body
        document.body.appendChild(this._container);
        //create conxtext for the renderer
        this._context = document.createElement("div");
        this._contextStyle = this._context.style;
        this._contextStyle.position = "absolute";
        this._contextStyle.transformStyle = this._contextStyle["-webkit-transform-style"] = this._contextStyle["-moz-transform-style"] = this._contextStyle["-o-transform-style"] = this._contextStyle["-ms-transform-style"] = "preserve-3d";
        this._contextStyle.transformOrigin = this._contextStyle["-webkit-transform-origin"] = this._contextStyle["-moz-transform-origin"] = this._contextStyle["-o-transform-origin"] = this._contextStyle["-ms-transform-origin"] = "0% 0%";
        //add context to container
        this._container.appendChild(this._context);
    }
    /**
     *
     * @param entityCollector
     */
    CSSDefaultRenderer.prototype.render = function (entityCollector) {
        _super.prototype.render.call(this, entityCollector);
        if (this._pBackBufferInvalid)
            this.pUpdateBackBuffer();
        this._iRender(entityCollector);
        this._pBackBufferInvalid = false;
    };
    /**
     * @inheritDoc
     */
    CSSDefaultRenderer.prototype.pDraw = function (entityCollector) {
        //			if (entityCollector.skyBox) {
        //				if (this._activeMaterial)
        //					this._activeMaterial.iDeactivate(this._pStageGL);
        //
        //				this._activeMaterial = null;
        //
        //				this._pContext.setDepthTest(false, away.gl.ContextGLCompareMode.ALWAYS);
        //				this.drawSkybox(entityCollector);
        //
        //			}
        //
        //			var which:number = target? DefaultRenderer.SCREEN_PASSES : DefaultRenderer.ALL_PASSES;
        var sheet = document.styleSheets[document.styleSheets.length - 1];
        for (var i = 0; i < sheet.cssRules.length; i++) {
            var style = sheet.cssRules[i].style;
            style.transform = style["-webkit-transform"] = style["-moz-transform"] = style["-o-transform"] = style["-ms-transform"] = (entityCollector.camera.projection.coordinateSystem == CoordinateSystem.RIGHT_HANDED) ? "" : "scale3d(1, -1, 1) translateY(-" + style.height + ")";
        }
        this.drawRenderables(this._renderableHead, entityCollector);
        //			if (this._activeMaterial)
        //				this._activeMaterial.iDeactivate(this._pStageGL);
        this._activeMaterial = null;
    };
    /**
     * Updates the backbuffer properties.
     */
    CSSDefaultRenderer.prototype.pUpdateBackBuffer = function () {
        this._container.style.width = this._width + "px";
        this._container.style.height = this._height + "px";
        this._container.style.clip = "rect(0px, " + this._width + "px, " + this._height + "px, 0px)";
        //update context matrix
        this._contextMatrix.rawData[0] = this._width / 2;
        this._contextMatrix.rawData[5] = -this._height / 2;
        this._contextMatrix.rawData[10] = -1; //fix for innaccurate z-sort
        this._contextMatrix.rawData[12] = this._width / 2;
        this._contextMatrix.rawData[13] = this._height / 2;
        //update context tranform
        this._contextStyle.transform = this._contextStyle["-webkit-transform"] = this._contextStyle["-moz-transform"] = this._contextStyle["-o-transform"] = this._contextStyle["-ms-transform"] = this._contextMatrix.toString();
        this._pBackBufferInvalid = false;
    };
    /**
     * Draw the skybox if present.
     * @param entityCollector The EntityCollector containing all potentially visible information.
     */
    CSSDefaultRenderer.prototype.drawSkybox = function (entityCollector) {
        //TODO
    };
    /**
     * Draw a list of renderables.
     * @param renderables The renderables to draw.
     * @param entityCollector The EntityCollector containing all potentially visible information.
     */
    CSSDefaultRenderer.prototype.drawRenderables = function (item, entityCollector) {
        var viewProjection = entityCollector.camera.viewProjection.clone();
        while (item) {
            //this._activeMaterial = <CSSMaterialBase> item.materialOwner.material;
            //serialise transform and apply to html element
            this._transform.copyRawDataFrom(item.renderSceneTransform.rawData);
            this._transform.append(viewProjection);
            var style = item.htmlElement.style;
            style.transform = style["-webkit-transform"] = style["-moz-transform"] = style["-o-transform"] = style["-ms-transform"] = this._transform.toString();
            style.transformStyle = style["-webkit-transform-style"] = style["-moz-transform-style"] = style["-o-transform-style"] = style["-ms-transform-style"] = "preserve-3d";
            //check if child requires adding to the view
            if (!this._context.contains(item.htmlElement))
                this._context.appendChild(item.htmlElement);
            item = item.next;
        }
        //			var numPasses:number;
        //			var j:number;
        //			var camera:away.entities.Camera = entityCollector.camera;
        //			var item2:away.render.CSSRenderableBase;
        //
        //			while (item) {
        //				this._activeMaterial = item.material;
        //
        //				this._activeMaterial.iUpdateMaterial(this._pContext);
        //
        //				numPasses = this._activeMaterial._iNumPasses;
        //
        //				j = 0;
        //
        //				do {
        //					item2 = item;
        //
        //					var rttMask:number = this._activeMaterial.iPassRendersToTexture(j)? 1 : 2;
        //
        //					if ((rttMask & which) != 0) {
        //						this._activeMaterial.iActivatePass(j, this._pStageGL, camera);
        //
        //						do {
        //							this._activeMaterial.iRenderPass(j, item2, this._pStageGL, entityCollector);
        //
        //							item2 = item2.next;
        //
        //						} while (item2 && item2.material == this._activeMaterial);
        //
        //						this._activeMaterial.iDeactivatePass(j, this._pStageGL);
        //
        //					} else {
        //						do {
        //							item2 = item2.next;
        //
        //						} while (item2 && item2.renderable.material == this._activeMaterial);
        //					}
        //				} while (++j < numPasses);
        //
        //				item = item2;
        //			}
    };
    CSSDefaultRenderer.prototype.dispose = function () {
        _super.prototype.dispose.call(this);
        //TODO
    };
    CSSDefaultRenderer.prototype._iCreateEntityCollector = function () {
        return new CSSEntityCollector();
    };
    return CSSDefaultRenderer;
})(CSSRendererBase);
module.exports = CSSDefaultRenderer;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1kaXNwbGF5L2xpYi9yZW5kZXIvQ1NTRGVmYXVsdFJlbmRlcmVyLnRzIl0sIm5hbWVzIjpbIkNTU0RlZmF1bHRSZW5kZXJlciIsIkNTU0RlZmF1bHRSZW5kZXJlci5jb25zdHJ1Y3RvciIsIkNTU0RlZmF1bHRSZW5kZXJlci5yZW5kZXIiLCJDU1NEZWZhdWx0UmVuZGVyZXIucERyYXciLCJDU1NEZWZhdWx0UmVuZGVyZXIucFVwZGF0ZUJhY2tCdWZmZXIiLCJDU1NEZWZhdWx0UmVuZGVyZXIuZHJhd1NreWJveCIsIkNTU0RlZmF1bHRSZW5kZXJlci5kcmF3UmVuZGVyYWJsZXMiLCJDU1NEZWZhdWx0UmVuZGVyZXIuZGlzcG9zZSIsIkNTU0RlZmF1bHRSZW5kZXJlci5faUNyZWF0ZUVudGl0eUNvbGxlY3RvciJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsSUFBTyxRQUFRLFdBQWdCLCtCQUErQixDQUFDLENBQUM7QUFDaEUsSUFBTyxnQkFBZ0IsV0FBYyw4Q0FBOEMsQ0FBQyxDQUFDO0FBR3JGLElBQU8sZUFBZSxXQUFjLDJDQUEyQyxDQUFDLENBQUM7QUFFakYsSUFBTyxrQkFBa0IsV0FBYSxnREFBZ0QsQ0FBQyxDQUFDO0FBTXhGLEFBTUE7Ozs7O0dBREc7SUFDRyxrQkFBa0I7SUFBU0EsVUFBM0JBLGtCQUFrQkEsVUFBd0JBO0lBVy9DQTs7T0FFR0E7SUFDSEEsU0FkS0Esa0JBQWtCQTtRQWdCdEJDLGlCQUFPQSxDQUFDQTtRQVhEQSxtQkFBY0EsR0FBWUEsSUFBSUEsUUFBUUEsRUFBRUEsQ0FBQ0E7UUFHekNBLHNCQUFpQkEsR0FBWUEsSUFBSUEsUUFBUUEsRUFBRUEsQ0FBQ0E7UUFDNUNBLGVBQVVBLEdBQVlBLElBQUlBLFFBQVFBLEVBQUVBLENBQUNBO1FBUzVDQSxBQUNBQSxtQ0FEbUNBO1FBQ25DQSxJQUFJQSxDQUFDQSxVQUFVQSxHQUFHQSxRQUFRQSxDQUFDQSxhQUFhQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQTtRQUNoREEsSUFB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QUFFRCxBQUE0QixpQkFBbkIsa0JBQWtCLENBQUMiLCJmaWxlIjoicmVuZGVyL0NTU0RlZmF1bHRSZW5kZXJlci5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgTWF0cml4M0RcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9NYXRyaXgzRFwiKTtcclxuaW1wb3J0IENvb3JkaW5hdGVTeXN0ZW1cdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9wcm9qZWN0aW9ucy9Db29yZGluYXRlU3lzdGVtXCIpO1xyXG5cclxuaW1wb3J0IENTU1JlbmRlcmFibGVCYXNlXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL3Bvb2wvQ1NTUmVuZGVyYWJsZUJhc2VcIik7XHJcbmltcG9ydCBDU1NSZW5kZXJlckJhc2VcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9yZW5kZXIvQ1NTUmVuZGVyZXJCYXNlXCIpO1xyXG5pbXBvcnQgSVJlbmRlcmVyXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9yZW5kZXIvSVJlbmRlcmVyXCIpO1xyXG5pbXBvcnQgQ1NTRW50aXR5Q29sbGVjdG9yXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL3RyYXZlcnNlL0NTU0VudGl0eUNvbGxlY3RvclwiKTtcclxuaW1wb3J0IEVudGl0eUNvbGxlY3Rvclx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL3RyYXZlcnNlL0VudGl0eUNvbGxlY3RvclwiKTtcclxuaW1wb3J0IENvbGxlY3RvckJhc2VcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi90cmF2ZXJzZS9Db2xsZWN0b3JCYXNlXCIpO1xyXG5pbXBvcnQgQ1NTTWF0ZXJpYWxCYXNlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvbWF0ZXJpYWxzL0NTU01hdGVyaWFsQmFzZVwiKTtcclxuXHJcblxyXG4vKipcclxuICogVGhlIERlZmF1bHRSZW5kZXJlciBjbGFzcyBwcm92aWRlcyB0aGUgZGVmYXVsdCByZW5kZXJpbmcgbWV0aG9kLiBJdCByZW5kZXJzIHRoZSBzY2VuZSBncmFwaCBvYmplY3RzIHVzaW5nIHRoZVxyXG4gKiBtYXRlcmlhbHMgYXNzaWduZWQgdG8gdGhlbS5cclxuICpcclxuICogQGNsYXNzIGF3YXkucmVuZGVyLkRlZmF1bHRSZW5kZXJlclxyXG4gKi9cclxuY2xhc3MgQ1NTRGVmYXVsdFJlbmRlcmVyIGV4dGVuZHMgQ1NTUmVuZGVyZXJCYXNlIGltcGxlbWVudHMgSVJlbmRlcmVyXHJcbntcclxuXHRwcml2YXRlIF9jb250YWluZXI6SFRNTERpdkVsZW1lbnQ7XHJcblx0cHJpdmF0ZSBfY29udGV4dDpIVE1MRGl2RWxlbWVudDtcclxuXHRwcml2YXRlIF9jb250ZXh0U3R5bGU6TVNTdHlsZUNTU1Byb3BlcnRpZXM7XHJcblx0cHJpdmF0ZSBfY29udGV4dE1hdHJpeDpNYXRyaXgzRCA9IG5ldyBNYXRyaXgzRCgpO1xyXG5cdFxyXG5cdHByaXZhdGUgX2FjdGl2ZU1hdGVyaWFsOkNTU01hdGVyaWFsQmFzZTtcclxuXHRwcml2YXRlIF9za3lib3hQcm9qZWN0aW9uOk1hdHJpeDNEID0gbmV3IE1hdHJpeDNEKCk7XHJcblx0cHJpdmF0ZSBfdHJhbnNmb3JtOk1hdHJpeDNEID0gbmV3IE1hdHJpeDNEKCk7XHJcblxyXG5cdC8qKlxyXG5cdCAqIENyZWF0ZXMgYSBuZXcgQ1NTRGVmYXVsdFJlbmRlcmVyIG9iamVjdC5cclxuXHQgKi9cclxuXHRjb25zdHJ1Y3RvcigpXHJcblx0e1xyXG5cdFx0c3VwZXIoKTtcclxuXHJcblx0XHQvL2NyZWF0ZSBjb250YWluZXIgZm9yIHRoZSByZW5kZXJlclxyXG5cdFx0dGhpcy5fY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuXHRcdHRoaXMuX2NvbnRhaW5lci5zdHlsZS5vdmVyZmxvdyA9IFwiaGlkZGVuXCI7XHJcblx0XHR0aGlzLl9jb250YWluZXIuc3R5bGUucG9zaXRpb24gPSBcImFic29sdXRlXCI7XHJcblx0XHRcclxuXHRcdC8vYWRkIGNvbnRhaW5lciB0byBib2R5XHJcblx0XHRkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMuX2NvbnRhaW5lcik7XHJcblxyXG5cdFx0Ly9jcmVhdGUgY29ueHRleHQgZm9yIHRoZSByZW5kZXJlclxyXG5cdFx0dGhpcy5fY29udGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcblx0XHR0aGlzLl9jb250ZXh0U3R5bGUgPSB0aGlzLl9jb250ZXh0LnN0eWxlO1xyXG5cdFx0dGhpcy5fY29udGV4dFN0eWxlLnBvc2l0aW9uID0gXCJhYnNvbHV0ZVwiO1xyXG5cdFx0dGhpcy5fY29udGV4dFN0eWxlLnRyYW5zZm9ybVN0eWxlXHJcblx0XHRcdD0gdGhpcy5fY29udGV4dFN0eWxlW1wiLXdlYmtpdC10cmFuc2Zvcm0tc3R5bGVcIl1cclxuXHRcdFx0PSB0aGlzLl9jb250ZXh0U3R5bGVbXCItbW96LXRyYW5zZm9ybS1zdHlsZVwiXVxyXG5cdFx0XHQ9IHRoaXMuX2NvbnRleHRTdHlsZVtcIi1vLXRyYW5zZm9ybS1zdHlsZVwiXVxyXG5cdFx0XHQ9IHRoaXMuX2NvbnRleHRTdHlsZVtcIi1tcy10cmFuc2Zvcm0tc3R5bGVcIl0gPSBcInByZXNlcnZlLTNkXCI7XHJcblx0XHR0aGlzLl9jb250ZXh0U3R5bGUudHJhbnNmb3JtT3JpZ2luXHJcblx0XHRcdD0gdGhpcy5fY29udGV4dFN0eWxlW1wiLXdlYmtpdC10cmFuc2Zvcm0tb3JpZ2luXCJdXHJcblx0XHRcdD0gdGhpcy5fY29udGV4dFN0eWxlW1wiLW1vei10cmFuc2Zvcm0tb3JpZ2luXCJdXHJcblx0XHRcdD0gdGhpcy5fY29udGV4dFN0eWxlW1wiLW8tdHJhbnNmb3JtLW9yaWdpblwiXVxyXG5cdFx0XHQ9IHRoaXMuX2NvbnRleHRTdHlsZVtcIi1tcy10cmFuc2Zvcm0tb3JpZ2luXCJdID0gXCIwJSAwJVwiO1xyXG5cclxuXHRcdC8vYWRkIGNvbnRleHQgdG8gY29udGFpbmVyXHJcblx0XHR0aGlzLl9jb250YWluZXIuYXBwZW5kQ2hpbGQodGhpcy5fY29udGV4dCk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKlxyXG5cdCAqIEBwYXJhbSBlbnRpdHlDb2xsZWN0b3JcclxuXHQgKi9cclxuXHRwdWJsaWMgcmVuZGVyKGVudGl0eUNvbGxlY3RvcjpDb2xsZWN0b3JCYXNlKVxyXG5cdHtcclxuXHRcdHN1cGVyLnJlbmRlcihlbnRpdHlDb2xsZWN0b3IpO1xyXG5cclxuXHRcdGlmICh0aGlzLl9wQmFja0J1ZmZlckludmFsaWQpLy8gcmVzZXQgb3IgdXBkYXRlIHJlbmRlciBzZXR0aW5nc1xyXG5cdFx0XHR0aGlzLnBVcGRhdGVCYWNrQnVmZmVyKCk7XHJcblxyXG5cdFx0dGhpcy5faVJlbmRlcig8RW50aXR5Q29sbGVjdG9yPiBlbnRpdHlDb2xsZWN0b3IpO1xyXG5cclxuXHRcdHRoaXMuX3BCYWNrQnVmZmVySW52YWxpZCA9IGZhbHNlO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQGluaGVyaXREb2NcclxuXHQgKi9cclxuXHRwdWJsaWMgcERyYXcoZW50aXR5Q29sbGVjdG9yOkVudGl0eUNvbGxlY3RvcilcclxuXHR7XHJcbi8vXHRcdFx0aWYgKGVudGl0eUNvbGxlY3Rvci5za3lCb3gpIHtcclxuLy9cdFx0XHRcdGlmICh0aGlzLl9hY3RpdmVNYXRlcmlhbClcclxuLy9cdFx0XHRcdFx0dGhpcy5fYWN0aXZlTWF0ZXJpYWwuaURlYWN0aXZhdGUodGhpcy5fcFN0YWdlR0wpO1xyXG4vL1xyXG4vL1x0XHRcdFx0dGhpcy5fYWN0aXZlTWF0ZXJpYWwgPSBudWxsO1xyXG4vL1xyXG4vL1x0XHRcdFx0dGhpcy5fcENvbnRleHQuc2V0RGVwdGhUZXN0KGZhbHNlLCBhd2F5LmdsLkNvbnRleHRHTENvbXBhcmVNb2RlLkFMV0FZUyk7XHJcbi8vXHRcdFx0XHR0aGlzLmRyYXdTa3lib3goZW50aXR5Q29sbGVjdG9yKTtcclxuLy9cclxuLy9cdFx0XHR9XHJcbi8vXHJcbi8vXHRcdFx0dmFyIHdoaWNoOm51bWJlciA9IHRhcmdldD8gRGVmYXVsdFJlbmRlcmVyLlNDUkVFTl9QQVNTRVMgOiBEZWZhdWx0UmVuZGVyZXIuQUxMX1BBU1NFUztcclxuXHJcblx0XHR2YXIgc2hlZXQ6Q1NTU3R5bGVTaGVldCA9IDxDU1NTdHlsZVNoZWV0PiBkb2N1bWVudC5zdHlsZVNoZWV0c1tkb2N1bWVudC5zdHlsZVNoZWV0cy5sZW5ndGggLSAxXTtcclxuXHJcblx0XHRmb3IgKHZhciBpOm51bWJlciA9IDA7IGkgPCBzaGVldC5jc3NSdWxlcy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHR2YXIgc3R5bGU6TVNTdHlsZUNTU1Byb3BlcnRpZXMgPSAoPENTU1N0eWxlUnVsZT4gc2hlZXQuY3NzUnVsZXNbaV0pLnN0eWxlO1xyXG5cdFx0XHRzdHlsZS50cmFuc2Zvcm1cclxuXHRcdFx0XHQ9IHN0eWxlW1wiLXdlYmtpdC10cmFuc2Zvcm1cIl1cclxuXHRcdFx0XHQ9IHN0eWxlW1wiLW1vei10cmFuc2Zvcm1cIl1cclxuXHRcdFx0XHQ9IHN0eWxlW1wiLW8tdHJhbnNmb3JtXCJdXHJcblx0XHRcdFx0PSBzdHlsZVtcIi1tcy10cmFuc2Zvcm1cIl0gPSAoZW50aXR5Q29sbGVjdG9yLmNhbWVyYS5wcm9qZWN0aW9uLmNvb3JkaW5hdGVTeXN0ZW0gPT0gQ29vcmRpbmF0ZVN5c3RlbS5SSUdIVF9IQU5ERUQpPyBcIlwiIDogXCJzY2FsZTNkKDEsIC0xLCAxKSB0cmFuc2xhdGVZKC1cIiArIHN0eWxlLmhlaWdodCArIFwiKVwiO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMuZHJhd1JlbmRlcmFibGVzKHRoaXMuX3JlbmRlcmFibGVIZWFkLCBlbnRpdHlDb2xsZWN0b3IpO1xyXG5cclxuLy9cdFx0XHRpZiAodGhpcy5fYWN0aXZlTWF0ZXJpYWwpXHJcbi8vXHRcdFx0XHR0aGlzLl9hY3RpdmVNYXRlcmlhbC5pRGVhY3RpdmF0ZSh0aGlzLl9wU3RhZ2VHTCk7XHJcblxyXG5cdFx0dGhpcy5fYWN0aXZlTWF0ZXJpYWwgPSBudWxsO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogVXBkYXRlcyB0aGUgYmFja2J1ZmZlciBwcm9wZXJ0aWVzLlxyXG5cdCAqL1xyXG5cdHB1YmxpYyBwVXBkYXRlQmFja0J1ZmZlcigpXHJcblx0e1xyXG5cdFx0dGhpcy5fY29udGFpbmVyLnN0eWxlLndpZHRoID0gdGhpcy5fd2lkdGggKyBcInB4XCI7XHJcblx0XHR0aGlzLl9jb250YWluZXIuc3R5bGUuaGVpZ2h0ID0gdGhpcy5faGVpZ2h0ICsgXCJweFwiO1xyXG5cdFx0dGhpcy5fY29udGFpbmVyLnN0eWxlLmNsaXAgPSBcInJlY3QoMHB4LCBcIiArIHRoaXMuX3dpZHRoICsgXCJweCwgXCIgKyB0aGlzLl9oZWlnaHQgKyBcInB4LCAwcHgpXCI7XHJcblxyXG5cdFx0Ly91cGRhdGUgY29udGV4dCBtYXRyaXhcclxuXHRcdHRoaXMuX2NvbnRleHRNYXRyaXgucmF3RGF0YVswXSA9IHRoaXMuX3dpZHRoLzI7XHJcblx0XHR0aGlzLl9jb250ZXh0TWF0cml4LnJhd0RhdGFbNV0gPSAtdGhpcy5faGVpZ2h0LzI7XHJcblx0XHR0aGlzLl9jb250ZXh0TWF0cml4LnJhd0RhdGFbMTBdID0gLTE7IC8vZml4IGZvciBpbm5hY2N1cmF0ZSB6LXNvcnRcclxuXHRcdHRoaXMuX2NvbnRleHRNYXRyaXgucmF3RGF0YVsxMl0gPSB0aGlzLl93aWR0aC8yO1xyXG5cdFx0dGhpcy5fY29udGV4dE1hdHJpeC5yYXdEYXRhWzEzXSA9IHRoaXMuX2hlaWdodC8yO1xyXG5cclxuXHRcdC8vdXBkYXRlIGNvbnRleHQgdHJhbmZvcm1cclxuXHRcdHRoaXMuX2NvbnRleHRTdHlsZS50cmFuc2Zvcm1cclxuXHRcdFx0PSB0aGlzLl9jb250ZXh0U3R5bGVbXCItd2Via2l0LXRyYW5zZm9ybVwiXVxyXG5cdFx0XHQ9IHRoaXMuX2NvbnRleHRTdHlsZVtcIi1tb3otdHJhbnNmb3JtXCJdXHJcblx0XHRcdD0gdGhpcy5fY29udGV4dFN0eWxlW1wiLW8tdHJhbnNmb3JtXCJdXHJcblx0XHRcdD0gdGhpcy5fY29udGV4dFN0eWxlW1wiLW1zLXRyYW5zZm9ybVwiXSA9IHRoaXMuX2NvbnRleHRNYXRyaXgudG9TdHJpbmcoKTtcclxuXHJcblx0XHR0aGlzLl9wQmFja0J1ZmZlckludmFsaWQgPSBmYWxzZTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIERyYXcgdGhlIHNreWJveCBpZiBwcmVzZW50LlxyXG5cdCAqIEBwYXJhbSBlbnRpdHlDb2xsZWN0b3IgVGhlIEVudGl0eUNvbGxlY3RvciBjb250YWluaW5nIGFsbCBwb3RlbnRpYWxseSB2aXNpYmxlIGluZm9ybWF0aW9uLlxyXG5cdCAqL1xyXG5cdHByaXZhdGUgZHJhd1NreWJveChlbnRpdHlDb2xsZWN0b3I6Q1NTRW50aXR5Q29sbGVjdG9yKVxyXG5cdHtcclxuXHRcdC8vVE9ET1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogRHJhdyBhIGxpc3Qgb2YgcmVuZGVyYWJsZXMuXHJcblx0ICogQHBhcmFtIHJlbmRlcmFibGVzIFRoZSByZW5kZXJhYmxlcyB0byBkcmF3LlxyXG5cdCAqIEBwYXJhbSBlbnRpdHlDb2xsZWN0b3IgVGhlIEVudGl0eUNvbGxlY3RvciBjb250YWluaW5nIGFsbCBwb3RlbnRpYWxseSB2aXNpYmxlIGluZm9ybWF0aW9uLlxyXG5cdCAqL1xyXG5cdHByaXZhdGUgZHJhd1JlbmRlcmFibGVzKGl0ZW06Q1NTUmVuZGVyYWJsZUJhc2UsIGVudGl0eUNvbGxlY3RvcjpFbnRpdHlDb2xsZWN0b3IpXHJcblx0e1xyXG5cdFx0dmFyIHZpZXdQcm9qZWN0aW9uOk1hdHJpeDNEID0gZW50aXR5Q29sbGVjdG9yLmNhbWVyYS52aWV3UHJvamVjdGlvbi5jbG9uZSgpO1xyXG5cclxuXHRcdHdoaWxlIChpdGVtKSB7XHJcblx0XHRcdC8vdGhpcy5fYWN0aXZlTWF0ZXJpYWwgPSA8Q1NTTWF0ZXJpYWxCYXNlPiBpdGVtLm1hdGVyaWFsT3duZXIubWF0ZXJpYWw7XHJcblxyXG5cdFx0XHQvL3NlcmlhbGlzZSB0cmFuc2Zvcm0gYW5kIGFwcGx5IHRvIGh0bWwgZWxlbWVudFxyXG5cdFx0XHR0aGlzLl90cmFuc2Zvcm0uY29weVJhd0RhdGFGcm9tKGl0ZW0ucmVuZGVyU2NlbmVUcmFuc2Zvcm0ucmF3RGF0YSk7XHJcblx0XHRcdHRoaXMuX3RyYW5zZm9ybS5hcHBlbmQodmlld1Byb2plY3Rpb24pO1xyXG5cclxuXHRcdFx0dmFyIHN0eWxlOk1TU3R5bGVDU1NQcm9wZXJ0aWVzID0gaXRlbS5odG1sRWxlbWVudC5zdHlsZTtcclxuXHJcblx0XHRcdHN0eWxlLnRyYW5zZm9ybVxyXG5cdFx0XHRcdD0gc3R5bGVbXCItd2Via2l0LXRyYW5zZm9ybVwiXVxyXG5cdFx0XHRcdD0gc3R5bGVbXCItbW96LXRyYW5zZm9ybVwiXVxyXG5cdFx0XHRcdD0gc3R5bGVbXCItby10cmFuc2Zvcm1cIl1cclxuXHRcdFx0XHQ9IHN0eWxlW1wiLW1zLXRyYW5zZm9ybVwiXSA9IHRoaXMuX3RyYW5zZm9ybS50b1N0cmluZygpO1xyXG5cclxuXHRcdFx0c3R5bGUudHJhbnNmb3JtU3R5bGVcclxuXHRcdFx0XHQ9IHN0eWxlW1wiLXdlYmtpdC10cmFuc2Zvcm0tc3R5bGVcIl1cclxuXHRcdFx0XHQ9IHN0eWxlW1wiLW1vei10cmFuc2Zvcm0tc3R5bGVcIl1cclxuXHRcdFx0XHQ9IHN0eWxlW1wiLW8tdHJhbnNmb3JtLXN0eWxlXCJdXHJcblx0XHRcdFx0PSBzdHlsZVtcIi1tcy10cmFuc2Zvcm0tc3R5bGVcIl0gPSBcInByZXNlcnZlLTNkXCI7XHJcblxyXG5cdFx0XHQvL2NoZWNrIGlmIGNoaWxkIHJlcXVpcmVzIGFkZGluZyB0byB0aGUgdmlld1xyXG5cdFx0XHRpZiAoIXRoaXMuX2NvbnRleHQuY29udGFpbnMoaXRlbS5odG1sRWxlbWVudCkpXHJcblx0XHRcdFx0dGhpcy5fY29udGV4dC5hcHBlbmRDaGlsZChpdGVtLmh0bWxFbGVtZW50KTtcclxuXHJcblx0XHRcdGl0ZW0gPSBpdGVtLm5leHQ7XHJcblx0XHR9XHJcblxyXG4vL1x0XHRcdHZhciBudW1QYXNzZXM6bnVtYmVyO1xyXG4vL1x0XHRcdHZhciBqOm51bWJlcjtcclxuLy9cdFx0XHR2YXIgY2FtZXJhOmF3YXkuZW50aXRpZXMuQ2FtZXJhID0gZW50aXR5Q29sbGVjdG9yLmNhbWVyYTtcclxuLy9cdFx0XHR2YXIgaXRlbTI6YXdheS5yZW5kZXIuQ1NTUmVuZGVyYWJsZUJhc2U7XHJcbi8vXHJcbi8vXHRcdFx0d2hpbGUgKGl0ZW0pIHtcclxuLy9cdFx0XHRcdHRoaXMuX2FjdGl2ZU1hdGVyaWFsID0gaXRlbS5tYXRlcmlhbDtcclxuLy9cclxuLy9cdFx0XHRcdHRoaXMuX2FjdGl2ZU1hdGVyaWFsLmlVcGRhdGVNYXRlcmlhbCh0aGlzLl9wQ29udGV4dCk7XHJcbi8vXHJcbi8vXHRcdFx0XHRudW1QYXNzZXMgPSB0aGlzLl9hY3RpdmVNYXRlcmlhbC5faU51bVBhc3NlcztcclxuLy9cclxuLy9cdFx0XHRcdGogPSAwO1xyXG4vL1xyXG4vL1x0XHRcdFx0ZG8ge1xyXG4vL1x0XHRcdFx0XHRpdGVtMiA9IGl0ZW07XHJcbi8vXHJcbi8vXHRcdFx0XHRcdHZhciBydHRNYXNrOm51bWJlciA9IHRoaXMuX2FjdGl2ZU1hdGVyaWFsLmlQYXNzUmVuZGVyc1RvVGV4dHVyZShqKT8gMSA6IDI7XHJcbi8vXHJcbi8vXHRcdFx0XHRcdGlmICgocnR0TWFzayAmIHdoaWNoKSAhPSAwKSB7XHJcbi8vXHRcdFx0XHRcdFx0dGhpcy5fYWN0aXZlTWF0ZXJpYWwuaUFjdGl2YXRlUGFzcyhqLCB0aGlzLl9wU3RhZ2VHTCwgY2FtZXJhKTtcclxuLy9cclxuLy9cdFx0XHRcdFx0XHRkbyB7XHJcbi8vXHRcdFx0XHRcdFx0XHR0aGlzLl9hY3RpdmVNYXRlcmlhbC5pUmVuZGVyUGFzcyhqLCBpdGVtMiwgdGhpcy5fcFN0YWdlR0wsIGVudGl0eUNvbGxlY3Rvcik7XHJcbi8vXHJcbi8vXHRcdFx0XHRcdFx0XHRpdGVtMiA9IGl0ZW0yLm5leHQ7XHJcbi8vXHJcbi8vXHRcdFx0XHRcdFx0fSB3aGlsZSAoaXRlbTIgJiYgaXRlbTIubWF0ZXJpYWwgPT0gdGhpcy5fYWN0aXZlTWF0ZXJpYWwpO1xyXG4vL1xyXG4vL1x0XHRcdFx0XHRcdHRoaXMuX2FjdGl2ZU1hdGVyaWFsLmlEZWFjdGl2YXRlUGFzcyhqLCB0aGlzLl9wU3RhZ2VHTCk7XHJcbi8vXHJcbi8vXHRcdFx0XHRcdH0gZWxzZSB7XHJcbi8vXHRcdFx0XHRcdFx0ZG8ge1xyXG4vL1x0XHRcdFx0XHRcdFx0aXRlbTIgPSBpdGVtMi5uZXh0O1xyXG4vL1xyXG4vL1x0XHRcdFx0XHRcdH0gd2hpbGUgKGl0ZW0yICYmIGl0ZW0yLnJlbmRlcmFibGUubWF0ZXJpYWwgPT0gdGhpcy5fYWN0aXZlTWF0ZXJpYWwpO1xyXG4vL1x0XHRcdFx0XHR9XHJcbi8vXHRcdFx0XHR9IHdoaWxlICgrK2ogPCBudW1QYXNzZXMpO1xyXG4vL1xyXG4vL1x0XHRcdFx0aXRlbSA9IGl0ZW0yO1xyXG4vL1x0XHRcdH1cclxuXHR9XHJcblxyXG5cdHB1YmxpYyBkaXNwb3NlKClcclxuXHR7XHJcblx0XHRzdXBlci5kaXNwb3NlKCk7XHJcblxyXG5cdFx0Ly9UT0RPXHJcblx0fVxyXG5cclxuXHJcblx0cHVibGljIF9pQ3JlYXRlRW50aXR5Q29sbGVjdG9yKCk6Q29sbGVjdG9yQmFzZVxyXG5cdHtcclxuXHRcdHJldHVybiBuZXcgQ1NTRW50aXR5Q29sbGVjdG9yKCk7XHJcblx0fVxyXG59XHJcblxyXG5leHBvcnQgPSBDU1NEZWZhdWx0UmVuZGVyZXI7Il19