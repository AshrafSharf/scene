var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Matrix3D = require("awayjs-core/lib/geom/Matrix3D");
var Vector3D = require("awayjs-core/lib/geom/Vector3D");
var LightBase = require("awayjs-display/lib/base/LightBase");
var BoundsType = require("awayjs-display/lib/bounds/BoundsType");
var CubeMapShadowMapper = require("awayjs-display/lib/materials/shadowmappers/CubeMapShadowMapper");
var PointLight = (function (_super) {
    __extends(PointLight, _super);
    function PointLight() {
        _super.call(this);
        this._pRadius = 90000;
        this._pFallOff = 100000;
        this._pIsEntity = true;
        this._pFallOffFactor = 1 / (this._pFallOff * this._pFallOff - this._pRadius * this._pRadius);
        //default bounds type
        this._boundsType = BoundsType.SPHERE;
    }
    PointLight.prototype.pCreateShadowMapper = function () {
        return new CubeMapShadowMapper();
    };
    Object.defineProperty(PointLight.prototype, "radius", {
        get: function () {
            return this._pRadius;
        },
        set: function (value) {
            this._pRadius = value;
            if (this._pRadius < 0) {
                this._pRadius = 0;
            }
            else if (this._pRadius > this._pFallOff) {
                this._pFallOff = this._pRadius;
                this._pInvalidateBounds();
            }
            this._pFallOffFactor = 1 / (this._pFallOff * this._pFallOff - this._pRadius * this._pRadius);
        },
        enumerable: true,
        configurable: true
    });
    PointLight.prototype.iFallOffFactor = function () {
        return this._pFallOffFactor;
    };
    Object.defineProperty(PointLight.prototype, "fallOff", {
        get: function () {
            return this._pFallOff;
        },
        set: function (value) {
            this._pFallOff = value;
            if (this._pFallOff < 0)
                this._pFallOff = 0;
            if (this._pFallOff < this._pRadius)
                this._pRadius = this._pFallOff;
            this._pFallOffFactor = 1 / (this._pFallOff * this._pFallOff - this._pRadius * this._pRadius);
            this._pInvalidateBounds();
        },
        enumerable: true,
        configurable: true
    });
    PointLight.prototype._pUpdateSphereBounds = function () {
        _super.prototype._pUpdateSphereBounds.call(this);
        this._pSphereBounds.radius = this._pFallOff;
    };
    PointLight.prototype.iGetObjectProjectionMatrix = function (entity, camera, target) {
        if (target === void 0) { target = null; }
        var raw = new Array(16);
        var m = new Matrix3D();
        // todo: do not use lookAt on Light
        m.copyFrom(entity.getRenderSceneTransform(camera));
        m.append(this._pParent.inverseSceneTransform);
        this.lookAt(m.position);
        m.copyFrom(entity.getRenderSceneTransform(camera));
        m.append(this.inverseSceneTransform);
        var box = entity.getBox();
        var v1 = m.deltaTransformVector(new Vector3D(box.left, box.bottom, box.front));
        var v2 = m.deltaTransformVector(new Vector3D(box.right, box.top, box.back));
        var d1 = v1.x * v1.x + v1.y * v1.y + v1.z * v1.z;
        var d2 = v2.x * v2.x + v2.y * v2.y + v2.z * v2.z;
        var d = Math.sqrt(d1 > d2 ? d1 : d2);
        var zMin;
        var zMax;
        var z = m.rawData[14];
        zMin = z - d;
        zMax = z + d;
        raw[5] = raw[0] = zMin / d;
        raw[10] = zMax / (zMax - zMin);
        raw[11] = 1;
        raw[1] = raw[2] = raw[3] = raw[4] = raw[6] = raw[7] = raw[8] = raw[9] = raw[12] = raw[13] = raw[15] = 0;
        raw[14] = -zMin * raw[10];
        if (!target)
            target = new Matrix3D();
        target.copyRawDataFrom(raw);
        target.prepend(m);
        return target;
    };
    PointLight.prototype._iCollectRenderables = function (rendererPool) {
        //nothing to do here
    };
    PointLight.prototype._pRegisterEntity = function (partition) {
        partition._iRegisterPointLight(this);
    };
    PointLight.prototype._pUnregisterEntity = function (partition) {
        partition._iUnregisterPointLight(this);
    };
    return PointLight;
})(LightBase);
module.exports = PointLight;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9Qb2ludExpZ2h0LnRzIl0sIm5hbWVzIjpbIlBvaW50TGlnaHQiLCJQb2ludExpZ2h0LmNvbnN0cnVjdG9yIiwiUG9pbnRMaWdodC5wQ3JlYXRlU2hhZG93TWFwcGVyIiwiUG9pbnRMaWdodC5yYWRpdXMiLCJQb2ludExpZ2h0LmlGYWxsT2ZmRmFjdG9yIiwiUG9pbnRMaWdodC5mYWxsT2ZmIiwiUG9pbnRMaWdodC5fcFVwZGF0ZVNwaGVyZUJvdW5kcyIsIlBvaW50TGlnaHQuaUdldE9iamVjdFByb2plY3Rpb25NYXRyaXgiLCJQb2ludExpZ2h0Ll9pQ29sbGVjdFJlbmRlcmFibGVzIiwiUG9pbnRMaWdodC5fcFJlZ2lzdGVyRW50aXR5IiwiUG9pbnRMaWdodC5fcFVucmVnaXN0ZXJFbnRpdHkiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUNBLElBQU8sUUFBUSxXQUFnQiwrQkFBK0IsQ0FBQyxDQUFDO0FBQ2hFLElBQU8sUUFBUSxXQUFnQiwrQkFBK0IsQ0FBQyxDQUFDO0FBRWhFLElBQU8sU0FBUyxXQUFlLG1DQUFtQyxDQUFDLENBQUM7QUFDcEUsSUFBTyxVQUFVLFdBQWUsc0NBQXNDLENBQUMsQ0FBQztBQU94RSxJQUFPLG1CQUFtQixXQUFhLGdFQUFnRSxDQUFDLENBQUM7QUFFekcsSUFBTSxVQUFVO0lBQVNBLFVBQW5CQSxVQUFVQSxVQUFrQkE7SUFNakNBLFNBTktBLFVBQVVBO1FBUWRDLGlCQUFPQSxDQUFDQTtRQU5GQSxhQUFRQSxHQUFVQSxLQUFLQSxDQUFDQTtRQUN4QkEsY0FBU0EsR0FBVUEsTUFBTUEsQ0FBQ0E7UUFPaENBLElBQUlBLENBQUNBLFVBQVVBLEdBQUdBLElBQUlBLENBQUNBO1FBRXZCQSxJQUFJQSxDQUFDQSxlQUFlQSxHQUFHQSxDQUFDQSxHQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxTQUFTQSxHQUFDQSxJQUFJQSxDQUFDQSxTQUFTQSxHQUFHQSxJQUFJQSxDQUFDQSxRQUFRQSxH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LENBQUNBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBLENBQUNBLEdBQUNBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1FBQ2xEQSxJQUFJQSxFQUFFQSxHQUFVQSxFQUFFQSxDQUFDQSxDQUFDQSxHQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQSxDQUFDQSxHQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQSxDQUFDQSxHQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNsREEsSUFBSUEsQ0FBQ0EsR0FBVUEsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsRUFBRUEsR0FBR0EsRUFBRUEsR0FBRUEsRUFBRUEsR0FBR0EsRUFBRUEsQ0FBQ0EsQ0FBQ0E7UUFDM0NBLElBQUlBLElBQVdBLENBQUNBO1FBQ2hCQSxJQUFJQSxJQUFXQSxDQUFDQTtRQUVoQkEsSUFBSUEsQ0FBQ0EsR0FBVUEsQ0FBQ0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0E7UUFDN0JBLElBQUlBLEdBQUdBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1FBQ2JBLElBQUlBLEdBQUdBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1FBRWJBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLEdBQUNBLENBQUNBLENBQUNBO1FBQ3pCQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxJQUFJQSxHQUFDQSxDQUFDQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUM3QkEsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDWkEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDeEdBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLENBQUNBLElBQUlBLEdBQUNBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBO1FBRXhCQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxNQUFNQSxDQUFDQTtZQUNYQSxNQUFNQSxHQUFHQSxJQUFJQSxRQUFRQSxFQUFFQSxDQUFDQTtRQUV6QkEsTUFBTUEsQ0FBQ0EsZUFBZUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDNUJBLE1BQU1BLENBQUNBLE9BQU9BLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBRWxCQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQTtJQUNmQSxDQUFDQTtJQUVNUCx5Q0FBb0JBLEdBQTNCQSxVQUE0QkEsWUFBMEJBO1FBRXJEUSxvQkFBb0JBO0lBQ3JCQSxDQUFDQTtJQUVNUixxQ0FBZ0JBLEdBQXZCQSxVQUF3QkEsU0FBbUJBO1FBRTFDUyxTQUFTQSxDQUFDQSxvQkFBb0JBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO0lBQ3RDQSxDQUFDQTtJQUVNVCx1Q0FBa0JBLEdBQXpCQSxVQUEwQkEsU0FBbUJBO1FBRTVDVSxTQUFTQSxDQUFDQSxzQkFBc0JBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO0lBQ3hDQSxDQUFDQTtJQUNGVixpQkFBQ0E7QUFBREEsQ0EvSEEsQUErSENBLEVBL0h3QixTQUFTLEVBK0hqQztBQUVELEFBQW9CLGlCQUFYLFVBQVUsQ0FBQyIsImZpbGUiOiJlbnRpdGllcy9Qb2ludExpZ2h0LmpzIiwic291cmNlUm9vdCI6Ii4uLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBCb3hcdFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9nZW9tL0JveFwiKTtcclxuaW1wb3J0IE1hdHJpeDNEXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vTWF0cml4M0RcIik7XHJcbmltcG9ydCBWZWN0b3IzRFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9nZW9tL1ZlY3RvcjNEXCIpO1xyXG5cclxuaW1wb3J0IExpZ2h0QmFzZVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvYmFzZS9MaWdodEJhc2VcIik7XHJcbmltcG9ydCBCb3VuZHNUeXBlXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9ib3VuZHMvQm91bmRzVHlwZVwiKTtcclxuaW1wb3J0IFBhcnRpdGlvblx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvcGFydGl0aW9uL1BhcnRpdGlvblwiKTtcclxuaW1wb3J0IEVudGl0eU5vZGVcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL3BhcnRpdGlvbi9FbnRpdHlOb2RlXCIpO1xyXG5pbXBvcnQgUG9pbnRMaWdodE5vZGVcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9wYXJ0aXRpb24vUG9pbnRMaWdodE5vZGVcIik7XHJcbmltcG9ydCBJUmVuZGVyZXJQb29sXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvcG9vbC9JUmVuZGVyZXJQb29sXCIpO1xyXG5pbXBvcnQgQ2FtZXJhXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL0NhbWVyYVwiKTtcclxuaW1wb3J0IElFbnRpdHlcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvZW50aXRpZXMvSUVudGl0eVwiKTtcclxuaW1wb3J0IEN1YmVNYXBTaGFkb3dNYXBwZXJcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvbWF0ZXJpYWxzL3NoYWRvd21hcHBlcnMvQ3ViZU1hcFNoYWRvd01hcHBlclwiKTtcclxuXHJcbmNsYXNzIFBvaW50TGlnaHQgZXh0ZW5kcyBMaWdodEJhc2UgaW1wbGVtZW50cyBJRW50aXR5XHJcbntcclxuXHRwdWJsaWMgX3BSYWRpdXM6bnVtYmVyID0gOTAwMDA7XHJcblx0cHVibGljIF9wRmFsbE9mZjpudW1iZXIgPSAxMDAwMDA7XHJcblx0cHVibGljIF9wRmFsbE9mZkZhY3RvcjpudW1iZXI7XHJcblxyXG5cdGNvbnN0cnVjdG9yKClcclxuXHR7XHJcblx0XHRzdXBlcigpO1xyXG5cclxuXHRcdHRoaXMuX3BJc0VudGl0eSA9IHRydWU7XHJcblxyXG5cdFx0dGhpcy5fcEZhbGxPZmZGYWN0b3IgPSAxLyh0aGlzLl9wRmFsbE9mZip0aGlzLl9wRmFsbE9mZiAtIHRoaXMuX3BSYWRpdXMqdGhpcy5fcFJhZGl1cyk7XHJcblxyXG5cdFx0Ly9kZWZhdWx0IGJvdW5kcyB0eXBlXHJcblx0XHR0aGlzLl9ib3VuZHNUeXBlID0gQm91bmRzVHlwZS5TUEhFUkU7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgcENyZWF0ZVNoYWRvd01hcHBlcigpOkN1YmVNYXBTaGFkb3dNYXBwZXJcclxuXHR7XHJcblx0XHRyZXR1cm4gbmV3IEN1YmVNYXBTaGFkb3dNYXBwZXIoKTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBnZXQgcmFkaXVzKCk6bnVtYmVyXHJcblx0e1xyXG5cdFx0cmV0dXJuIHRoaXMuX3BSYWRpdXM7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgc2V0IHJhZGl1cyh2YWx1ZTpudW1iZXIpXHJcblx0e1xyXG5cdFx0dGhpcy5fcFJhZGl1cyA9IHZhbHVlO1xyXG5cclxuXHRcdGlmICh0aGlzLl9wUmFkaXVzIDwgMCkge1xyXG5cdFx0XHR0aGlzLl9wUmFkaXVzID0gMDtcclxuXHRcdH0gZWxzZSBpZiAodGhpcy5fcFJhZGl1cyA+IHRoaXMuX3BGYWxsT2ZmKSB7XHJcblx0XHRcdHRoaXMuX3BGYWxsT2ZmID0gdGhpcy5fcFJhZGl1cztcclxuXHRcdFx0dGhpcy5fcEludmFsaWRhdGVCb3VuZHMoKTtcclxuXHRcdH1cclxuXHRcdHRoaXMuX3BGYWxsT2ZmRmFjdG9yID0gMS8oIHRoaXMuX3BGYWxsT2ZmKnRoaXMuX3BGYWxsT2ZmIC0gdGhpcy5fcFJhZGl1cyp0aGlzLl9wUmFkaXVzICk7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgaUZhbGxPZmZGYWN0b3IoKTpudW1iZXJcclxuXHR7XHJcblx0XHRyZXR1cm4gdGhpcy5fcEZhbGxPZmZGYWN0b3I7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgZ2V0IGZhbGxPZmYoKTpudW1iZXJcclxuXHR7XHJcblx0XHRyZXR1cm4gdGhpcy5fcEZhbGxPZmY7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgc2V0IGZhbGxPZmYodmFsdWU6bnVtYmVyKVxyXG5cdHtcclxuXHRcdHRoaXMuX3BGYWxsT2ZmID0gdmFsdWU7XHJcblxyXG5cdFx0aWYgKHRoaXMuX3BGYWxsT2ZmIDwgMClcclxuXHRcdFx0dGhpcy5fcEZhbGxPZmYgPSAwO1xyXG5cclxuXHRcdGlmICh0aGlzLl9wRmFsbE9mZiA8IHRoaXMuX3BSYWRpdXMpXHJcblx0XHRcdHRoaXMuX3BSYWRpdXMgPSB0aGlzLl9wRmFsbE9mZjtcclxuXHJcblx0XHR0aGlzLl9wRmFsbE9mZkZhY3RvciA9IDEvKCB0aGlzLl9wRmFsbE9mZip0aGlzLl9wRmFsbE9mZiAtIHRoaXMuX3BSYWRpdXMqdGhpcy5fcFJhZGl1cyk7XHJcblx0XHR0aGlzLl9wSW52YWxpZGF0ZUJvdW5kcygpO1xyXG5cdH1cclxuXHJcblx0cHVibGljIF9wVXBkYXRlU3BoZXJlQm91bmRzKClcclxuXHR7XHJcblx0XHRzdXBlci5fcFVwZGF0ZVNwaGVyZUJvdW5kcygpO1xyXG5cclxuXHRcdHRoaXMuX3BTcGhlcmVCb3VuZHMucmFkaXVzID0gdGhpcy5fcEZhbGxPZmY7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgaUdldE9iamVjdFByb2plY3Rpb25NYXRyaXgoZW50aXR5OklFbnRpdHksIGNhbWVyYTpDYW1lcmEsIHRhcmdldDpNYXRyaXgzRCA9IG51bGwpOk1hdHJpeDNEXHJcblx0e1xyXG5cdFx0dmFyIHJhdzpudW1iZXJbXSA9IG5ldyBBcnJheTxudW1iZXI+KDE2KTtcclxuXHRcdHZhciBtOk1hdHJpeDNEID0gbmV3IE1hdHJpeDNEKCk7XHJcblxyXG5cdFx0Ly8gdG9kbzogZG8gbm90IHVzZSBsb29rQXQgb24gTGlnaHRcclxuXHRcdG0uY29weUZyb20oZW50aXR5LmdldFJlbmRlclNjZW5lVHJhbnNmb3JtKGNhbWVyYSkpO1xyXG5cdFx0bS5hcHBlbmQodGhpcy5fcFBhcmVudC5pbnZlcnNlU2NlbmVUcmFuc2Zvcm0pO1xyXG5cdFx0dGhpcy5sb29rQXQobS5wb3NpdGlvbik7XHJcblxyXG5cdFx0bS5jb3B5RnJvbShlbnRpdHkuZ2V0UmVuZGVyU2NlbmVUcmFuc2Zvcm0oY2FtZXJhKSk7XHJcblx0XHRtLmFwcGVuZCh0aGlzLmludmVyc2VTY2VuZVRyYW5zZm9ybSk7XHJcblxyXG5cdFx0dmFyIGJveDpCb3ggPSBlbnRpdHkuZ2V0Qm94KCk7XHJcblx0XHR2YXIgdjE6VmVjdG9yM0QgPSBtLmRlbHRhVHJhbnNmb3JtVmVjdG9yKG5ldyBWZWN0b3IzRChib3gubGVmdCwgYm94LmJvdHRvbSwgYm94LmZyb250KSk7XHJcblx0XHR2YXIgdjI6VmVjdG9yM0QgPSBtLmRlbHRhVHJhbnNmb3JtVmVjdG9yKG5ldyBWZWN0b3IzRChib3gucmlnaHQsIGJveC50b3AsIGJveC5iYWNrKSk7XHJcblx0XHR2YXIgZDE6bnVtYmVyID0gdjEueCp2MS54ICsgdjEueSp2MS55ICsgdjEueip2MS56O1xyXG5cdFx0dmFyIGQyOm51bWJlciA9IHYyLngqdjIueCArIHYyLnkqdjIueSArIHYyLnoqdjIuejtcclxuXHRcdHZhciBkOm51bWJlciA9IE1hdGguc3FydChkMSA+IGQyPyBkMSA6IGQyKTtcclxuXHRcdHZhciB6TWluOm51bWJlcjtcclxuXHRcdHZhciB6TWF4Om51bWJlcjtcclxuXHJcblx0XHR2YXIgejpudW1iZXIgPSBtLnJhd0RhdGFbMTRdO1xyXG5cdFx0ek1pbiA9IHogLSBkO1xyXG5cdFx0ek1heCA9IHogKyBkO1xyXG5cclxuXHRcdHJhd1s1XSA9IHJhd1swXSA9IHpNaW4vZDtcclxuXHRcdHJhd1sxMF0gPSB6TWF4Lyh6TWF4IC0gek1pbik7XHJcblx0XHRyYXdbMTFdID0gMTtcclxuXHRcdHJhd1sxXSA9IHJhd1syXSA9IHJhd1szXSA9IHJhd1s0XSA9IHJhd1s2XSA9IHJhd1s3XSA9IHJhd1s4XSA9IHJhd1s5XSA9IHJhd1sxMl0gPSByYXdbMTNdID0gcmF3WzE1XSA9IDA7XHJcblx0XHRyYXdbMTRdID0gLXpNaW4qcmF3WzEwXTtcclxuXHJcblx0XHRpZiAoIXRhcmdldClcclxuXHRcdFx0dGFyZ2V0ID0gbmV3IE1hdHJpeDNEKCk7XHJcblxyXG5cdFx0dGFyZ2V0LmNvcHlSYXdEYXRhRnJvbShyYXcpO1xyXG5cdFx0dGFyZ2V0LnByZXBlbmQobSk7XHJcblxyXG5cdFx0cmV0dXJuIHRhcmdldDtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBfaUNvbGxlY3RSZW5kZXJhYmxlcyhyZW5kZXJlclBvb2w6SVJlbmRlcmVyUG9vbClcclxuXHR7XHJcblx0XHQvL25vdGhpbmcgdG8gZG8gaGVyZVxyXG5cdH1cclxuXHJcblx0cHVibGljIF9wUmVnaXN0ZXJFbnRpdHkocGFydGl0aW9uOlBhcnRpdGlvbilcclxuXHR7XHJcblx0XHRwYXJ0aXRpb24uX2lSZWdpc3RlclBvaW50TGlnaHQodGhpcyk7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgX3BVbnJlZ2lzdGVyRW50aXR5KHBhcnRpdGlvbjpQYXJ0aXRpb24pXHJcblx0e1xyXG5cdFx0cGFydGl0aW9uLl9pVW5yZWdpc3RlclBvaW50TGlnaHQodGhpcyk7XHJcblx0fVxyXG59XHJcblxyXG5leHBvcnQgPSBQb2ludExpZ2h0OyJdfQ==