var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Matrix3D = require("awayjs-core/lib/geom/Matrix3D");
var Plane3D = require("awayjs-core/lib/geom/Plane3D");
var AssetType = require("awayjs-core/lib/library/AssetType");
var ProjectionEvent = require("awayjs-core/lib/events/ProjectionEvent");
var PerspectiveProjection = require("awayjs-core/lib/projections/PerspectiveProjection");
var BoundsType = require("awayjs-display/lib/bounds/BoundsType");
var DisplayObjectContainer = require("awayjs-display/lib/containers/DisplayObjectContainer");
var CameraEvent = require("awayjs-display/lib/events/CameraEvent");
var Camera = (function (_super) {
    __extends(Camera, _super);
    function Camera(projection) {
        var _this = this;
        if (projection === void 0) { projection = null; }
        _super.call(this);
        this._viewProjection = new Matrix3D();
        this._viewProjectionDirty = true;
        this._frustumPlanesDirty = true;
        this._pIsEntity = true;
        this._onProjectionMatrixChangedDelegate = function (event) { return _this.onProjectionMatrixChanged(event); };
        this._projection = projection || new PerspectiveProjection();
        this._projection.addEventListener(ProjectionEvent.MATRIX_CHANGED, this._onProjectionMatrixChangedDelegate);
        this._frustumPlanes = [];
        for (var i = 0; i < 6; ++i)
            this._frustumPlanes[i] = new Plane3D();
        this.z = -1000;
        //default bounds type
        this._boundsType = BoundsType.NULL;
    }
    Object.defineProperty(Camera.prototype, "assetType", {
        //@override
        get: function () {
            return AssetType.CAMERA;
        },
        enumerable: true,
        configurable: true
    });
    Camera.prototype.onProjectionMatrixChanged = function (event) {
        this._viewProjectionDirty = true;
        this._frustumPlanesDirty = true;
        this.dispatchEvent(event);
    };
    Object.defineProperty(Camera.prototype, "frustumPlanes", {
        get: function () {
            if (this._frustumPlanesDirty)
                this.updateFrustum();
            return this._frustumPlanes;
        },
        enumerable: true,
        configurable: true
    });
    Camera.prototype.updateFrustum = function () {
        var a, b, c;
        //var d : Number;
        var c11, c12, c13, c14;
        var c21, c22, c23, c24;
        var c31, c32, c33, c34;
        var c41, c42, c43, c44;
        var p;
        var raw = new Array(16);
        ;
        var invLen;
        this.viewProjection.copyRawDataTo(raw);
        c11 = raw[0];
        c12 = raw[4];
        c13 = raw[8];
        c14 = raw[12];
        c21 = raw[1];
        c22 = raw[5];
        c23 = raw[9];
        c24 = raw[13];
        c31 = raw[2];
        c32 = raw[6];
        c33 = raw[10];
        c34 = raw[14];
        c41 = raw[3];
        c42 = raw[7];
        c43 = raw[11];
        c44 = raw[15];
        // left plane
        p = this._frustumPlanes[0];
        a = c41 + c11;
        b = c42 + c12;
        c = c43 + c13;
        invLen = 1 / Math.sqrt(a * a + b * b + c * c);
        p.a = a * invLen;
        p.b = b * invLen;
        p.c = c * invLen;
        p.d = -(c44 + c14) * invLen;
        // right plane
        p = this._frustumPlanes[1];
        a = c41 - c11;
        b = c42 - c12;
        c = c43 - c13;
        invLen = 1 / Math.sqrt(a * a + b * b + c * c);
        p.a = a * invLen;
        p.b = b * invLen;
        p.c = c * invLen;
        p.d = (c14 - c44) * invLen;
        // bottom
        p = this._frustumPlanes[2];
        a = c41 + c21;
        b = c42 + c22;
        c = c43 + c23;
        invLen = 1 / Math.sqrt(a * a + b * b + c * c);
        p.a = a * invLen;
        p.b = b * invLen;
        p.c = c * invLen;
        p.d = -(c44 + c24) * invLen;
        // top
        p = this._frustumPlanes[3];
        a = c41 - c21;
        b = c42 - c22;
        c = c43 - c23;
        invLen = 1 / Math.sqrt(a * a + b * b + c * c);
        p.a = a * invLen;
        p.b = b * invLen;
        p.c = c * invLen;
        p.d = (c24 - c44) * invLen;
        // near
        p = this._frustumPlanes[4];
        a = c31;
        b = c32;
        c = c33;
        invLen = 1 / Math.sqrt(a * a + b * b + c * c);
        p.a = a * invLen;
        p.b = b * invLen;
        p.c = c * invLen;
        p.d = -c34 * invLen;
        // far
        p = this._frustumPlanes[5];
        a = c41 - c31;
        b = c42 - c32;
        c = c43 - c33;
        invLen = 1 / Math.sqrt(a * a + b * b + c * c);
        p.a = a * invLen;
        p.b = b * invLen;
        p.c = c * invLen;
        p.d = (c34 - c44) * invLen;
        this._frustumPlanesDirty = false;
    };
    /**
     * @protected
     */
    Camera.prototype.pInvalidateSceneTransform = function () {
        _super.prototype.pInvalidateSceneTransform.call(this);
        this._viewProjectionDirty = true;
        this._frustumPlanesDirty = true;
    };
    Object.defineProperty(Camera.prototype, "projection", {
        /**
         *
         */
        get: function () {
            return this._projection;
        },
        set: function (value) {
            if (this._projection == value)
                return;
            if (!value)
                throw new Error("Projection cannot be null!");
            this._projection.removeEventListener(ProjectionEvent.MATRIX_CHANGED, this._onProjectionMatrixChangedDelegate);
            this._projection = value;
            this._projection.addEventListener(ProjectionEvent.MATRIX_CHANGED, this._onProjectionMatrixChangedDelegate);
            this.dispatchEvent(new CameraEvent(CameraEvent.PROJECTION_CHANGED, this));
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Camera.prototype, "viewProjection", {
        /**
         *
         */
        get: function () {
            if (this._viewProjectionDirty) {
                this._viewProjection.copyFrom(this.inverseSceneTransform);
                this._viewProjection.append(this._projection.matrix);
                this._viewProjectionDirty = false;
            }
            return this._viewProjection;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Calculates the ray in scene space from the camera to the given normalized coordinates in screen space.
     *
     * @param nX The normalised x coordinate in screen space, -1 corresponds to the left edge of the viewport, 1 to the right.
     * @param nY The normalised y coordinate in screen space, -1 corresponds to the top edge of the viewport, 1 to the bottom.
     * @param sZ The z coordinate in screen space, representing the distance into the screen.
     * @return The ray from the camera to the scene space position of the given screen coordinates.
     */
    Camera.prototype.getRay = function (nX, nY, sZ) {
        return this.sceneTransform.deltaTransformVector(this._projection.unproject(nX, nY, sZ));
    };
    /**
     * Calculates the normalised position in screen space of the given scene position.
     *
     * @param point3d the position vector of the scene coordinates to be projected.
     * @return The normalised screen position of the given scene coordinates.
     */
    Camera.prototype.project = function (point3d) {
        return this._projection.project(this.inverseSceneTransform.transformVector(point3d));
    };
    /**
     * Calculates the scene position of the given normalized coordinates in screen space.
     *
     * @param nX The normalised x coordinate in screen space, minus the originX offset of the projection property.
     * @param nY The normalised y coordinate in screen space, minus the originY offset of the projection property.
     * @param sZ The z coordinate in screen space, representing the distance into the screen.
     * @return The scene position of the given screen coordinates.
     */
    Camera.prototype.unproject = function (nX, nY, sZ) {
        return this.sceneTransform.transformVector(this._projection.unproject(nX, nY, sZ));
    };
    Camera.prototype._iCollectRenderables = function (rendererPool) {
        // Since this getter is invoked every iteration of the render loop, and
        // the prefab construct could affect the sub-meshes, the prefab is
        // validated here to give it a chance to rebuild.
        if (this._iSourcePrefab)
            this._iSourcePrefab._iValidate();
        this._iCollectRenderable(rendererPool);
    };
    Camera.prototype._iCollectRenderable = function (rendererPool) {
        //nothing to do here
    };
    Camera.prototype._pRegisterEntity = function (partition) {
        partition._iRegisterCamera(this);
    };
    Camera.prototype._pUnregisterEntity = function (partition) {
        partition._iUnregisterCamera(this);
    };
    return Camera;
})(DisplayObjectContainer);
module.exports = Camera;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9DYW1lcmEudHMiXSwibmFtZXMiOlsiQ2FtZXJhIiwiQ2FtZXJhLmNvbnN0cnVjdG9yIiwiQ2FtZXJhLmFzc2V0VHlwZSIsIkNhbWVyYS5vblByb2plY3Rpb25NYXRyaXhDaGFuZ2VkIiwiQ2FtZXJhLmZydXN0dW1QbGFuZXMiLCJDYW1lcmEudXBkYXRlRnJ1c3R1bSIsIkNhbWVyYS5wSW52YWxpZGF0ZVNjZW5lVHJhbnNmb3JtIiwiQ2FtZXJhLnByb2plY3Rpb24iLCJDYW1lcmEudmlld1Byb2plY3Rpb24iLCJDYW1lcmEuZ2V0UmF5IiwiQ2FtZXJhLnByb2plY3QiLCJDYW1lcmEudW5wcm9qZWN0IiwiQ2FtZXJhLl9pQ29sbGVjdFJlbmRlcmFibGVzIiwiQ2FtZXJhLl9pQ29sbGVjdFJlbmRlcmFibGUiLCJDYW1lcmEuX3BSZWdpc3RlckVudGl0eSIsIkNhbWVyYS5fcFVucmVnaXN0ZXJFbnRpdHkiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLElBQU8sUUFBUSxXQUFnQiwrQkFBK0IsQ0FBQyxDQUFDO0FBQ2hFLElBQU8sT0FBTyxXQUFnQiw4QkFBOEIsQ0FBQyxDQUFDO0FBRTlELElBQU8sU0FBUyxXQUFlLG1DQUFtQyxDQUFDLENBQUM7QUFDcEUsSUFBTyxlQUFlLFdBQWMsd0NBQXdDLENBQUMsQ0FBQztBQUU5RSxJQUFPLHFCQUFxQixXQUFZLG1EQUFtRCxDQUFDLENBQUM7QUFFN0YsSUFBTyxVQUFVLFdBQWUsc0NBQXNDLENBQUMsQ0FBQztBQUN4RSxJQUFPLHNCQUFzQixXQUFZLHNEQUFzRCxDQUFDLENBQUM7QUFHakcsSUFBTyxXQUFXLFdBQWUsdUNBQXVDLENBQUMsQ0FBQztBQU0xRSxJQUFNLE1BQU07SUFBU0EsVUFBZkEsTUFBTUEsVUFBK0JBO0lBUzFDQSxTQVRLQSxNQUFNQSxDQVNDQSxVQUE2QkE7UUFUMUNDLGlCQXNRQ0E7UUE3UFlBLDBCQUE2QkEsR0FBN0JBLGlCQUE2QkE7UUFFeENB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QUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQ2JBLEdBQUdBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQ2JBLEdBQUdBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQ2JBLEdBQUdBLEdBQUdBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBO1FBQ2RBLEdBQUdBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQ2JBLEdBQUdBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQ2JBLEdBQUdBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQ2JBLEdBQUdBLEdBQUdBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBO1FBQ2RBLEdBQUdBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQ2JBLEdBQUdBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQ2JBLEdBQUdBLEdBQUdBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBO1FBQ2RBLEdBQUdBLEdBQUdBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBO1FBQ2RBLEdBQUdBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQ2JBLEdBQUdBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQ2JBLEdBQUdBLEdBQUdBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBO1FBQ2RBLEdBQUdBLEdBQUdBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBO1FBRWRBLEFBQ0FBLGFBRGFBO1FBQ2JBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLGNBQWNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQzNCQSxDQUFDQSxHQUFHQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQTtRQUNkQSxDQUFDQSxHQUFHQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQTtRQUNkQSxDQUFDQSxHQUFHQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQTtRQUNkQSxNQUFNQSxHQUFHQSxDQUFDQSxHQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxHQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUN0Q0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsTUFBTUEsQ0FBQ0E7UUFDZkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsTUFBTUEsQ0FBQ0E7UUFDZkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsTUFBTUEsQ0FBQ0E7UUFDZkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsTUFBTUEsQ0FBQ0E7UUFFMUJBLEFBQ0FBLGNBRGNBO1FBQ2RBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLGNBQWNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQzNCQSxDQUFDQSxHQUFHQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQTtRQUNkQSxDQUFDQSxHQUFHQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQTtRQUNkQSxDQUFDQSxHQUFHQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQTtRQUNkQSxNQUFNQSxHQUFHQSxDQUFDQSxHQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxHQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUN0Q0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsTUFBTUEsQ0FBQ0E7UUFDZkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsTUFBTUEsQ0FBQ0E7UUFDZkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsTUFBTUEsQ0FBQ0E7UUFDZkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsTUFBTUEsQ0FBQ0E7UUFFekJBLEFBQ0FBLFNBRFNBO1FBQ1RBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLGNBQWNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQzNCQSxDQUFDQSxHQUFHQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQTtRQUNkQSxDQUFDQSxHQUFHQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQTtRQUNkQSxDQUFDQSxHQUFHQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQTtRQUNkQSxNQUFNQSxHQUFHQSxDQUFDQSxHQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxHQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUN0Q0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsTUFBTUEsQ0FBQ0E7UUFDZkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsTUFBTUEsQ0FBQ0E7UUFDZkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsTUFBTUEsQ0FBQ0E7UUFDZkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsTUFBTUEsQ0FBQ0E7UUFFMUJBLEFBQ0FBLE1BRE1BO1FBQ05BLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLGNBQWNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQzNCQSxDQUFDQSxHQUFHQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQTtRQUNkQSxDQUFDQSxHQUFHQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQTtRQUNkQSxDQUFDQSxHQUFHQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQTtRQUNkQSxNQUFNQSxHQUFHQSxDQUFDQSxHQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxHQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUN0Q0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsTUFBTUEsQ0FBQ0E7UUFDZkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsTUFBTUEsQ0FBQ0E7UUFDZkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsTUFBTUEsQ0FBQ0E7UUFDZkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsTUFBTUEsQ0FBQ0E7UUFFekJBLEFBQ0FBLE9BRE9BO1FBQ1BBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLGNBQWNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQzNCQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQTtRQUNSQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQTtRQUNSQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQTtRQUNSQSxNQUFNQSxHQUFHQSxDQUFDQSxHQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxHQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUN0Q0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsTUFBTUEsQ0FBQ0E7UUFDZkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsTUFBTUEsQ0FBQ0E7UUFDZkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsTUFBTUEsQ0FBQ0E7UUFDZkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBR0EsR0FBQ0EsTUFBTUEsQ0FBQ0E7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Q0EsWUFBWUEsQ0FBQ0EsQ0FBQ0E7SUFDeENBLENBQUNBO0lBRU1aLG9DQUFtQkEsR0FBMUJBLFVBQTJCQSxZQUEwQkE7UUFFcERhLG9CQUFvQkE7SUFDckJBLENBQUNBO0lBRU1iLGlDQUFnQkEsR0FBdkJBLFVBQXdCQSxTQUFtQkE7UUFFMUNjLFNBQVNBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7SUFDbENBLENBQUNBO0lBRU1kLG1DQUFrQkEsR0FBekJBLFVBQTBCQSxTQUFtQkE7UUFFNUNlLFNBQVNBLENBQUNBLGtCQUFrQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7SUFDcENBLENBQUNBO0lBQ0ZmLGFBQUNBO0FBQURBLENBdFFBLEFBc1FDQSxFQXRRb0Isc0JBQXNCLEVBc1ExQztBQUVELEFBQWdCLGlCQUFQLE1BQU0sQ0FBQyIsImZpbGUiOiJlbnRpdGllcy9DYW1lcmEuanMiLCJzb3VyY2VSb290IjoiLi4vIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IE1hdHJpeDNEXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vTWF0cml4M0RcIik7XHJcbmltcG9ydCBQbGFuZTNEXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vUGxhbmUzRFwiKTtcclxuaW1wb3J0IFZlY3RvcjNEXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vVmVjdG9yM0RcIik7XHJcbmltcG9ydCBBc3NldFR5cGVcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2xpYnJhcnkvQXNzZXRUeXBlXCIpO1xyXG5pbXBvcnQgUHJvamVjdGlvbkV2ZW50XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZXZlbnRzL1Byb2plY3Rpb25FdmVudFwiKTtcclxuaW1wb3J0IElQcm9qZWN0aW9uXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9wcm9qZWN0aW9ucy9JUHJvamVjdGlvblwiKTtcclxuaW1wb3J0IFBlcnNwZWN0aXZlUHJvamVjdGlvblx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvcHJvamVjdGlvbnMvUGVyc3BlY3RpdmVQcm9qZWN0aW9uXCIpO1xyXG5cclxuaW1wb3J0IEJvdW5kc1R5cGVcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2JvdW5kcy9Cb3VuZHNUeXBlXCIpO1xyXG5pbXBvcnQgRGlzcGxheU9iamVjdENvbnRhaW5lclx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvY29udGFpbmVycy9EaXNwbGF5T2JqZWN0Q29udGFpbmVyXCIpO1xyXG5pbXBvcnQgUGFydGl0aW9uXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9wYXJ0aXRpb24vUGFydGl0aW9uXCIpO1xyXG5pbXBvcnQgSUVudGl0eVx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9JRW50aXR5XCIpO1xyXG5pbXBvcnQgQ2FtZXJhRXZlbnRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2V2ZW50cy9DYW1lcmFFdmVudFwiKTtcclxuaW1wb3J0IENhbWVyYU5vZGVcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL3BhcnRpdGlvbi9DYW1lcmFOb2RlXCIpO1xyXG5pbXBvcnQgRW50aXR5Tm9kZVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvcGFydGl0aW9uL0VudGl0eU5vZGVcIik7XHJcbmltcG9ydCBJUmVuZGVyZXJQb29sXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvcG9vbC9JUmVuZGVyZXJQb29sXCIpO1xyXG5cclxuXHJcbmNsYXNzIENhbWVyYSBleHRlbmRzIERpc3BsYXlPYmplY3RDb250YWluZXIgaW1wbGVtZW50cyBJRW50aXR5XHJcbntcclxuXHRwcml2YXRlIF92aWV3UHJvamVjdGlvbjpNYXRyaXgzRCA9IG5ldyBNYXRyaXgzRCgpO1xyXG5cdHByaXZhdGUgX3ZpZXdQcm9qZWN0aW9uRGlydHk6Qm9vbGVhbiA9IHRydWU7XHJcblx0cHJpdmF0ZSBfcHJvamVjdGlvbjpJUHJvamVjdGlvbjtcclxuXHRwcml2YXRlIF9mcnVzdHVtUGxhbmVzOkFycmF5PFBsYW5lM0Q+O1xyXG5cdHByaXZhdGUgX2ZydXN0dW1QbGFuZXNEaXJ0eTpCb29sZWFuID0gdHJ1ZTtcclxuXHRwcml2YXRlIF9vblByb2plY3Rpb25NYXRyaXhDaGFuZ2VkRGVsZWdhdGU6KGV2ZW50OlByb2plY3Rpb25FdmVudCkgPT4gdm9pZDtcclxuXHJcblx0Y29uc3RydWN0b3IocHJvamVjdGlvbjpJUHJvamVjdGlvbiA9IG51bGwpXHJcblx0e1xyXG5cdFx0c3VwZXIoKTtcclxuXHJcblx0XHR0aGlzLl9wSXNFbnRpdHkgPSB0cnVlO1xyXG5cclxuXHRcdHRoaXMuX29uUHJvamVjdGlvbk1hdHJpeENoYW5nZWREZWxlZ2F0ZSA9IChldmVudDpQcm9qZWN0aW9uRXZlbnQpID0+IHRoaXMub25Qcm9qZWN0aW9uTWF0cml4Q2hhbmdlZChldmVudCk7XHJcblxyXG5cdFx0dGhpcy5fcHJvamVjdGlvbiA9IHByb2plY3Rpb24gfHwgbmV3IFBlcnNwZWN0aXZlUHJvamVjdGlvbigpO1xyXG5cdFx0dGhpcy5fcHJvamVjdGlvbi5hZGRFdmVudExpc3RlbmVyKFByb2plY3Rpb25FdmVudC5NQVRSSVhfQ0hBTkdFRCwgdGhpcy5fb25Qcm9qZWN0aW9uTWF0cml4Q2hhbmdlZERlbGVnYXRlKTtcclxuXHJcblx0XHR0aGlzLl9mcnVzdHVtUGxhbmVzID0gW107XHJcblxyXG5cdFx0Zm9yICh2YXIgaTpudW1iZXIgPSAwOyBpIDwgNjsgKytpKVxyXG5cdFx0XHR0aGlzLl9mcnVzdHVtUGxhbmVzW2ldID0gbmV3IFBsYW5lM0QoKTtcclxuXHJcblx0XHR0aGlzLnogPSAtMTAwMDtcclxuXHJcblx0XHQvL2RlZmF1bHQgYm91bmRzIHR5cGVcclxuXHRcdHRoaXMuX2JvdW5kc1R5cGUgPSBCb3VuZHNUeXBlLk5VTEw7XHJcblx0fVxyXG5cclxuXHQvL0BvdmVycmlkZVxyXG5cdHB1YmxpYyBnZXQgYXNzZXRUeXBlKCk6c3RyaW5nXHJcblx0e1xyXG5cdFx0cmV0dXJuIEFzc2V0VHlwZS5DQU1FUkE7XHJcblx0fVxyXG5cclxuXHRwcml2YXRlIG9uUHJvamVjdGlvbk1hdHJpeENoYW5nZWQoZXZlbnQ6UHJvamVjdGlvbkV2ZW50KVxyXG5cdHtcclxuXHRcdHRoaXMuX3ZpZXdQcm9qZWN0aW9uRGlydHkgPSB0cnVlO1xyXG5cdFx0dGhpcy5fZnJ1c3R1bVBsYW5lc0RpcnR5ID0gdHJ1ZTtcclxuXHRcdHRoaXMuZGlzcGF0Y2hFdmVudChldmVudCk7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgZ2V0IGZydXN0dW1QbGFuZXMoKTpBcnJheTxQbGFuZTNEPlxyXG5cdHtcclxuXHRcdGlmICh0aGlzLl9mcnVzdHVtUGxhbmVzRGlydHkpXHJcblx0XHRcdHRoaXMudXBkYXRlRnJ1c3R1bSgpO1xyXG5cclxuXHRcdHJldHVybiB0aGlzLl9mcnVzdHVtUGxhbmVzO1xyXG5cdH1cclxuXHJcblx0cHJpdmF0ZSB1cGRhdGVGcnVzdHVtKClcclxuXHR7XHJcblx0XHR2YXIgYTpudW1iZXIsIGI6bnVtYmVyLCBjOm51bWJlcjtcclxuXHRcdC8vdmFyIGQgOiBOdW1iZXI7XHJcblx0XHR2YXIgYzExOm51bWJlciwgYzEyOm51bWJlciwgYzEzOm51bWJlciwgYzE0Om51bWJlcjtcclxuXHRcdHZhciBjMjE6bnVtYmVyLCBjMjI6bnVtYmVyLCBjMjM6bnVtYmVyLCBjMjQ6bnVtYmVyO1xyXG5cdFx0dmFyIGMzMTpudW1iZXIsIGMzMjpudW1iZXIsIGMzMzpudW1iZXIsIGMzNDpudW1iZXI7XHJcblx0XHR2YXIgYzQxOm51bWJlciwgYzQyOm51bWJlciwgYzQzOm51bWJlciwgYzQ0Om51bWJlcjtcclxuXHRcdHZhciBwOlBsYW5lM0Q7XHJcblx0XHR2YXIgcmF3Om51bWJlcltdID0gbmV3IEFycmF5PG51bWJlcj4oMTYpO1xyXG5cdFx0Oy8vbmV3IEFycmF5KDE2ICk7YXdheS51dGlscy5NYXRyaXgzRFV0aWxzLlJBV19EQVRBX0NPTlRBSU5FUjsvL1tdO1xyXG5cdFx0dmFyIGludkxlbjpudW1iZXI7XHJcblx0XHR0aGlzLnZpZXdQcm9qZWN0aW9uLmNvcHlSYXdEYXRhVG8ocmF3KTtcclxuXHJcblx0XHRjMTEgPSByYXdbMF07XHJcblx0XHRjMTIgPSByYXdbNF07XHJcblx0XHRjMTMgPSByYXdbOF07XHJcblx0XHRjMTQgPSByYXdbMTJdO1xyXG5cdFx0YzIxID0gcmF3WzFdO1xyXG5cdFx0YzIyID0gcmF3WzVdO1xyXG5cdFx0YzIzID0gcmF3WzldO1xyXG5cdFx0YzI0ID0gcmF3WzEzXTtcclxuXHRcdGMzMSA9IHJhd1syXTtcclxuXHRcdGMzMiA9IHJhd1s2XTtcclxuXHRcdGMzMyA9IHJhd1sxMF07XHJcblx0XHRjMzQgPSByYXdbMTRdO1xyXG5cdFx0YzQxID0gcmF3WzNdO1xyXG5cdFx0YzQyID0gcmF3WzddO1xyXG5cdFx0YzQzID0gcmF3WzExXTtcclxuXHRcdGM0NCA9IHJhd1sxNV07XHJcblxyXG5cdFx0Ly8gbGVmdCBwbGFuZVxyXG5cdFx0cCA9IHRoaXMuX2ZydXN0dW1QbGFuZXNbMF07XHJcblx0XHRhID0gYzQxICsgYzExO1xyXG5cdFx0YiA9IGM0MiArIGMxMjtcclxuXHRcdGMgPSBjNDMgKyBjMTM7XHJcblx0XHRpbnZMZW4gPSAxL01hdGguc3FydChhKmEgKyBiKmIgKyBjKmMpO1xyXG5cdFx0cC5hID0gYSppbnZMZW47XHJcblx0XHRwLmIgPSBiKmludkxlbjtcclxuXHRcdHAuYyA9IGMqaW52TGVuO1xyXG5cdFx0cC5kID0gLShjNDQgKyBjMTQpKmludkxlbjtcclxuXHJcblx0XHQvLyByaWdodCBwbGFuZVxyXG5cdFx0cCA9IHRoaXMuX2ZydXN0dW1QbGFuZXNbMV07XHJcblx0XHRhID0gYzQxIC0gYzExO1xyXG5cdFx0YiA9IGM0MiAtIGMxMjtcclxuXHRcdGMgPSBjNDMgLSBjMTM7XHJcblx0XHRpbnZMZW4gPSAxL01hdGguc3FydChhKmEgKyBiKmIgKyBjKmMpO1xyXG5cdFx0cC5hID0gYSppbnZMZW47XHJcblx0XHRwLmIgPSBiKmludkxlbjtcclxuXHRcdHAuYyA9IGMqaW52TGVuO1xyXG5cdFx0cC5kID0gKGMxNCAtIGM0NCkqaW52TGVuO1xyXG5cclxuXHRcdC8vIGJvdHRvbVxyXG5cdFx0cCA9IHRoaXMuX2ZydXN0dW1QbGFuZXNbMl07XHJcblx0XHRhID0gYzQxICsgYzIxO1xyXG5cdFx0YiA9IGM0MiArIGMyMjtcclxuXHRcdGMgPSBjNDMgKyBjMjM7XHJcblx0XHRpbnZMZW4gPSAxL01hdGguc3FydChhKmEgKyBiKmIgKyBjKmMpO1xyXG5cdFx0cC5hID0gYSppbnZMZW47XHJcblx0XHRwLmIgPSBiKmludkxlbjtcclxuXHRcdHAuYyA9IGMqaW52TGVuO1xyXG5cdFx0cC5kID0gLShjNDQgKyBjMjQpKmludkxlbjtcclxuXHJcblx0XHQvLyB0b3BcclxuXHRcdHAgPSB0aGlzLl9mcnVzdHVtUGxhbmVzWzNdO1xyXG5cdFx0YSA9IGM0MSAtIGMyMTtcclxuXHRcdGIgPSBjNDIgLSBjMjI7XHJcblx0XHRjID0gYzQzIC0gYzIzO1xyXG5cdFx0aW52TGVuID0gMS9NYXRoLnNxcnQoYSphICsgYipiICsgYypjKTtcclxuXHRcdHAuYSA9IGEqaW52TGVuO1xyXG5cdFx0cC5iID0gYippbnZMZW47XHJcblx0XHRwLmMgPSBjKmludkxlbjtcclxuXHRcdHAuZCA9IChjMjQgLSBjNDQpKmludkxlbjtcclxuXHJcblx0XHQvLyBuZWFyXHJcblx0XHRwID0gdGhpcy5fZnJ1c3R1bVBsYW5lc1s0XTtcclxuXHRcdGEgPSBjMzE7XHJcblx0XHRiID0gYzMyO1xyXG5cdFx0YyA9IGMzMztcclxuXHRcdGludkxlbiA9IDEvTWF0aC5zcXJ0KGEqYSArIGIqYiArIGMqYyk7XHJcblx0XHRwLmEgPSBhKmludkxlbjtcclxuXHRcdHAuYiA9IGIqaW52TGVuO1xyXG5cdFx0cC5jID0gYyppbnZMZW47XHJcblx0XHRwLmQgPSAtYzM0KmludkxlbjtcclxuXHJcblx0XHQvLyBmYXJcclxuXHRcdHAgPSB0aGlzLl9mcnVzdHVtUGxhbmVzWzVdO1xyXG5cdFx0YSA9IGM0MSAtIGMzMTtcclxuXHRcdGIgPSBjNDIgLSBjMzI7XHJcblx0XHRjID0gYzQzIC0gYzMzO1xyXG5cdFx0aW52TGVuID0gMS9NYXRoLnNxcnQoYSphICsgYipiICsgYypjKTtcclxuXHRcdHAuYSA9IGEqaW52TGVuO1xyXG5cdFx0cC5iID0gYippbnZMZW47XHJcblx0XHRwLmMgPSBjKmludkxlbjtcclxuXHRcdHAuZCA9IChjMzQgLSBjNDQpKmludkxlbjtcclxuXHJcblx0XHR0aGlzLl9mcnVzdHVtUGxhbmVzRGlydHkgPSBmYWxzZTtcclxuXHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcHJvdGVjdGVkXHJcblx0ICovXHJcblx0cHVibGljIHBJbnZhbGlkYXRlU2NlbmVUcmFuc2Zvcm0oKVxyXG5cdHtcclxuXHRcdHN1cGVyLnBJbnZhbGlkYXRlU2NlbmVUcmFuc2Zvcm0oKTtcclxuXHJcblx0XHR0aGlzLl92aWV3UHJvamVjdGlvbkRpcnR5ID0gdHJ1ZTtcclxuXHRcdHRoaXMuX2ZydXN0dW1QbGFuZXNEaXJ0eSA9IHRydWU7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKlxyXG5cdCAqL1xyXG5cdHB1YmxpYyBnZXQgcHJvamVjdGlvbigpOklQcm9qZWN0aW9uXHJcblx0e1xyXG5cdFx0cmV0dXJuIHRoaXMuX3Byb2plY3Rpb247XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgc2V0IHByb2plY3Rpb24odmFsdWU6SVByb2plY3Rpb24pXHJcblx0e1xyXG5cdFx0aWYgKHRoaXMuX3Byb2plY3Rpb24gPT0gdmFsdWUpXHJcblx0XHRcdHJldHVybjtcclxuXHJcblx0XHRpZiAoIXZhbHVlKVxyXG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJQcm9qZWN0aW9uIGNhbm5vdCBiZSBudWxsIVwiKTtcclxuXHJcblx0XHR0aGlzLl9wcm9qZWN0aW9uLnJlbW92ZUV2ZW50TGlzdGVuZXIoUHJvamVjdGlvbkV2ZW50Lk1BVFJJWF9DSEFOR0VELCB0aGlzLl9vblByb2plY3Rpb25NYXRyaXhDaGFuZ2VkRGVsZWdhdGUpO1xyXG5cdFx0dGhpcy5fcHJvamVjdGlvbiA9IHZhbHVlO1xyXG5cdFx0dGhpcy5fcHJvamVjdGlvbi5hZGRFdmVudExpc3RlbmVyKFByb2plY3Rpb25FdmVudC5NQVRSSVhfQ0hBTkdFRCwgdGhpcy5fb25Qcm9qZWN0aW9uTWF0cml4Q2hhbmdlZERlbGVnYXRlKTtcclxuXHRcdHRoaXMuZGlzcGF0Y2hFdmVudChuZXcgQ2FtZXJhRXZlbnQoQ2FtZXJhRXZlbnQuUFJPSkVDVElPTl9DSEFOR0VELCB0aGlzKSk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKlxyXG5cdCAqL1xyXG5cdHB1YmxpYyBnZXQgdmlld1Byb2plY3Rpb24oKTpNYXRyaXgzRFxyXG5cdHtcclxuXHRcdGlmICh0aGlzLl92aWV3UHJvamVjdGlvbkRpcnR5KSB7XHJcblx0XHRcdHRoaXMuX3ZpZXdQcm9qZWN0aW9uLmNvcHlGcm9tKHRoaXMuaW52ZXJzZVNjZW5lVHJhbnNmb3JtKTtcclxuXHRcdFx0dGhpcy5fdmlld1Byb2plY3Rpb24uYXBwZW5kKHRoaXMuX3Byb2plY3Rpb24ubWF0cml4KTtcclxuXHRcdFx0dGhpcy5fdmlld1Byb2plY3Rpb25EaXJ0eSA9IGZhbHNlO1xyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiB0aGlzLl92aWV3UHJvamVjdGlvbjtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIENhbGN1bGF0ZXMgdGhlIHJheSBpbiBzY2VuZSBzcGFjZSBmcm9tIHRoZSBjYW1lcmEgdG8gdGhlIGdpdmVuIG5vcm1hbGl6ZWQgY29vcmRpbmF0ZXMgaW4gc2NyZWVuIHNwYWNlLlxyXG5cdCAqXHJcblx0ICogQHBhcmFtIG5YIFRoZSBub3JtYWxpc2VkIHggY29vcmRpbmF0ZSBpbiBzY3JlZW4gc3BhY2UsIC0xIGNvcnJlc3BvbmRzIHRvIHRoZSBsZWZ0IGVkZ2Ugb2YgdGhlIHZpZXdwb3J0LCAxIHRvIHRoZSByaWdodC5cclxuXHQgKiBAcGFyYW0gblkgVGhlIG5vcm1hbGlzZWQgeSBjb29yZGluYXRlIGluIHNjcmVlbiBzcGFjZSwgLTEgY29ycmVzcG9uZHMgdG8gdGhlIHRvcCBlZGdlIG9mIHRoZSB2aWV3cG9ydCwgMSB0byB0aGUgYm90dG9tLlxyXG5cdCAqIEBwYXJhbSBzWiBUaGUgeiBjb29yZGluYXRlIGluIHNjcmVlbiBzcGFjZSwgcmVwcmVzZW50aW5nIHRoZSBkaXN0YW5jZSBpbnRvIHRoZSBzY3JlZW4uXHJcblx0ICogQHJldHVybiBUaGUgcmF5IGZyb20gdGhlIGNhbWVyYSB0byB0aGUgc2NlbmUgc3BhY2UgcG9zaXRpb24gb2YgdGhlIGdpdmVuIHNjcmVlbiBjb29yZGluYXRlcy5cclxuXHQgKi9cclxuXHRwdWJsaWMgZ2V0UmF5KG5YOm51bWJlciwgblk6bnVtYmVyLCBzWjpudW1iZXIpOlZlY3RvcjNEXHJcblx0e1xyXG5cdFx0cmV0dXJuIHRoaXMuc2NlbmVUcmFuc2Zvcm0uZGVsdGFUcmFuc2Zvcm1WZWN0b3IodGhpcy5fcHJvamVjdGlvbi51bnByb2plY3QoblgsIG5ZLCBzWikpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQ2FsY3VsYXRlcyB0aGUgbm9ybWFsaXNlZCBwb3NpdGlvbiBpbiBzY3JlZW4gc3BhY2Ugb2YgdGhlIGdpdmVuIHNjZW5lIHBvc2l0aW9uLlxyXG5cdCAqXHJcblx0ICogQHBhcmFtIHBvaW50M2QgdGhlIHBvc2l0aW9uIHZlY3RvciBvZiB0aGUgc2NlbmUgY29vcmRpbmF0ZXMgdG8gYmUgcHJvamVjdGVkLlxyXG5cdCAqIEByZXR1cm4gVGhlIG5vcm1hbGlzZWQgc2NyZWVuIHBvc2l0aW9uIG9mIHRoZSBnaXZlbiBzY2VuZSBjb29yZGluYXRlcy5cclxuXHQgKi9cclxuXHRwdWJsaWMgcHJvamVjdChwb2ludDNkOlZlY3RvcjNEKTpWZWN0b3IzRFxyXG5cdHtcclxuXHRcdHJldHVybiB0aGlzLl9wcm9qZWN0aW9uLnByb2plY3QodGhpcy5pbnZlcnNlU2NlbmVUcmFuc2Zvcm0udHJhbnNmb3JtVmVjdG9yKHBvaW50M2QpKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIENhbGN1bGF0ZXMgdGhlIHNjZW5lIHBvc2l0aW9uIG9mIHRoZSBnaXZlbiBub3JtYWxpemVkIGNvb3JkaW5hdGVzIGluIHNjcmVlbiBzcGFjZS5cclxuXHQgKlxyXG5cdCAqIEBwYXJhbSBuWCBUaGUgbm9ybWFsaXNlZCB4IGNvb3JkaW5hdGUgaW4gc2NyZWVuIHNwYWNlLCBtaW51cyB0aGUgb3JpZ2luWCBvZmZzZXQgb2YgdGhlIHByb2plY3Rpb24gcHJvcGVydHkuXHJcblx0ICogQHBhcmFtIG5ZIFRoZSBub3JtYWxpc2VkIHkgY29vcmRpbmF0ZSBpbiBzY3JlZW4gc3BhY2UsIG1pbnVzIHRoZSBvcmlnaW5ZIG9mZnNldCBvZiB0aGUgcHJvamVjdGlvbiBwcm9wZXJ0eS5cclxuXHQgKiBAcGFyYW0gc1ogVGhlIHogY29vcmRpbmF0ZSBpbiBzY3JlZW4gc3BhY2UsIHJlcHJlc2VudGluZyB0aGUgZGlzdGFuY2UgaW50byB0aGUgc2NyZWVuLlxyXG5cdCAqIEByZXR1cm4gVGhlIHNjZW5lIHBvc2l0aW9uIG9mIHRoZSBnaXZlbiBzY3JlZW4gY29vcmRpbmF0ZXMuXHJcblx0ICovXHJcblx0cHVibGljIHVucHJvamVjdChuWDpudW1iZXIsIG5ZOm51bWJlciwgc1o6bnVtYmVyKTpWZWN0b3IzRFxyXG5cdHtcclxuXHRcdHJldHVybiB0aGlzLnNjZW5lVHJhbnNmb3JtLnRyYW5zZm9ybVZlY3Rvcih0aGlzLl9wcm9qZWN0aW9uLnVucHJvamVjdChuWCwgblksIHNaKSk7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgX2lDb2xsZWN0UmVuZGVyYWJsZXMocmVuZGVyZXJQb29sOklSZW5kZXJlclBvb2wpXHJcblx0e1xyXG5cdFx0Ly8gU2luY2UgdGhpcyBnZXR0ZXIgaXMgaW52b2tlZCBldmVyeSBpdGVyYXRpb24gb2YgdGhlIHJlbmRlciBsb29wLCBhbmRcclxuXHRcdC8vIHRoZSBwcmVmYWIgY29uc3RydWN0IGNvdWxkIGFmZmVjdCB0aGUgc3ViLW1lc2hlcywgdGhlIHByZWZhYiBpc1xyXG5cdFx0Ly8gdmFsaWRhdGVkIGhlcmUgdG8gZ2l2ZSBpdCBhIGNoYW5jZSB0byByZWJ1aWxkLlxyXG5cdFx0aWYgKHRoaXMuX2lTb3VyY2VQcmVmYWIpXHJcblx0XHRcdHRoaXMuX2lTb3VyY2VQcmVmYWIuX2lWYWxpZGF0ZSgpO1xyXG5cclxuXHRcdHRoaXMuX2lDb2xsZWN0UmVuZGVyYWJsZShyZW5kZXJlclBvb2wpO1xyXG5cdH1cclxuXHJcblx0cHVibGljIF9pQ29sbGVjdFJlbmRlcmFibGUocmVuZGVyZXJQb29sOklSZW5kZXJlclBvb2wpXHJcblx0e1xyXG5cdFx0Ly9ub3RoaW5nIHRvIGRvIGhlcmVcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBfcFJlZ2lzdGVyRW50aXR5KHBhcnRpdGlvbjpQYXJ0aXRpb24pXHJcblx0e1xyXG5cdFx0cGFydGl0aW9uLl9pUmVnaXN0ZXJDYW1lcmEodGhpcyk7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgX3BVbnJlZ2lzdGVyRW50aXR5KHBhcnRpdGlvbjpQYXJ0aXRpb24pXHJcblx0e1xyXG5cdFx0cGFydGl0aW9uLl9pVW5yZWdpc3RlckNhbWVyYSh0aGlzKTtcclxuXHR9XHJcbn1cclxuXHJcbmV4cG9ydCA9IENhbWVyYTsiXX0=