var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Matrix3D = require("awayjs-core/lib/geom/Matrix3D");
var Plane3D = require("awayjs-core/lib/geom/Plane3D");
var ProjectionEvent = require("awayjs-core/lib/events/ProjectionEvent");
var PerspectiveProjection = require("awayjs-core/lib/projections/PerspectiveProjection");
var BoundsType = require("awayjs-display/lib/bounds/BoundsType");
var DisplayObjectContainer = require("awayjs-display/lib/containers/DisplayObjectContainer");
var CameraEvent = require("awayjs-display/lib/events/CameraEvent");
var Camera = (function (_super) {
    __extends(Camera, _super);
    function Camera(projection) {
        var _this = this;
        if (projection === void 0) { projection = null; }
        _super.call(this);
        this._viewProjection = new Matrix3D();
        this._viewProjectionDirty = true;
        this._frustumPlanesDirty = true;
        this._pIsEntity = true;
        this._onProjectionMatrixChangedDelegate = function (event) { return _this.onProjectionMatrixChanged(event); };
        this._projection = projection || new PerspectiveProjection();
        this._projection.addEventListener(ProjectionEvent.MATRIX_CHANGED, this._onProjectionMatrixChangedDelegate);
        this._frustumPlanes = [];
        for (var i = 0; i < 6; ++i)
            this._frustumPlanes[i] = new Plane3D();
        this.z = -1000;
        //default bounds type
        this._boundsType = BoundsType.NULL;
    }
    Object.defineProperty(Camera.prototype, "assetType", {
        //@override
        get: function () {
            return Camera.assetType;
        },
        enumerable: true,
        configurable: true
    });
    Camera.prototype.onProjectionMatrixChanged = function (event) {
        this._viewProjectionDirty = true;
        this._frustumPlanesDirty = true;
        this.dispatchEvent(event);
    };
    Object.defineProperty(Camera.prototype, "frustumPlanes", {
        get: function () {
            if (this._frustumPlanesDirty)
                this.updateFrustum();
            return this._frustumPlanes;
        },
        enumerable: true,
        configurable: true
    });
    Camera.prototype.updateFrustum = function () {
        var a, b, c;
        //var d : Number;
        var c11, c12, c13, c14;
        var c21, c22, c23, c24;
        var c31, c32, c33, c34;
        var c41, c42, c43, c44;
        var p;
        var raw = new Array(16);
        ;
        var invLen;
        this.viewProjection.copyRawDataTo(raw);
        c11 = raw[0];
        c12 = raw[4];
        c13 = raw[8];
        c14 = raw[12];
        c21 = raw[1];
        c22 = raw[5];
        c23 = raw[9];
        c24 = raw[13];
        c31 = raw[2];
        c32 = raw[6];
        c33 = raw[10];
        c34 = raw[14];
        c41 = raw[3];
        c42 = raw[7];
        c43 = raw[11];
        c44 = raw[15];
        // left plane
        p = this._frustumPlanes[0];
        a = c41 + c11;
        b = c42 + c12;
        c = c43 + c13;
        invLen = 1 / Math.sqrt(a * a + b * b + c * c);
        p.a = a * invLen;
        p.b = b * invLen;
        p.c = c * invLen;
        p.d = -(c44 + c14) * invLen;
        // right plane
        p = this._frustumPlanes[1];
        a = c41 - c11;
        b = c42 - c12;
        c = c43 - c13;
        invLen = 1 / Math.sqrt(a * a + b * b + c * c);
        p.a = a * invLen;
        p.b = b * invLen;
        p.c = c * invLen;
        p.d = (c14 - c44) * invLen;
        // bottom
        p = this._frustumPlanes[2];
        a = c41 + c21;
        b = c42 + c22;
        c = c43 + c23;
        invLen = 1 / Math.sqrt(a * a + b * b + c * c);
        p.a = a * invLen;
        p.b = b * invLen;
        p.c = c * invLen;
        p.d = -(c44 + c24) * invLen;
        // top
        p = this._frustumPlanes[3];
        a = c41 - c21;
        b = c42 - c22;
        c = c43 - c23;
        invLen = 1 / Math.sqrt(a * a + b * b + c * c);
        p.a = a * invLen;
        p.b = b * invLen;
        p.c = c * invLen;
        p.d = (c24 - c44) * invLen;
        // near
        p = this._frustumPlanes[4];
        a = c31;
        b = c32;
        c = c33;
        invLen = 1 / Math.sqrt(a * a + b * b + c * c);
        p.a = a * invLen;
        p.b = b * invLen;
        p.c = c * invLen;
        p.d = -c34 * invLen;
        // far
        p = this._frustumPlanes[5];
        a = c41 - c31;
        b = c42 - c32;
        c = c43 - c33;
        invLen = 1 / Math.sqrt(a * a + b * b + c * c);
        p.a = a * invLen;
        p.b = b * invLen;
        p.c = c * invLen;
        p.d = (c34 - c44) * invLen;
        this._frustumPlanesDirty = false;
    };
    /**
     * @protected
     */
    Camera.prototype.pInvalidateSceneTransform = function () {
        _super.prototype.pInvalidateSceneTransform.call(this);
        this._viewProjectionDirty = true;
        this._frustumPlanesDirty = true;
    };
    Object.defineProperty(Camera.prototype, "projection", {
        /**
         *
         */
        get: function () {
            return this._projection;
        },
        set: function (value) {
            if (this._projection == value)
                return;
            if (!value)
                throw new Error("Projection cannot be null!");
            this._projection.removeEventListener(ProjectionEvent.MATRIX_CHANGED, this._onProjectionMatrixChangedDelegate);
            this._projection = value;
            this._projection.addEventListener(ProjectionEvent.MATRIX_CHANGED, this._onProjectionMatrixChangedDelegate);
            this.dispatchEvent(new CameraEvent(CameraEvent.PROJECTION_CHANGED, this));
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Camera.prototype, "viewProjection", {
        /**
         *
         */
        get: function () {
            if (this._viewProjectionDirty) {
                this._viewProjection.copyFrom(this.inverseSceneTransform);
                this._viewProjection.append(this._projection.matrix);
                this._viewProjectionDirty = false;
            }
            return this._viewProjection;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Calculates the ray in scene space from the camera to the given normalized coordinates in screen space.
     *
     * @param nX The normalised x coordinate in screen space, -1 corresponds to the left edge of the viewport, 1 to the right.
     * @param nY The normalised y coordinate in screen space, -1 corresponds to the top edge of the viewport, 1 to the bottom.
     * @param sZ The z coordinate in screen space, representing the distance into the screen.
     * @return The ray from the camera to the scene space position of the given screen coordinates.
     */
    Camera.prototype.getRay = function (nX, nY, sZ) {
        return this.sceneTransform.deltaTransformVector(this._projection.unproject(nX, nY, sZ));
    };
    /**
     * Calculates the normalised position in screen space of the given scene position.
     *
     * @param point3d the position vector of the scene coordinates to be projected.
     * @return The normalised screen position of the given scene coordinates.
     */
    Camera.prototype.project = function (point3d) {
        return this._projection.project(this.inverseSceneTransform.transformVector(point3d));
    };
    /**
     * Calculates the scene position of the given normalized coordinates in screen space.
     *
     * @param nX The normalised x coordinate in screen space, minus the originX offset of the projection property.
     * @param nY The normalised y coordinate in screen space, minus the originY offset of the projection property.
     * @param sZ The z coordinate in screen space, representing the distance into the screen.
     * @return The scene position of the given screen coordinates.
     */
    Camera.prototype.unproject = function (nX, nY, sZ) {
        return this.sceneTransform.transformVector(this._projection.unproject(nX, nY, sZ));
    };
    Camera.prototype._iCollectRenderables = function (rendererPool) {
        // Since this getter is invoked every iteration of the render loop, and
        // the prefab construct could affect the sub-meshes, the prefab is
        // validated here to give it a chance to rebuild.
        if (this._iSourcePrefab)
            this._iSourcePrefab._iValidate();
        this._iCollectRenderable(rendererPool);
    };
    Camera.prototype._iCollectRenderable = function (rendererPool) {
        //nothing to do here
    };
    Camera.prototype._pRegisterEntity = function (partition) {
        partition._iRegisterCamera(this);
    };
    Camera.prototype._pUnregisterEntity = function (partition) {
        partition._iUnregisterCamera(this);
    };
    Camera.assetType = "[asset Camera]";
    return Camera;
})(DisplayObjectContainer);
module.exports = Camera;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9DYW1lcmEudHMiXSwibmFtZXMiOlsiQ2FtZXJhIiwiQ2FtZXJhLmNvbnN0cnVjdG9yIiwiQ2FtZXJhLmFzc2V0VHlwZSIsIkNhbWVyYS5vblByb2plY3Rpb25NYXRyaXhDaGFuZ2VkIiwiQ2FtZXJhLmZydXN0dW1QbGFuZXMiLCJDYW1lcmEudXBkYXRlRnJ1c3R1bSIsIkNhbWVyYS5wSW52YWxpZGF0ZVNjZW5lVHJhbnNmb3JtIiwiQ2FtZXJhLnByb2plY3Rpb24iLCJDYW1lcmEudmlld1Byb2plY3Rpb24iLCJDYW1lcmEuZ2V0UmF5IiwiQ2FtZXJhLnByb2plY3QiLCJDYW1lcmEudW5wcm9qZWN0IiwiQ2FtZXJhLl9pQ29sbGVjdFJlbmRlcmFibGVzIiwiQ2FtZXJhLl9pQ29sbGVjdFJlbmRlcmFibGUiLCJDYW1lcmEuX3BSZWdpc3RlckVudGl0eSIsIkNhbWVyYS5fcFVucmVnaXN0ZXJFbnRpdHkiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLElBQU8sUUFBUSxXQUFnQiwrQkFBK0IsQ0FBQyxDQUFDO0FBQ2hFLElBQU8sT0FBTyxXQUFnQiw4QkFBOEIsQ0FBQyxDQUFDO0FBRTlELElBQU8sZUFBZSxXQUFjLHdDQUF3QyxDQUFDLENBQUM7QUFFOUUsSUFBTyxxQkFBcUIsV0FBWSxtREFBbUQsQ0FBQyxDQUFDO0FBRTdGLElBQU8sVUFBVSxXQUFlLHNDQUFzQyxDQUFDLENBQUM7QUFDeEUsSUFBTyxzQkFBc0IsV0FBWSxzREFBc0QsQ0FBQyxDQUFDO0FBR2pHLElBQU8sV0FBVyxXQUFlLHVDQUF1QyxDQUFDLENBQUM7QUFNMUUsSUFBTSxNQUFNO0lBQVNBLFVBQWZBLE1BQU1BLFVBQStCQTtJQVcxQ0EsU0FYS0EsTUFBTUEsQ0FXQ0EsVUFBNkJBO1FBWDFDQyxpQkF3UUNBO1FBN1BZQSwwQkFBNkJBLEdBQTdCQSxpQkFBNkJBO1FBRXhDQSxpQkFBT0EsQ0FBQ0E7UUFUREEsb0JBQWVBLEdBQVlBLElBQUlBLFFBQVFBLEVBQUVBLENBQUNBO1FBQzFDQSx5QkFBb0JBLEdBQVdBLElBQUlBLENBQUNBO1FBR3BDQSx3QkFBbUJBLEdBQVdBLElBQUlBLENBQUNBO1FBTzFDQSxJQUFJQSxDQUFDQSxVQUFVQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUV2QkEsSUFBSUEsQ0FBQ0Esa0NBQWtDQSxHQUFHQSxVQUFDQSxLQUFxQkEsSUFBS0EsT0FBQUEsS0FBSUEsQ0FBQ0EseUJBQXlCQSxDQUFDQSxLQUFLQSxDQUFDQSxFQUFyQ0EsQ0FBcUNBLENBQUNBO1FBRTNHQSxJQUFJQSxDQUFDQSxXQUFXQSxHQUFHQSxVQUFVQSxJQUFJQSxJQUFJQSxxQkFBcUJBLEVBQUVBLENBQUNBO1FBQzdEQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFDQSxnQkFBZ0JBLENBQUNBLGVBQWVBLENBQUNBLGNBQWNBLEVBQUVBLElBQUlBLENBQUNBLGtDQUFrQ0EsQ0FBQ0EsQ0FBQ0E7UUFFM0dBLElBQUlBLENBQUNBLGNBQWNBLEdBQUdBLEVBQUVBLENBQUNBO1FBRXpCQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFVQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQTtZQUNoQ0EsSUFBSUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsT0FBT0EsRUFBRUEsQ0FBQ0E7UUFFeENBLElBQUlBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLElBQUlBLENBQUNBO1FBRWZBLEFBQ0FBLHFCQURxQkE7UUFDckJBLElBQUlBLENBQUNBLFdBQVdBLEdBQUdBLFVBQVVBLENBQUNBLElBQUlBLENBQUNBO0lBQ3BDQSxDQUFDQTtJQUdERCxzQkFBV0EsNkJBQVNBO1FBRHBCQSxXQUFXQTthQUNYQTtZQUVDRSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQSxTQUFTQSxDQUFDQTtRQUN6QkEsQ0FBQ0E7OztPQUFBRjtJQUVPQSwwQ0FBeUJBLEdBQWpDQSxVQUFrQ0EsS0FBcUJBO1FBRXRERyxJQUFJQSxDQUFDQSxvQkFBb0JBLEdBQUdBLElBQUlBLENBQUNBO1FBQ2pDQSxJQUFJQSxDQUFDQSxtQkFBbUJBLEdBQUdBLElBQUlBLENBQUNBO1FBQ2hDQSxJQUFJQSxDQUFDQSxhQUFhQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQTtJQUMzQkEsQ0FBQ0E7SUFFREgsc0JBQVdBLGlDQUFhQTthQUF4QkE7WUFFQ0ksRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsbUJBQW1CQSxDQUFDQTtnQkFDNUJBLElBQUlBLENBQUNBLGFBQWFBLEVBQUVBLENBQUNBO1lBRXRCQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxjQUFjQSxDQUFDQTtRQUM1QkEsQ0FBQ0E7OztPQUFBSjtJQUVPQSw4QkFBYUEsR0FBckJBO1FBRUNLLElBQUlBLENBQVFBLEVBQUVBLENBQVFBLEVBQUVBLENBQVFBLENBQUNBO1FBQ2pDQSxBQUNBQSxpQkFEaUJBO1lBQ2JBLEdBQVVBLEVBQUVBLEdBQVVBLEVBQUVBLEdBQVVBLEVBQUVBLEdBQVVBLENBQUNBO1FBQ25EQSxJQUFJQSxHQUFVQSxFQUFFQSxHQUFVQSxFQUFFQSxHQUFVQSxFQUFFQSxHQUFVQSxDQUFDQTtRQUNuREEsSUFBSUEsR0FBVUEsRUFBRUEsR0FBVUEsRUFBRUEsR0FBVUEsRUFBRUEsR0FBVUEsQ0FBQ0E7UUFDbkRBLElBQUlBLEdBQVVBLEVBQUVBLEdBQVVBLEVBQUVBLEdBQVVBLEVBQUVBLEdBQVVBLENBQUNBO1FBQ25EQSxJQUFJQSxDQUFTQSxDQUFDQTtRQUNkQSxJQUFJQSxHQUFHQSxHQUFZQSxJQUFJQSxLQUFLQSxDQUFTQSxFQUFFQSxDQUFDQSxDQUFDQTtRQUN6Q0EsQ0FBQ0E7UUFDREEsSUFBSUEsTUFBYUEsQ0FBQ0E7UUFDbEJBLElBQUlBLENBQUNBLGNBQWNBLENBQUNBLGFBQWFBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1FBRXZDQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNiQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNiQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNiQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQTtRQUNkQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNiQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNiQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNiQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQTtRQUNkQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNiQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNiQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQTtRQUNkQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQTtRQUNkQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNiQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNiQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQTtRQUNkQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQTtRQUVkQSxBQUNBQSxhQURhQTtRQUNiQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxjQUFjQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUMzQkEsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0E7UUFDZEEsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0E7UUFDZEEsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0E7UUFDZEEsTUFBTUEsR0FBR0EsQ0FBQ0EsR0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDdENBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BLENBQUNBO1FBQ2ZBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BLENBQUNBO1FBQ2ZBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BLENBQUNBO1FBQ2ZBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BLENBQUNBO1FBRTFCQSxBQUNBQSxjQURjQTtRQUNkQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxjQUFjQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUMzQkEsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0E7UUFDZEEsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0E7UUFDZEEsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0E7UUFDZEEsTUFBTUEsR0FBR0EsQ0FBQ0EsR0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDdENBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BLENBQUNBO1FBQ2ZBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BLENBQUNBO1FBQ2ZBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BLENBQUNBO1FBQ2ZBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUdBLEdBQUdBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BLENBQUNBO1FBRXpCQSxBQUNBQSxTQURTQTtRQUNUQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxjQUFjQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUMzQkEsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0E7UUFDZEEsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0E7UUFDZEEsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0E7UUFDZEEsTUFBTUEsR0FBR0EsQ0FBQ0EsR0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDdENBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BLENBQUNBO1FBQ2ZBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BLENBQUNBO1FBQ2ZBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BLENBQUNBO1FBQ2ZBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BLENBQUNBO1FBRTFCQSxBQUNBQSxNQURNQTtRQUNOQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxjQUFjQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUMzQkEsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0E7UUFDZEEsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0E7UUFDZEEsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0E7UUFDZEEsTUFBTUEsR0FBR0EsQ0FBQ0EsR0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDdENBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BLENBQUNBO1FBQ2ZBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BLENBQUNBO1FBQ2ZBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BLENBQUNBO1FBQ2ZBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUdBLEdBQUdBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BLENBQUNBO1FBRXpCQSxBQUNBQSxPQURPQTtRQUNQQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxjQUFjQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUMzQkEsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0E7UUFDUkEsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0E7UUFDUkEsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0E7UUFDUkEsTUFBTUEsR0FBR0EsQ0FBQ0EsR0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDdENBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BLENBQUNBO1FBQ2ZBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BLENBQUNBO1FBQ2ZBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BLENBQUNBO1FBQ2ZBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUdBLEdBQUNBLE1BQU1BLENBQUNBO1FBRWxCQSxBQUNBQSxNQURNQTtRQUNOQSxDQUFDQSxHQUFHQSxJ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WixvQ0FBbUJBLEdBQTFCQSxVQUEyQkEsWUFBMEJBO1FBRXBEYSxvQkFBb0JBO0lBQ3JCQSxDQUFDQTtJQUVNYixpQ0FBZ0JBLEdBQXZCQSxVQUF3QkEsU0FBbUJBO1FBRTFDYyxTQUFTQSxDQUFDQSxnQkFBZ0JBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO0lBQ2xDQSxDQUFDQTtJQUVNZCxtQ0FBa0JBLEdBQXpCQSxVQUEwQkEsU0FBbUJBO1FBRTVDZSxTQUFTQSxDQUFDQSxrQkFBa0JBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO0lBQ3BDQSxDQUFDQTtJQXJRYWYsZ0JBQVNBLEdBQVVBLGdCQUFnQkEsQ0FBQ0E7SUFzUW5EQSxhQUFDQTtBQUFEQSxDQXhRQSxBQXdRQ0EsRUF4UW9CLHNCQUFzQixFQXdRMUM7QUFFRCxBQUFnQixpQkFBUCxNQUFNLENBQUMiLCJmaWxlIjoiZW50aXRpZXMvQ2FtZXJhLmpzIiwic291cmNlUm9vdCI6Ii4uLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBNYXRyaXgzRFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9nZW9tL01hdHJpeDNEXCIpO1xyXG5pbXBvcnQgUGxhbmUzRFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9nZW9tL1BsYW5lM0RcIik7XHJcbmltcG9ydCBWZWN0b3IzRFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9nZW9tL1ZlY3RvcjNEXCIpO1xyXG5pbXBvcnQgUHJvamVjdGlvbkV2ZW50XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZXZlbnRzL1Byb2plY3Rpb25FdmVudFwiKTtcclxuaW1wb3J0IElQcm9qZWN0aW9uXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9wcm9qZWN0aW9ucy9JUHJvamVjdGlvblwiKTtcclxuaW1wb3J0IFBlcnNwZWN0aXZlUHJvamVjdGlvblx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvcHJvamVjdGlvbnMvUGVyc3BlY3RpdmVQcm9qZWN0aW9uXCIpO1xyXG5cclxuaW1wb3J0IEJvdW5kc1R5cGVcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2JvdW5kcy9Cb3VuZHNUeXBlXCIpO1xyXG5pbXBvcnQgRGlzcGxheU9iamVjdENvbnRhaW5lclx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvY29udGFpbmVycy9EaXNwbGF5T2JqZWN0Q29udGFpbmVyXCIpO1xyXG5pbXBvcnQgUGFydGl0aW9uXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9wYXJ0aXRpb24vUGFydGl0aW9uXCIpO1xyXG5pbXBvcnQgSUVudGl0eVx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9JRW50aXR5XCIpO1xyXG5pbXBvcnQgQ2FtZXJhRXZlbnRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2V2ZW50cy9DYW1lcmFFdmVudFwiKTtcclxuaW1wb3J0IENhbWVyYU5vZGVcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL3BhcnRpdGlvbi9DYW1lcmFOb2RlXCIpO1xyXG5pbXBvcnQgRW50aXR5Tm9kZVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvcGFydGl0aW9uL0VudGl0eU5vZGVcIik7XHJcbmltcG9ydCBJUmVuZGVyZXJQb29sXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvcG9vbC9JUmVuZGVyZXJQb29sXCIpO1xyXG5cclxuXHJcbmNsYXNzIENhbWVyYSBleHRlbmRzIERpc3BsYXlPYmplY3RDb250YWluZXIgaW1wbGVtZW50cyBJRW50aXR5XHJcbntcclxuXHRwdWJsaWMgc3RhdGljIGFzc2V0VHlwZTpzdHJpbmcgPSBcIlthc3NldCBDYW1lcmFdXCI7XHJcblxyXG5cdHByaXZhdGUgX3ZpZXdQcm9qZWN0aW9uOk1hdHJpeDNEID0gbmV3IE1hdHJpeDNEKCk7XHJcblx0cHJpdmF0ZSBfdmlld1Byb2plY3Rpb25EaXJ0eTpCb29sZWFuID0gdHJ1ZTtcclxuXHRwcml2YXRlIF9wcm9qZWN0aW9uOklQcm9qZWN0aW9uO1xyXG5cdHByaXZhdGUgX2ZydXN0dW1QbGFuZXM6QXJyYXk8UGxhbmUzRD47XHJcblx0cHJpdmF0ZSBfZnJ1c3R1bVBsYW5lc0RpcnR5OkJvb2xlYW4gPSB0cnVlO1xyXG5cdHByaXZhdGUgX29uUHJvamVjdGlvbk1hdHJpeENoYW5nZWREZWxlZ2F0ZTooZXZlbnQ6UHJvamVjdGlvbkV2ZW50KSA9PiB2b2lkO1xyXG5cclxuXHRjb25zdHJ1Y3Rvcihwcm9qZWN0aW9uOklQcm9qZWN0aW9uID0gbnVsbClcclxuXHR7XHJcblx0XHRzdXBlcigpO1xyXG5cclxuXHRcdHRoaXMuX3BJc0VudGl0eSA9IHRydWU7XHJcblxyXG5cdFx0dGhpcy5fb25Qcm9qZWN0aW9uTWF0cml4Q2hhbmdlZERlbGVnYXRlID0gKGV2ZW50OlByb2plY3Rpb25FdmVudCkgPT4gdGhpcy5vblByb2plY3Rpb25NYXRyaXhDaGFuZ2VkKGV2ZW50KTtcclxuXHJcblx0XHR0aGlzLl9wcm9qZWN0aW9uID0gcHJvamVjdGlvbiB8fCBuZXcgUGVyc3BlY3RpdmVQcm9qZWN0aW9uKCk7XHJcblx0XHR0aGlzLl9wcm9qZWN0aW9uLmFkZEV2ZW50TGlzdGVuZXIoUHJvamVjdGlvbkV2ZW50Lk1BVFJJWF9DSEFOR0VELCB0aGlzLl9vblByb2plY3Rpb25NYXRyaXhDaGFuZ2VkRGVsZWdhdGUpO1xyXG5cclxuXHRcdHRoaXMuX2ZydXN0dW1QbGFuZXMgPSBbXTtcclxuXHJcblx0XHRmb3IgKHZhciBpOm51bWJlciA9IDA7IGkgPCA2OyArK2kpXHJcblx0XHRcdHRoaXMuX2ZydXN0dW1QbGFuZXNbaV0gPSBuZXcgUGxhbmUzRCgpO1xyXG5cclxuXHRcdHRoaXMueiA9IC0xMDAwO1xyXG5cclxuXHRcdC8vZGVmYXVsdCBib3VuZHMgdHlwZVxyXG5cdFx0dGhpcy5fYm91bmRzVHlwZSA9IEJvdW5kc1R5cGUuTlVMTDtcclxuXHR9XHJcblxyXG5cdC8vQG92ZXJyaWRlXHJcblx0cHVibGljIGdldCBhc3NldFR5cGUoKTpzdHJpbmdcclxuXHR7XHJcblx0XHRyZXR1cm4gQ2FtZXJhLmFzc2V0VHlwZTtcclxuXHR9XHJcblxyXG5cdHByaXZhdGUgb25Qcm9qZWN0aW9uTWF0cml4Q2hhbmdlZChldmVudDpQcm9qZWN0aW9uRXZlbnQpXHJcblx0e1xyXG5cdFx0dGhpcy5fdmlld1Byb2plY3Rpb25EaXJ0eSA9IHRydWU7XHJcblx0XHR0aGlzLl9mcnVzdHVtUGxhbmVzRGlydHkgPSB0cnVlO1xyXG5cdFx0dGhpcy5kaXNwYXRjaEV2ZW50KGV2ZW50KTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBnZXQgZnJ1c3R1bVBsYW5lcygpOkFycmF5PFBsYW5lM0Q+XHJcblx0e1xyXG5cdFx0aWYgKHRoaXMuX2ZydXN0dW1QbGFuZXNEaXJ0eSlcclxuXHRcdFx0dGhpcy51cGRhdGVGcnVzdHVtKCk7XHJcblxyXG5cdFx0cmV0dXJuIHRoaXMuX2ZydXN0dW1QbGFuZXM7XHJcblx0fVxyXG5cclxuXHRwcml2YXRlIHVwZGF0ZUZydXN0dW0oKVxyXG5cdHtcclxuXHRcdHZhciBhOm51bWJlciwgYjpudW1iZXIsIGM6bnVtYmVyO1xyXG5cdFx0Ly92YXIgZCA6IE51bWJlcjtcclxuXHRcdHZhciBjMTE6bnVtYmVyLCBjMTI6bnVtYmVyLCBjMTM6bnVtYmVyLCBjMTQ6bnVtYmVyO1xyXG5cdFx0dmFyIGMyMTpudW1iZXIsIGMyMjpudW1iZXIsIGMyMzpudW1iZXIsIGMyNDpudW1iZXI7XHJcblx0XHR2YXIgYzMxOm51bWJlciwgYzMyOm51bWJlciwgYzMzOm51bWJlciwgYzM0Om51bWJlcjtcclxuXHRcdHZhciBjNDE6bnVtYmVyLCBjNDI6bnVtYmVyLCBjNDM6bnVtYmVyLCBjNDQ6bnVtYmVyO1xyXG5cdFx0dmFyIHA6UGxhbmUzRDtcclxuXHRcdHZhciByYXc6bnVtYmVyW10gPSBuZXcgQXJyYXk8bnVtYmVyPigxNik7XHJcblx0XHQ7Ly9uZXcgQXJyYXkoMTYgKTthd2F5LnV0aWxzLk1hdHJpeDNEVXRpbHMuUkFXX0RBVEFfQ09OVEFJTkVSOy8vW107XHJcblx0XHR2YXIgaW52TGVuOm51bWJlcjtcclxuXHRcdHRoaXMudmlld1Byb2plY3Rpb24uY29weVJhd0RhdGFUbyhyYXcpO1xyXG5cclxuXHRcdGMxMSA9IHJhd1swXTtcclxuXHRcdGMxMiA9IHJhd1s0XTtcclxuXHRcdGMxMyA9IHJhd1s4XTtcclxuXHRcdGMxNCA9IHJhd1sxMl07XHJcblx0XHRjMjEgPSByYXdbMV07XHJcblx0XHRjMjIgPSByYXdbNV07XHJcblx0XHRjMjMgPSByYXdbOV07XHJcblx0XHRjMjQgPSByYXdbMTNdO1xyXG5cdFx0YzMxID0gcmF3WzJdO1xyXG5cdFx0YzMyID0gcmF3WzZdO1xyXG5cdFx0YzMzID0gcmF3WzEwXTtcclxuXHRcdGMzNCA9IHJhd1sxNF07XHJcblx0XHRjNDEgPSByYXdbM107XHJcblx0XHRjNDIgPSByYXdbN107XHJcblx0XHRjNDMgPSByYXdbMTFdO1xyXG5cdFx0YzQ0ID0gcmF3WzE1XTtcclxuXHJcblx0XHQvLyBsZWZ0IHBsYW5lXHJcblx0XHRwID0gdGhpcy5fZnJ1c3R1bVBsYW5lc1swXTtcclxuXHRcdGEgPSBjNDEgKyBjMTE7XHJcblx0XHRiID0gYzQyICsgYzEyO1xyXG5cdFx0YyA9IGM0MyArIGMxMztcclxuXHRcdGludkxlbiA9IDEvTWF0aC5zcXJ0KGEqYSArIGIqYiArIGMqYyk7XHJcblx0XHRwLmEgPSBhKmludkxlbjtcclxuXHRcdHAuYiA9IGIqaW52TGVuO1xyXG5cdFx0cC5jID0gYyppbnZMZW47XHJcblx0XHRwLmQgPSAtKGM0NCArIGMxNCkqaW52TGVuO1xyXG5cclxuXHRcdC8vIHJpZ2h0IHBsYW5lXHJcblx0XHRwID0gdGhpcy5fZnJ1c3R1bVBsYW5lc1sxXTtcclxuXHRcdGEgPSBjNDEgLSBjMTE7XHJcblx0XHRiID0gYzQyIC0gYzEyO1xyXG5cdFx0YyA9IGM0MyAtIGMxMztcclxuXHRcdGludkxlbiA9IDEvTWF0aC5zcXJ0KGEqYSArIGIqYiArIGMqYyk7XHJcblx0XHRwLmEgPSBhKmludkxlbjtcclxuXHRcdHAuYiA9IGIqaW52TGVuO1xyXG5cdFx0cC5jID0gYyppbnZMZW47XHJcblx0XHRwLmQgPSAoYzE0IC0gYzQ0KSppbnZMZW47XHJcblxyXG5cdFx0Ly8gYm90dG9tXHJcblx0XHRwID0gdGhpcy5fZnJ1c3R1bVBsYW5lc1syXTtcclxuXHRcdGEgPSBjNDEgKyBjMjE7XHJcblx0XHRiID0gYzQyICsgYzIyO1xyXG5cdFx0YyA9IGM0MyArIGMyMztcclxuXHRcdGludkxlbiA9IDEvTWF0aC5zcXJ0KGEqYSArIGIqYiArIGMqYyk7XHJcblx0XHRwLmEgPSBhKmludkxlbjtcclxuXHRcdHAuYiA9IGIqaW52TGVuO1xyXG5cdFx0cC5jID0gYyppbnZMZW47XHJcblx0XHRwLmQgPSAtKGM0NCArIGMyNCkqaW52TGVuO1xyXG5cclxuXHRcdC8vIHRvcFxyXG5cdFx0cCA9IHRoaXMuX2ZydXN0dW1QbGFuZXNbM107XHJcblx0XHRhID0gYzQxIC0gYzIxO1xyXG5cdFx0YiA9IGM0MiAtIGMyMjtcclxuXHRcdGMgPSBjNDMgLSBjMjM7XHJcblx0XHRpbnZMZW4gPSAxL01hdGguc3FydChhKmEgKyBiKmIgKyBjKmMpO1xyXG5cdFx0cC5hID0gYSppbnZMZW47XHJcblx0XHRwLmIgPSBiKmludkxlbjtcclxuXHRcdHAuYyA9IGMqaW52TGVuO1xyXG5cdFx0cC5kID0gKGMyNCAtIGM0NCkqaW52TGVuO1xyXG5cclxuXHRcdC8vIG5lYXJcclxuXHRcdHAgPSB0aGlzLl9mcnVzdHVtUGxhbmVzWzRdO1xyXG5cdFx0YSA9IGMzMTtcclxuXHRcdGIgPSBjMzI7XHJcblx0XHRjID0gYzMzO1xyXG5cdFx0aW52TGVuID0gMS9NYXRoLnNxcnQoYSphICsgYipiICsgYypjKTtcclxuXHRcdHAuYSA9IGEqaW52TGVuO1xyXG5cdFx0cC5iID0gYippbnZMZW47XHJcblx0XHRwLmMgPSBjKmludkxlbjtcclxuXHRcdHAuZCA9IC1jMzQqaW52TGVuO1xyXG5cclxuXHRcdC8vIGZhclxyXG5cdFx0cCA9IHRoaXMuX2ZydXN0dW1QbGFuZXNbNV07XHJcblx0XHRhID0gYzQxIC0gYzMxO1xyXG5cdFx0YiA9IGM0MiAtIGMzMjtcclxuXHRcdGMgPSBjNDMgLSBjMzM7XHJcblx0XHRpbnZMZW4gPSAxL01hdGguc3FydChhKmEgKyBiKmIgKyBjKmMpO1xyXG5cdFx0cC5hID0gYSppbnZMZW47XHJcblx0XHRwLmIgPSBiKmludkxlbjtcclxuXHRcdHAuYyA9IGMqaW52TGVuO1xyXG5cdFx0cC5kID0gKGMzNCAtIGM0NCkqaW52TGVuO1xyXG5cclxuXHRcdHRoaXMuX2ZydXN0dW1QbGFuZXNEaXJ0eSA9IGZhbHNlO1xyXG5cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwcm90ZWN0ZWRcclxuXHQgKi9cclxuXHRwdWJsaWMgcEludmFsaWRhdGVTY2VuZVRyYW5zZm9ybSgpXHJcblx0e1xyXG5cdFx0c3VwZXIucEludmFsaWRhdGVTY2VuZVRyYW5zZm9ybSgpO1xyXG5cclxuXHRcdHRoaXMuX3ZpZXdQcm9qZWN0aW9uRGlydHkgPSB0cnVlO1xyXG5cdFx0dGhpcy5fZnJ1c3R1bVBsYW5lc0RpcnR5ID0gdHJ1ZTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqXHJcblx0ICovXHJcblx0cHVibGljIGdldCBwcm9qZWN0aW9uKCk6SVByb2plY3Rpb25cclxuXHR7XHJcblx0XHRyZXR1cm4gdGhpcy5fcHJvamVjdGlvbjtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBzZXQgcHJvamVjdGlvbih2YWx1ZTpJUHJvamVjdGlvbilcclxuXHR7XHJcblx0XHRpZiAodGhpcy5fcHJvamVjdGlvbiA9PSB2YWx1ZSlcclxuXHRcdFx0cmV0dXJuO1xyXG5cclxuXHRcdGlmICghdmFsdWUpXHJcblx0XHRcdHRocm93IG5ldyBFcnJvcihcIlByb2plY3Rpb24gY2Fubm90IGJlIG51bGwhXCIpO1xyXG5cclxuXHRcdHRoaXMuX3Byb2plY3Rpb24ucmVtb3ZlRXZlbnRMaXN0ZW5lcihQcm9qZWN0aW9uRXZlbnQuTUFUUklYX0NIQU5HRUQsIHRoaXMuX29uUHJvamVjdGlvbk1hdHJpeENoYW5nZWREZWxlZ2F0ZSk7XHJcblx0XHR0aGlzLl9wcm9qZWN0aW9uID0gdmFsdWU7XHJcblx0XHR0aGlzLl9wcm9qZWN0aW9uLmFkZEV2ZW50TGlzdGVuZXIoUHJvamVjdGlvbkV2ZW50Lk1BVFJJWF9DSEFOR0VELCB0aGlzLl9vblByb2plY3Rpb25NYXRyaXhDaGFuZ2VkRGVsZWdhdGUpO1xyXG5cdFx0dGhpcy5kaXNwYXRjaEV2ZW50KG5ldyBDYW1lcmFFdmVudChDYW1lcmFFdmVudC5QUk9KRUNUSU9OX0NIQU5HRUQsIHRoaXMpKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqXHJcblx0ICovXHJcblx0cHVibGljIGdldCB2aWV3UHJvamVjdGlvbigpOk1hdHJpeDNEXHJcblx0e1xyXG5cdFx0aWYgKHRoaXMuX3ZpZXdQcm9qZWN0aW9uRGlydHkpIHtcclxuXHRcdFx0dGhpcy5fdmlld1Byb2plY3Rpb24uY29weUZyb20odGhpcy5pbnZlcnNlU2NlbmVUcmFuc2Zvcm0pO1xyXG5cdFx0XHR0aGlzLl92aWV3UHJvamVjdGlvbi5hcHBlbmQodGhpcy5fcHJvamVjdGlvbi5tYXRyaXgpO1xyXG5cdFx0XHR0aGlzLl92aWV3UHJvamVjdGlvbkRpcnR5ID0gZmFsc2U7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIHRoaXMuX3ZpZXdQcm9qZWN0aW9uO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQ2FsY3VsYXRlcyB0aGUgcmF5IGluIHNjZW5lIHNwYWNlIGZyb20gdGhlIGNhbWVyYSB0byB0aGUgZ2l2ZW4gbm9ybWFsaXplZCBjb29yZGluYXRlcyBpbiBzY3JlZW4gc3BhY2UuXHJcblx0ICpcclxuXHQgKiBAcGFyYW0gblggVGhlIG5vcm1hbGlzZWQgeCBjb29yZGluYXRlIGluIHNjcmVlbiBzcGFjZSwgLTEgY29ycmVzcG9uZHMgdG8gdGhlIGxlZnQgZWRnZSBvZiB0aGUgdmlld3BvcnQsIDEgdG8gdGhlIHJpZ2h0LlxyXG5cdCAqIEBwYXJhbSBuWSBUaGUgbm9ybWFsaXNlZCB5IGNvb3JkaW5hdGUgaW4gc2NyZWVuIHNwYWNlLCAtMSBjb3JyZXNwb25kcyB0byB0aGUgdG9wIGVkZ2Ugb2YgdGhlIHZpZXdwb3J0LCAxIHRvIHRoZSBib3R0b20uXHJcblx0ICogQHBhcmFtIHNaIFRoZSB6IGNvb3JkaW5hdGUgaW4gc2NyZWVuIHNwYWNlLCByZXByZXNlbnRpbmcgdGhlIGRpc3RhbmNlIGludG8gdGhlIHNjcmVlbi5cclxuXHQgKiBAcmV0dXJuIFRoZSByYXkgZnJvbSB0aGUgY2FtZXJhIHRvIHRoZSBzY2VuZSBzcGFjZSBwb3NpdGlvbiBvZiB0aGUgZ2l2ZW4gc2NyZWVuIGNvb3JkaW5hdGVzLlxyXG5cdCAqL1xyXG5cdHB1YmxpYyBnZXRSYXkoblg6bnVtYmVyLCBuWTpudW1iZXIsIHNaOm51bWJlcik6VmVjdG9yM0RcclxuXHR7XHJcblx0XHRyZXR1cm4gdGhpcy5zY2VuZVRyYW5zZm9ybS5kZWx0YVRyYW5zZm9ybVZlY3Rvcih0aGlzLl9wcm9qZWN0aW9uLnVucHJvamVjdChuWCwgblksIHNaKSk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBDYWxjdWxhdGVzIHRoZSBub3JtYWxpc2VkIHBvc2l0aW9uIGluIHNjcmVlbiBzcGFjZSBvZiB0aGUgZ2l2ZW4gc2NlbmUgcG9zaXRpb24uXHJcblx0ICpcclxuXHQgKiBAcGFyYW0gcG9pbnQzZCB0aGUgcG9zaXRpb24gdmVjdG9yIG9mIHRoZSBzY2VuZSBjb29yZGluYXRlcyB0byBiZSBwcm9qZWN0ZWQuXHJcblx0ICogQHJldHVybiBUaGUgbm9ybWFsaXNlZCBzY3JlZW4gcG9zaXRpb24gb2YgdGhlIGdpdmVuIHNjZW5lIGNvb3JkaW5hdGVzLlxyXG5cdCAqL1xyXG5cdHB1YmxpYyBwcm9qZWN0KHBvaW50M2Q6VmVjdG9yM0QpOlZlY3RvcjNEXHJcblx0e1xyXG5cdFx0cmV0dXJuIHRoaXMuX3Byb2plY3Rpb24ucHJvamVjdCh0aGlzLmludmVyc2VTY2VuZVRyYW5zZm9ybS50cmFuc2Zvcm1WZWN0b3IocG9pbnQzZCkpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQ2FsY3VsYXRlcyB0aGUgc2NlbmUgcG9zaXRpb24gb2YgdGhlIGdpdmVuIG5vcm1hbGl6ZWQgY29vcmRpbmF0ZXMgaW4gc2NyZWVuIHNwYWNlLlxyXG5cdCAqXHJcblx0ICogQHBhcmFtIG5YIFRoZSBub3JtYWxpc2VkIHggY29vcmRpbmF0ZSBpbiBzY3JlZW4gc3BhY2UsIG1pbnVzIHRoZSBvcmlnaW5YIG9mZnNldCBvZiB0aGUgcHJvamVjdGlvbiBwcm9wZXJ0eS5cclxuXHQgKiBAcGFyYW0gblkgVGhlIG5vcm1hbGlzZWQgeSBjb29yZGluYXRlIGluIHNjcmVlbiBzcGFjZSwgbWludXMgdGhlIG9yaWdpblkgb2Zmc2V0IG9mIHRoZSBwcm9qZWN0aW9uIHByb3BlcnR5LlxyXG5cdCAqIEBwYXJhbSBzWiBUaGUgeiBjb29yZGluYXRlIGluIHNjcmVlbiBzcGFjZSwgcmVwcmVzZW50aW5nIHRoZSBkaXN0YW5jZSBpbnRvIHRoZSBzY3JlZW4uXHJcblx0ICogQHJldHVybiBUaGUgc2NlbmUgcG9zaXRpb24gb2YgdGhlIGdpdmVuIHNjcmVlbiBjb29yZGluYXRlcy5cclxuXHQgKi9cclxuXHRwdWJsaWMgdW5wcm9qZWN0KG5YOm51bWJlciwgblk6bnVtYmVyLCBzWjpudW1iZXIpOlZlY3RvcjNEXHJcblx0e1xyXG5cdFx0cmV0dXJuIHRoaXMuc2NlbmVUcmFuc2Zvcm0udHJhbnNmb3JtVmVjdG9yKHRoaXMuX3Byb2plY3Rpb24udW5wcm9qZWN0KG5YLCBuWSwgc1opKTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBfaUNvbGxlY3RSZW5kZXJhYmxlcyhyZW5kZXJlclBvb2w6SVJlbmRlcmVyUG9vbClcclxuXHR7XHJcblx0XHQvLyBTaW5jZSB0aGlzIGdldHRlciBpcyBpbnZva2VkIGV2ZXJ5IGl0ZXJhdGlvbiBvZiB0aGUgcmVuZGVyIGxvb3AsIGFuZFxyXG5cdFx0Ly8gdGhlIHByZWZhYiBjb25zdHJ1Y3QgY291bGQgYWZmZWN0IHRoZSBzdWItbWVzaGVzLCB0aGUgcHJlZmFiIGlzXHJcblx0XHQvLyB2YWxpZGF0ZWQgaGVyZSB0byBnaXZlIGl0IGEgY2hhbmNlIHRvIHJlYnVpbGQuXHJcblx0XHRpZiAodGhpcy5faVNvdXJjZVByZWZhYilcclxuXHRcdFx0dGhpcy5faVNvdXJjZVByZWZhYi5faVZhbGlkYXRlKCk7XHJcblxyXG5cdFx0dGhpcy5faUNvbGxlY3RSZW5kZXJhYmxlKHJlbmRlcmVyUG9vbCk7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgX2lDb2xsZWN0UmVuZGVyYWJsZShyZW5kZXJlclBvb2w6SVJlbmRlcmVyUG9vbClcclxuXHR7XHJcblx0XHQvL25vdGhpbmcgdG8gZG8gaGVyZVxyXG5cdH1cclxuXHJcblx0cHVibGljIF9wUmVnaXN0ZXJFbnRpdHkocGFydGl0aW9uOlBhcnRpdGlvbilcclxuXHR7XHJcblx0XHRwYXJ0aXRpb24uX2lSZWdpc3RlckNhbWVyYSh0aGlzKTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBfcFVucmVnaXN0ZXJFbnRpdHkocGFydGl0aW9uOlBhcnRpdGlvbilcclxuXHR7XHJcblx0XHRwYXJ0aXRpb24uX2lVbnJlZ2lzdGVyQ2FtZXJhKHRoaXMpO1xyXG5cdH1cclxufVxyXG5cclxuZXhwb3J0ID0gQ2FtZXJhOyJdfQ==