var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var NullBounds = require("awayjs-core/lib/bounds/NullBounds");
var Matrix3D = require("awayjs-core/lib/geom/Matrix3D");
var Plane3D = require("awayjs-core/lib/geom/Plane3D");
var AssetType = require("awayjs-core/lib/library/AssetType");
var ProjectionEvent = require("awayjs-core/lib/events/ProjectionEvent");
var PerspectiveProjection = require("awayjs-core/lib/projections/PerspectiveProjection");
var DisplayObjectContainer = require("awayjs-display/lib/containers/DisplayObjectContainer");
var CameraEvent = require("awayjs-display/lib/events/CameraEvent");
var CameraNode = require("awayjs-display/lib/partition/CameraNode");
var Camera = (function (_super) {
    __extends(Camera, _super);
    function Camera(projection) {
        var _this = this;
        if (projection === void 0) { projection = null; }
        _super.call(this);
        this._viewProjection = new Matrix3D();
        this._viewProjectionDirty = true;
        this._frustumPlanesDirty = true;
        this._pIsEntity = true;
        this._onProjectionMatrixChangedDelegate = function (event) { return _this.onProjectionMatrixChanged(event); };
        this._projection = projection || new PerspectiveProjection();
        this._projection.addEventListener(ProjectionEvent.MATRIX_CHANGED, this._onProjectionMatrixChangedDelegate);
        this._frustumPlanes = [];
        for (var i = 0; i < 6; ++i)
            this._frustumPlanes[i] = new Plane3D();
        this.z = -1000;
    }
    Camera.prototype.pCreateDefaultBoundingVolume = function () {
        return new NullBounds();
    };
    /**
     * @protected
     */
    Camera.prototype.pCreateEntityPartitionNode = function () {
        return new CameraNode(this);
    };
    Object.defineProperty(Camera.prototype, "assetType", {
        //@override
        get: function () {
            return AssetType.CAMERA;
        },
        enumerable: true,
        configurable: true
    });
    Camera.prototype.onProjectionMatrixChanged = function (event) {
        this._viewProjectionDirty = true;
        this._frustumPlanesDirty = true;
        this.dispatchEvent(event);
    };
    Object.defineProperty(Camera.prototype, "frustumPlanes", {
        get: function () {
            if (this._frustumPlanesDirty)
                this.updateFrustum();
            return this._frustumPlanes;
        },
        enumerable: true,
        configurable: true
    });
    Camera.prototype.updateFrustum = function () {
        var a, b, c;
        //var d : Number;
        var c11, c12, c13, c14;
        var c21, c22, c23, c24;
        var c31, c32, c33, c34;
        var c41, c42, c43, c44;
        var p;
        var raw = new Array(16);
        ;
        var invLen;
        this.viewProjection.copyRawDataTo(raw);
        c11 = raw[0];
        c12 = raw[4];
        c13 = raw[8];
        c14 = raw[12];
        c21 = raw[1];
        c22 = raw[5];
        c23 = raw[9];
        c24 = raw[13];
        c31 = raw[2];
        c32 = raw[6];
        c33 = raw[10];
        c34 = raw[14];
        c41 = raw[3];
        c42 = raw[7];
        c43 = raw[11];
        c44 = raw[15];
        // left plane
        p = this._frustumPlanes[0];
        a = c41 + c11;
        b = c42 + c12;
        c = c43 + c13;
        invLen = 1 / Math.sqrt(a * a + b * b + c * c);
        p.a = a * invLen;
        p.b = b * invLen;
        p.c = c * invLen;
        p.d = -(c44 + c14) * invLen;
        // right plane
        p = this._frustumPlanes[1];
        a = c41 - c11;
        b = c42 - c12;
        c = c43 - c13;
        invLen = 1 / Math.sqrt(a * a + b * b + c * c);
        p.a = a * invLen;
        p.b = b * invLen;
        p.c = c * invLen;
        p.d = (c14 - c44) * invLen;
        // bottom
        p = this._frustumPlanes[2];
        a = c41 + c21;
        b = c42 + c22;
        c = c43 + c23;
        invLen = 1 / Math.sqrt(a * a + b * b + c * c);
        p.a = a * invLen;
        p.b = b * invLen;
        p.c = c * invLen;
        p.d = -(c44 + c24) * invLen;
        // top
        p = this._frustumPlanes[3];
        a = c41 - c21;
        b = c42 - c22;
        c = c43 - c23;
        invLen = 1 / Math.sqrt(a * a + b * b + c * c);
        p.a = a * invLen;
        p.b = b * invLen;
        p.c = c * invLen;
        p.d = (c24 - c44) * invLen;
        // near
        p = this._frustumPlanes[4];
        a = c31;
        b = c32;
        c = c33;
        invLen = 1 / Math.sqrt(a * a + b * b + c * c);
        p.a = a * invLen;
        p.b = b * invLen;
        p.c = c * invLen;
        p.d = -c34 * invLen;
        // far
        p = this._frustumPlanes[5];
        a = c41 - c31;
        b = c42 - c32;
        c = c43 - c33;
        invLen = 1 / Math.sqrt(a * a + b * b + c * c);
        p.a = a * invLen;
        p.b = b * invLen;
        p.c = c * invLen;
        p.d = (c34 - c44) * invLen;
        this._frustumPlanesDirty = false;
    };
    /**
     * @protected
     */
    Camera.prototype.pInvalidateSceneTransform = function () {
        _super.prototype.pInvalidateSceneTransform.call(this);
        this._viewProjectionDirty = true;
        this._frustumPlanesDirty = true;
    };
    /**
     * @protected
     */
    Camera.prototype.pUpdateBounds = function () {
        this._pBoundsInvalid = false;
        this._pBounds.nullify();
    };
    Object.defineProperty(Camera.prototype, "projection", {
        /**
         *
         */
        get: function () {
            return this._projection;
        },
        set: function (value) {
            if (this._projection == value)
                return;
            if (!value)
                throw new Error("Projection cannot be null!");
            this._projection.removeEventListener(ProjectionEvent.MATRIX_CHANGED, this._onProjectionMatrixChangedDelegate);
            this._projection = value;
            this._projection.addEventListener(ProjectionEvent.MATRIX_CHANGED, this._onProjectionMatrixChangedDelegate);
            this.dispatchEvent(new CameraEvent(CameraEvent.PROJECTION_CHANGED, this));
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Camera.prototype, "viewProjection", {
        /**
         *
         */
        get: function () {
            if (this._viewProjectionDirty) {
                this._viewProjection.copyFrom(this.inverseSceneTransform);
                this._viewProjection.append(this._projection.matrix);
                this._viewProjectionDirty = false;
            }
            return this._viewProjection;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Calculates the ray in scene space from the camera to the given normalized coordinates in screen space.
     *
     * @param nX The normalised x coordinate in screen space, -1 corresponds to the left edge of the viewport, 1 to the right.
     * @param nY The normalised y coordinate in screen space, -1 corresponds to the top edge of the viewport, 1 to the bottom.
     * @param sZ The z coordinate in screen space, representing the distance into the screen.
     * @return The ray from the camera to the scene space position of the given screen coordinates.
     */
    Camera.prototype.getRay = function (nX, nY, sZ) {
        return this.sceneTransform.deltaTransformVector(this._projection.unproject(nX, nY, sZ));
    };
    /**
     * Calculates the normalised position in screen space of the given scene position.
     *
     * @param point3d the position vector of the scene coordinates to be projected.
     * @return The normalised screen position of the given scene coordinates.
     */
    Camera.prototype.project = function (point3d) {
        return this._projection.project(this.inverseSceneTransform.transformVector(point3d));
    };
    /**
     * Calculates the scene position of the given normalized coordinates in screen space.
     *
     * @param nX The normalised x coordinate in screen space, minus the originX offset of the projection property.
     * @param nY The normalised y coordinate in screen space, minus the originY offset of the projection property.
     * @param sZ The z coordinate in screen space, representing the distance into the screen.
     * @return The scene position of the given screen coordinates.
     */
    Camera.prototype.unproject = function (nX, nY, sZ) {
        return this.sceneTransform.transformVector(this._projection.unproject(nX, nY, sZ));
    };
    Camera.prototype._iCollectRenderables = function (rendererPool) {
        // Since this getter is invoked every iteration of the render loop, and
        // the prefab construct could affect the sub-meshes, the prefab is
        // validated here to give it a chance to rebuild.
        if (this._iSourcePrefab)
            this._iSourcePrefab._iValidate();
        this._iCollectRenderable(rendererPool);
    };
    Camera.prototype._iCollectRenderable = function (rendererPool) {
        //nothing to do here
    };
    return Camera;
})(DisplayObjectContainer);
module.exports = Camera;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9DYW1lcmEudHMiXSwibmFtZXMiOlsiQ2FtZXJhIiwiQ2FtZXJhLmNvbnN0cnVjdG9yIiwiQ2FtZXJhLnBDcmVhdGVEZWZhdWx0Qm91bmRpbmdWb2x1bWUiLCJDYW1lcmEucENyZWF0ZUVudGl0eVBhcnRpdGlvbk5vZGUiLCJDYW1lcmEuYXNzZXRUeXBlIiwiQ2FtZXJhLm9uUHJvamVjdGlvbk1hdHJpeENoYW5nZWQiLCJDYW1lcmEuZnJ1c3R1bVBsYW5lcyIsIkNhbWVyYS51cGRhdGVGcnVzdHVtIiwiQ2FtZXJhLnBJbnZhbGlkYXRlU2NlbmVUcmFuc2Zvcm0iLCJDYW1lcmEucFVwZGF0ZUJvdW5kcyIsIkNhbWVyYS5wcm9qZWN0aW9uIiwiQ2FtZXJhLnZpZXdQcm9qZWN0aW9uIiwiQ2FtZXJhLmdldFJheSIsIkNhbWVyYS5wcm9qZWN0IiwiQ2FtZXJhLnVucHJvamVjdCIsIkNhbWVyYS5faUNvbGxlY3RSZW5kZXJhYmxlcyIsIkNhbWVyYS5faUNvbGxlY3RSZW5kZXJhYmxlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFDQSxJQUFPLFVBQVUsV0FBYyxtQ0FBbUMsQ0FBQyxDQUFDO0FBQ3BFLElBQU8sUUFBUSxXQUFlLCtCQUErQixDQUFDLENBQUM7QUFDL0QsSUFBTyxPQUFPLFdBQWUsOEJBQThCLENBQUMsQ0FBQztBQUU3RCxJQUFPLFNBQVMsV0FBYyxtQ0FBbUMsQ0FBQyxDQUFDO0FBQ25FLElBQU8sZUFBZSxXQUFhLHdDQUF3QyxDQUFDLENBQUM7QUFFN0UsSUFBTyxxQkFBcUIsV0FBVyxtREFBbUQsQ0FBQyxDQUFDO0FBRTVGLElBQU8sc0JBQXNCLFdBQVcsc0RBQXNELENBQUMsQ0FBQztBQUVoRyxJQUFPLFdBQVcsV0FBYyx1Q0FBdUMsQ0FBQyxDQUFDO0FBQ3pFLElBQU8sVUFBVSxXQUFjLHlDQUF5QyxDQUFDLENBQUM7QUFLMUUsSUFBTSxNQUFNO0lBQVNBLFVBQWZBLE1BQU1BLFVBQStCQTtJQVMx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QTtRQUNkQSxJQUFJQSxHQUFHQSxHQUFZQSxJQUFJQSxLQUFLQSxDQUFTQSxFQUFFQSxDQUFDQSxDQUFDQTtRQUN6Q0EsQ0FBQ0E7UUFDREEsSUFBSUEsTUFBYUEsQ0FBQ0E7UUFDbEJBLElBQUlBLENBQUNBLGNBQWNBLENBQUNBLGFBQWFBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1FBRXZDQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNiQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNiQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNiQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQTtRQUNkQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNiQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNiQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNiQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQTtRQUNkQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNiQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNiQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQTtRQUNkQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQTtRQUNkQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNiQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNiQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQTtRQUNkQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQTtRQUVkQSxBQUNBQSxhQURhQTtRQUNiQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxjQUFjQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUMzQkEsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0E7UUFDZEEsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0E7UUFDZEEsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0E7UUFDZEEsTUFBTUEsR0FBR0EsQ0FBQ0EsR0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDdENBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BLENBQUNBO1FBQ2ZBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BLENBQUNBO1FBQ2ZBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BLENBQUNBO1FBQ2ZBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BLENBQUNBO1FBRTFCQSxBQUNBQSxjQURjQTtRQUNkQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxjQUFjQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUMzQkEsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0E7UUFDZEEsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0E7UUFDZEEsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0E7UUFDZEEsTUFBTUEsR0FBR0EsQ0FBQ0EsR0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDdENBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BLENBQUNBO1FBQ2ZBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BLENBQUNBO1FBQ2ZBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BLENBQUNBO1FBQ2ZBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUdBLEdBQUdBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BLENBQUNBO1FBRXpCQSxBQUNBQSxTQURTQTtRQUNUQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxjQUFjQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUMzQkEsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0E7UUFDZEEsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0E7UUFDZEEsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0E7UUFDZEEsTUFBTUEsR0FBR0EsQ0FBQ0EsR0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDdENBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BLENBQUNBO1FBQ2ZBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BLENBQUNBO1FBQ2ZBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BLENBQUNBO1FBQ2ZBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BLENBQUNBO1FBRTFCQSxBQUNBQSxNQURNQTtRQUNOQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxjQUFjQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUMzQkEsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0E7UUFDZEEsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0E7UUFDZEEsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0E7UUFDZEEsTUFBTUEsR0FBR0EsQ0FBQ0EsR0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDdENBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BLENBQUNBO1FBQ2ZBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BLENBQUNBO1FBQ2ZBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BLENBQUNBO1FBQ2ZBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUdBLEdBQUdBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BLENBQUNBO1FBRXpCQSxBQUNBQSxPQURPQTtRQUNQQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxjQUFjQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUMzQkEsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0E7UUFDUkEsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0E7UUFDUkEsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0E7UUFDUkEsTUFBTUEsR0FBR0EsQ0FBQ0EsR0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDdENBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BLENBQUNBO1FBQ2ZBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BLENBQUNBO1FBQ2ZBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BLENBQUNBO1FBQ2ZBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUdBLEdBQUNBLE1BQU1BLENBQUNBO1FBRWxCQSxBQUNBQSxNQURNQTtRQUNOQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxjQUFjQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUMzQkEsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0E7UUFDZEEsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0E7UUFDZEEsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0E7UUFDZEEsTUFBTUEsR0FBR0EsQ0FBQ0EsR0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDdENBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BLENBQUNBO1FBQ2ZBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BLENBQUNBO1FBQ2ZBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BLENBQUNBO1FBQ2ZBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUdBLEdBQUdBLEdBQUdBLENBQUNBLEdBQUNBLE1BQU1BLENBQUNBO1FBRXpCQSxJQUFJQSxDQUFDQSxtQkFBbUJBLEdBQUdBLEtBQUtBLENBQUNBO0lBRWxDQSxDQUFDQTtJQUVEUDs7T0FFR0E7SUFDSUEsMENBQXlCQSxHQUFoQ0E7UUFFQ1EsZ0JBQUtBLENBQUNBLHlCQUF5QkEsV0FBRUEsQ0FBQ0E7UUFFbENBLElBQUlBLENBQUNBLG9CQUFvQkEsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFDakNBLElBQUlBLENBQUNBLG1CQUFtQkEsR0FBR0EsSUFBSUEsQ0FBQ0E7SUFDakNBLENBQUNBO0lBRURSOztPQUVHQTtJQUNJQSw4QkFBYUEsR0FBcEJBO1FBRUNTLElBQUlBLENBQUNBLGVBQWVBLEdBQUdBLEtBQUtBLENBQUNBO1FBQzdCQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxPQUFPQSxFQUFFQSxDQUFDQTtJQUN6QkEsQ0FBQ0E7SUFLRFQsc0JBQVdBLDhCQUFVQTtRQUhyQkE7O1dBRUdBO2FBQ0hBO1lBRUNVLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBO1FBQ3pCQSxDQUFDQTthQUVEVixVQUFzQkEsS0FBaUJBO1lBRXRDVSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxXQUFXQSxJQUFJQSxLQUFLQSxDQUFDQTtnQkFDN0JBLE1BQU1BLENBQUNBO1lBRVJBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLEtBQUtBLENBQUNBO2dCQUNWQSxNQUFNQSxJQUFJQSxLQUFLQSxDQUFDQSw0QkFBNEJBLENBQUNBLENBQUNBO1lBRS9DQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFDQSxtQkFBbUJBLENBQUNBLGVBQWVBLENBQUNBLGNBQWNBLEVBQUVBLElBQUlBLENBQUNBLGtDQUFrQ0EsQ0FBQ0EsQ0FBQ0E7WUFDOUdBLElBQUlBLENBQUNBLFdBQVdBLEdBQUdBLEtBQUtBLENBQUNBO1lBQ3pCQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFDQSxnQkFBZ0JBLENBQUNBLGVBQWVBLENBQUNBLGNBQWNBLEVBQUVBLElBQUlBLENBQUNBLGtDQUFrQ0EsQ0FBQ0EsQ0FBQ0E7WUFDM0dBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLElBQUlBLFdBQVdBLENBQUNBLFdBQVdBLENBQUNBLGtCQUFrQkEsRUFBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDM0VBLENBQUNBOzs7T0FkQVY7SUFtQkRBLHNCQUFXQSxrQ0FBY0E7UUFIekJBOztXQUVHQTthQUNIQTtZQUVDVyxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxvQkFBb0JBLENBQUNBLENBQUNBLENBQUNBO2dCQUMvQkEsSUFBSUEsQ0FBQ0EsZUFBZUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EscUJBQXFCQSxDQUFDQSxDQUFDQTtnQkFDMURBLElBQUlBLENBQUNBLGVBQWVBLENBQUNBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO2dCQUNyREEsSUFBSUEsQ0FBQ0Esb0JBQW9CQSxHQUFHQSxLQUFLQSxDQUFDQTtZQUNuQ0EsQ0FBQ0E7WUFFREEsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsZUFBZUEsQ0FBQ0E7UUFDN0JBLENBQUNBOzs7T0FBQVg7SUFFREE7Ozs7Ozs7T0FPR0E7SUFDSUEsdUJBQU1BLEdBQWJBLFVBQWNBLEVBQVNBLEVBQUVBLEVBQVNBLEVBQUVBLEVBQVNBO1FBRTVDWSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxjQUFjQSxDQUFDQSxvQkFBb0JBLENBQUNBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBLFNBQVNBLENBQUNBLEVBQUVBLEVBQUVBLEVBQUVBLEVBQUVBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO0lBQ3pGQSxDQUFDQTtJQUVEWjs7Ozs7T0FLR0E7SUFDSUEsd0JBQU9BLEdBQWRBLFVBQWVBLE9BQWdCQTtRQUU5QmEsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EscUJBQXFCQSxDQUFDQSxlQUFlQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQSxDQUFDQTtJQUN0RkEsQ0FBQ0E7SUFFRGI7Ozs7Ozs7T0FPR0E7SUFDSUEsMEJBQVNBLEdBQWhCQSxVQUFpQkEsRUFBU0EsRUFBRUEsRUFBU0EsRUFBRUEsRUFBU0E7UUFFL0NjLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLGNBQWNBLENBQUNBLGVBQWVBLENBQUNBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBLFNBQVNBLENBQUNBLEVBQUVBLEVBQUVBLEVBQUVBLEVBQUVBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO0lBQ3BGQSxDQUFDQTtJQUVNZCxxQ0FBb0JBLEdBQTNCQSxVQUE0QkEsWUFBMEJBO1FBRXJEZSxBQUdBQSx1RUFIdUVBO1FBQ3ZFQSxrRUFBa0VBO1FBQ2xFQSxpREFBaURBO1FBQ2pEQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxjQUFjQSxDQUFDQTtZQUN2QkEsSUFBSUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsVUFBVUEsRUFBRUEsQ0FBQ0E7UUFFbENBLElBQUlBLENBQUNBLG1CQUFtQkEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsQ0FBQ0E7SUFDeENBLENBQUNBO0lBRU1mLG9DQUFtQkEsR0FBMUJBLFVBQTJCQSxZQUEwQkE7UUFFcERnQixvQkFBb0JBO0lBQ3JCQSxDQUFDQTtJQUNGaEIsYUFBQ0E7QUFBREEsQ0FoUkEsQUFnUkNBLEVBaFJvQixzQkFBc0IsRUFnUjFDO0FBRUQsQUFBZ0IsaUJBQVAsTUFBTSxDQUFDIiwiZmlsZSI6ImVudGl0aWVzL0NhbWVyYS5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQm91bmRpbmdWb2x1bWVCYXNlXHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9ib3VuZHMvQm91bmRpbmdWb2x1bWVCYXNlXCIpO1xyXG5pbXBvcnQgTnVsbEJvdW5kc1x0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2JvdW5kcy9OdWxsQm91bmRzXCIpO1xyXG5pbXBvcnQgTWF0cml4M0RcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vTWF0cml4M0RcIik7XHJcbmltcG9ydCBQbGFuZTNEXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9nZW9tL1BsYW5lM0RcIik7XHJcbmltcG9ydCBWZWN0b3IzRFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9WZWN0b3IzRFwiKTtcclxuaW1wb3J0IEFzc2V0VHlwZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2xpYnJhcnkvQXNzZXRUeXBlXCIpO1xyXG5pbXBvcnQgUHJvamVjdGlvbkV2ZW50XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2V2ZW50cy9Qcm9qZWN0aW9uRXZlbnRcIik7XHJcbmltcG9ydCBJUHJvamVjdGlvblx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL3Byb2plY3Rpb25zL0lQcm9qZWN0aW9uXCIpO1xyXG5pbXBvcnQgUGVyc3BlY3RpdmVQcm9qZWN0aW9uXHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvcHJvamVjdGlvbnMvUGVyc3BlY3RpdmVQcm9qZWN0aW9uXCIpO1xyXG5cclxuaW1wb3J0IERpc3BsYXlPYmplY3RDb250YWluZXJcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9jb250YWluZXJzL0Rpc3BsYXlPYmplY3RDb250YWluZXJcIik7XHJcbmltcG9ydCBJRW50aXR5XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9JRW50aXR5XCIpO1xyXG5pbXBvcnQgQ2FtZXJhRXZlbnRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9ldmVudHMvQ2FtZXJhRXZlbnRcIik7XHJcbmltcG9ydCBDYW1lcmFOb2RlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvcGFydGl0aW9uL0NhbWVyYU5vZGVcIik7XHJcbmltcG9ydCBFbnRpdHlOb2RlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvcGFydGl0aW9uL0VudGl0eU5vZGVcIik7XHJcbmltcG9ydCBJUmVuZGVyZXJQb29sXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL3Bvb2wvSVJlbmRlcmVyUG9vbFwiKTtcclxuXHJcblxyXG5jbGFzcyBDYW1lcmEgZXh0ZW5kcyBEaXNwbGF5T2JqZWN0Q29udGFpbmVyIGltcGxlbWVudHMgSUVudGl0eVxyXG57XHJcblx0cHJpdmF0ZSBfdmlld1Byb2plY3Rpb246TWF0cml4M0QgPSBuZXcgTWF0cml4M0QoKTtcclxuXHRwcml2YXRlIF92aWV3UHJvamVjdGlvbkRpcnR5OkJvb2xlYW4gPSB0cnVlO1xyXG5cdHByaXZhdGUgX3Byb2plY3Rpb246SVByb2plY3Rpb247XHJcblx0cHJpdmF0ZSBfZnJ1c3R1bVBsYW5lczpBcnJheTxQbGFuZTNEPjtcclxuXHRwcml2YXRlIF9mcnVzdHVtUGxhbmVzRGlydHk6Qm9vbGVhbiA9IHRydWU7XHJcblx0cHJpdmF0ZSBfb25Qcm9qZWN0aW9uTWF0cml4Q2hhbmdlZERlbGVnYXRlOihldmVudDpQcm9qZWN0aW9uRXZlbnQpID0+IHZvaWQ7XHJcblxyXG5cdGNvbnN0cnVjdG9yKHByb2plY3Rpb246SVByb2plY3Rpb24gPSBudWxsKVxyXG5cdHtcclxuXHRcdHN1cGVyKCk7XHJcblxyXG5cdFx0dGhpcy5fcElzRW50aXR5ID0gdHJ1ZTtcclxuXHJcblx0XHR0aGlzLl9vblByb2plY3Rpb25NYXRyaXhDaGFuZ2VkRGVsZWdhdGUgPSAoZXZlbnQ6UHJvamVjdGlvbkV2ZW50KSA9PiB0aGlzLm9uUHJvamVjdGlvbk1hdHJpeENoYW5nZWQoZXZlbnQpO1xyXG5cclxuXHRcdHRoaXMuX3Byb2plY3Rpb24gPSBwcm9qZWN0aW9uIHx8IG5ldyBQZXJzcGVjdGl2ZVByb2plY3Rpb24oKTtcclxuXHRcdHRoaXMuX3Byb2plY3Rpb24uYWRkRXZlbnRMaXN0ZW5lcihQcm9qZWN0aW9uRXZlbnQuTUFUUklYX0NIQU5HRUQsIHRoaXMuX29uUHJvamVjdGlvbk1hdHJpeENoYW5nZWREZWxlZ2F0ZSk7XHJcblxyXG5cdFx0dGhpcy5fZnJ1c3R1bVBsYW5lcyA9IFtdO1xyXG5cclxuXHRcdGZvciAodmFyIGk6bnVtYmVyID0gMDsgaSA8IDY7ICsraSlcclxuXHRcdFx0dGhpcy5fZnJ1c3R1bVBsYW5lc1tpXSA9IG5ldyBQbGFuZTNEKCk7XHJcblxyXG5cdFx0dGhpcy56ID0gLTEwMDA7XHJcblxyXG5cdH1cclxuXHJcblx0cHVibGljIHBDcmVhdGVEZWZhdWx0Qm91bmRpbmdWb2x1bWUoKTpCb3VuZGluZ1ZvbHVtZUJhc2VcclxuXHR7XHJcblx0XHRyZXR1cm4gbmV3IE51bGxCb3VuZHMoKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwcm90ZWN0ZWRcclxuXHQgKi9cclxuXHRwdWJsaWMgcENyZWF0ZUVudGl0eVBhcnRpdGlvbk5vZGUoKTpFbnRpdHlOb2RlXHJcblx0e1xyXG5cdFx0cmV0dXJuIG5ldyBDYW1lcmFOb2RlKHRoaXMpO1xyXG5cdH1cclxuXHJcblx0Ly9Ab3ZlcnJpZGVcclxuXHRwdWJsaWMgZ2V0IGFzc2V0VHlwZSgpOnN0cmluZ1xyXG5cdHtcclxuXHRcdHJldHVybiBBc3NldFR5cGUuQ0FNRVJBO1xyXG5cdH1cclxuXHJcblx0cHJpdmF0ZSBvblByb2plY3Rpb25NYXRyaXhDaGFuZ2VkKGV2ZW50OlByb2plY3Rpb25FdmVudClcclxuXHR7XHJcblx0XHR0aGlzLl92aWV3UHJvamVjdGlvbkRpcnR5ID0gdHJ1ZTtcclxuXHRcdHRoaXMuX2ZydXN0dW1QbGFuZXNEaXJ0eSA9IHRydWU7XHJcblx0XHR0aGlzLmRpc3BhdGNoRXZlbnQoZXZlbnQpO1xyXG5cdH1cclxuXHJcblx0cHVibGljIGdldCBmcnVzdHVtUGxhbmVzKCk6QXJyYXk8UGxhbmUzRD5cclxuXHR7XHJcblx0XHRpZiAodGhpcy5fZnJ1c3R1bVBsYW5lc0RpcnR5KVxyXG5cdFx0XHR0aGlzLnVwZGF0ZUZydXN0dW0oKTtcclxuXHJcblx0XHRyZXR1cm4gdGhpcy5fZnJ1c3R1bVBsYW5lcztcclxuXHR9XHJcblxyXG5cdHByaXZhdGUgdXBkYXRlRnJ1c3R1bSgpXHJcblx0e1xyXG5cdFx0dmFyIGE6bnVtYmVyLCBiOm51bWJlciwgYzpudW1iZXI7XHJcblx0XHQvL3ZhciBkIDogTnVtYmVyO1xyXG5cdFx0dmFyIGMxMTpudW1iZXIsIGMxMjpudW1iZXIsIGMxMzpudW1iZXIsIGMxNDpudW1iZXI7XHJcblx0XHR2YXIgYzIxOm51bWJlciwgYzIyOm51bWJlciwgYzIzOm51bWJlciwgYzI0Om51bWJlcjtcclxuXHRcdHZhciBjMzE6bnVtYmVyLCBjMzI6bnVtYmVyLCBjMzM6bnVtYmVyLCBjMzQ6bnVtYmVyO1xyXG5cdFx0dmFyIGM0MTpudW1iZXIsIGM0MjpudW1iZXIsIGM0MzpudW1iZXIsIGM0NDpudW1iZXI7XHJcblx0XHR2YXIgcDpQbGFuZTNEO1xyXG5cdFx0dmFyIHJhdzpudW1iZXJbXSA9IG5ldyBBcnJheTxudW1iZXI+KDE2KTtcclxuXHRcdDsvL25ldyBBcnJheSgxNiApO2F3YXkudXRpbHMuTWF0cml4M0RVdGlscy5SQVdfREFUQV9DT05UQUlORVI7Ly9bXTtcclxuXHRcdHZhciBpbnZMZW46bnVtYmVyO1xyXG5cdFx0dGhpcy52aWV3UHJvamVjdGlvbi5jb3B5UmF3RGF0YVRvKHJhdyk7XHJcblxyXG5cdFx0YzExID0gcmF3WzBdO1xyXG5cdFx0YzEyID0gcmF3WzRdO1xyXG5cdFx0YzEzID0gcmF3WzhdO1xyXG5cdFx0YzE0ID0gcmF3WzEyXTtcclxuXHRcdGMyMSA9IHJhd1sxXTtcclxuXHRcdGMyMiA9IHJhd1s1XTtcclxuXHRcdGMyMyA9IHJhd1s5XTtcclxuXHRcdGMyNCA9IHJhd1sxM107XHJcblx0XHRjMzEgPSByYXdbMl07XHJcblx0XHRjMzIgPSByYXdbNl07XHJcblx0XHRjMzMgPSByYXdbMTBdO1xyXG5cdFx0YzM0ID0gcmF3WzE0XTtcclxuXHRcdGM0MSA9IHJhd1szXTtcclxuXHRcdGM0MiA9IHJhd1s3XTtcclxuXHRcdGM0MyA9IHJhd1sxMV07XHJcblx0XHRjNDQgPSByYXdbMTVdO1xyXG5cclxuXHRcdC8vIGxlZnQgcGxhbmVcclxuXHRcdHAgPSB0aGlzLl9mcnVzdHVtUGxhbmVzWzBdO1xyXG5cdFx0YSA9IGM0MSArIGMxMTtcclxuXHRcdGIgPSBjNDIgKyBjMTI7XHJcblx0XHRjID0gYzQzICsgYzEzO1xyXG5cdFx0aW52TGVuID0gMS9NYXRoLnNxcnQoYSphICsgYipiICsgYypjKTtcclxuXHRcdHAuYSA9IGEqaW52TGVuO1xyXG5cdFx0cC5iID0gYippbnZMZW47XHJcblx0XHRwLmMgPSBjKmludkxlbjtcclxuXHRcdHAuZCA9IC0oYzQ0ICsgYzE0KSppbnZMZW47XHJcblxyXG5cdFx0Ly8gcmlnaHQgcGxhbmVcclxuXHRcdHAgPSB0aGlzLl9mcnVzdHVtUGxhbmVzWzFdO1xyXG5cdFx0YSA9IGM0MSAtIGMxMTtcclxuXHRcdGIgPSBjNDIgLSBjMTI7XHJcblx0XHRjID0gYzQzIC0gYzEzO1xyXG5cdFx0aW52TGVuID0gMS9NYXRoLnNxcnQoYSphICsgYipiICsgYypjKTtcclxuXHRcdHAuYSA9IGEqaW52TGVuO1xyXG5cdFx0cC5iID0gYippbnZMZW47XHJcblx0XHRwLmMgPSBjKmludkxlbjtcclxuXHRcdHAuZCA9IChjMTQgLSBjNDQpKmludkxlbjtcclxuXHJcblx0XHQvLyBib3R0b21cclxuXHRcdHAgPSB0aGlzLl9mcnVzdHVtUGxhbmVzWzJdO1xyXG5cdFx0YSA9IGM0MSArIGMyMTtcclxuXHRcdGIgPSBjNDIgKyBjMjI7XHJcblx0XHRjID0gYzQzICsgYzIzO1xyXG5cdFx0aW52TGVuID0gMS9NYXRoLnNxcnQoYSphICsgYipiICsgYypjKTtcclxuXHRcdHAuYSA9IGEqaW52TGVuO1xyXG5cdFx0cC5iID0gYippbnZMZW47XHJcblx0XHRwLmMgPSBjKmludkxlbjtcclxuXHRcdHAuZCA9IC0oYzQ0ICsgYzI0KSppbnZMZW47XHJcblxyXG5cdFx0Ly8gdG9wXHJcblx0XHRwID0gdGhpcy5fZnJ1c3R1bVBsYW5lc1szXTtcclxuXHRcdGEgPSBjNDEgLSBjMjE7XHJcblx0XHRiID0gYzQyIC0gYzIyO1xyXG5cdFx0YyA9IGM0MyAtIGMyMztcclxuXHRcdGludkxlbiA9IDEvTWF0aC5zcXJ0KGEqYSArIGIqYiArIGMqYyk7XHJcblx0XHRwLmEgPSBhKmludkxlbjtcclxuXHRcdHAuYiA9IGIqaW52TGVuO1xyXG5cdFx0cC5jID0gYyppbnZMZW47XHJcblx0XHRwLmQgPSAoYzI0IC0gYzQ0KSppbnZMZW47XHJcblxyXG5cdFx0Ly8gbmVhclxyXG5cdFx0cCA9IHRoaXMuX2ZydXN0dW1QbGFuZXNbNF07XHJcblx0XHRhID0gYzMxO1xyXG5cdFx0YiA9IGMzMjtcclxuXHRcdGMgPSBjMzM7XHJcblx0XHRpbnZMZW4gPSAxL01hdGguc3FydChhKmEgKyBiKmIgKyBjKmMpO1xyXG5cdFx0cC5hID0gYSppbnZMZW47XHJcblx0XHRwLmIgPSBiKmludkxlbjtcclxuXHRcdHAuYyA9IGMqaW52TGVuO1xyXG5cdFx0cC5kID0gLWMzNCppbnZMZW47XHJcblxyXG5cdFx0Ly8gZmFyXHJcblx0XHRwID0gdGhpcy5fZnJ1c3R1bVBsYW5lc1s1XTtcclxuXHRcdGEgPSBjNDEgLSBjMzE7XHJcblx0XHRiID0gYzQyIC0gYzMyO1xyXG5cdFx0YyA9IGM0MyAtIGMzMztcclxuXHRcdGludkxlbiA9IDEvTWF0aC5zcXJ0KGEqYSArIGIqYiArIGMqYyk7XHJcblx0XHRwLmEgPSBhKmludkxlbjtcclxuXHRcdHAuYiA9IGIqaW52TGVuO1xyXG5cdFx0cC5jID0gYyppbnZMZW47XHJcblx0XHRwLmQgPSAoYzM0IC0gYzQ0KSppbnZMZW47XHJcblxyXG5cdFx0dGhpcy5fZnJ1c3R1bVBsYW5lc0RpcnR5ID0gZmFsc2U7XHJcblxyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHByb3RlY3RlZFxyXG5cdCAqL1xyXG5cdHB1YmxpYyBwSW52YWxpZGF0ZVNjZW5lVHJhbnNmb3JtKClcclxuXHR7XHJcblx0XHRzdXBlci5wSW52YWxpZGF0ZVNjZW5lVHJhbnNmb3JtKCk7XHJcblxyXG5cdFx0dGhpcy5fdmlld1Byb2plY3Rpb25EaXJ0eSA9IHRydWU7XHJcblx0XHR0aGlzLl9mcnVzdHVtUGxhbmVzRGlydHkgPSB0cnVlO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHByb3RlY3RlZFxyXG5cdCAqL1xyXG5cdHB1YmxpYyBwVXBkYXRlQm91bmRzKClcclxuXHR7XHJcblx0XHR0aGlzLl9wQm91bmRzSW52YWxpZCA9IGZhbHNlO1xyXG5cdFx0dGhpcy5fcEJvdW5kcy5udWxsaWZ5KCk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKlxyXG5cdCAqL1xyXG5cdHB1YmxpYyBnZXQgcHJvamVjdGlvbigpOklQcm9qZWN0aW9uXHJcblx0e1xyXG5cdFx0cmV0dXJuIHRoaXMuX3Byb2plY3Rpb247XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgc2V0IHByb2plY3Rpb24odmFsdWU6SVByb2plY3Rpb24pXHJcblx0e1xyXG5cdFx0aWYgKHRoaXMuX3Byb2plY3Rpb24gPT0gdmFsdWUpXHJcblx0XHRcdHJldHVybjtcclxuXHJcblx0XHRpZiAoIXZhbHVlKVxyXG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJQcm9qZWN0aW9uIGNhbm5vdCBiZSBudWxsIVwiKTtcclxuXHJcblx0XHR0aGlzLl9wcm9qZWN0aW9uLnJlbW92ZUV2ZW50TGlzdGVuZXIoUHJvamVjdGlvbkV2ZW50Lk1BVFJJWF9DSEFOR0VELCB0aGlzLl9vblByb2plY3Rpb25NYXRyaXhDaGFuZ2VkRGVsZWdhdGUpO1xyXG5cdFx0dGhpcy5fcHJvamVjdGlvbiA9IHZhbHVlO1xyXG5cdFx0dGhpcy5fcHJvamVjdGlvbi5hZGRFdmVudExpc3RlbmVyKFByb2plY3Rpb25FdmVudC5NQVRSSVhfQ0hBTkdFRCwgdGhpcy5fb25Qcm9qZWN0aW9uTWF0cml4Q2hhbmdlZERlbGVnYXRlKTtcclxuXHRcdHRoaXMuZGlzcGF0Y2hFdmVudChuZXcgQ2FtZXJhRXZlbnQoQ2FtZXJhRXZlbnQuUFJPSkVDVElPTl9DSEFOR0VELCB0aGlzKSk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKlxyXG5cdCAqL1xyXG5cdHB1YmxpYyBnZXQgdmlld1Byb2plY3Rpb24oKTpNYXRyaXgzRFxyXG5cdHtcclxuXHRcdGlmICh0aGlzLl92aWV3UHJvamVjdGlvbkRpcnR5KSB7XHJcblx0XHRcdHRoaXMuX3ZpZXdQcm9qZWN0aW9uLmNvcHlGcm9tKHRoaXMuaW52ZXJzZVNjZW5lVHJhbnNmb3JtKTtcclxuXHRcdFx0dGhpcy5fdmlld1Byb2plY3Rpb24uYXBwZW5kKHRoaXMuX3Byb2plY3Rpb24ubWF0cml4KTtcclxuXHRcdFx0dGhpcy5fdmlld1Byb2plY3Rpb25EaXJ0eSA9IGZhbHNlO1xyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiB0aGlzLl92aWV3UHJvamVjdGlvbjtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIENhbGN1bGF0ZXMgdGhlIHJheSBpbiBzY2VuZSBzcGFjZSBmcm9tIHRoZSBjYW1lcmEgdG8gdGhlIGdpdmVuIG5vcm1hbGl6ZWQgY29vcmRpbmF0ZXMgaW4gc2NyZWVuIHNwYWNlLlxyXG5cdCAqXHJcblx0ICogQHBhcmFtIG5YIFRoZSBub3JtYWxpc2VkIHggY29vcmRpbmF0ZSBpbiBzY3JlZW4gc3BhY2UsIC0xIGNvcnJlc3BvbmRzIHRvIHRoZSBsZWZ0IGVkZ2Ugb2YgdGhlIHZpZXdwb3J0LCAxIHRvIHRoZSByaWdodC5cclxuXHQgKiBAcGFyYW0gblkgVGhlIG5vcm1hbGlzZWQgeSBjb29yZGluYXRlIGluIHNjcmVlbiBzcGFjZSwgLTEgY29ycmVzcG9uZHMgdG8gdGhlIHRvcCBlZGdlIG9mIHRoZSB2aWV3cG9ydCwgMSB0byB0aGUgYm90dG9tLlxyXG5cdCAqIEBwYXJhbSBzWiBUaGUgeiBjb29yZGluYXRlIGluIHNjcmVlbiBzcGFjZSwgcmVwcmVzZW50aW5nIHRoZSBkaXN0YW5jZSBpbnRvIHRoZSBzY3JlZW4uXHJcblx0ICogQHJldHVybiBUaGUgcmF5IGZyb20gdGhlIGNhbWVyYSB0byB0aGUgc2NlbmUgc3BhY2UgcG9zaXRpb24gb2YgdGhlIGdpdmVuIHNjcmVlbiBjb29yZGluYXRlcy5cclxuXHQgKi9cclxuXHRwdWJsaWMgZ2V0UmF5KG5YOm51bWJlciwgblk6bnVtYmVyLCBzWjpudW1iZXIpOlZlY3RvcjNEXHJcblx0e1xyXG5cdFx0cmV0dXJuIHRoaXMuc2NlbmVUcmFuc2Zvcm0uZGVsdGFUcmFuc2Zvcm1WZWN0b3IodGhpcy5fcHJvamVjdGlvbi51bnByb2plY3QoblgsIG5ZLCBzWikpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQ2FsY3VsYXRlcyB0aGUgbm9ybWFsaXNlZCBwb3NpdGlvbiBpbiBzY3JlZW4gc3BhY2Ugb2YgdGhlIGdpdmVuIHNjZW5lIHBvc2l0aW9uLlxyXG5cdCAqXHJcblx0ICogQHBhcmFtIHBvaW50M2QgdGhlIHBvc2l0aW9uIHZlY3RvciBvZiB0aGUgc2NlbmUgY29vcmRpbmF0ZXMgdG8gYmUgcHJvamVjdGVkLlxyXG5cdCAqIEByZXR1cm4gVGhlIG5vcm1hbGlzZWQgc2NyZWVuIHBvc2l0aW9uIG9mIHRoZSBnaXZlbiBzY2VuZSBjb29yZGluYXRlcy5cclxuXHQgKi9cclxuXHRwdWJsaWMgcHJvamVjdChwb2ludDNkOlZlY3RvcjNEKTpWZWN0b3IzRFxyXG5cdHtcclxuXHRcdHJldHVybiB0aGlzLl9wcm9qZWN0aW9uLnByb2plY3QodGhpcy5pbnZlcnNlU2NlbmVUcmFuc2Zvcm0udHJhbnNmb3JtVmVjdG9yKHBvaW50M2QpKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIENhbGN1bGF0ZXMgdGhlIHNjZW5lIHBvc2l0aW9uIG9mIHRoZSBnaXZlbiBub3JtYWxpemVkIGNvb3JkaW5hdGVzIGluIHNjcmVlbiBzcGFjZS5cclxuXHQgKlxyXG5cdCAqIEBwYXJhbSBuWCBUaGUgbm9ybWFsaXNlZCB4IGNvb3JkaW5hdGUgaW4gc2NyZWVuIHNwYWNlLCBtaW51cyB0aGUgb3JpZ2luWCBvZmZzZXQgb2YgdGhlIHByb2plY3Rpb24gcHJvcGVydHkuXHJcblx0ICogQHBhcmFtIG5ZIFRoZSBub3JtYWxpc2VkIHkgY29vcmRpbmF0ZSBpbiBzY3JlZW4gc3BhY2UsIG1pbnVzIHRoZSBvcmlnaW5ZIG9mZnNldCBvZiB0aGUgcHJvamVjdGlvbiBwcm9wZXJ0eS5cclxuXHQgKiBAcGFyYW0gc1ogVGhlIHogY29vcmRpbmF0ZSBpbiBzY3JlZW4gc3BhY2UsIHJlcHJlc2VudGluZyB0aGUgZGlzdGFuY2UgaW50byB0aGUgc2NyZWVuLlxyXG5cdCAqIEByZXR1cm4gVGhlIHNjZW5lIHBvc2l0aW9uIG9mIHRoZSBnaXZlbiBzY3JlZW4gY29vcmRpbmF0ZXMuXHJcblx0ICovXHJcblx0cHVibGljIHVucHJvamVjdChuWDpudW1iZXIsIG5ZOm51bWJlciwgc1o6bnVtYmVyKTpWZWN0b3IzRFxyXG5cdHtcclxuXHRcdHJldHVybiB0aGlzLnNjZW5lVHJhbnNmb3JtLnRyYW5zZm9ybVZlY3Rvcih0aGlzLl9wcm9qZWN0aW9uLnVucHJvamVjdChuWCwgblksIHNaKSk7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgX2lDb2xsZWN0UmVuZGVyYWJsZXMocmVuZGVyZXJQb29sOklSZW5kZXJlclBvb2wpXHJcblx0e1xyXG5cdFx0Ly8gU2luY2UgdGhpcyBnZXR0ZXIgaXMgaW52b2tlZCBldmVyeSBpdGVyYXRpb24gb2YgdGhlIHJlbmRlciBsb29wLCBhbmRcclxuXHRcdC8vIHRoZSBwcmVmYWIgY29uc3RydWN0IGNvdWxkIGFmZmVjdCB0aGUgc3ViLW1lc2hlcywgdGhlIHByZWZhYiBpc1xyXG5cdFx0Ly8gdmFsaWRhdGVkIGhlcmUgdG8gZ2l2ZSBpdCBhIGNoYW5jZSB0byByZWJ1aWxkLlxyXG5cdFx0aWYgKHRoaXMuX2lTb3VyY2VQcmVmYWIpXHJcblx0XHRcdHRoaXMuX2lTb3VyY2VQcmVmYWIuX2lWYWxpZGF0ZSgpO1xyXG5cclxuXHRcdHRoaXMuX2lDb2xsZWN0UmVuZGVyYWJsZShyZW5kZXJlclBvb2wpO1xyXG5cdH1cclxuXHJcblx0cHVibGljIF9pQ29sbGVjdFJlbmRlcmFibGUocmVuZGVyZXJQb29sOklSZW5kZXJlclBvb2wpXHJcblx0e1xyXG5cdFx0Ly9ub3RoaW5nIHRvIGRvIGhlcmVcclxuXHR9XHJcbn1cclxuXHJcbmV4cG9ydCA9IENhbWVyYTsiXX0=