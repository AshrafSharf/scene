var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var AssetType = require("awayjs-core/lib/library/AssetType");
var DisplayObjectContainer = require("awayjs-display/lib/containers/DisplayObjectContainer");
/**
 * Timeline is a DisplayObjectContainer, that can control the animation of a list of TimeLineObjects.
 * For now, the focus of Development is on animating the new type of 2D-Geometry exported from FlashPro,
 * but there is no reason that this cannot be used to animate any type of object, that implements IAsset.
**/
var TimeLine = (function (_super) {
    __extends(TimeLine, _super);
    function TimeLine() {
        _super.call(this);
        this._duration = 0;
        this._timeLineObjs = new Array();
        this._frames = new Array();
        this._currentFrame = 0;
        this._speed = 1.0;
        this._isplaying = false;
        this._fps = 25;
        this._time = 0;
        this._duration = 0;
        this._playMode = 1;
    }
    Object.defineProperty(TimeLine.prototype, "speed", {
        get: function () {
            return this._speed;
        },
        set: function (newSpeed) {
            this._speed = newSpeed;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TimeLine.prototype, "fps", {
        get: function () {
            return this._fps;
        },
        set: function (newFps) {
            this._fps = newFps;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TimeLine.prototype, "assetType", {
        get: function () {
            return AssetType.TIMELINE;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * should be called right before the call to away3d-render.
     */
    TimeLine.prototype.update = function (timeDelta, jumpingToFrame) {
        if (jumpingToFrame === void 0) { jumpingToFrame = false; }
        var tlo;
        // only update if playing, or if not init before, or if jumping to frame
        if ((this._isplaying) || (!this._isInit) || (jumpingToFrame)) {
            // multiply the timeDelta with the speed (can be negative)
            // update the this._time accordingly
            var timeDelta = timeDelta * this._speed;
            this._time += timeDelta;
            while (this._time > this._duration) {
                if (this._playMode == 0) {
                    this._time = this._duration;
                    this.stop();
                }
                else if (this._playMode == 1) {
                    this._time -= this._duration;
                }
            }
            while (this._time < 0) {
                if (this._playMode == 0) {
                    this._time = 0;
                    this.stop();
                }
                else if (this._playMode == 1) {
                    this._time += this._duration;
                }
            }
            // now we know the exact time of the animation that we want to display.
            // next we need to decide which Frame needs to be displayed. (index in Array)
            // this should always be currentFrame, or currentFrame++
            // each frame has startTime and EndTime, so we can easily decide
            var frameCnt = 0;
            var curFrame;
            var foundFrame = false;
            while (frameCnt < this._frames.length) {
                curFrame = this._frames[this._currentFrame];
                //console.log("searchForFrame=="+this._time+" startTime= "+curFrame.startTime+" endTime = "+curFrame.endTime);
                if ((this._time >= curFrame.startTime) && (this._time <= curFrame.endTime)) {
                    foundFrame = true;
                    frameCnt = this._frames.length;
                }
                else {
                    curFrame.makeDirty(); // make sure the frame gets executed next time it should show
                    if (this._speed < 0) {
                        this._currentFrame--;
                        if (this._currentFrame < 0) {
                            this._currentFrame = this._frames.length - 1;
                        }
                    }
                    else {
                        this._currentFrame++;
                        if (this._currentFrame >= this._frames.length) {
                            this._currentFrame = 0;
                        }
                    }
                }
                frameCnt++;
            }
            //console.log("foundframe="+foundFrame+" thistime= "+this._time+" frameIDX = "+this._currentFrame);
            // if foundFrame is true, curFrame is the frame to display.
            if (foundFrame) {
                //console.log("Frame dirty="+curFrame.isDirty);
                if (curFrame.isDirty) {
                    //console.log("Reset isOnStage value");
                    // reset the "isOnStage" state for all the objects
                    var commandSet = 1; // 1 = execute normal playback commands
                    if (this._speed < 0) {
                        commandSet = 2; //2 = execute reversed playback commands
                    }
                    // if we are jumping Frames, we need to hide all objects and fully init
                    //if(jumpingToFrame) {
                    commandSet = 0; //0 = execute full init frame commands
                    for (tlo = 0; tlo < this._timeLineObjs.length; tlo++) {
                        if (this._timeLineObjs[tlo].isActive) {
                            this._timeLineObjs[tlo].deactivate();
                        }
                    }
                    // }
                    //todo: use the correct set of commands (for now we always use set 1)
                    curFrame.executeCommands(1, this._time, this._speed);
                    // now we have all objects on stage, we can execute the frame script for this frame
                    this.executeFrameScript(curFrame.script);
                }
                else {
                }
            }
            this._isInit = true;
        }
        for (tlo = 0; tlo < this._timeLineObjs.length; tlo++) {
            if (this._timeLineObjs[tlo].isActive) {
                if (this._timeLineObjs[tlo].asset.assetType == AssetType.TIMELINE) {
                    this._timeLineObjs[tlo].asset.update(timeDelta);
                }
            }
        }
    };
    /**
     * Add a new TimeLineFrame.
     */
    TimeLine.prototype.addFrame = function (newFrame) {
        this._duration += newFrame.duration;
        this._frames.push(newFrame);
    };
    Object.defineProperty(TimeLine.prototype, "duration", {
        get: function () {
            return this._duration;
        },
        set: function (newDuration) {
            this._duration = newDuration;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * This is called inside the TimeLineFrame.execute() function.
     */
    TimeLine.prototype.executeFrameScript = function (frameScript) {
        // this function should interpret the framescript.
        // the timeline object offer functions getObjectByInstanceName(instanceName:string)
        // a nested movieClip like "mainWindow.clip1" could be accessed like this:
        // getObjectByInstanceName("mainWindow").getObjectByInstanceName("clip1")
        // the AssetLibrary can be used as equivalent for the flash-library.
        // it already has options to access library-assets by name, so i think we can work with that.
    };
    /**
     * Starts playback of animation from current position
     */
    TimeLine.prototype.start = function () {
        this._isplaying = true;
        this.update(0);
    };
    /**
     * Stop playback of animation and hold current position
     */
    TimeLine.prototype.stop = function () {
        this._isplaying = false; // no need to call any other stuff
    };
    /**
     * Classic gotoAndPlay like as3 api - set frame by frame-number.
     */
    TimeLine.prototype.gotoAndPlay = function (frameNumber) {
        this._time = frameNumber * (1000 / this._fps);
        this._isplaying = true;
        this.update(0, true);
    };
    /**
     * Classic gotoAndStop as3 api - set frame by frame-number.
     */
    TimeLine.prototype.gotoAndStop = function (frameNumber) {
        this._time = frameNumber * (1000 / this._fps);
        this.update(0, true);
        this._isplaying = false; //stop playback again
    };
    /**
     * gotoAndPlay - set frame by frame-label.
     */
    TimeLine.prototype.gotoAndPlayLabel = function (frameLabel) {
        var frameNumber = -1;
        for (var i = 0; i < this._frames.length; i++) {
            for (var fl = 0; fl < this._frames[i].framelabels.length; fl++) {
                if (this._frames[i].framelabels[fl] == frameLabel) {
                    fl = this._frames[i].framelabels.length;
                    frameNumber = i;
                    i = this._frames.length;
                }
            }
        }
        if (frameNumber >= 0) {
            this._time = frameNumber * (1000 / this._fps);
            this._isplaying = true;
            this.update(0, true);
        }
    };
    /**
     * gotoAndStop - set frame by frame-label.
     */
    TimeLine.prototype.gotoAndStopLabel = function (frameLabel) {
        var frameNumber = -1;
        for (var i = 0; i < this._frames.length; i++) {
            for (var fl = 0; fl < this._frames[i].framelabels.length; fl++) {
                if (this._frames[i].framelabels[fl] == frameLabel) {
                    fl = this._frames[i].framelabels.length;
                    frameNumber = i;
                    i = this._frames.length;
                }
            }
        }
        if (frameNumber >= 0) {
            this._time = frameNumber * (1000 / this._fps);
            this.update(0, true);
            this._isplaying = false;
        }
    };
    /**
     * gotoAndPlay - set time in ms.
     */
    TimeLine.prototype.gotoAndPlayTime = function (time) {
        this._time = time;
        this._isplaying = true;
        this.update(0, true);
    };
    /**
     * gotoAndStop - set time in ms.
     */
    TimeLine.prototype.gotoAndStopTime = function (time) {
        this._time = time;
        this.update(0, true);
        this._isplaying = false; //stop playback again
    };
    TimeLine.prototype.addTimeLineObject = function (newTlObj, isDisplayObj) {
        if (isDisplayObj === void 0) { isDisplayObj = true; }
        if (isDisplayObj) {
            this.addChild(newTlObj.asset);
        }
        newTlObj.deactivate();
        this._timeLineObjs.push(newTlObj);
    };
    TimeLine.prototype.getTimeLineObjectByID = function (objID) {
        for (var tlo = 0; tlo < this._timeLineObjs.length; tlo++) {
            if (this._timeLineObjs[tlo].objID == objID) {
                return this._timeLineObjs[tlo];
            }
        }
        return undefined;
    };
    TimeLine.prototype.getObjectByInstanceName = function (instanceName) {
        for (var tlo = 0; tlo < this._timeLineObjs.length; tlo++) {
            if (this._timeLineObjs[tlo].asset.name == instanceName) {
                return this._timeLineObjs[tlo].asset;
            }
        }
    };
    return TimeLine;
})(DisplayObjectContainer);
module.exports = TimeLine;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy90aW1lbGluZS50cyJdLCJuYW1lcyI6WyJUaW1lTGluZSIsIlRpbWVMaW5lLmNvbnN0cnVjdG9yIiwiVGltZUxpbmUuc3BlZWQiLCJUaW1lTGluZS5mcHMiLCJUaW1lTGluZS5hc3NldFR5cGUiLCJUaW1lTGluZS51cGRhdGUiLCJUaW1lTGluZS5hZGRGcmFtZSIsIlRpbWVMaW5lLmR1cmF0aW9uIiwiVGltZUxpbmUuZXhlY3V0ZUZyYW1lU2NyaXB0IiwiVGltZUxpbmUuc3RhcnQiLCJUaW1lTGluZS5zdG9wIiwiVGltZUxpbmUuZ290b0FuZFBsYXkiLCJUaW1lTGluZS5nb3RvQW5kU3RvcCIsIlRpbWVMaW5lLmdvdG9BbmRQbGF5TGFiZWwiLCJUaW1lTGluZS5nb3RvQW5kU3RvcExhYmVsIiwiVGltZUxpbmUuZ290b0FuZFBsYXlUaW1lIiwiVGltZUxpbmUuZ290b0FuZFN0b3BUaW1lIiwiVGltZUxpbmUuYWRkVGltZUxpbmVPYmplY3QiLCJUaW1lTGluZS5nZXRUaW1lTGluZU9iamVjdEJ5SUQiLCJUaW1lTGluZS5nZXRPYmplY3RCeUluc3RhbmNlTmFtZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQ0EsSUFBTyxTQUFTLFdBQWUsbUNBQW1DLENBQUMsQ0FBQztBQWdCcEUsSUFBTyxzQkFBc0IsV0FBYSxzREFBc0QsQ0FBQyxDQUFDO0FBSWxHLEFBS0E7Ozs7R0FERztJQUNHLFFBQVE7SUFBU0EsVUFBakJBLFFBQVFBLFVBQStCQTtJQW9CekNBLFNBcEJFQSxRQUFRQTtRQXNCTkMsaUJBQU9BLENBQUNBO1FBSkpBLGNBQVNBLEdBQVFBLENBQUNBLENBQUNBO1FBS3ZCQSxJQUFJQSxDQUFDQSxhQUFhQSxHQUFDQSxJQUFJQSxLQUFLQSxFQUFrQkEsQ0FBQ0E7UUFDL0NBLElBQUlBLENBQUNBLE9BQU9BLEdBQUNBLElBQUlBLEtBQUtBLEVBQWlCQSxDQUFDQTtRQUN4Q0EsSUFBSUEsQ0FBQ0EsYUFBYUEsR0FB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QkFDckNBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1lBQ25DQSxDQUFDQTtRQUNMQSxDQUFDQTtRQUNEQSxNQUFNQSxDQUFDQSxTQUFTQSxDQUFDQTtJQUNyQkEsQ0FBQ0E7SUFDTWxCLDBDQUF1QkEsR0FBOUJBLFVBQStCQSxZQUFtQkE7UUFFOUNtQixHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFHQSxHQUFRQSxDQUFDQSxFQUFFQSxHQUFHQSxHQUFDQSxJQUFJQSxDQUFDQSxhQUFhQSxDQUFDQSxNQUFNQSxFQUFDQSxHQUFHQSxFQUFFQSxFQUFDQSxDQUFDQTtZQUN4REEsRUFBRUEsQ0FBQUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsSUFBSUEsSUFBRUEsWUFBWUEsQ0FBQ0EsQ0FBQUEsQ0FBQ0E7Z0JBQ2pEQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxhQUFhQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQTtZQUN6Q0EsQ0FBQ0E7UUFDTEEsQ0FBQ0E7SUFDTEEsQ0FBQ0E7SUFDTG5CLGVBQUNBO0FBQURBLENBdlRBLEFBdVRDQSxFQXZUc0Isc0JBQXNCLEVBdVQ1QztBQUVELEFBQWtCLGlCQUFULFFBQVEsQ0FBQyIsImZpbGUiOiJlbnRpdGllcy9UaW1lTGluZS5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgVVZUcmFuc2Zvcm1cdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vVVZUcmFuc2Zvcm1cIik7XHJcbmltcG9ydCBBc3NldFR5cGVcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2xpYnJhcnkvQXNzZXRUeXBlXCIpO1xyXG5pbXBvcnQgSUFzc2V0XHRcdFx0XHRcdCAgICA9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvbGlicmFyeS9JQXNzZXRcIik7XHJcbi8vaW1wb3J0IFRyYW5zZm9ybVx0XHRcdFx0ICAgID0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9nZW9tL1RyYW5zZm9ybVwiKTtcclxuaW1wb3J0IE1hdHJpeDNEXHRcdFx0XHRcdCAgICA9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9NYXRyaXgzRFwiKTtcclxuaW1wb3J0IE1hdHJpeFx0XHRcdFx0XHQgICAgPSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vTWF0cml4XCIpO1xyXG5cclxuaW1wb3J0IElBbmltYXRvclx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvYW5pbWF0b3JzL0lBbmltYXRvclwiKTtcclxuaW1wb3J0IFN1Ykdlb21ldHJ5QmFzZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2Jhc2UvU3ViR2VvbWV0cnlCYXNlXCIpO1xyXG5pbXBvcnQgU3ViR2VvbWV0cnlcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2Jhc2UvVHJpYW5nbGVTdWJHZW9tZXRyeVwiKTtcclxuaW1wb3J0IElTdWJNZXNoXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2Jhc2UvSVN1Yk1lc2hcIik7XHJcbmltcG9ydCBJU3ViTWVzaENsYXNzXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvYmFzZS9JU3ViTWVzaENsYXNzXCIpO1xyXG5pbXBvcnQgR2VvbWV0cnlcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvYmFzZS9HZW9tZXRyeVwiKTtcclxuaW1wb3J0IEdlb21ldHJ5RXZlbnRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9ldmVudHMvR2VvbWV0cnlFdmVudFwiKTtcclxuaW1wb3J0IE1hdGVyaWFsQmFzZVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvbWF0ZXJpYWxzL01hdGVyaWFsQmFzZVwiKTtcclxuaW1wb3J0IEVudGl0eU5vZGVcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL3BhcnRpdGlvbi9FbnRpdHlOb2RlXCIpO1xyXG5pbXBvcnQgSVJlbmRlcmVyXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9yZW5kZXIvSVJlbmRlcmVyXCIpO1xyXG5pbXBvcnQgRGlzcGxheU9iamVjdENvbnRhaW5lclx0XHQgPSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2NvbnRhaW5lcnMvRGlzcGxheU9iamVjdENvbnRhaW5lclwiKTtcclxuaW1wb3J0IFRpbWVMaW5lRnJhbWVcdFx0ICAgICAgICA9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvZW50aXRpZXMvdGltZWxpbmVkYXRhL1RpbWVMaW5lRnJhbWVcIik7XHJcbmltcG9ydCBUaW1lTGluZU9iamVjdFx0XHQgICAgICAgID0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy90aW1lbGluZWRhdGEvVGltZUxpbmVPYmplY3RcIik7XHJcblxyXG4vKipcclxuICogVGltZWxpbmUgaXMgYSBEaXNwbGF5T2JqZWN0Q29udGFpbmVyLCB0aGF0IGNhbiBjb250cm9sIHRoZSBhbmltYXRpb24gb2YgYSBsaXN0IG9mIFRpbWVMaW5lT2JqZWN0cy5cclxuICogRm9yIG5vdywgdGhlIGZvY3VzIG9mIERldmVsb3BtZW50IGlzIG9uIGFuaW1hdGluZyB0aGUgbmV3IHR5cGUgb2YgMkQtR2VvbWV0cnkgZXhwb3J0ZWQgZnJvbSBGbGFzaFBybyxcclxuICogYnV0IHRoZXJlIGlzIG5vIHJlYXNvbiB0aGF0IHRoaXMgY2Fubm90IGJlIHVzZWQgdG8gYW5pbWF0ZSBhbnkgdHlwZSBvZiBvYmplY3QsIHRoYXQgaW1wbGVtZW50cyBJQXNzZXQuXHJcbioqL1xyXG5jbGFzcyBUaW1lTGluZSBleHRlbmRzIERpc3BsYXlPYmplY3RDb250YWluZXJcclxue1xyXG4gICAgLy8gcG9vbCBvZiBhdmFpbGFibGUgVGltZUxpbmVPYmplY3Qtb2JqZWN0cyBmb3IgdGhpcyB0aW1lbGluZS5cclxuICAgIC8vIEVhY2ggVEltZUxpbmVPYmplY3QgaG9sZCByZWZlcmVuY2UgdG8gYSBwcmUtaW5zdGFuY2VkIChjbG9uZWQpIElBc3NldCxcclxuICAgIC8vIHNvIHdlIGRvIG5vdCBoYXZlIHRvIGRvIGFueSBjbG9uaW5nIHdoaWxlIHBsYXlpbmcuXHJcbiAgICAvLyBJZiBhIElBc3NldCBpcyBvZiBhIHR5cGUgdGhhdCBleHRlbmRzIERpc3BsYXlPYmplY3QsIGl0IGdldHMgYWRkZWQgYXMgQ2hpbGQsIHdpdGggLnZpc2libGU9ZmFsc2VcclxuICAgIC8vIHdlIG5lZWQgdGhpcyBsaXN0LCBhbmQgY2FuIG5vdCB1c2UgdGhlIGNoaWxkcmVuLWxpc3QgZGlyZWN0bHksXHJcbiAgICAvLyBiZWNhdXNlIFRpbWVMaW5lIG5lZWRzIHRvIGJlIGFibGUgdG8gY29udHJvbCBJQXNzZXQgdGhhdCB0byBub3QgZXh0ZW5kIERpc3BsYXlPYmplY3QuXHJcbiAgICBwcml2YXRlIF90aW1lTGluZU9ianM6QXJyYXk8VGltZUxpbmVPYmplY3Q+O1xyXG5cclxuICAgIHByaXZhdGUgX2ZyYW1lczpBcnJheTxUaW1lTGluZUZyYW1lPjtcclxuICAgIHByaXZhdGUgX3RpbWU6bnVtYmVyOy8vIHRoZSBjdXJyZW50IHRpbWUgaW5zaWRlIHRoZSBhbmltYXRpb25cclxuICAgIHByaXZhdGUgX2N1cnJlbnRGcmFtZTpudW1iZXI7Ly8gdGhlIGN1cnJlbnQgZnJhbWVcclxuICAgIHByaXZhdGUgX3NwZWVkOm51bWJlcjsvLyB0aGUgc3BlZWQgb2YgYW5pbWF0aW9uLiBmb3Igbm93IGtlZXAgaXQgcG9zaXRpdmUsIGFzIHJldmVyc2UgcGxheWluZyB3aWxsIG5lZWQgY2hhbmdlcyB0byB0aGUgY29tbWFuZHNcclxuICAgIHByaXZhdGUgX2ZwczpudW1iZXI7Ly8gd2UgdXNlIG1zIGludGVybmFsbHksIGJ1dCBoYXZlIGZwcywgc28gdXNlciBjYW4gc2V0IHRpbWUgYnkgZnJhbWVcclxuICAgIHByaXZhdGUgX2lzcGxheWluZzpib29sZWFuOy8vIGZhbHNlIGlmIHBhdXNlZCBvciBzdG9wcGVkXHJcbiAgICBwcml2YXRlIF9pc0luaXQ6Ym9vbGVhbjsvLyBmYWxzZSBpZiBwYXVzZWQgb3Igc3RvcHBlZFxyXG4gICAgcHJpdmF0ZSBfcGxheU1vZGU6bnVtYmVyOy8vIDA6IG5vcm1hbCwgMTogbG9vcCwgMjogcGluZ3BvbmdcclxuICAgIHByaXZhdGUgX2R1cmF0aW9uOm51bWJlcj0wO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKClcclxuICAgIHtcclxuICAgICAgICBzdXBlcigpO1xyXG4gICAgICAgIHRoaXMuX3RpbWVMaW5lT2Jqcz1uZXcgQXJyYXk8VGltZUxpbmVPYmplY3Q+KCk7XHJcbiAgICAgICAgdGhpcy5fZnJhbWVzPW5ldyBBcnJheTxUaW1lTGluZUZyYW1lPigpO1xyXG4gICAgICAgIHRoaXMuX2N1cnJlbnRGcmFtZT0wO1xyXG4gICAgICAgIHRoaXMuX3NwZWVkPTEuMDtcclxuICAgICAgICB0aGlzLl9pc3BsYXlpbmc9ZmFsc2U7XHJcbiAgICAgICAgdGhpcy5fZnBzPTI1O1xyXG4gICAgICAgIHRoaXMuX3RpbWU9MDtcclxuICAgICAgICB0aGlzLl9kdXJhdGlvbj0wO1xyXG4gICAgICAgIHRoaXMuX3BsYXlNb2RlPTE7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldCBzcGVlZCgpOm51bWJlclxyXG4gICAge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9zcGVlZDtcclxuICAgIH1cclxuICAgIHB1YmxpYyBzZXQgc3BlZWQobmV3U3BlZWQ6bnVtYmVyKVxyXG4gICAge1xyXG4gICAgICAgIHRoaXMuX3NwZWVkPW5ld1NwZWVkO1xyXG4gICAgfVxyXG4gICAgcHVibGljIGdldCBmcHMoKTpudW1iZXJcclxuICAgIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fZnBzO1xyXG4gICAgfVxyXG4gICAgcHVibGljIHNldCBmcHMobmV3RnBzOm51bWJlcilcclxuICAgIHtcclxuICAgICAgICB0aGlzLl9mcHM9bmV3RnBzO1xyXG4gICAgfVxyXG4gICAgcHVibGljIGdldCBhc3NldFR5cGUoKTpzdHJpbmdcclxuICAgIHtcclxuICAgICAgcmV0dXJuIEFzc2V0VHlwZS5USU1FTElORTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIHNob3VsZCBiZSBjYWxsZWQgcmlnaHQgYmVmb3JlIHRoZSBjYWxsIHRvIGF3YXkzZC1yZW5kZXIuXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyB1cGRhdGUodGltZURlbHRhOm51bWJlciwganVtcGluZ1RvRnJhbWU6Ym9vbGVhbj1mYWxzZSlcclxuICAgIHtcclxuICAgICAgICB2YXIgdGxvOm51bWJlcjtcclxuICAgICAgICAvLyBvbmx5IHVwZGF0ZSBpZiBwbGF5aW5nLCBvciBpZiBub3QgaW5pdCBiZWZvcmUsIG9yIGlmIGp1bXBpbmcgdG8gZnJhbWVcclxuICAgICAgICBpZigodGhpcy5faXNwbGF5aW5nKXx8KCF0aGlzLl9pc0luaXQpfHwoanVtcGluZ1RvRnJhbWUpKSB7XHJcblxyXG4gICAgICAgICAgICAvLyBtdWx0aXBseSB0aGUgdGltZURlbHRhIHdpdGggdGhlIHNwZWVkIChjYW4gYmUgbmVnYXRpdmUpXHJcbiAgICAgICAgICAgIC8vIHVwZGF0ZSB0aGUgdGhpcy5fdGltZSBhY2NvcmRpbmdseVxyXG4gICAgICAgICAgICB2YXIgdGltZURlbHRhOm51bWJlciA9IHRpbWVEZWx0YSAqIHRoaXMuX3NwZWVkO1xyXG4gICAgICAgICAgICB0aGlzLl90aW1lICs9IHRpbWVEZWx0YTtcclxuICAgICAgICAgICAgLy8gdGFrZSBjYXJlIHRoYXQgdGhlIF90aW1lIGlzIHdpdGhpbiBib3VuZHNcclxuICAgICAgICAgICAgd2hpbGUodGhpcy5fdGltZT50aGlzLl9kdXJhdGlvbil7XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLl9wbGF5TW9kZT09MCl7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGltZT10aGlzLl9kdXJhdGlvbjtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0b3AoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYodGhpcy5fcGxheU1vZGU9PTEpe1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3RpbWUtPXRoaXMuX2R1cmF0aW9uO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHdoaWxlKHRoaXMuX3RpbWU8MCl7XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLl9wbGF5TW9kZT09MCl7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGltZT0wO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3RvcCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZih0aGlzLl9wbGF5TW9kZT09MSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3RpbWUgKz0gdGhpcy5fZHVyYXRpb247XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICAvLyBub3cgd2Uga25vdyB0aGUgZXhhY3QgdGltZSBvZiB0aGUgYW5pbWF0aW9uIHRoYXQgd2Ugd2FudCB0byBkaXNwbGF5LlxyXG4gICAgICAgICAgICAvLyBuZXh0IHdlIG5lZWQgdG8gZGVjaWRlIHdoaWNoIEZyYW1lIG5lZWRzIHRvIGJlIGRpc3BsYXllZC4gKGluZGV4IGluIEFycmF5KVxyXG4gICAgICAgICAgICAvLyB0aGlzIHNob3VsZCBhbHdheXMgYmUgY3VycmVudEZyYW1lLCBvciBjdXJyZW50RnJhbWUrK1xyXG4gICAgICAgICAgICAvLyBlYWNoIGZyYW1lIGhhcyBzdGFydFRpbWUgYW5kIEVuZFRpbWUsIHNvIHdlIGNhbiBlYXNpbHkgZGVjaWRlXHJcbiAgICAgICAgICAgIHZhciBmcmFtZUNudDpudW1iZXIgPSAwO1xyXG4gICAgICAgICAgICB2YXIgY3VyRnJhbWU6VGltZUxpbmVGcmFtZTtcclxuICAgICAgICAgICAgdmFyIGZvdW5kRnJhbWU6Qm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgICAgICAgICAvLyB0aGlzIHdoaWxlIGxvb3Agc2hvdWxkIG9ubHkgYmUgZXhlY3V0ZWQgMS0yIHRpbWVzXHJcbiAgICAgICAgICAgIHdoaWxlIChmcmFtZUNudCA8IHRoaXMuX2ZyYW1lcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIGN1ckZyYW1lID0gdGhpcy5fZnJhbWVzW3RoaXMuX2N1cnJlbnRGcmFtZV07XHJcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKFwic2VhcmNoRm9yRnJhbWU9PVwiK3RoaXMuX3RpbWUrXCIgc3RhcnRUaW1lPSBcIitjdXJGcmFtZS5zdGFydFRpbWUrXCIgZW5kVGltZSA9IFwiK2N1ckZyYW1lLmVuZFRpbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICgodGhpcy5fdGltZSA+PSBjdXJGcmFtZS5zdGFydFRpbWUpICYmICh0aGlzLl90aW1lIDw9IGN1ckZyYW1lLmVuZFRpbWUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm91bmRGcmFtZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgZnJhbWVDbnQgPSB0aGlzLl9mcmFtZXMubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY3VyRnJhbWUubWFrZURpcnR5KCk7Ly8gbWFrZSBzdXJlIHRoZSBmcmFtZSBnZXRzIGV4ZWN1dGVkIG5leHQgdGltZSBpdCBzaG91bGQgc2hvd1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9zcGVlZCA8IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudEZyYW1lLS07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9jdXJyZW50RnJhbWUgPCAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50RnJhbWUgPSB0aGlzLl9mcmFtZXMubGVuZ3RoIC0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudEZyYW1lKys7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9jdXJyZW50RnJhbWUgPj0gdGhpcy5fZnJhbWVzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudEZyYW1lID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGZyYW1lQ250Kys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhcImZvdW5kZnJhbWU9XCIrZm91bmRGcmFtZStcIiB0aGlzdGltZT0gXCIrdGhpcy5fdGltZStcIiBmcmFtZUlEWCA9IFwiK3RoaXMuX2N1cnJlbnRGcmFtZSk7XHJcblxyXG4gICAgICAgICAgICAvLyBpZiBmb3VuZEZyYW1lIGlzIHRydWUsIGN1ckZyYW1lIGlzIHRoZSBmcmFtZSB0byBkaXNwbGF5LlxyXG4gICAgICAgICAgICBpZiAoZm91bmRGcmFtZSkge1xyXG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhcIkZyYW1lIGRpcnR5PVwiK2N1ckZyYW1lLmlzRGlydHkpO1xyXG4gICAgICAgICAgICAgICAgaWYoY3VyRnJhbWUuaXNEaXJ0eSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coXCJSZXNldCBpc09uU3RhZ2UgdmFsdWVcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gcmVzZXQgdGhlIFwiaXNPblN0YWdlXCIgc3RhdGUgZm9yIGFsbCB0aGUgb2JqZWN0c1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgY29tbWFuZFNldDpudW1iZXI9MTsvLyAxID0gZXhlY3V0ZSBub3JtYWwgcGxheWJhY2sgY29tbWFuZHNcclxuICAgICAgICAgICAgICAgICAgICBpZih0aGlzLl9zcGVlZDwwKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZFNldD0yOy8vMiA9IGV4ZWN1dGUgcmV2ZXJzZWQgcGxheWJhY2sgY29tbWFuZHNcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgd2UgYXJlIGp1bXBpbmcgRnJhbWVzLCB3ZSBuZWVkIHRvIGhpZGUgYWxsIG9iamVjdHMgYW5kIGZ1bGx5IGluaXRcclxuICAgICAgICAgICAgICAgICAgICAvL2lmKGp1bXBpbmdUb0ZyYW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRTZXQgPSAwOy8vMCA9IGV4ZWN1dGUgZnVsbCBpbml0IGZyYW1lIGNvbW1hbmRzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodGxvID0gMDsgdGxvIDwgdGhpcy5fdGltZUxpbmVPYmpzLmxlbmd0aDsgdGxvKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl90aW1lTGluZU9ianNbdGxvXS5pc0FjdGl2ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3RpbWVMaW5lT2Jqc1t0bG9dLmRlYWN0aXZhdGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgICAgICAgICAgICAgIC8vdG9kbzogdXNlIHRoZSBjb3JyZWN0IHNldCBvZiBjb21tYW5kcyAoZm9yIG5vdyB3ZSBhbHdheXMgdXNlIHNldCAxKVxyXG4gICAgICAgICAgICAgICAgICAgIGN1ckZyYW1lLmV4ZWN1dGVDb21tYW5kcygxLCB0aGlzLl90aW1lLCB0aGlzLl9zcGVlZCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIG5vdyB3ZSBoYXZlIGFsbCBvYmplY3RzIG9uIHN0YWdlLCB3ZSBjYW4gZXhlY3V0ZSB0aGUgZnJhbWUgc2NyaXB0IGZvciB0aGlzIGZyYW1lXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5leGVjdXRlRnJhbWVTY3JpcHQoY3VyRnJhbWUuc2NyaXB0KTtcclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNle1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHRoZSBmcmFtZSBoYXMgYWxyZWFkeSBiZWVuIGluaXRpYXRlZC5cclxuICAgICAgICAgICAgICAgICAgICAvLyBmb3Igbm93IHdlIGRvIG5vdGhpbmdcclxuICAgICAgICAgICAgICAgICAgICAvLyBsYXRlciB3ZSBtaWdodCB3YW50IHRvIGltcGxlbWVudCBpbnRlcnBvbGF0aW9uIGhlcmVcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLl9pc0luaXQ9dHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gdXBkYXRlIGFsbCB0aGUgdmlzaWJsZSBUaW1lTGluZU9iamVjdHMgdGhhdCBhcmUgb2YgdHlwZSB0aW1lbGluZVxyXG4gICAgICAgIGZvciAodGxvPTA7IHRsbzx0aGlzLl90aW1lTGluZU9ianMubGVuZ3RoO3RsbysrKXtcclxuICAgICAgICAgICAgaWYodGhpcy5fdGltZUxpbmVPYmpzW3Rsb10uaXNBY3RpdmUpe1xyXG4gICAgICAgICAgICAgICAgaWYodGhpcy5fdGltZUxpbmVPYmpzW3Rsb10uYXNzZXQuYXNzZXRUeXBlPT1Bc3NldFR5cGUuVElNRUxJTkUpe1xyXG4gICAgICAgICAgICAgICAgICAgICg8VGltZUxpbmU+dGhpcy5fdGltZUxpbmVPYmpzW3Rsb10uYXNzZXQpLnVwZGF0ZSh0aW1lRGVsdGEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQWRkIGEgbmV3IFRpbWVMaW5lRnJhbWUuXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBhZGRGcmFtZShuZXdGcmFtZTpUaW1lTGluZUZyYW1lKVxyXG4gICAge1xyXG4gICAgICAgIHRoaXMuX2R1cmF0aW9uKz1uZXdGcmFtZS5kdXJhdGlvbjtcclxuICAgICAgICB0aGlzLl9mcmFtZXMucHVzaChuZXdGcmFtZSk7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgZ2V0IGR1cmF0aW9uKCk6bnVtYmVyXHJcbiAgICB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2R1cmF0aW9uO1xyXG4gICAgfVxyXG4gICAgcHVibGljIHNldCBkdXJhdGlvbihuZXdEdXJhdGlvbjpudW1iZXIpXHJcbiAgICB7XHJcbiAgICAgICAgdGhpcy5fZHVyYXRpb249bmV3RHVyYXRpb247XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFRoaXMgaXMgY2FsbGVkIGluc2lkZSB0aGUgVGltZUxpbmVGcmFtZS5leGVjdXRlKCkgZnVuY3Rpb24uXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBleGVjdXRlRnJhbWVTY3JpcHQoZnJhbWVTY3JpcHQ6c3RyaW5nKVxyXG4gICAge1xyXG5cclxuICAgICAgICAvLyB0aGlzIGZ1bmN0aW9uIHNob3VsZCBpbnRlcnByZXQgdGhlIGZyYW1lc2NyaXB0LlxyXG4gICAgICAgIC8vIHRoZSB0aW1lbGluZSBvYmplY3Qgb2ZmZXIgZnVuY3Rpb25zIGdldE9iamVjdEJ5SW5zdGFuY2VOYW1lKGluc3RhbmNlTmFtZTpzdHJpbmcpXHJcbiAgICAgICAgLy8gYSBuZXN0ZWQgbW92aWVDbGlwIGxpa2UgXCJtYWluV2luZG93LmNsaXAxXCIgY291bGQgYmUgYWNjZXNzZWQgbGlrZSB0aGlzOlxyXG4gICAgICAgIC8vIGdldE9iamVjdEJ5SW5zdGFuY2VOYW1lKFwibWFpbldpbmRvd1wiKS5nZXRPYmplY3RCeUluc3RhbmNlTmFtZShcImNsaXAxXCIpXHJcblxyXG4gICAgICAgIC8vIHRoZSBBc3NldExpYnJhcnkgY2FuIGJlIHVzZWQgYXMgZXF1aXZhbGVudCBmb3IgdGhlIGZsYXNoLWxpYnJhcnkuXHJcbiAgICAgICAgLy8gaXQgYWxyZWFkeSBoYXMgb3B0aW9ucyB0byBhY2Nlc3MgbGlicmFyeS1hc3NldHMgYnkgbmFtZSwgc28gaSB0aGluayB3ZSBjYW4gd29yayB3aXRoIHRoYXQuXHJcblxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBTdGFydHMgcGxheWJhY2sgb2YgYW5pbWF0aW9uIGZyb20gY3VycmVudCBwb3NpdGlvblxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhcnQoKSB7XHJcbiAgICAgICAgdGhpcy5faXNwbGF5aW5nPXRydWU7XHJcbiAgICAgICAgdGhpcy51cGRhdGUoMCk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFN0b3AgcGxheWJhY2sgb2YgYW5pbWF0aW9uIGFuZCBob2xkIGN1cnJlbnQgcG9zaXRpb25cclxuICAgICAqL1xyXG4gICAgcHVibGljIHN0b3AoKSB7XHJcbiAgICAgICAgdGhpcy5faXNwbGF5aW5nPWZhbHNlOy8vIG5vIG5lZWQgdG8gY2FsbCBhbnkgb3RoZXIgc3R1ZmZcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIENsYXNzaWMgZ290b0FuZFBsYXkgbGlrZSBhczMgYXBpIC0gc2V0IGZyYW1lIGJ5IGZyYW1lLW51bWJlci5cclxuICAgICAqL1xyXG4gICAgcHVibGljIGdvdG9BbmRQbGF5KGZyYW1lTnVtYmVyOm51bWJlcil7XHJcbiAgICAgICAgdGhpcy5fdGltZT1mcmFtZU51bWJlciooMTAwMC90aGlzLl9mcHMpO1xyXG4gICAgICAgIHRoaXMuX2lzcGxheWluZz10cnVlO1xyXG4gICAgICAgIHRoaXMudXBkYXRlKDAsIHRydWUpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBDbGFzc2ljIGdvdG9BbmRTdG9wIGFzMyBhcGkgLSBzZXQgZnJhbWUgYnkgZnJhbWUtbnVtYmVyLlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgZ290b0FuZFN0b3AoZnJhbWVOdW1iZXI6bnVtYmVyKXtcclxuICAgICAgICB0aGlzLl90aW1lPWZyYW1lTnVtYmVyKigxMDAwL3RoaXMuX2Zwcyk7XHJcbiAgICAgICAgdGhpcy51cGRhdGUoMCwgdHJ1ZSk7XHJcbiAgICAgICAgdGhpcy5faXNwbGF5aW5nPWZhbHNlOy8vc3RvcCBwbGF5YmFjayBhZ2FpblxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBnb3RvQW5kUGxheSAtIHNldCBmcmFtZSBieSBmcmFtZS1sYWJlbC5cclxuICAgICAqL1xyXG4gICAgcHVibGljIGdvdG9BbmRQbGF5TGFiZWwoZnJhbWVMYWJlbDpzdHJpbmcpIHtcclxuICAgICAgICB2YXIgZnJhbWVOdW1iZXI6bnVtYmVyID0gLTE7XHJcbiAgICAgICAgZm9yICh2YXIgaTpudW1iZXIgPSAwOyBpIDwgdGhpcy5fZnJhbWVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGZsOm51bWJlciA9IDA7IGZsIDwgdGhpcy5fZnJhbWVzW2ldLmZyYW1lbGFiZWxzLmxlbmd0aDsgZmwrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2ZyYW1lc1tpXS5mcmFtZWxhYmVsc1tmbF0gPT0gZnJhbWVMYWJlbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZsID0gdGhpcy5fZnJhbWVzW2ldLmZyYW1lbGFiZWxzLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgICAgICBmcmFtZU51bWJlciA9IGk7XHJcbiAgICAgICAgICAgICAgICAgICAgaSA9IHRoaXMuX2ZyYW1lcy5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGZyYW1lTnVtYmVyID49IDApIHtcclxuICAgICAgICAgICAgdGhpcy5fdGltZSA9IGZyYW1lTnVtYmVyICogKDEwMDAgLyB0aGlzLl9mcHMpO1xyXG4gICAgICAgICAgICB0aGlzLl9pc3BsYXlpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZSgwLCB0cnVlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIGdvdG9BbmRTdG9wIC0gc2V0IGZyYW1lIGJ5IGZyYW1lLWxhYmVsLlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgZ290b0FuZFN0b3BMYWJlbChmcmFtZUxhYmVsOnN0cmluZykge1xyXG4gICAgICAgIHZhciBmcmFtZU51bWJlcjpudW1iZXIgPSAtMTtcclxuICAgICAgICBmb3IgKHZhciBpOm51bWJlciA9IDA7IGkgPCB0aGlzLl9mcmFtZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgZmw6bnVtYmVyID0gMDsgZmwgPCB0aGlzLl9mcmFtZXNbaV0uZnJhbWVsYWJlbHMubGVuZ3RoOyBmbCsrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fZnJhbWVzW2ldLmZyYW1lbGFiZWxzW2ZsXSA9PSBmcmFtZUxhYmVsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZmwgPSB0aGlzLl9mcmFtZXNbaV0uZnJhbWVsYWJlbHMubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgICAgIGZyYW1lTnVtYmVyID0gaTtcclxuICAgICAgICAgICAgICAgICAgICBpID0gdGhpcy5fZnJhbWVzLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZnJhbWVOdW1iZXIgPj0gMCkge1xyXG4gICAgICAgICAgICB0aGlzLl90aW1lID0gZnJhbWVOdW1iZXIgKiAoMTAwMCAvIHRoaXMuX2Zwcyk7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlKDAsIHRydWUpO1xyXG4gICAgICAgICAgICB0aGlzLl9pc3BsYXlpbmcgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIGdvdG9BbmRQbGF5IC0gc2V0IHRpbWUgaW4gbXMuXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBnb3RvQW5kUGxheVRpbWUodGltZTpudW1iZXIpe1xyXG4gICAgICAgIHRoaXMuX3RpbWU9dGltZTtcclxuICAgICAgICB0aGlzLl9pc3BsYXlpbmc9dHJ1ZTtcclxuICAgICAgICB0aGlzLnVwZGF0ZSgwLCB0cnVlKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogZ290b0FuZFN0b3AgLSBzZXQgdGltZSBpbiBtcy5cclxuICAgICAqL1xyXG4gICAgcHVibGljIGdvdG9BbmRTdG9wVGltZSh0aW1lOm51bWJlcil7XHJcbiAgICAgICAgdGhpcy5fdGltZT10aW1lO1xyXG4gICAgICAgIHRoaXMudXBkYXRlKDAsIHRydWUpO1xyXG4gICAgICAgIHRoaXMuX2lzcGxheWluZz1mYWxzZTsvL3N0b3AgcGxheWJhY2sgYWdhaW5cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgYWRkVGltZUxpbmVPYmplY3QobmV3VGxPYmo6VGltZUxpbmVPYmplY3QsIGlzRGlzcGxheU9iajpib29sZWFuPXRydWUpIHtcclxuICAgICAgICBpZiAoaXNEaXNwbGF5T2JqKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYWRkQ2hpbGQoPERpc3BsYXlPYmplY3RDb250YWluZXI+bmV3VGxPYmouYXNzZXQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBuZXdUbE9iai5kZWFjdGl2YXRlKCk7XHJcbiAgICAgICAgdGhpcy5fdGltZUxpbmVPYmpzLnB1c2gobmV3VGxPYmopO1xyXG4gICAgfVxyXG4gICAgcHVibGljIGdldFRpbWVMaW5lT2JqZWN0QnlJRChvYmpJRDpudW1iZXIpOlRpbWVMaW5lT2JqZWN0XHJcbiAgICB7XHJcbiAgICAgICAgZm9yICh2YXIgdGxvOm51bWJlcj0wOyB0bG88dGhpcy5fdGltZUxpbmVPYmpzLmxlbmd0aDt0bG8rKyl7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuX3RpbWVMaW5lT2Jqc1t0bG9dLm9iaklEPT1vYmpJRCl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdGltZUxpbmVPYmpzW3Rsb107XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgIH1cclxuICAgIHB1YmxpYyBnZXRPYmplY3RCeUluc3RhbmNlTmFtZShpbnN0YW5jZU5hbWU6c3RyaW5nKTpJQXNzZXRcclxuICAgIHtcclxuICAgICAgICBmb3IgKHZhciB0bG86bnVtYmVyPTA7IHRsbzx0aGlzLl90aW1lTGluZU9ianMubGVuZ3RoO3RsbysrKXtcclxuICAgICAgICAgICAgaWYodGhpcy5fdGltZUxpbmVPYmpzW3Rsb10uYXNzZXQubmFtZT09aW5zdGFuY2VOYW1lKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl90aW1lTGluZU9ianNbdGxvXS5hc3NldDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0ID0gVGltZUxpbmU7XHJcbiJdfQ==