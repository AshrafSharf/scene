var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var NullBounds = require("awayjs-core/lib/bounds/NullBounds");
var Matrix3D = require("awayjs-core/lib/geom/Matrix3D");
var Vector3D = require("awayjs-core/lib/geom/Vector3D");
var LightBase = require("awayjs-display/lib/base/LightBase");
var DirectionalLightNode = require("awayjs-display/lib/partition/DirectionalLightNode");
var DirectionalShadowMapper = require("awayjs-display/lib/materials/shadowmappers/DirectionalShadowMapper");
var DirectionalLight = (function (_super) {
    __extends(DirectionalLight, _super);
    function DirectionalLight(xDir, yDir, zDir) {
        if (xDir === void 0) { xDir = 0; }
        if (yDir === void 0) { yDir = -1; }
        if (zDir === void 0) { zDir = 1; }
        _super.call(this);
        this._pIsEntity = true;
        this.direction = new Vector3D(xDir, yDir, zDir);
        this._sceneDirection = new Vector3D();
    }
    Object.defineProperty(DirectionalLight.prototype, "sceneDirection", {
        get: function () {
            if (this._pSceneTransformDirty)
                this.pUpdateSceneTransform();
            return this._sceneDirection;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DirectionalLight.prototype, "direction", {
        get: function () {
            return this._direction;
        },
        set: function (value) {
            this._direction = value;
            if (!this._tmpLookAt)
                this._tmpLookAt = new Vector3D();
            this._tmpLookAt.x = this.x + this._direction.x;
            this._tmpLookAt.y = this.y + this._direction.y;
            this._tmpLookAt.z = this.z + this._direction.z;
            this.lookAt(this._tmpLookAt);
        },
        enumerable: true,
        configurable: true
    });
    /**
     *
     * @returns {away.bounds.NullBounds}
     */
    DirectionalLight.prototype.pCreateDefaultBoundingVolume = function () {
        //directional lights are to be considered global, hence always in view
        return new NullBounds();
    };
    /**
     *
     */
    DirectionalLight.prototype.pUpdateBounds = function () {
    };
    //@override
    DirectionalLight.prototype.pUpdateSceneTransform = function () {
        _super.prototype.pUpdateSceneTransform.call(this);
        this.sceneTransform.copyColumnTo(2, this._sceneDirection);
        this._sceneDirection.normalize();
    };
    //@override
    DirectionalLight.prototype.pCreateShadowMapper = function () {
        return new DirectionalShadowMapper();
    };
    /**
     * @protected
     */
    DirectionalLight.prototype.pCreateEntityPartitionNode = function () {
        return new DirectionalLightNode(this);
    };
    //override
    DirectionalLight.prototype.iGetObjectProjectionMatrix = function (entity, camera, target) {
        if (target === void 0) { target = null; }
        var raw = new Array();
        var bounds = entity.bounds;
        var m = new Matrix3D();
        m.copyFrom(entity.getRenderSceneTransform(camera));
        m.append(this.inverseSceneTransform);
        if (!this._projAABBPoints)
            this._projAABBPoints = [];
        m.transformVectors(bounds.aabbPoints, this._projAABBPoints);
        var xMin = Infinity, xMax = -Infinity;
        var yMin = Infinity, yMax = -Infinity;
        var zMin = Infinity, zMax = -Infinity;
        var d;
        for (var i = 0; i < 24;) {
            d = this._projAABBPoints[i++];
            if (d < xMin)
                xMin = d;
            if (d > xMax)
                xMax = d;
            d = this._projAABBPoints[i++];
            if (d < yMin)
                yMin = d;
            if (d > yMax)
                yMax = d;
            d = this._projAABBPoints[i++];
            if (d < zMin)
                zMin = d;
            if (d > zMax)
                zMax = d;
        }
        var invXRange = 1 / (xMax - xMin);
        var invYRange = 1 / (yMax - yMin);
        var invZRange = 1 / (zMax - zMin);
        raw[0] = 2 * invXRange;
        raw[5] = 2 * invYRange;
        raw[10] = invZRange;
        raw[12] = -(xMax + xMin) * invXRange;
        raw[13] = -(yMax + yMin) * invYRange;
        raw[14] = -zMin * invZRange;
        raw[1] = raw[2] = raw[3] = raw[4] = raw[6] = raw[7] = raw[8] = raw[9] = raw[11] = 0;
        raw[15] = 1;
        if (!target)
            target = new Matrix3D();
        target.copyRawDataFrom(raw);
        target.prepend(m);
        return target;
    };
    DirectionalLight.prototype._iCollectRenderables = function (rendererPool) {
        //nothing to do here
    };
    return DirectionalLight;
})(LightBase);
module.exports = DirectionalLight;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9EaXJlY3Rpb25hbExpZ2h0LnRzIl0sIm5hbWVzIjpbIkRpcmVjdGlvbmFsTGlnaHQiLCJEaXJlY3Rpb25hbExpZ2h0LmNvbnN0cnVjdG9yIiwiRGlyZWN0aW9uYWxMaWdodC5zY2VuZURpcmVjdGlvbiIsIkRpcmVjdGlvbmFsTGlnaHQuZGlyZWN0aW9uIiwiRGlyZWN0aW9uYWxMaWdodC5wQ3JlYXRlRGVmYXVsdEJvdW5kaW5nVm9sdW1lIiwiRGlyZWN0aW9uYWxMaWdodC5wVXBkYXRlQm91bmRzIiwiRGlyZWN0aW9uYWxMaWdodC5wVXBkYXRlU2NlbmVUcmFuc2Zvcm0iLCJEaXJlY3Rpb25hbExpZ2h0LnBDcmVhdGVTaGFkb3dNYXBwZXIiLCJEaXJlY3Rpb25hbExpZ2h0LnBDcmVhdGVFbnRpdHlQYXJ0aXRpb25Ob2RlIiwiRGlyZWN0aW9uYWxMaWdodC5pR2V0T2JqZWN0UHJvamVjdGlvbk1hdHJpeCIsIkRpcmVjdGlvbmFsTGlnaHQuX2lDb2xsZWN0UmVuZGVyYWJsZXMiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUNBLElBQU8sVUFBVSxXQUFlLG1DQUFtQyxDQUFDLENBQUM7QUFDckUsSUFBTyxRQUFRLFdBQWdCLCtCQUErQixDQUFDLENBQUM7QUFDaEUsSUFBTyxRQUFRLFdBQWdCLCtCQUErQixDQUFDLENBQUM7QUFFaEUsSUFBTyxTQUFTLFdBQWUsbUNBQW1DLENBQUMsQ0FBQztBQUNwRSxJQUFPLG9CQUFvQixXQUFhLG1EQUFtRCxDQUFDLENBQUM7QUFLN0YsSUFBTyx1QkFBdUIsV0FBWSxvRUFBb0UsQ0FBQyxDQUFDO0FBRWhILElBQU0sZ0JBQWdCO0lBQVNBLFVBQXpCQSxnQkFBZ0JBLFVBQWtCQTtJQU92Q0EsU0FQS0EsZ0JBQWdCQSxDQU9UQSxJQUFlQSxFQUFFQSxJQUFnQkEsRUFBRUEsSUFBZUE7UUFBbERDLG9CQUFlQSxHQUFmQSxRQUFlQTtRQUFFQSxvQkFBZ0JBLEdBQWhCQSxRQUFlQSxDQUFDQTtRQUFFQSxvQkFBZUEsR0FBZkEsUUFBZUE7UUFFN0RBLGlCQUFPQSxDQUFDQTtRQUVSQSxJQUFJQSxDQUFDQSxVQUFVQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUV2QkEsSUFBSUEsQ0FBQ0EsU0FBU0EsR0FBR0EsSUFBSUEsUUFBUUEsQ0FBQ0EsSUFBSUEsRUFBRUEsSUFBSUEsRUFBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFFaERBLElBQUlBLENBQUNBLGVBQWVBLEdBQUdBLElBQUlBLFFBQVFBLEVBQUVBLENBQUNBO0lBQ3ZDQSxDQUFDQTtJQUVERCxzQkFBV0EsNENBQWNBO2FBQXpCQTtZQUVDRSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxxQkFBcUJBLENBQUNBO2dCQUM5QkEsSUFBSUEsQ0FBQ0EscUJBQXFCQSxFQUFFQSxDQUFDQTtZQUU5QkEsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsZUFBZUEsQ0FBQ0E7UUFDN0JBLENBQUNBOzs7T0FBQUY7SUFFREEsc0JBQVdBLHVDQUFTQTthQUFwQkE7WUFFQ0csTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0E7UUFDeEJBLENBQUNBO2FBRURILFVBQXFCQSxLQUFjQTtZQUVsQ0csSUFBSUEsQ0FBQ0EsVUFBVUEsR0FBR0EsS0FBS0EsQ0FBQ0E7WUFFeEJBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLFVBQVVBLENBQUNBO2dCQUNwQkEsSUFBSUEsQ0FBQ0EsVUFBVUEsR0FBR0EsSUFBSUEsUUFBUUEsRUFBRUEsQ0FBQ0E7WUFFbENBLElBQUlBLENBQUNBLFVBQVVBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLFVBQVVBLENBQUNBLENBQUNBLENBQUNBO1lBQy9DQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUMvQ0EsSUFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFFL0NBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLFVBQVVBLENBQUNBLENBQUNBO1FBQzlCQSxDQUFDQTs7O09BZEFIO0lBZ0JEQTs7O09BR0dBO0lBQ0lBLHVEQUE0QkEsR0FBbkNBO1FBRUNJLEFBQ0FBLHNFQURzRUE7UUFDdEVBLE1BQU1BLENBQUNBLElBQUlBLFVBQVVBLEVBQUVBLENBQUNBO0lBQ3pCQSxDQUFDQTtJQUVESjs7T0FFR0E7SUFDSUEsd0NBQWFBLEdBQXBCQTtJQUVBSyxDQUFDQTtJQUVETCxXQUFXQTtJQUNKQSxnREFBcUJBLEdBQTVCQTtRQUVDTSxnQkFBS0EsQ0FBQ0EscUJBQXFCQSxXQUFFQSxDQUFDQTtRQUM5QkEsSUFBSUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsWUFBWUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsSUFBSUEsQ0FBQ0EsZUFBZUEsQ0FBQ0EsQ0FBQ0E7UUFDMURBLElBQUlBLENBQUNBLGVBQWVBLENBQUNBLFNBQVNBLEVBQUVBLENBQUNBO0lBQ2xDQSxDQUFDQTtJQUVETixXQUFXQTtJQUNKQSw4Q0FBbUJBLEdBQTFCQTtRQUVDTyxNQUFNQSxDQUFDQSxJQUFJQSx1QkFBdUJBLEVBQUVBLENBQUNBO0lBQ3RDQSxDQUFDQTtJQUVEUDs7T0FFR0E7SUFDSUEscURBQTBCQSxHQUFqQ0E7UUFFQ1EsTUFBTUEsQ0FBQ0EsSUFBSUEsb0JBQW9CQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtJQUN2Q0EsQ0FBQ0E7SUFFRFIsVUFBVUE7SUFDSEEscURBQTBCQSxHQUFqQ0EsVUFBa0NBLE1BQWNBLEVBQUVBLE1BQWFBLEVBQUVBLE1BQXNCQTtRQUF0QlMsc0JBQXNCQSxHQUF0QkEsYUFBc0JBO1FBRXRGQSxJQUFJQSxHQUFHQSxHQUFpQkEsSUFBSUEsS0FBS0EsRUFBVUEsQ0FBQ0E7UUFDNUNBLElBQUlBLE1BQU1BLEdBQXNCQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQTtRQUM5Q0EsSUFBSUEsQ0FBQ0EsR0FBWUEsSUFBSUEsUUFBUUEsRUFBRUEsQ0FBQ0E7UUFFaENBLENBQUNBLENBQUNBLFFBQVFBLENBQUNBLE1BQU1BLENBQUNBLHVCQUF1QkEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDbkRBLENBQUNBLENBQUNBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLHFCQUFxQkEsQ0FBQ0EsQ0FBQ0E7UUFFckNBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLGVBQWVBLENBQUNBO1lBQ3pCQSxJQUFJQSxDQUFDQSxlQUFlQSxHQUFHQSxFQUFFQSxDQUFDQTtRQUUzQkEsQ0FBQ0EsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxNQUFNQSxDQUFDQSxVQUFVQSxFQUFFQSxJQUFJQSxDQUFDQSxlQUFlQSxDQUFDQSxDQUFDQTtRQUU1REEsSUFBSUEsSUFBSUEsR0FBVUEsUUFBUUEsRUFBRUEsSUFBSUEsR0FBVUEsQ0FBQ0EsUUFBUUEsQ0FBQ0E7UUFDcERBLElBQUlBLElBQUlBLEdBQVVBLFFBQVFBLEVBQUVBLElBQUlBLEdBQVVBLENBQUNBLFFBQVFBLENBQUNBO1FBQ3BEQSxJQUFJQSxJQUFJQSxHQUFVQSxRQUFRQSxFQUFFQSxJQUFJQSxHQUFVQSxDQUFDQSxRQUFRQSxDQUFDQTtRQUNwREEsSUFBSUEsQ0FBUUEsQ0FBQ0E7UUFDYkEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBVUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsRUFBRUEsR0FBR0EsQ0FBQ0E7WUFDaENBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLGVBQWVBLENBQUNBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBO1lBRTlCQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQTtnQkFDWkEsSUFBSUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7WUFFVkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0E7Z0JBQ1pBLElBQUlBLEdBQUdBLENBQUNBLENBQUNBO1lBRVZBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLGVBQWVBLENBQUNBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBO1lBRTlCQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQTtnQkFDWkEsSUFBSUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7WUFFVkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0E7Z0JBQ1pBLElBQUlBLEdBQUdBLENBQUNBLENBQUNBO1lBRVZBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLGVBQWVBLENBQUNBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBO1lBRTlCQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQTtnQkFDWkEsSUFBSUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7WUFFVkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0E7Z0JBQ1pBLElBQUlBLEdBQUdBLENBQUNBLENBQUNBO1FBQ1hBLENBQUNBO1FBRURBLElBQUlBLFNBQVNBLEdBQVVBLENBQUNBLEdBQUNBLENBQUNBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBLENBQUNBO1FBQ3ZDQSxJQUFJQSxTQUFTQSxHQUFVQSxDQUFDQSxHQUFDQSxDQUFDQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUN2Q0EsSUFBSUEsU0FBU0EsR0FBVUEsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDdkNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLFNBQVNBLENBQUNBO1FBQ3JCQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFDQSxTQUFTQSxDQUFDQTtRQUNyQkEsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsU0FBU0EsQ0FBQ0E7UUFDcEJBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBLEdBQUNBLFNBQVNBLENBQUNBO1FBQ25DQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxHQUFDQSxTQUFTQSxDQUFDQTtRQUNuQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsSUFBSUEsR0FBQ0EsU0FBU0EsQ0FBQ0E7UUFDMUJBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1FBQ3BGQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUVaQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxNQUFNQSxDQUFDQTtZQUNYQSxNQUFNQSxHQUFHQSxJQUFJQSxRQUFRQSxFQUFFQSxDQUFDQTtRQUV6QkEsTUFBTUEsQ0FBQ0EsZUFBZUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDNUJBLE1BQU1BLENBQUNBLE9BQU9BLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBRWxCQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQTtJQUNmQSxDQUFDQTtJQUVNVCwrQ0FBb0JBLEdBQTNCQSxVQUE0QkEsWUFBMEJBO1FBRXJEVSxvQkFBb0JBO0lBQ3JCQSxDQUFDQTtJQUNGVix1QkFBQ0E7QUFBREEsQ0ExSkEsQUEwSkNBLEVBMUo4QixTQUFTLEVBMEp2QztBQUVELEFBQTBCLGlCQUFqQixnQkFBZ0IsQ0FBQyIsImZpbGUiOiJlbnRpdGllcy9EaXJlY3Rpb25hbExpZ2h0LmpzIiwic291cmNlUm9vdCI6Ii4uLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBCb3VuZGluZ1ZvbHVtZUJhc2VcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvYm91bmRzL0JvdW5kaW5nVm9sdW1lQmFzZVwiKTtcclxuaW1wb3J0IE51bGxCb3VuZHNcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2JvdW5kcy9OdWxsQm91bmRzXCIpO1xyXG5pbXBvcnQgTWF0cml4M0RcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9NYXRyaXgzRFwiKTtcclxuaW1wb3J0IFZlY3RvcjNEXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vVmVjdG9yM0RcIik7XHJcblxyXG5pbXBvcnQgTGlnaHRCYXNlXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9iYXNlL0xpZ2h0QmFzZVwiKTtcclxuaW1wb3J0IERpcmVjdGlvbmFsTGlnaHROb2RlXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL3BhcnRpdGlvbi9EaXJlY3Rpb25hbExpZ2h0Tm9kZVwiKTtcclxuaW1wb3J0IEVudGl0eU5vZGVcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL3BhcnRpdGlvbi9FbnRpdHlOb2RlXCIpO1xyXG5pbXBvcnQgSVJlbmRlcmVyUG9vbFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL3Bvb2wvSVJlbmRlcmVyUG9vbFwiKTtcclxuaW1wb3J0IENhbWVyYVx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9DYW1lcmFcIik7XHJcbmltcG9ydCBJRW50aXR5XHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL0lFbnRpdHlcIik7XHJcbmltcG9ydCBEaXJlY3Rpb25hbFNoYWRvd01hcHBlclx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvbWF0ZXJpYWxzL3NoYWRvd21hcHBlcnMvRGlyZWN0aW9uYWxTaGFkb3dNYXBwZXJcIik7XHJcblxyXG5jbGFzcyBEaXJlY3Rpb25hbExpZ2h0IGV4dGVuZHMgTGlnaHRCYXNlIGltcGxlbWVudHMgSUVudGl0eVxyXG57XHJcblx0cHJpdmF0ZSBfZGlyZWN0aW9uOlZlY3RvcjNEO1xyXG5cdHByaXZhdGUgX3RtcExvb2tBdDpWZWN0b3IzRDtcclxuXHRwcml2YXRlIF9zY2VuZURpcmVjdGlvbjpWZWN0b3IzRDtcclxuXHRwcml2YXRlIF9wcm9qQUFCQlBvaW50czpBcnJheTxudW1iZXI+O1xyXG5cclxuXHRjb25zdHJ1Y3Rvcih4RGlyOm51bWJlciA9IDAsIHlEaXI6bnVtYmVyID0gLTEsIHpEaXI6bnVtYmVyID0gMSlcclxuXHR7XHJcblx0XHRzdXBlcigpO1xyXG5cclxuXHRcdHRoaXMuX3BJc0VudGl0eSA9IHRydWU7XHJcblxyXG5cdFx0dGhpcy5kaXJlY3Rpb24gPSBuZXcgVmVjdG9yM0QoeERpciwgeURpciwgekRpcik7XHJcblxyXG5cdFx0dGhpcy5fc2NlbmVEaXJlY3Rpb24gPSBuZXcgVmVjdG9yM0QoKTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBnZXQgc2NlbmVEaXJlY3Rpb24oKTpWZWN0b3IzRFxyXG5cdHtcclxuXHRcdGlmICh0aGlzLl9wU2NlbmVUcmFuc2Zvcm1EaXJ0eSlcclxuXHRcdFx0dGhpcy5wVXBkYXRlU2NlbmVUcmFuc2Zvcm0oKTtcclxuXHJcblx0XHRyZXR1cm4gdGhpcy5fc2NlbmVEaXJlY3Rpb247XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgZ2V0IGRpcmVjdGlvbigpOlZlY3RvcjNEXHJcblx0e1xyXG5cdFx0cmV0dXJuIHRoaXMuX2RpcmVjdGlvbjtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBzZXQgZGlyZWN0aW9uKHZhbHVlOlZlY3RvcjNEKVxyXG5cdHtcclxuXHRcdHRoaXMuX2RpcmVjdGlvbiA9IHZhbHVlO1xyXG5cclxuXHRcdGlmICghdGhpcy5fdG1wTG9va0F0KVxyXG5cdFx0XHR0aGlzLl90bXBMb29rQXQgPSBuZXcgVmVjdG9yM0QoKTtcclxuXHJcblx0XHR0aGlzLl90bXBMb29rQXQueCA9IHRoaXMueCArIHRoaXMuX2RpcmVjdGlvbi54O1xyXG5cdFx0dGhpcy5fdG1wTG9va0F0LnkgPSB0aGlzLnkgKyB0aGlzLl9kaXJlY3Rpb24ueTtcclxuXHRcdHRoaXMuX3RtcExvb2tBdC56ID0gdGhpcy56ICsgdGhpcy5fZGlyZWN0aW9uLno7XHJcblxyXG5cdFx0dGhpcy5sb29rQXQodGhpcy5fdG1wTG9va0F0KTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqXHJcblx0ICogQHJldHVybnMge2F3YXkuYm91bmRzLk51bGxCb3VuZHN9XHJcblx0ICovXHJcblx0cHVibGljIHBDcmVhdGVEZWZhdWx0Qm91bmRpbmdWb2x1bWUoKTpCb3VuZGluZ1ZvbHVtZUJhc2VcclxuXHR7XHJcblx0XHQvL2RpcmVjdGlvbmFsIGxpZ2h0cyBhcmUgdG8gYmUgY29uc2lkZXJlZCBnbG9iYWwsIGhlbmNlIGFsd2F5cyBpbiB2aWV3XHJcblx0XHRyZXR1cm4gbmV3IE51bGxCb3VuZHMoKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqXHJcblx0ICovXHJcblx0cHVibGljIHBVcGRhdGVCb3VuZHMoKVxyXG5cdHtcclxuXHR9XHJcblxyXG5cdC8vQG92ZXJyaWRlXHJcblx0cHVibGljIHBVcGRhdGVTY2VuZVRyYW5zZm9ybSgpXHJcblx0e1xyXG5cdFx0c3VwZXIucFVwZGF0ZVNjZW5lVHJhbnNmb3JtKCk7XHJcblx0XHR0aGlzLnNjZW5lVHJhbnNmb3JtLmNvcHlDb2x1bW5UbygyLCB0aGlzLl9zY2VuZURpcmVjdGlvbik7XHJcblx0XHR0aGlzLl9zY2VuZURpcmVjdGlvbi5ub3JtYWxpemUoKTtcclxuXHR9XHJcblxyXG5cdC8vQG92ZXJyaWRlXHJcblx0cHVibGljIHBDcmVhdGVTaGFkb3dNYXBwZXIoKTpEaXJlY3Rpb25hbFNoYWRvd01hcHBlclxyXG5cdHtcclxuXHRcdHJldHVybiBuZXcgRGlyZWN0aW9uYWxTaGFkb3dNYXBwZXIoKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwcm90ZWN0ZWRcclxuXHQgKi9cclxuXHRwdWJsaWMgcENyZWF0ZUVudGl0eVBhcnRpdGlvbk5vZGUoKTpFbnRpdHlOb2RlXHJcblx0e1xyXG5cdFx0cmV0dXJuIG5ldyBEaXJlY3Rpb25hbExpZ2h0Tm9kZSh0aGlzKTtcclxuXHR9XHJcblxyXG5cdC8vb3ZlcnJpZGVcclxuXHRwdWJsaWMgaUdldE9iamVjdFByb2plY3Rpb25NYXRyaXgoZW50aXR5OklFbnRpdHksIGNhbWVyYTpDYW1lcmEsIHRhcmdldDpNYXRyaXgzRCA9IG51bGwpOk1hdHJpeDNEXHJcblx0e1xyXG5cdFx0dmFyIHJhdzpBcnJheTxudW1iZXI+ID0gbmV3IEFycmF5PG51bWJlcj4oKTtcclxuXHRcdHZhciBib3VuZHM6Qm91bmRpbmdWb2x1bWVCYXNlID0gZW50aXR5LmJvdW5kcztcclxuXHRcdHZhciBtOk1hdHJpeDNEID0gbmV3IE1hdHJpeDNEKCk7XHJcblxyXG5cdFx0bS5jb3B5RnJvbShlbnRpdHkuZ2V0UmVuZGVyU2NlbmVUcmFuc2Zvcm0oY2FtZXJhKSk7XHJcblx0XHRtLmFwcGVuZCh0aGlzLmludmVyc2VTY2VuZVRyYW5zZm9ybSk7XHJcblxyXG5cdFx0aWYgKCF0aGlzLl9wcm9qQUFCQlBvaW50cylcclxuXHRcdFx0dGhpcy5fcHJvakFBQkJQb2ludHMgPSBbXTtcclxuXHJcblx0XHRtLnRyYW5zZm9ybVZlY3RvcnMoYm91bmRzLmFhYmJQb2ludHMsIHRoaXMuX3Byb2pBQUJCUG9pbnRzKTtcclxuXHJcblx0XHR2YXIgeE1pbjpudW1iZXIgPSBJbmZpbml0eSwgeE1heDpudW1iZXIgPSAtSW5maW5pdHk7XHJcblx0XHR2YXIgeU1pbjpudW1iZXIgPSBJbmZpbml0eSwgeU1heDpudW1iZXIgPSAtSW5maW5pdHk7XHJcblx0XHR2YXIgek1pbjpudW1iZXIgPSBJbmZpbml0eSwgek1heDpudW1iZXIgPSAtSW5maW5pdHk7XHJcblx0XHR2YXIgZDpudW1iZXI7XHJcblx0XHRmb3IgKHZhciBpOm51bWJlciA9IDA7IGkgPCAyNDspIHtcclxuXHRcdFx0ZCA9IHRoaXMuX3Byb2pBQUJCUG9pbnRzW2krK107XHJcblxyXG5cdFx0XHRpZiAoZCA8IHhNaW4pXHJcblx0XHRcdFx0eE1pbiA9IGQ7XHJcblxyXG5cdFx0XHRpZiAoZCA+IHhNYXgpXHJcblx0XHRcdFx0eE1heCA9IGQ7XHJcblxyXG5cdFx0XHRkID0gdGhpcy5fcHJvakFBQkJQb2ludHNbaSsrXTtcclxuXHJcblx0XHRcdGlmIChkIDwgeU1pbilcclxuXHRcdFx0XHR5TWluID0gZDtcclxuXHJcblx0XHRcdGlmIChkID4geU1heClcclxuXHRcdFx0XHR5TWF4ID0gZDtcclxuXHJcblx0XHRcdGQgPSB0aGlzLl9wcm9qQUFCQlBvaW50c1tpKytdO1xyXG5cclxuXHRcdFx0aWYgKGQgPCB6TWluKVxyXG5cdFx0XHRcdHpNaW4gPSBkO1xyXG5cclxuXHRcdFx0aWYgKGQgPiB6TWF4KVxyXG5cdFx0XHRcdHpNYXggPSBkO1xyXG5cdFx0fVxyXG5cclxuXHRcdHZhciBpbnZYUmFuZ2U6bnVtYmVyID0gMS8oeE1heCAtIHhNaW4pO1xyXG5cdFx0dmFyIGludllSYW5nZTpudW1iZXIgPSAxLyh5TWF4IC0geU1pbik7XHJcblx0XHR2YXIgaW52WlJhbmdlOm51bWJlciA9IDEvKHpNYXggLSB6TWluKTtcclxuXHRcdHJhd1swXSA9IDIqaW52WFJhbmdlO1xyXG5cdFx0cmF3WzVdID0gMippbnZZUmFuZ2U7XHJcblx0XHRyYXdbMTBdID0gaW52WlJhbmdlO1xyXG5cdFx0cmF3WzEyXSA9IC0oeE1heCArIHhNaW4pKmludlhSYW5nZTtcclxuXHRcdHJhd1sxM10gPSAtKHlNYXggKyB5TWluKSppbnZZUmFuZ2U7XHJcblx0XHRyYXdbMTRdID0gLXpNaW4qaW52WlJhbmdlO1xyXG5cdFx0cmF3WzFdID0gcmF3WzJdID0gcmF3WzNdID0gcmF3WzRdID0gcmF3WzZdID0gcmF3WzddID0gcmF3WzhdID0gcmF3WzldID0gcmF3WzExXSA9IDA7XHJcblx0XHRyYXdbMTVdID0gMTtcclxuXHJcblx0XHRpZiAoIXRhcmdldClcclxuXHRcdFx0dGFyZ2V0ID0gbmV3IE1hdHJpeDNEKCk7XHJcblxyXG5cdFx0dGFyZ2V0LmNvcHlSYXdEYXRhRnJvbShyYXcpO1xyXG5cdFx0dGFyZ2V0LnByZXBlbmQobSk7XHJcblxyXG5cdFx0cmV0dXJuIHRhcmdldDtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBfaUNvbGxlY3RSZW5kZXJhYmxlcyhyZW5kZXJlclBvb2w6SVJlbmRlcmVyUG9vbClcclxuXHR7XHJcblx0XHQvL25vdGhpbmcgdG8gZG8gaGVyZVxyXG5cdH1cclxufVxyXG5cclxuZXhwb3J0ID0gRGlyZWN0aW9uYWxMaWdodDsiXX0=