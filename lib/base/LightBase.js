var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var AbstractMethodError = require("awayjs-core/lib/errors/AbstractMethodError");
var DisplayObjectContainer = require("awayjs-display/lib/containers/DisplayObjectContainer");
var LightEvent = require("awayjs-display/lib/events/LightEvent");
var LightBase = (function (_super) {
    __extends(LightBase, _super);
    function LightBase() {
        _super.call(this);
        this._color = 0xffffff;
        this._colorR = 1;
        this._colorG = 1;
        this._colorB = 1;
        this._ambientColor = 0xffffff;
        this._ambient = 0;
        this._iAmbientR = 0;
        this._iAmbientG = 0;
        this._iAmbientB = 0;
        this._specular = 1;
        this._iSpecularR = 1;
        this._iSpecularG = 1;
        this._iSpecularB = 1;
        this._diffuse = 1;
        this._iDiffuseR = 1;
        this._iDiffuseG = 1;
        this._iDiffuseB = 1;
        this._castsShadows = false;
    }
    Object.defineProperty(LightBase.prototype, "castsShadows", {
        get: function () {
            return this._castsShadows;
        },
        set: function (value) {
            if (this._castsShadows == value)
                return;
            this._castsShadows = value;
            if (value) {
                if (this._shadowMapper == null)
                    this._shadowMapper = this.pCreateShadowMapper();
                this._shadowMapper.light = this;
            }
            else {
                this._shadowMapper.dispose();
                this._shadowMapper = null;
            }
            //*/
            this.dispatchEvent(new LightEvent(LightEvent.CASTS_SHADOW_CHANGE));
        },
        enumerable: true,
        configurable: true
    });
    LightBase.prototype.pCreateShadowMapper = function () {
        throw new AbstractMethodError();
    };
    Object.defineProperty(LightBase.prototype, "specular", {
        get: function () {
            return this._specular;
        },
        set: function (value) {
            if (value < 0)
                value = 0;
            this._specular = value;
            this.updateSpecular();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(LightBase.prototype, "diffuse", {
        get: function () {
            return this._diffuse;
        },
        set: function (value) {
            if (value < 0)
                value = 0;
            this._diffuse = value;
            this.updateDiffuse();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(LightBase.prototype, "color", {
        get: function () {
            return this._color;
        },
        set: function (value) {
            this._color = value;
            this._colorR = ((this._color >> 16) & 0xff) / 0xff;
            this._colorG = ((this._color >> 8) & 0xff) / 0xff;
            this._colorB = (this._color & 0xff) / 0xff;
            this.updateDiffuse();
            this.updateSpecular();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(LightBase.prototype, "ambient", {
        get: function () {
            return this._ambient;
        },
        set: function (value) {
            if (value < 0)
                value = 0;
            else if (value > 1)
                value = 1;
            this._ambient = value;
            this.updateAmbient();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(LightBase.prototype, "ambientColor", {
        get: function () {
            return this._ambientColor;
        },
        set: function (value) {
            this._ambientColor = value;
            this.updateAmbient();
        },
        enumerable: true,
        configurable: true
    });
    LightBase.prototype.updateAmbient = function () {
        this._iAmbientR = ((this._ambientColor >> 16) & 0xff) / 0xff * this._ambient;
        this._iAmbientG = ((this._ambientColor >> 8) & 0xff) / 0xff * this._ambient;
        this._iAmbientB = (this._ambientColor & 0xff) / 0xff * this._ambient;
    };
    LightBase.prototype.iGetObjectProjectionMatrix = function (entity, camera, target) {
        if (target === void 0) { target = null; }
        throw new AbstractMethodError();
    };
    Object.defineProperty(LightBase.prototype, "assetType", {
        //@override
        get: function () {
            return LightBase.assetType;
        },
        enumerable: true,
        configurable: true
    });
    LightBase.prototype.updateSpecular = function () {
        this._iSpecularR = this._colorR * this._specular;
        this._iSpecularG = this._colorG * this._specular;
        this._iSpecularB = this._colorB * this._specular;
    };
    LightBase.prototype.updateDiffuse = function () {
        this._iDiffuseR = this._colorR * this._diffuse;
        this._iDiffuseG = this._colorG * this._diffuse;
        this._iDiffuseB = this._colorB * this._diffuse;
    };
    Object.defineProperty(LightBase.prototype, "shadowMapper", {
        get: function () {
            return this._shadowMapper;
        },
        set: function (value) {
            this._shadowMapper = value;
            this._shadowMapper.light = this;
        },
        enumerable: true,
        configurable: true
    });
    LightBase.assetType = "[asset Light]";
    return LightBase;
})(DisplayObjectContainer);
module.exports = LightBase;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1kaXNwbGF5L2xpYi9iYXNlL0xpZ2h0QmFzZS50cyJdLCJuYW1lcyI6WyJMaWdodEJhc2UiLCJMaWdodEJhc2UuY29uc3RydWN0b3IiLCJMaWdodEJhc2UuY2FzdHNTaGFkb3dzIiwiTGlnaHRCYXNlLnBDcmVhdGVTaGFkb3dNYXBwZXIiLCJMaWdodEJhc2Uuc3BlY3VsYXIiLCJMaWdodEJhc2UuZGlmZnVzZSIsIkxpZ2h0QmFzZS5jb2xvciIsIkxpZ2h0QmFzZS5hbWJpZW50IiwiTGlnaHRCYXNlLmFtYmllbnRDb2xvciIsIkxpZ2h0QmFzZS51cGRhdGVBbWJpZW50IiwiTGlnaHRCYXNlLmlHZXRPYmplY3RQcm9qZWN0aW9uTWF0cml4IiwiTGlnaHRCYXNlLmFzc2V0VHlwZSIsIkxpZ2h0QmFzZS51cGRhdGVTcGVjdWxhciIsIkxpZ2h0QmFzZS51cGRhdGVEaWZmdXNlIiwiTGlnaHRCYXNlLnNoYWRvd01hcHBlciJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQ0EsSUFBTyxtQkFBbUIsV0FBWSw0Q0FBNEMsQ0FBQyxDQUFDO0FBRXBGLElBQU8sc0JBQXNCLFdBQVcsc0RBQXNELENBQUMsQ0FBQztBQUdoRyxJQUFPLFVBQVUsV0FBYyxzQ0FBc0MsQ0FBQyxDQUFDO0FBR3ZFLElBQU0sU0FBUztJQUFTQSxVQUFsQkEsU0FBU0EsVUFBK0JBO0lBNkI3Q0EsU0E3QktBLFNBQVNBO1FBK0JiQyxpQkFBT0EsQ0FBQ0E7UUEzQkRBLFdBQU1BLEdBQVVBLFFBQVFBLENBQUNBO1FBQ3pCQSxZQUFPQSxHQUFVQSxDQUFDQSxDQUFDQTtRQUNuQkEsWUFBT0EsR0FBVUEsQ0FBQ0EsQ0FBQ0E7UUFDbkJBLFlBQU9BLEdBQVVBLENBQUNBLENBQUNBO1FBRW5CQSxrQkFBYUEsR0FBVUEsUUFBUUEsQ0FBQ0E7UUFDaENBLGFBQVFBLEdBQVVBLENBQUNBLENBQUNBO1FBQ3JCQSxlQUFVQSxHQUFVQSxDQUFDQSxDQUFDQTtRQUN0QkEsZUFBVUEsR0FBVUEsQ0FBQ0EsQ0FB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LENBQUNBLFdBQVdBLEdBQUdBLElBQUlBLENBQUNBLE9BQU9BLEdBQUNBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBO1FBQy9DQSxJQUFJQSxDQUFDQSxXQUFXQSxHQUFHQSxJQUFJQSxDQUFDQSxPQUFPQSxHQUFDQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQTtJQUNoREEsQ0FBQ0E7SUFFT1osaUNBQWFBLEdBQXJCQTtRQUVDYSxJQUFJQSxDQUFDQSxVQUFVQSxHQUFHQSxJQUFJQSxDQUFDQSxPQUFPQSxHQUFDQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQTtRQUM3Q0EsSUFBSUEsQ0FBQ0EsVUFBVUEsR0FBR0EsSUFBSUEsQ0FBQ0EsT0FBT0EsR0FBQ0EsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0E7UUFDN0NBLElBQUlBLENBQUNBLFVBQVVBLEdBQUdBLElBQUlBLENBQUNBLE9BQU9BLEdBQUNBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBO0lBQzlDQSxDQUFDQTtJQUVEYixzQkFBV0EsbUNBQVlBO2FBQXZCQTtZQUVDYyxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxhQUFhQSxDQUFDQTtRQUMzQkEsQ0FBQ0E7YUFFRGQsVUFBd0JBLEtBQXNCQTtZQUU3Q2MsSUFBSUEsQ0FBQ0EsYUFBYUEsR0FBR0EsS0FBS0EsQ0FBQ0E7WUFDM0JBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLEtBQUtBLEdBQUdBLElBQUlBLENBQUNBO1FBQ2pDQSxDQUFDQTs7O09BTkFkO0lBeEthQSxtQkFBU0EsR0FBVUEsZUFBZUEsQ0FBQ0E7SUErS2xEQSxnQkFBQ0E7QUFBREEsQ0FqTEEsQUFpTENBLEVBakx1QixzQkFBc0IsRUFpTDdDO0FBRUQsQUFBbUIsaUJBQVYsU0FBUyxDQUFDIiwiZmlsZSI6ImJhc2UvTGlnaHRCYXNlLmpzIiwic291cmNlUm9vdCI6Ii4uLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBNYXRyaXgzRFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9NYXRyaXgzRFwiKTtcclxuaW1wb3J0IEFic3RyYWN0TWV0aG9kRXJyb3JcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2Vycm9ycy9BYnN0cmFjdE1ldGhvZEVycm9yXCIpO1xyXG5cclxuaW1wb3J0IERpc3BsYXlPYmplY3RDb250YWluZXJcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9jb250YWluZXJzL0Rpc3BsYXlPYmplY3RDb250YWluZXJcIik7XHJcbmltcG9ydCBDYW1lcmFcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL0NhbWVyYVwiKTtcclxuaW1wb3J0IElFbnRpdHlcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL0lFbnRpdHlcIik7XHJcbmltcG9ydCBMaWdodEV2ZW50XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvZXZlbnRzL0xpZ2h0RXZlbnRcIik7XHJcbmltcG9ydCBTaGFkb3dNYXBwZXJCYXNlXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL21hdGVyaWFscy9zaGFkb3dtYXBwZXJzL1NoYWRvd01hcHBlckJhc2VcIik7XHJcblxyXG5jbGFzcyBMaWdodEJhc2UgZXh0ZW5kcyBEaXNwbGF5T2JqZWN0Q29udGFpbmVyXHJcbntcclxuXHRwdWJsaWMgc3RhdGljIGFzc2V0VHlwZTpzdHJpbmcgPSBcIlthc3NldCBMaWdodF1cIjtcclxuXHJcblx0cHJpdmF0ZSBfY29sb3I6bnVtYmVyID0gMHhmZmZmZmY7XHJcblx0cHJpdmF0ZSBfY29sb3JSOm51bWJlciA9IDE7XHJcblx0cHJpdmF0ZSBfY29sb3JHOm51bWJlciA9IDE7XHJcblx0cHJpdmF0ZSBfY29sb3JCOm51bWJlciA9IDE7XHJcblxyXG5cdHByaXZhdGUgX2FtYmllbnRDb2xvcjpudW1iZXIgPSAweGZmZmZmZjtcclxuXHRwcml2YXRlIF9hbWJpZW50Om51bWJlciA9IDA7XHJcblx0cHVibGljIF9pQW1iaWVudFI6bnVtYmVyID0gMDtcclxuXHRwdWJsaWMgX2lBbWJpZW50RzpudW1iZXIgPSAwO1xyXG5cdHB1YmxpYyBfaUFtYmllbnRCOm51bWJlciA9IDA7XHJcblxyXG5cdHByaXZhdGUgX3NwZWN1bGFyOm51bWJlciA9IDE7XHJcblx0cHVibGljIF9pU3BlY3VsYXJSOm51bWJlciA9IDE7XHJcblx0cHVibGljIF9pU3BlY3VsYXJHOm51bWJlciA9IDE7XHJcblx0cHVibGljIF9pU3BlY3VsYXJCOm51bWJlciA9IDE7XHJcblxyXG5cdHByaXZhdGUgX2RpZmZ1c2U6bnVtYmVyID0gMTtcclxuXHRwdWJsaWMgX2lEaWZmdXNlUjpudW1iZXIgPSAxO1xyXG5cdHB1YmxpYyBfaURpZmZ1c2VHOm51bWJlciA9IDE7XHJcblx0cHVibGljIF9pRGlmZnVzZUI6bnVtYmVyID0gMTtcclxuXHJcblx0cHJpdmF0ZSBfY2FzdHNTaGFkb3dzOmJvb2xlYW4gPSBmYWxzZTtcclxuXHJcblx0cHJpdmF0ZSBfc2hhZG93TWFwcGVyOlNoYWRvd01hcHBlckJhc2U7XHJcblxyXG5cdGNvbnN0cnVjdG9yKClcclxuXHR7XHJcblx0XHRzdXBlcigpO1xyXG5cdH1cclxuXHJcblx0cHVibGljIGdldCBjYXN0c1NoYWRvd3MoKTpib29sZWFuXHJcblx0e1xyXG5cdFx0cmV0dXJuIHRoaXMuX2Nhc3RzU2hhZG93cztcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBzZXQgY2FzdHNTaGFkb3dzKHZhbHVlOmJvb2xlYW4pXHJcblx0e1xyXG5cdFx0aWYgKHRoaXMuX2Nhc3RzU2hhZG93cyA9PSB2YWx1ZSlcclxuXHRcdFx0cmV0dXJuO1xyXG5cclxuXHRcdHRoaXMuX2Nhc3RzU2hhZG93cyA9IHZhbHVlO1xyXG5cclxuXHRcdGlmICh2YWx1ZSkge1xyXG5cdFx0XHRpZiAodGhpcy5fc2hhZG93TWFwcGVyID09IG51bGwpXHJcblx0XHRcdFx0dGhpcy5fc2hhZG93TWFwcGVyID0gdGhpcy5wQ3JlYXRlU2hhZG93TWFwcGVyKCk7XHJcblxyXG5cdFx0XHR0aGlzLl9zaGFkb3dNYXBwZXIubGlnaHQgPSB0aGlzO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0dGhpcy5fc2hhZG93TWFwcGVyLmRpc3Bvc2UoKTtcclxuXHRcdFx0dGhpcy5fc2hhZG93TWFwcGVyID0gbnVsbDtcclxuXHRcdH1cclxuXHRcdC8vKi9cclxuXHRcdHRoaXMuZGlzcGF0Y2hFdmVudChuZXcgTGlnaHRFdmVudChMaWdodEV2ZW50LkNBU1RTX1NIQURPV19DSEFOR0UpKTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBwQ3JlYXRlU2hhZG93TWFwcGVyKCk6U2hhZG93TWFwcGVyQmFzZVxyXG5cdHtcclxuXHRcdHRocm93IG5ldyBBYnN0cmFjdE1ldGhvZEVycm9yKCk7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgZ2V0IHNwZWN1bGFyKCk6bnVtYmVyXHJcblx0e1xyXG5cdFx0cmV0dXJuIHRoaXMuX3NwZWN1bGFyO1xyXG5cdH1cclxuXHJcblx0cHVibGljIHNldCBzcGVjdWxhcih2YWx1ZTpudW1iZXIpXHJcblx0e1xyXG5cdFx0aWYgKHZhbHVlIDwgMClcclxuXHRcdFx0dmFsdWUgPSAwO1xyXG5cclxuXHRcdHRoaXMuX3NwZWN1bGFyID0gdmFsdWU7XHJcblx0XHR0aGlzLnVwZGF0ZVNwZWN1bGFyKCk7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgZ2V0IGRpZmZ1c2UoKTpudW1iZXJcclxuXHR7XHJcblx0XHRyZXR1cm4gdGhpcy5fZGlmZnVzZTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBzZXQgZGlmZnVzZSh2YWx1ZTpudW1iZXIpXHJcblx0e1xyXG5cdFx0aWYgKHZhbHVlIDwgMClcclxuXHRcdFx0dmFsdWUgPSAwO1xyXG5cclxuXHRcdHRoaXMuX2RpZmZ1c2UgPSB2YWx1ZTtcclxuXHRcdHRoaXMudXBkYXRlRGlmZnVzZSgpO1xyXG5cdH1cclxuXHJcblx0cHVibGljIGdldCBjb2xvcigpOm51bWJlclxyXG5cdHtcclxuXHRcdHJldHVybiB0aGlzLl9jb2xvcjtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBzZXQgY29sb3IodmFsdWU6bnVtYmVyKVxyXG5cdHtcclxuXHRcdHRoaXMuX2NvbG9yID0gdmFsdWU7XHJcblx0XHR0aGlzLl9jb2xvclIgPSAoKHRoaXMuX2NvbG9yID4+IDE2KSAmIDB4ZmYpLzB4ZmY7XHJcblx0XHR0aGlzLl9jb2xvckcgPSAoKHRoaXMuX2NvbG9yID4+IDgpICYgMHhmZikvMHhmZjtcclxuXHRcdHRoaXMuX2NvbG9yQiA9ICh0aGlzLl9jb2xvciAmIDB4ZmYpLzB4ZmY7XHJcblxyXG5cdFx0dGhpcy51cGRhdGVEaWZmdXNlKCk7XHJcblx0XHR0aGlzLnVwZGF0ZVNwZWN1bGFyKCk7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgZ2V0IGFtYmllbnQoKTpudW1iZXJcclxuXHR7XHJcblx0XHRyZXR1cm4gdGhpcy5fYW1iaWVudDtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBzZXQgYW1iaWVudCh2YWx1ZTpudW1iZXIpXHJcblx0e1xyXG5cdFx0aWYgKHZhbHVlIDwgMClcclxuXHRcdFx0dmFsdWUgPSAwO1xyXG5cdFx0ZWxzZSBpZiAodmFsdWUgPiAxKVxyXG5cdFx0XHR2YWx1ZSA9IDE7XHJcblxyXG5cdFx0dGhpcy5fYW1iaWVudCA9IHZhbHVlO1xyXG5cdFx0dGhpcy51cGRhdGVBbWJpZW50KCk7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgZ2V0IGFtYmllbnRDb2xvcigpOm51bWJlclxyXG5cdHtcclxuXHRcdHJldHVybiB0aGlzLl9hbWJpZW50Q29sb3I7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgc2V0IGFtYmllbnRDb2xvcih2YWx1ZTpudW1iZXIpXHJcblx0e1xyXG5cdFx0dGhpcy5fYW1iaWVudENvbG9yID0gdmFsdWU7XHJcblx0XHR0aGlzLnVwZGF0ZUFtYmllbnQoKTtcclxuXHR9XHJcblxyXG5cdHByaXZhdGUgdXBkYXRlQW1iaWVudCgpXHJcblx0e1xyXG5cdFx0dGhpcy5faUFtYmllbnRSID0gKCh0aGlzLl9hbWJpZW50Q29sb3IgPj4gMTYpICYgMHhmZikvMHhmZip0aGlzLl9hbWJpZW50O1xyXG5cdFx0dGhpcy5faUFtYmllbnRHID0gKCh0aGlzLl9hbWJpZW50Q29sb3IgPj4gOCkgJiAweGZmKS8weGZmKnRoaXMuX2FtYmllbnQ7XHJcblx0XHR0aGlzLl9pQW1iaWVudEIgPSAodGhpcy5fYW1iaWVudENvbG9yICYgMHhmZikvMHhmZip0aGlzLl9hbWJpZW50O1xyXG5cdH1cclxuXHJcblx0cHVibGljIGlHZXRPYmplY3RQcm9qZWN0aW9uTWF0cml4KGVudGl0eTpJRW50aXR5LCBjYW1lcmE6Q2FtZXJhLCB0YXJnZXQ6TWF0cml4M0QgPSBudWxsKTpNYXRyaXgzRFxyXG5cdHtcclxuXHRcdHRocm93IG5ldyBBYnN0cmFjdE1ldGhvZEVycm9yKCk7XHJcblx0fVxyXG5cclxuXHQvL0BvdmVycmlkZVxyXG5cdHB1YmxpYyBnZXQgYXNzZXRUeXBlKCk6c3RyaW5nXHJcblx0e1xyXG5cdFx0cmV0dXJuIExpZ2h0QmFzZS5hc3NldFR5cGU7XHJcblx0fVxyXG5cclxuXHRwcml2YXRlIHVwZGF0ZVNwZWN1bGFyKClcclxuXHR7XHJcblx0XHR0aGlzLl9pU3BlY3VsYXJSID0gdGhpcy5fY29sb3JSKnRoaXMuX3NwZWN1bGFyO1xyXG5cdFx0dGhpcy5faVNwZWN1bGFyRyA9IHRoaXMuX2NvbG9yRyp0aGlzLl9zcGVjdWxhcjtcclxuXHRcdHRoaXMuX2lTcGVjdWxhckIgPSB0aGlzLl9jb2xvckIqdGhpcy5fc3BlY3VsYXI7XHJcblx0fVxyXG5cclxuXHRwcml2YXRlIHVwZGF0ZURpZmZ1c2UoKVxyXG5cdHtcclxuXHRcdHRoaXMuX2lEaWZmdXNlUiA9IHRoaXMuX2NvbG9yUip0aGlzLl9kaWZmdXNlO1xyXG5cdFx0dGhpcy5faURpZmZ1c2VHID0gdGhpcy5fY29sb3JHKnRoaXMuX2RpZmZ1c2U7XHJcblx0XHR0aGlzLl9pRGlmZnVzZUIgPSB0aGlzLl9jb2xvckIqdGhpcy5fZGlmZnVzZTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBnZXQgc2hhZG93TWFwcGVyKCk6U2hhZG93TWFwcGVyQmFzZVxyXG5cdHtcclxuXHRcdHJldHVybiB0aGlzLl9zaGFkb3dNYXBwZXI7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgc2V0IHNoYWRvd01hcHBlcih2YWx1ZTpTaGFkb3dNYXBwZXJCYXNlKVxyXG5cdHtcclxuXHRcdHRoaXMuX3NoYWRvd01hcHBlciA9IHZhbHVlO1xyXG5cdFx0dGhpcy5fc2hhZG93TWFwcGVyLmxpZ2h0ID0gdGhpcztcclxuXHR9XHJcbn1cclxuXHJcbmV4cG9ydCA9IExpZ2h0QmFzZTsiXX0=