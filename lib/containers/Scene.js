var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var EventDispatcher = require("awayjs-core/lib/events/EventDispatcher");
var DisplayObjectContainer = require("awayjs-display/lib/containers/DisplayObjectContainer");
var SceneEvent = require("awayjs-display/lib/events/SceneEvent");
var NodeBase = require("awayjs-display/lib/partition/NodeBase");
var Partition = require("awayjs-display/lib/partition/Partition");
var Scene = (function (_super) {
    __extends(Scene, _super);
    function Scene() {
        _super.call(this);
        this._expandedPartitions = new Array();
        this._partitions = new Array();
        this._iCollectionMark = 0;
        this._partition = new Partition(new NodeBase());
        this._iSceneGraphRoot = new DisplayObjectContainer();
        this._iSceneGraphRoot._iSetScene(this);
        this._iSceneGraphRoot._iIsRoot = true;
        this._iSceneGraphRoot.partition = this._partition;
    }
    Scene.prototype.traversePartitions = function (traverser) {
        var i = 0;
        var len = this._partitions.length;
        traverser.scene = this;
        this._iCollectionMark++;
        while (i < len)
            this._partitions[i++].traverse(traverser);
    };
    Object.defineProperty(Scene.prototype, "partition", {
        get: function () {
            return this._iSceneGraphRoot.partition;
        },
        set: function (value) {
            this._iSceneGraphRoot.partition = value;
            this.dispatchEvent(new SceneEvent(SceneEvent.PARTITION_CHANGED, this._iSceneGraphRoot));
        },
        enumerable: true,
        configurable: true
    });
    Scene.prototype.contains = function (child) {
        return this._iSceneGraphRoot.contains(child);
    };
    Scene.prototype.addChild = function (child) {
        return this._iSceneGraphRoot.addChild(child);
    };
    Scene.prototype.removeChild = function (child) {
        this._iSceneGraphRoot.removeChild(child);
    };
    Scene.prototype.removeChildAt = function (index) {
        this._iSceneGraphRoot.removeChildAt(index);
    };
    Scene.prototype.getChildAt = function (index) {
        return this._iSceneGraphRoot.getChildAt(index);
    };
    Object.defineProperty(Scene.prototype, "numChildren", {
        get: function () {
            return this._iSceneGraphRoot.numChildren;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @internal
     */
    Scene.prototype._iRegisterPartition = function (partition) {
        this._expandedPartitions.push(partition);
        //ensure duplicates are not found in partitions array
        if (this._partitions.indexOf(partition) == -1)
            this._partitions.push(partition);
    };
    /**
     * @internal
     */
    Scene.prototype._iUnregisterPartition = function (partition) {
        this._expandedPartitions.splice(this._expandedPartitions.indexOf(partition), 1);
        //if no more partition references found, remove from partitions array
        if (this._expandedPartitions.indexOf(partition) == -1)
            this._partitions.splice(this._partitions.indexOf(partition), 1);
    };
    return Scene;
})(EventDispatcher);
module.exports = Scene;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1kaXNwbGF5L2xpYi9jb250YWluZXJzL1NjZW5lLnRzIl0sIm5hbWVzIjpbIlNjZW5lIiwiU2NlbmUuY29uc3RydWN0b3IiLCJTY2VuZS50cmF2ZXJzZVBhcnRpdGlvbnMiLCJTY2VuZS5wYXJ0aXRpb24iLCJTY2VuZS5jb250YWlucyIsIlNjZW5lLmFkZENoaWxkIiwiU2NlbmUucmVtb3ZlQ2hpbGQiLCJTY2VuZS5yZW1vdmVDaGlsZEF0IiwiU2NlbmUuZ2V0Q2hpbGRBdCIsIlNjZW5lLm51bUNoaWxkcmVuIiwiU2NlbmUuX2lSZWdpc3RlclBhcnRpdGlvbiIsIlNjZW5lLl9pVW5yZWdpc3RlclBhcnRpdGlvbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsSUFBTyxlQUFlLFdBQWMsd0NBQXdDLENBQUMsQ0FBQztBQUc5RSxJQUFPLHNCQUFzQixXQUFZLHNEQUFzRCxDQUFDLENBQUM7QUFDakcsSUFBTyxVQUFVLFdBQWUsc0NBQXNDLENBQUMsQ0FBQztBQUN4RSxJQUFPLFFBQVEsV0FBZ0IsdUNBQXVDLENBQUMsQ0FBQztBQUN4RSxJQUFPLFNBQVMsV0FBZSx3Q0FBd0MsQ0FBQyxDQUFDO0FBR3pFLElBQU0sS0FBSztJQUFTQSxVQUFkQSxLQUFLQSxVQUF3QkE7SUFTbENBLFNBVEtBLEtBQUtBO1FBV1RDLGlCQUFPQSxDQUFDQTtRQVREQSx3QkFBbUJBLEdBQW9CQSxJQUFJQSxLQUFLQSxFQUFhQSxDQUFDQTtRQUM5REEsZ0JBQVdBLEdBQW9CQSxJQUFJQSxLQUFLQSxFQUFhQSxDQUFDQTtRQUl2REEscUJBQWdCQSxHQUFHQSxDQUFDQSxDQUFDQTtRQU0zQkEsSUFBSUEsQ0FBQ0EsVUFBVUEsR0FBR0EsSUFBSUEsU0FBU0EsQ0FBQ0EsSUFBSUEsUUFBUUEsRUFBRUEsQ0FBQ0EsQ0FBQ0E7UUFFaERBLElBQUlBLENBQUNBLGdCQUFnQkEsR0FBR0EsSUFBSUEsc0JBQXNCQSxFQUFFQSxDQUFDQTtRQUVyREEsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxD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QUNuQ0EsQ0FBQ0E7SUFFRFY7O09BRUdBO0lBQ0lBLHFDQUFxQkEsR0FBNUJBLFVBQTZCQSxTQUFtQkE7UUFFL0NXLElBQUlBLENBQUNBLG1CQUFtQkEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsbUJBQW1CQSxDQUFDQSxPQUFPQSxDQUFDQSxTQUFTQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUVoRkEsQUFDQUEscUVBRHFFQTtRQUNyRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsbUJBQW1CQSxDQUFDQSxPQUFPQSxDQUFDQSxTQUFTQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNyREEsSUFBSUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsU0FBU0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7SUFDbEVBLENBQUNBO0lBQ0ZYLFlBQUNBO0FBQURBLENBckdBLEFBcUdDQSxFQXJHbUIsZUFBZSxFQXFHbEM7QUFFRCxBQUFlLGlCQUFOLEtBQUssQ0FBQyIsImZpbGUiOiJjb250YWluZXJzL1NjZW5lLmpzIiwic291cmNlUm9vdCI6Ii4uLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBFdmVudERpc3BhdGNoZXJcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9ldmVudHMvRXZlbnREaXNwYXRjaGVyXCIpO1xyXG5cclxuaW1wb3J0IERpc3BsYXlPYmplY3RcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9iYXNlL0Rpc3BsYXlPYmplY3RcIik7XHJcbmltcG9ydCBEaXNwbGF5T2JqZWN0Q29udGFpbmVyXHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9jb250YWluZXJzL0Rpc3BsYXlPYmplY3RDb250YWluZXJcIik7XHJcbmltcG9ydCBTY2VuZUV2ZW50XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9ldmVudHMvU2NlbmVFdmVudFwiKTtcclxuaW1wb3J0IE5vZGVCYXNlXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL3BhcnRpdGlvbi9Ob2RlQmFzZVwiKTtcclxuaW1wb3J0IFBhcnRpdGlvblx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvcGFydGl0aW9uL1BhcnRpdGlvblwiKTtcclxuaW1wb3J0IENvbGxlY3RvckJhc2VcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi90cmF2ZXJzZS9Db2xsZWN0b3JCYXNlXCIpO1xyXG5cclxuY2xhc3MgU2NlbmUgZXh0ZW5kcyBFdmVudERpc3BhdGNoZXJcclxue1xyXG5cdHByaXZhdGUgX2V4cGFuZGVkUGFydGl0aW9uczpBcnJheTxQYXJ0aXRpb24+ID0gbmV3IEFycmF5PFBhcnRpdGlvbj4oKTtcclxuXHRwcml2YXRlIF9wYXJ0aXRpb25zOkFycmF5PFBhcnRpdGlvbj4gPSBuZXcgQXJyYXk8UGFydGl0aW9uPigpO1xyXG5cdHByaXZhdGUgX3BhcnRpdGlvbjpQYXJ0aXRpb247XHJcblxyXG5cdHB1YmxpYyBfaVNjZW5lR3JhcGhSb290OkRpc3BsYXlPYmplY3RDb250YWluZXI7XHJcblx0cHVibGljIF9pQ29sbGVjdGlvbk1hcmsgPSAwO1xyXG5cclxuXHRjb25zdHJ1Y3RvcigpXHJcblx0e1xyXG5cdFx0c3VwZXIoKTtcclxuXHJcblx0XHR0aGlzLl9wYXJ0aXRpb24gPSBuZXcgUGFydGl0aW9uKG5ldyBOb2RlQmFzZSgpKTtcclxuXHJcblx0XHR0aGlzLl9pU2NlbmVHcmFwaFJvb3QgPSBuZXcgRGlzcGxheU9iamVjdENvbnRhaW5lcigpO1xyXG5cclxuXHRcdHRoaXMuX2lTY2VuZUdyYXBoUm9vdC5faVNldFNjZW5lKHRoaXMpO1xyXG5cdFx0dGhpcy5faVNjZW5lR3JhcGhSb290Ll9pSXNSb290ID0gdHJ1ZTtcclxuXHRcdHRoaXMuX2lTY2VuZUdyYXBoUm9vdC5wYXJ0aXRpb24gPSB0aGlzLl9wYXJ0aXRpb247XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgdHJhdmVyc2VQYXJ0aXRpb25zKHRyYXZlcnNlcjpDb2xsZWN0b3JCYXNlKVxyXG5cdHtcclxuXHRcdHZhciBpOm51bWJlciA9IDA7XHJcblx0XHR2YXIgbGVuOm51bWJlciA9IHRoaXMuX3BhcnRpdGlvbnMubGVuZ3RoO1xyXG5cclxuXHRcdHRyYXZlcnNlci5zY2VuZSA9IHRoaXM7XHJcblxyXG5cdFx0dGhpcy5faUNvbGxlY3Rpb25NYXJrKys7XHJcblxyXG5cdFx0d2hpbGUgKGkgPCBsZW4pXHJcblx0XHRcdHRoaXMuX3BhcnRpdGlvbnNbaSsrXS50cmF2ZXJzZSh0cmF2ZXJzZXIpO1xyXG5cdH1cclxuXHJcblx0cHVibGljIGdldCBwYXJ0aXRpb24oKTpQYXJ0aXRpb25cclxuXHR7XHJcblx0XHRyZXR1cm4gdGhpcy5faVNjZW5lR3JhcGhSb290LnBhcnRpdGlvbjtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBzZXQgcGFydGl0aW9uKHZhbHVlOlBhcnRpdGlvbilcclxuXHR7XHJcblx0XHR0aGlzLl9pU2NlbmVHcmFwaFJvb3QucGFydGl0aW9uID0gdmFsdWU7XHJcblxyXG5cdFx0dGhpcy5kaXNwYXRjaEV2ZW50KG5ldyBTY2VuZUV2ZW50KFNjZW5lRXZlbnQuUEFSVElUSU9OX0NIQU5HRUQsIHRoaXMuX2lTY2VuZUdyYXBoUm9vdCkpO1xyXG5cdH1cclxuXHJcblx0cHVibGljIGNvbnRhaW5zKGNoaWxkOkRpc3BsYXlPYmplY3QpOmJvb2xlYW5cclxuXHR7XHJcblx0XHRyZXR1cm4gdGhpcy5faVNjZW5lR3JhcGhSb290LmNvbnRhaW5zKGNoaWxkKTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBhZGRDaGlsZChjaGlsZDpEaXNwbGF5T2JqZWN0KTpEaXNwbGF5T2JqZWN0XHJcblx0e1xyXG5cdFx0cmV0dXJuIHRoaXMuX2lTY2VuZUdyYXBoUm9vdC5hZGRDaGlsZChjaGlsZCk7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgcmVtb3ZlQ2hpbGQoY2hpbGQ6RGlzcGxheU9iamVjdClcclxuXHR7XHJcblx0XHR0aGlzLl9pU2NlbmVHcmFwaFJvb3QucmVtb3ZlQ2hpbGQoY2hpbGQpO1xyXG5cdH1cclxuXHJcblx0cHVibGljIHJlbW92ZUNoaWxkQXQoaW5kZXg6bnVtYmVyKVxyXG5cdHtcclxuXHRcdHRoaXMuX2lTY2VuZUdyYXBoUm9vdC5yZW1vdmVDaGlsZEF0KGluZGV4KTtcclxuXHR9XHJcblxyXG5cclxuXHRwdWJsaWMgZ2V0Q2hpbGRBdChpbmRleDpudW1iZXIpOkRpc3BsYXlPYmplY3RcclxuXHR7XHJcblx0XHRyZXR1cm4gdGhpcy5faVNjZW5lR3JhcGhSb290LmdldENoaWxkQXQoaW5kZXgpO1xyXG5cdH1cclxuXHJcblx0cHVibGljIGdldCBudW1DaGlsZHJlbigpOm51bWJlclxyXG5cdHtcclxuXHRcdHJldHVybiB0aGlzLl9pU2NlbmVHcmFwaFJvb3QubnVtQ2hpbGRyZW47XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAaW50ZXJuYWxcclxuXHQgKi9cclxuXHRwdWJsaWMgX2lSZWdpc3RlclBhcnRpdGlvbihwYXJ0aXRpb246UGFydGl0aW9uKVxyXG5cdHtcclxuXHRcdHRoaXMuX2V4cGFuZGVkUGFydGl0aW9ucy5wdXNoKHBhcnRpdGlvbik7XHJcblxyXG5cdFx0Ly9lbnN1cmUgZHVwbGljYXRlcyBhcmUgbm90IGZvdW5kIGluIHBhcnRpdGlvbnMgYXJyYXlcclxuXHRcdGlmICh0aGlzLl9wYXJ0aXRpb25zLmluZGV4T2YocGFydGl0aW9uKSA9PSAtMSlcclxuXHRcdFx0dGhpcy5fcGFydGl0aW9ucy5wdXNoKHBhcnRpdGlvbik7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAaW50ZXJuYWxcclxuXHQgKi9cclxuXHRwdWJsaWMgX2lVbnJlZ2lzdGVyUGFydGl0aW9uKHBhcnRpdGlvbjpQYXJ0aXRpb24pXHJcblx0e1xyXG5cdFx0dGhpcy5fZXhwYW5kZWRQYXJ0aXRpb25zLnNwbGljZSh0aGlzLl9leHBhbmRlZFBhcnRpdGlvbnMuaW5kZXhPZihwYXJ0aXRpb24pLCAxKTtcclxuXHJcblx0XHQvL2lmIG5vIG1vcmUgcGFydGl0aW9uIHJlZmVyZW5jZXMgZm91bmQsIHJlbW92ZSBmcm9tIHBhcnRpdGlvbnMgYXJyYXlcclxuXHRcdGlmICh0aGlzLl9leHBhbmRlZFBhcnRpdGlvbnMuaW5kZXhPZihwYXJ0aXRpb24pID09IC0xKVxyXG5cdFx0XHR0aGlzLl9wYXJ0aXRpb25zLnNwbGljZSh0aGlzLl9wYXJ0aXRpb25zLmluZGV4T2YocGFydGl0aW9uKSwgMSk7XHJcblx0fVxyXG59XHJcblxyXG5leHBvcnQgPSBTY2VuZTsiXX0=